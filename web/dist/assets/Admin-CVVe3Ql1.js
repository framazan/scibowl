import{b as o,j as e}from"./vendor-react-DpsG3A-O.js";import{g as Z,b as W,p as N}from"./index-C_iWMZo5.js";import{a as U,d as E,c as Y,b as ee,u as $}from"./vendor-firebase-firestore-BRp-7IKb.js";import{i as se}from"./visualBonuses-DFQrNomD.js";import{a as G,C as B}from"./vendor-lucide-react-DoOgXp02.js";import"./vendor-abs-svg-path-DCUpb6Nw.js";import"./vendor-react-dom-D1u-fJLi.js";import"./vendor-scheduler-CoSDG3-6.js";import"./vendor-firebase-BZrYkTdu.js";import"./vendor-firebase-app-DqcDUDC6.js";import"./vendor-firebase-component-B9jxOSis.js";import"./vendor-firebase-util-CIVODmCg.js";import"./vendor-firebase-logger-CNz1B4Yj.js";import"./vendor-idb-BXWtuYvb.js";import"./vendor-firebase-app-check-Co35-rT3.js";import"./vendor-firebase-storage-D1N4MLec.js";import"./vendor-firebase-database-DcYXcGm3.js";import"./vendor-react-helmet-async-bvMvt1Ax.js";import"./vendor-react-fast-compare-BCtOC5yC.js";import"./vendor-invariant-DW3JcdOx.js";import"./vendor-shallowequal-Df9Q-7bk.js";import"./vendor-react-router-dom-D6uELkfw.js";import"./vendor-react-router-B_FrsTVh.js";import"./vendor-remix-run-router-9r-WWGj9.js";import"./vendor-mui-material-DksXbHt-.js";import"./vendor-mui-utils-B23qfrSe.js";import"./vendor-clsx-B-dksMZM.js";import"./vendor-mui-system-BndTH9qf.js";import"./vendor-mui-styled-engine-CPmDJbkS.js";import"./vendor-emotion-styled-5vLscvJp.js";import"./vendor-babel-runtime-WXw8LxeR.js";import"./vendor-emotion-serialize-B6qc6euy.js";import"./vendor-emotion-hash-WldOFDRm.js";import"./vendor-emotion-unitless-x5IvBceT.js";import"./vendor-emotion-memoize-3S_6p140.js";import"./vendor-emotion-use-insertion-effect-with-fallbacks-B--OEmuQ.js";import"./vendor-emotion-utils-BijCJQMc.js";import"./vendor-emotion-is-prop-valid-DOnQZHJ6.js";import"./vendor-emotion-react-DrbGOuDy.js";import"./vendor-hoist-non-react-statics-mDtaWys7.js";import"./vendor-react-is-CnyDuYXe.js";import"./vendor-emotion-cache-DvsOMRO7.js";import"./vendor-emotion-sheet-6IwnyhEX.js";import"./vendor-stylis-DDa9OTMq.js";import"./vendor-react-transition-group-Q1VPUTjR.js";import"./vendor-katex-DP_4UPSs.js";import"./vendor-firebase-webchannel-wrapper-QS5lB7L3.js";const te="fkLJJ2R6HbdwqoXSxrLUybZ0IdH2";function Ze({auth:w}){const l=o.useMemo(()=>Z(),[]),[T,k]=o.useState([]),[g,I]=o.useState(""),[c,_]=o.useState([]),[d,t]=o.useState(""),[y,a]=o.useState(!1),[p,n]=o.useState(null),[u,h]=o.useState(null),[C,v]=o.useState(!1),[f,j]=o.useState([]),[q,L]=o.useState(!1),[S,H]=o.useState(!0),[A,J]=o.useState(!0),[O,M]=o.useState({}),Q=!!w?.user&&w.user.uid===te,V=o.useMemo(()=>{if(!u)return[];const s=u.tossups||[],r=u.bonuses||[],i=new Map;return s.forEach((x,b)=>{const m=x.question_number||b+1;i.has(m)||i.set(m,{question_number:m,tossup:null,bonuses:[]}),i.get(m).tossup={...x,originalIndex:b}}),r.forEach((x,b)=>{const m=x.question_number||b+1;i.has(m)||i.set(m,{question_number:m,tossup:null,bonuses:[]}),i.get(m).bonuses.push({...x,originalIndex:b})}),Array.from(i.values()).sort((x,b)=>(x.question_number||0)-(b.question_number||0))},[u]);o.useEffect(()=>{(async()=>{try{a(!0),n(null);const s=await U(E(l,"meta","tournaments")),r=s.exists()?s.data()?.list||[]:[];k(r),j([...r])}catch(s){n(s)}finally{a(!1)}})()},[l]),o.useEffect(()=>{(async()=>{if(!g){_([]),t("");return}try{a(!0),n(null);const s=Y(l,"tournaments",g,"rounds"),r=await ee(s),i=[];r.forEach(x=>i.push(x.id)),i.sort((x,b)=>String(x).localeCompare(String(b))),_(i),i.length&&!d&&t(i[0])}catch(s){n(s)}finally{a(!1)}})()},[l,g]),o.useEffect(()=>{(async()=>{if(!g||!d){h(null);return}try{a(!0),n(null);const s=E(l,"tournaments",g,"rounds",d),r=await U(s);h(r.exists()?r.data():{tossups:[],bonuses:[]})}catch(s){n(s),h(null)}finally{a(!1)}})()},[l,g,d]);async function F(){if(!(!Q||!g||!d||!u))try{v(!0),n(null);const s=E(l,"tournaments",g,"rounds",d),r={};Array.isArray(u.tossups)&&(r.tossups=u.tossups),Array.isArray(u.bonuses)&&(r.bonuses=u.bonuses),await $(s,r),alert("Saved.")}catch(s){console.error(s),n(s),alert("Save failed: "+(s.message||String(s)))}finally{v(!1)}}async function K(){if(Q)try{L(!0),n(null);const s=E(l,"meta","tournaments");await $(s,{list:f}),k([...f]),alert("Tournament list saved.")}catch(s){console.error(s),n(s),alert("Save failed: "+(s.message||String(s)))}finally{L(!1)}}function R(s){s.trim()&&!f.includes(s.trim())&&j(r=>[...r,s.trim()])}function P(s){j(r=>r.filter(i=>i!==s))}function X(s,r,i,x){h(b=>{const m={...b||{}},D=Array.isArray(m[s])?[...m[s]]:[],z={...D[r]||{}};return z[i]=x,D[r]=z,m[s]=D,m})}return w?.user?Q?e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"glass p-4",children:[e.jsxs("div",{className:`flex items-center justify-between ${S?"":"mb-3"}`,children:[e.jsx("h2",{className:"font-semibold",children:"Tournament List"}),e.jsx("button",{type:"button",onClick:()=>H(!S),className:"btn btn-ghost p-1",title:S?"Expand":"Collapse",children:S?e.jsx(G,{size:16}):e.jsx(B,{size:16})})]}),!S&&e.jsxs("div",{className:"grid gap-3",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:f.map(s=>e.jsxs("div",{className:"flex items-center gap-2 bg-black/5 dark:bg-white/10 rounded px-3 py-1",children:[e.jsx("span",{children:s}),e.jsx("button",{type:"button",onClick:()=>P(s),className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",title:"Remove tournament",children:"×"})]},s))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"New tournament name",className:"flex-1 rounded border p-2 bg-white dark:bg-darkcard",onKeyDown:s=>{s.key==="Enter"&&(R(s.target.value),s.target.value="")}}),e.jsx("button",{type:"button",onClick:()=>{const s=document.querySelector('input[placeholder="New tournament name"]');s&&(R(s.value),s.value="")},className:"btn btn-ghost",children:"Add"}),e.jsx("button",{className:"btn btn-primary",onClick:K,disabled:q,children:q?"Saving...":"Save List"})]})]})]}),e.jsxs("div",{className:"glass p-4 flex flex-wrap gap-3 items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:"Tournament"}),e.jsxs("select",{className:"select",value:g,onChange:s=>I(s.target.value),children:[e.jsx("option",{value:"",children:"Select tournament…"}),T.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:"Round"}),e.jsxs("select",{className:"select",value:d,onChange:s=>t(s.target.value),disabled:!g,children:[e.jsx("option",{value:"",children:"Select round…"}),c.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsx("button",{className:"btn btn-primary",onClick:F,disabled:!u||C,children:"Save"}),u&&e.jsx("button",{type:"button",onClick:()=>{const s=!A;J(s),s&&M({})},className:"btn btn-ghost",title:A?"Expand All":"Collapse All",children:A?"Expand All":"Collapse All"}),y&&e.jsx(W,{className:"text-sm opacity-70"}),p&&e.jsx("span",{className:"text-sm text-red-600",children:String(p.message||p)})]}),u?e.jsx("div",{className:"grid gap-4 grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 transition-all duration-300 ease-in-out",children:V.map(s=>e.jsx(ae,{group:s,onChange:X,globalCollapsed:A,individualCollapsed:O[s.question_number],onToggleIndividual:r=>{M(i=>({...i,[r]:i[r]!==void 0?!i[r]:!A}))}},s.question_number))}):e.jsx("div",{className:"glass p-6",children:"Select a tournament and round."})]}):e.jsx("div",{className:"glass p-6 text-red-600",children:"Access denied. Admins only."}):e.jsx("div",{className:"glass p-6",children:"Please sign in."})}function ae({group:w,onChange:l,globalCollapsed:T,individualCollapsed:k,onToggleIndividual:g}){const{question_number:I,tossup:c,bonuses:_}=w,d=k!==void 0?k:T;return e.jsxs("div",{className:`glass transition-all duration-300 ease-in-out ${d?"p-2":"p-4 col-span-full"}`,children:[e.jsxs("div",{className:`flex items-center justify-between ${d?"":"mb-3"}`,children:[e.jsxs("h2",{className:`font-semibold transition-all duration-300 ease-in-out dark:text-white ${d?"text-sm":"text-base"}`,children:["Question #",I]}),e.jsx("button",{type:"button",onClick:()=>g(I),className:`btn btn-ghost transition-all duration-300 ease-in-out ${d?"p-0.5":"p-1"}`,title:d?"Expand":"Collapse",children:d?e.jsx(G,{size:14}):e.jsx(B,{size:16})})]}),!d&&e.jsxs("div",{className:"grid gap-4",children:[c&&e.jsxs("div",{className:"rounded border border-black/10 dark:border-white/10 p-3",children:[e.jsxs("div",{className:"text-sm opacity-70 mb-2",children:["Toss-up • ",c.category??"—"]}),e.jsxs("label",{className:"block mb-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide mb-1",children:"Question"}),e.jsx("textarea",{className:"w-full min-h-[120px] rounded border p-2 bg-white dark:bg-darkcard",value:c.question||"",onChange:t=>l("tossups",c.originalIndex,"question",t.target.value)})]}),e.jsxs("label",{className:"block mb-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide mb-1",children:"Answer"}),e.jsx("textarea",{className:"w-full min-h-[60px] rounded border p-2 bg-white dark:bg-darkcard",value:c.answer||"",onChange:t=>l("tossups",c.originalIndex,"answer",t.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"block",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide mb-1",children:"Category"}),e.jsx("input",{className:"w-full rounded border p-2 bg-white dark:bg-darkcard",value:c.category||"",onChange:t=>l("tossups",c.originalIndex,"category",t.target.value)})]}),e.jsxs("label",{className:"block",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide mb-1",children:"Question Number"}),e.jsx("input",{className:"w-full rounded border p-2 bg-white dark:bg-darkcard",value:c.question_number??"",onChange:t=>l("tossups",c.originalIndex,"question_number",t.target.value)})]})]}),N(c).length>0&&e.jsx("div",{className:"grid grid-cols-4 gap-2 mt-2",children:(()=>{const t=N(c),y=new Map(t);return["w","x","y","z"].map(a=>e.jsxs("label",{className:"block",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide mb-1",children:a.toUpperCase()}),e.jsx("input",{className:"w-full rounded border p-2 bg-white dark:bg-darkcard",value:y.get(a)||"",onChange:p=>{const n=p.target.value,h=N(c).filter(([v])=>v!==a);n.trim()&&h.push([a,n.trim()]);const C={};h.forEach(([v,f])=>C[v]=f),l("tossups",c.originalIndex,"choices",C)}})]},a))})()})]}),_.map((t,y)=>e.jsxs("div",{className:"rounded border border-black/10 dark:border-white/10 p-3",children:[e.jsxs("div",{className:"text-sm opacity-70 mb-2",children:["Bonus • ",t.category??"—"]}),e.jsxs("label",{className:"block mb-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide mb-1",children:"Question"}),e.jsx("textarea",{className:"w-full min-h-[120px] rounded border p-2 bg-white dark:bg-darkcard",value:t.question||"",onChange:a=>l("bonuses",t.originalIndex,"question",a.target.value)})]}),e.jsxs("label",{className:"block mb-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide mb-1",children:"Answer"}),e.jsx("textarea",{className:"w-full min-h-[60px] rounded border p-2 bg-white dark:bg-darkcard",value:t.answer||"",onChange:a=>l("bonuses",t.originalIndex,"answer",a.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"block",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide mb-1",children:"Category"}),e.jsx("input",{className:"w-full rounded border p-2 bg-white dark:bg-darkcard",value:t.category||"",onChange:a=>l("bonuses",t.originalIndex,"category",a.target.value)})]}),e.jsxs("label",{className:"block",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide mb-1",children:"Question Number"}),e.jsx("input",{className:"w-full rounded border p-2 bg-white dark:bg-darkcard",value:t.question_number??"",onChange:a=>l("bonuses",t.originalIndex,"question_number",a.target.value)})]})]}),N(t).length>0&&e.jsx("div",{className:"grid grid-cols-4 gap-2 mt-2",children:(()=>{const a=N(t),p=new Map(a);return["w","x","y","z"].map(n=>e.jsxs("label",{className:"block",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide mb-1",children:n.toUpperCase()}),e.jsx("input",{className:"w-full rounded border p-2 bg-white dark:bg-darkcard",value:p.get(n)||"",onChange:u=>{const h=u.target.value,v=N(t).filter(([j])=>j!==n);h.trim()&&v.push([n,h.trim()]);const f={};v.forEach(([j,q])=>f[j]=q),l("bonuses",t.originalIndex,"choices",f)}})]},n))})()}),e.jsx("div",{className:"mt-2",children:e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"accent-tint",checked:(()=>{if(t&&(t.visual!=null||t.is_visual_bonus!=null)){const a=t.visual??t.is_visual_bonus;if(a===!0)return!0;const p=String(a??"").trim().toLowerCase();return p==="true"||p==="1"||p==="yes"||p==="y"}return se(t)})(),onChange:a=>{const n=a.target.checked?"true":"";l("bonuses",t.originalIndex,"visual",n)}}),e.jsx("span",{className:"text-sm",children:"Visual bonus"})]})})]},y))]})]})}export{Ze as default};
