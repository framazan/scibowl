import{j as e,r as k,b as J}from"./vendor-react-DpsG3A-O.js";import{L as ae,g as kt,i as Ke}from"./visualBonuses-4DetGzrX.js";import{a as Nt,r as St,s as Ze,b as et,c as gt,d as wt,e as ze,f as ds,h as Ct,i as us,j as ms}from"./index-1DbH85vI.js";import{p as Ce,u as ps,c as hs,T as fs,f as xs,l as bs}from"./TournamentSelector-BqHBDHES.js";import{P as gs,M as ws,R as js,F as ys,b as jt,c as vs,d as Xe,e as Je,a as yt,f as ks,X as Ns,C as Ss,g as Cs,T as As,h as vt,i as Rs,j as Bs,A as Ls}from"./vendor-lucide-react-Lx6fY6Gz.js";import{S as Ts,p as Ms}from"./vendor-react-pdf-renderer-DfOTdHag.js";import{D as Fs,P as Is,T as Y,V as G}from"./vendor-react-pdf-primitives-B6ApagcG.js";import"./vendor-abs-svg-path-DCUpb6Nw.js";import"./vendor-katex-DP_4UPSs.js";import"./vendor-firebase-storage-D58QqkYS.js";import"./vendor-firebase-app-C29JXm3G.js";import"./vendor-firebase-component-CtBPhazS.js";import"./vendor-firebase-util-DPJAB8vN.js";import"./vendor-firebase-logger-CNz1B4Yj.js";import"./vendor-idb-BXWtuYvb.js";import"./vendor-react-dom-D1u-fJLi.js";import"./vendor-scheduler-CoSDG3-6.js";import"./vendor-firebase-ij0QPQ9d.js";import"./vendor-firebase-firestore-BGkxm74f.js";import"./vendor-firebase-webchannel-wrapper-QS5lB7L3.js";import"./vendor-mui-material-DksXbHt-.js";import"./vendor-mui-utils-B23qfrSe.js";import"./vendor-clsx-B-dksMZM.js";import"./vendor-mui-system-BndTH9qf.js";import"./vendor-mui-styled-engine-CPmDJbkS.js";import"./vendor-emotion-styled-5vLscvJp.js";import"./vendor-babel-runtime-WXw8LxeR.js";import"./vendor-emotion-serialize-B6qc6euy.js";import"./vendor-emotion-hash-WldOFDRm.js";import"./vendor-emotion-unitless-x5IvBceT.js";import"./vendor-emotion-memoize-3S_6p140.js";import"./vendor-emotion-use-insertion-effect-with-fallbacks-B--OEmuQ.js";import"./vendor-emotion-utils-BijCJQMc.js";import"./vendor-emotion-is-prop-valid-DOnQZHJ6.js";import"./vendor-emotion-react-DrbGOuDy.js";import"./vendor-hoist-non-react-statics-mDtaWys7.js";import"./vendor-react-is-CnyDuYXe.js";import"./vendor-emotion-cache-DvsOMRO7.js";import"./vendor-emotion-sheet-6IwnyhEX.js";import"./vendor-stylis-DDa9OTMq.js";import"./vendor-react-transition-group-Q1VPUTjR.js";import"./vendor-react-router-dom-D-i9eXTo.js";import"./vendor-react-router-D4SgS1v_.js";import"./vendor-remix-run-router-9r-WWGj9.js";import"./vendor-react-helmet-async-bvMvt1Ax.js";import"./vendor-react-fast-compare-BCtOC5yC.js";import"./vendor-invariant-DW3JcdOx.js";import"./vendor-shallowequal-Df9Q-7bk.js";import"./vendor-queue-IZnSDwnG.js";import"./vendor-inherits-BICa84dG.js";import"./vendor-events-DQ172AOg.js";import"./vendor-react-pdf-font-ByacAZ2x.js";import"./vendor-cross-fetch-DvOI2u39.js";import"./vendor-fontkit-5mDwoQ7O.js";import"./vendor-restructure-DwIbRzqP.js";import"./vendor-swc-helpers-DIxjOVuh.js";import"./vendor-fast-deep-equal-DtIvihjZ.js";import"./vendor-unicode-properties-BbL32wKl.js";import"./vendor-base64-js-BJmSPyJr.js";import"./vendor-unicode-trie-rSh8NucD.js";import"./vendor-tiny-inflate-BmeP50H3.js";import"./vendor-dfa-DFRa2UL2.js";import"./vendor-clone-DniFCc4t.js";import"./vendor-brotli-CUuIRSoC.js";import"./vendor-tslib-kHcLnhpD.js";import"./vendor-react-pdf-render-DYs5yDRr.js";import"./vendor-react-pdf-fns-DIcDsgsD.js";import"./vendor-parse-svg-path-Bi0KIs1g.js";import"./vendor-normalize-svg-path-CFWHe3yZ.js";import"./vendor-svg-arc-to-cubic-bezier-DEq50KMd.js";import"./vendor-color-string-BKSasjlw.js";import"./vendor-color-name-Dju3oUBS.js";import"./vendor-simple-swizzle-3gX0Onlb.js";import"./vendor-is-arrayish-DyGeW-O8.js";import"./vendor-react-pdf-pdfkit-CgWEQEi-.js";import"./vendor-pako-CNe1bWpJ.js";import"./vendor-crypto-js-C9XMI5TL.js";import"./vendor-jay-peg-DnV82Tak.js";import"./vendor-react-pdf-png-js-D_OjzuBh.js";import"./vendor-react-pdf-layout-CVT9JNgr.js";import"./vendor-react-pdf-stylesheet-B2kC1IpU.js";import"./vendor-postcss-value-parser-DOXmp8r9.js";import"./vendor-hsl-to-hex-CDkcI7Vq.js";import"./vendor-hsl-to-rgb-for-reals-jL61FXS_.js";import"./vendor-media-engine-BWjc9dwl.js";import"./vendor-react-pdf-textkit-R3VqYnwu.js";import"./vendor-bidi-js-DLACMwmw.js";import"./vendor-hyphen-B2aENclZ.js";import"./vendor-yoga-layout-nAHjiEuJ.js";import"./vendor-react-pdf-image-BJ1YGwqv.js";import"./vendor-object-assign-Dm9xdUEz.js";function Ds({selectedTournaments:n,tournaments:x,roundRanges:p,setRoundRanges:g,roundsByTournament:F,globalNumericRoundMax:T}){return e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold mb-2 flex items-center justify-between gap-2",children:[e.jsx("span",{children:"Round ranges"}),e.jsx("button",{type:"button",className:`chip px-2 py-1 ${n.length===0?"opacity-50 cursor-not-allowed":""}`,"aria-label":"Add round range",title:"Add range",disabled:n.length===0,onClick:()=>{if(n.length===0)return;const f=n.length===1?n[0]:"";g([...p,{from:1,to:3,tournament:f}])},children:e.jsx(gs,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[p.length===0&&e.jsx("div",{className:"text-xs italic text-black/70 dark:text-white/60 px-1",children:"All rounds included (no range filters). Add a range to limit rounds."}),p.map((b,f)=>{const C=n.length>0?n:x,$=n.length===1,E=n.length===0&&x.length===1,I=$||E||C.length===1,u=I&&(n[0]||C[0])||"",R=I?u:b.tournament||"",A=I?u:b.tournament||null,v=A?F[A]??[]:[],_=v.length>0&&v.every(c=>/^\d+$/.test(c));return e.jsxs("div",{className:"round-range-row w-full overflow-hidden",children:[e.jsx("div",{className:"select-wrapper flex-1 min-w-0",children:e.jsx("select",{className:"sb-select-range rounded-lg border px-3 py-1.5 shadow-none focus:outline-none "+(I?"bg-gray-100 dark:bg-white/10 text-gray-500 dark:text-gray-400 border-gray-300 dark:border-white/20 cursor-not-allowed pointer-events-none":"bg-white text-black border-black/10 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20"),value:R,disabled:I,onChange:c=>{if(I)return;const S=[...p];S[f]={...S[f],tournament:c.target.value},g(S)},title:R||"All Tournaments",children:I?e.jsx("option",{value:u,children:u}):n.length===0?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"",children:"All Tournaments"}),C.map(c=>e.jsx("option",{value:c,children:c},c))]}):C.map(c=>e.jsx("option",{value:c,children:c},c))})}),A?_?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"select-wrapper sb-select-round",children:e.jsx("select",{className:"rounded-lg border border-black/10 bg-white text-black px-2 py-1 shadow-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20 shrink-0 sb-select-round",value:b.from!=null&&v.includes(String(b.from))?String(b.from):v[0]??"",onChange:c=>{const S=[...p];let q=Number(c.target.value),M=Number(S[f].to);(!Number.isFinite(M)||M<q)&&(M=q),S[f]={...S[f],from:q,to:M,dFrom:void 0,dTo:void 0},g(S)},children:v.map(c=>e.jsx("option",{value:c,children:c},c))})}),e.jsx("span",{className:"text-black dark:text-white",children:"to"}),e.jsx("div",{className:"select-wrapper sb-select-round",children:e.jsx("select",{className:"rounded-lg border border-black/10 bg-white text-black px-2 py-1 shadow-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20 shrink-0 sb-select-round",value:b.to!=null&&v.includes(String(b.to))?String(b.to):v[v.length-1]??"",onChange:c=>{const S=[...p];let q=Number(c.target.value),M=Number(S[f].from);(!Number.isFinite(M)||M>q)&&(M=q),S[f]={...S[f],from:M,to:q,dFrom:void 0,dTo:void 0},g(S)},children:v.map(c=>e.jsx("option",{value:c,children:c},c))})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"select-wrapper sb-select-round",children:e.jsx("select",{className:"rounded-lg border border-black/10 bg-white text-black px-2 py-1 shadow-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20 shrink-0 sb-select-round",value:b.dFrom??v[0]??"",onChange:c=>{const S=[...p],q=c.target.value;let M=S[f].dTo;if(M){const a=v.indexOf(q),o=v.indexOf(M);a!==-1&&o!==-1&&a>o&&(M=q)}S[f]={...S[f],dFrom:q,dTo:M},g(S)},children:v.map(c=>e.jsx("option",{value:c,children:c},c))})}),e.jsx("span",{className:"text-black dark:text-white",children:"to"}),e.jsx("div",{className:"select-wrapper sb-select-round",children:e.jsx("select",{className:"rounded-lg border border-black/10 bg-white text-black px-2 py-1 shadow-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20 shrink-0 sb-select-round",value:b.dTo??v[v.length-1]??"",onChange:c=>{const S=[...p],q=c.target.value;let M=S[f].dFrom;if(M){const a=v.indexOf(M),o=v.indexOf(q);a!==-1&&o!==-1&&a>o&&(M=q)}S[f]={...S[f],dFrom:M??q,dTo:q},g(S)},children:v.map(c=>e.jsx("option",{value:c,children:c},c))})})]}):(()=>{const c=Array.from({length:T},(M,a)=>a+1),S=b.from!=null&&b.from>=1?b.from:c[0],q=b.to!=null&&b.to>=S||b.to!=null?b.to:c[c.length-1];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"select-wrapper sb-select-round",children:e.jsx("select",{className:"rounded-lg border border-black/10 bg-white text-black px-2 py-1 shadow-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20 shrink-0 sb-select-round",value:String(S),onChange:M=>{const a=[...p];let o=Number(M.target.value),w=Number(a[f].to);(!Number.isFinite(w)||w<o)&&(w=o),a[f]={...a[f],from:o,to:w,dFrom:void 0,dTo:void 0},g(a)},children:c.map(M=>e.jsx("option",{value:M,children:M},M))})}),e.jsx("span",{className:"text-black dark:text-white",children:"to"}),e.jsx("div",{className:"select-wrapper sb-select-round",children:e.jsx("select",{className:"rounded-lg border border-black/10 bg-white text-black px-2 py-1 shadow-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20 shrink-0 sb-select-round",value:String(q),onChange:M=>{const a=[...p];let o=Number(M.target.value),w=Number(a[f].from);(!Number.isFinite(w)||w>o)&&(w=o),a[f]={...a[f],from:w,to:o,dFrom:void 0,dTo:void 0},g(a)},children:c.map(M=>e.jsx("option",{value:M,children:M},M))})})]})})(),e.jsx("button",{className:"chip shrink-0","aria-label":"Remove round range",title:"Remove range",onClick:()=>g(p.filter((c,S)=>S!==f)),children:e.jsx(ws,{className:"h-4 w-4"})})]},f)})]})]})}function $s({auth:n,roundsIndex:x,setRoundsIndex:p,roundFolders:g,setRoundFolders:F,loadingUserRounds:T,refresh:b,selectedExcludeRoundIds:f,setSelectedExcludeRoundIds:C,foldersOpen:$,setFoldersOpen:E,handleExcludeRoundToggle:I,pushToast:u,setManagerSelection:R,setShowRoundsManager:A,setFolderDeleteTarget:v,setDeleteTarget:_,onViewRound:c}){return n?.user?e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold mb-2 flex items-center gap-2",children:["Exclude rounds",e.jsx("button",{className:"chip px-2 py-0.5 text-xs",onClick:()=>C([]),children:"Clear"}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs inline-flex items-center","aria-label":"Refresh rounds & folders",title:"Refresh",onClick:b,children:e.jsx(js,{size:14})}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs inline-flex items-center","aria-label":"Create folder",title:"Create folder",onClick:async()=>{if(!n?.user)return;const S=window.prompt("Folder name");if(S==null)return;const q=S.trim();if(!q){u("Folder name cannot be empty.","error");return}const M=q.toLowerCase();if(g.some(a=>a.toLowerCase()===M)){u("Folder already exists.","error");return}try{await Nt(n.user.uid,q),F(a=>[...a,q].sort((o,w)=>o.localeCompare(w))),E(a=>{const o=new Set(a);return o.add(q),o}),u("Folder created.","success")}catch(a){u(a.message||"Failed to create folder.","error")}},children:e.jsx(ys,{size:14})}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs inline-flex items-center","aria-label":"Open rounds manager",title:"Manage saved rounds",onClick:()=>{R(new Set(f)),A(!0)},children:e.jsx(jt,{size:14})})]}),T?e.jsx("div",{className:"text-sm opacity-70",children:"Loading your rounds…"}):x.length===0?e.jsx("div",{className:"text-sm opacity-70",children:"No saved rounds yet."}):e.jsx("div",{className:"border rounded-lg max-h-64 overflow-y-auto overflow-x-hidden divide-y divide-black/10 dark:divide-white/10",children:(()=>{const S=[],q=g.sort((o,w)=>o.localeCompare(w)).map(o=>{const w=$.has(o),B=x.filter(m=>m.folder===o);return e.jsxs("div",{className:"select-none",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 hover:bg-black/5 dark:hover:bg-white/10 cursor-pointer",onClick:()=>E(m=>{const h=new Set(m);return h.has(o)?h.delete(o):h.add(o),h}),onDragOver:m=>{m.preventDefault(),m.dataTransfer.dropEffect="move"},onDrop:async m=>{if(m.preventDefault(),!n?.user)return;const h=m.dataTransfer.getData("text/round-ids");if(!h)return;const L=h.split(",").filter(Boolean);for(const N of L)try{await Ze(n.user.uid,N,o)}catch{}p(N=>N.map(j=>L.includes(j.id)?{...j,folder:o}:j)),u(`Moved ${L.length} round(s) to ${o}.`,"success")},children:[e.jsx("button",{type:"button",className:"p-0.5 rounded hover:bg-black/10 dark:hover:bg-white/10","aria-label":w?"Collapse folder":"Expand folder",children:w?e.jsx(jt,{size:15}):e.jsx(vs,{size:15})}),e.jsx("input",{type:"checkbox",className:"accent-tint",ref:m=>{if(!m)return;const h=x.filter(j=>j.folder===o),L=h.length,N=h.filter(j=>f.includes(j.id)).length;m.indeterminate=N>0&&N<L},checked:(()=>{const m=x.filter(h=>h.folder===o);return m.length>0&&m.every(h=>f.includes(h.id))})(),onChange:()=>{const h=x.filter(L=>L.folder===o).map(L=>L.id);C(L=>{const N=new Set(L);return h.every(X=>N.has(X))?h.forEach(X=>N.delete(X)):h.forEach(X=>N.add(X)),Array.from(N)})},"aria-label":`Select all rounds in folder ${o}`,title:"Select all in folder"}),e.jsxs("span",{className:"font-medium flex-1 truncate",title:o,children:[o," ",e.jsxs("span",{className:"opacity-60 text-xs",children:["(",B.length,")"]})]}),e.jsx("button",{type:"button",className:"chip px-2 py-0.5 text-[11px] inline-flex items-center","aria-label":"Rename folder",title:"Rename folder",onClick:m=>{m.stopPropagation();const h=window.prompt("Rename folder",o);if(h==null)return;const L=h.trim();if(!(!L||L===o)){if(g.some(N=>N.toLowerCase()===L.toLowerCase())){u("Folder name already exists.","error");return}(async()=>{try{await St(n.user.uid,o,L),F(N=>N.map(j=>j===o?L:j)),p(N=>N.map(j=>j.folder===o?{...j,folder:L}:j)),E(N=>{const j=new Set(N);return j.has(o)&&(j.delete(o),j.add(L)),j}),u("Folder renamed.","success")}catch(N){u(N.message||"Failed to rename folder.","error")}})()}},children:e.jsx(Xe,{size:13})}),e.jsx("button",{type:"button",className:"chip px-2 py-0.5 text-[11px] inline-flex items-center text-red-600 border-red-200 hover:bg-red-50 dark:text-red-300 dark:border-red-700 dark:hover:bg-red-900/30","aria-label":"Delete folder and its rounds",title:"Delete folder",onClick:m=>{m.stopPropagation();const h=x.filter(L=>L.folder===o);v({name:o,count:h.length,roundIds:h.map(L=>L.id)})},children:e.jsx(Je,{className:"h-3.5 w-3.5"})})]}),w&&e.jsx("ul",{className:"divide-y divide-black/5 dark:divide-white/10",role:"group",children:B.map(m=>{S.push(m.id);const h=m.createdAt?.seconds?new Date(m.createdAt.seconds*1e3):null,L=h?`${h.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})} on ${h.toLocaleDateString()}`:m.title||"Untitled",N=f.includes(m.id);return e.jsx("li",{draggable:!0,onDragStart:j=>{j.dataTransfer.effectAllowed="move";const X=f.includes(m.id)?f:[m.id];j.dataTransfer.setData("text/round-ids",X.join(","))},children:e.jsxs("div",{className:`group flex items-center justify-between gap-2 pl-10 pr-3 py-2 ${N?"bg-tint/10 ring-1 ring-tint":""}`,children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer flex-1 min-w-0",title:m.title||`Round ${L}`,children:[e.jsx("input",{type:"checkbox",checked:N,onChange:j=>I(j,m.id)}),e.jsx("span",{className:"block whitespace-normal overflow-visible group-hover:truncate group-focus-within:truncate",children:m.title||`Round ${L}`})]}),e.jsx("button",{type:"button",className:"chip px-2 py-0.5 text-xs shrink-0 opacity-0 group-hover:opacity-100 focus:opacity-100 inline-flex items-center","aria-label":"View round",title:"View round",onClick:j=>{j.stopPropagation(),c?.(m)},children:e.jsx(yt,{size:13})}),e.jsx("button",{type:"button",className:"chip px-2 py-0.5 text-xs shrink-0 opacity-0 group-hover:opacity-100 focus:opacity-100 inline-flex items-center","aria-label":"Rename round",title:"Rename round",onClick:async j=>{j.stopPropagation();const X=m.title||`Round ${L}`,K=window.prompt("Rename round",X);if(K==null)return;const Z=K.trim();if(!Z||Z===X)return;if(x.some(oe=>oe.id!==m.id&&(oe.title||"").trim().toLowerCase()===Z.toLowerCase())){u("Another round already has that title.","error");return}try{await et(n.user.uid,m.id,Z),p(oe=>oe.map(ce=>ce.id===m.id?{...ce,title:Z}:ce))}catch(oe){window.alert?.(oe?.message||"Failed to rename round.")}},children:e.jsx(Xe,{size:13})}),e.jsx("button",{type:"button",className:"chip px-2 py-0.5 text-xs shrink-0 text-red-600 border-red-200 hover:bg-red-50 dark:text-red-300 dark:border-red-700 dark:hover:bg-red-900/30",title:"Delete round",onClick:j=>{j.stopPropagation(),_(m)},children:e.jsx(Je,{className:"h-3.5 w-3.5"})})]})},m.id)})})]},o)}),M=x.filter(o=>!o.folder),a=e.jsxs("div",{className:"select-none",onDragOver:o=>{o.preventDefault(),o.dataTransfer.dropEffect="move"},onDrop:async o=>{if(o.preventDefault(),!n?.user)return;const w=o.dataTransfer.getData("text/round-ids");if(!w)return;const B=w.split(",").filter(Boolean);for(const m of B)try{await Ze(n.user.uid,m,"")}catch{}p(m=>m.map(h=>B.includes(h.id)?(()=>{const{folder:L,...N}=h;return N})():h)),u(`Cleared folder for ${B.length} round(s).`,"success")},children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-black/5 dark:bg-white/10 font-medium",children:["Unfiled ",e.jsxs("span",{className:"opacity-60 text-xs",children:["(",M.length,")"]})]}),e.jsx("ul",{className:"divide-y divide-black/5 dark:divide-white/10",role:"group",children:M.map(o=>{S.push(o.id);const w=o.createdAt?.seconds?new Date(o.createdAt.seconds*1e3):null,B=w?`${w.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})} on ${w.toLocaleDateString()}`:o.title||"Untitled",m=f.includes(o.id);return e.jsx("li",{draggable:!0,onDragStart:h=>{h.dataTransfer.effectAllowed="move";const L=f.includes(o.id)?f:[o.id];h.dataTransfer.setData("text/round-ids",L.join(","))},children:e.jsxs("div",{className:`group flex items-center justify-between gap-2 pl-6 pr-3 py-2 ${m?"bg-tint/10 ring-1 ring-tint":""}`,children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer flex-1 min-w-0",title:o.title||`Round ${B}`,children:[e.jsx("input",{type:"checkbox",checked:m,onChange:h=>I(h,o.id)}),e.jsx("span",{className:"block whitespace-normal overflow-visible group-hover:truncate group-focus-within:truncate",children:o.title||`Round ${B}`})]}),e.jsx("button",{type:"button",className:"chip px-2 py-0.5 text-xs shrink-0 opacity-0 group-hover:opacity-100 focus:opacity-100 inline-flex items-center","aria-label":"View round",title:"View round",onClick:h=>{h.stopPropagation(),c?.(o)},children:e.jsx(yt,{size:13})}),e.jsx("button",{type:"button",className:"chip px-2 py-0.5 text-xs shrink-0 opacity-0 group-hover:opacity-100 focus:opacity-100 inline-flex items-center","aria-label":"Rename round",title:"Rename round",onClick:async h=>{h.stopPropagation();const L=o.title||`Round ${B}`,N=window.prompt("Rename round",L);if(N==null)return;const j=N.trim();if(!j||j===L)return;if(x.some(K=>K.id!==o.id&&(K.title||"").trim().toLowerCase()===j.toLowerCase())){u("Another round already has that title.","error");return}try{await et(n.user.uid,o.id,j),p(K=>K.map(Z=>Z.id===o.id?{...Z,title:j}:Z))}catch(K){window.alert?.(K?.message||"Failed to rename round.")}},children:e.jsx(Xe,{size:13})}),e.jsx("button",{type:"button",className:"chip px-2 py-0.5 text-xs shrink-0 text-red-600 border-red-200 hover:bg-red-50 dark:text-red-300 dark:border-red-700 dark:hover:bg-red-900/30",title:"Delete round",onClick:h=>{h.stopPropagation(),_(o)},children:e.jsx(Je,{className:"h-3.5 w-3.5"})})]})},o.id)})})]},"__unfiled__");return e.jsxs(e.Fragment,{children:[q,a]})})()})]}):null}function Es({auth:n,pushToast:x}){const[p,g]=k.useState([]),[F,T]=k.useState(!1),[b,f]=k.useState([]),[C,$]=k.useState(()=>new Set),[E,I]=k.useState([]),u=k.useRef(new Map);k.useEffect(()=>{let a=!1;async function o(){if(!n?.user){g([]),u.current.clear(),f([]);return}T(!0);try{const w=await gt(n.user.uid).catch(()=>[]);a||g(w);const B=await wt(n.user.uid).catch(()=>[]);a||f(B)}finally{a||T(!1)}}return o(),()=>{a=!0}},[n?.user?.uid]);async function R(a,o){a?.nativeEvent?.shiftKey||a?.shiftKey;const w=E.includes(o),B=!w;if(I(m=>{const h=new Set(m);return w?h.delete(o):h.add(o),Array.from(h)}),B&&n?.user&&!u.current.has(o))try{const m=await Ct(n.user.uid,o);m&&u.current.set(o,m)}catch{}}async function A(){if(n?.user){T(!0);try{g(await gt(n.user.uid,{force:!0})),f(await wt(n.user.uid,{force:!0}))}finally{T(!1)}}}async function v(a){if(!n?.user)return;if(!a?.trim()){x?.("Folder name cannot be empty.","error");return}const o=a.toLowerCase();if(b.some(w=>w.toLowerCase()===o)){x?.("Folder already exists.","error");return}await Nt(n.user.uid,a),f(w=>[...w,a].sort((B,m)=>B.localeCompare(m))),$(w=>{const B=new Set(w);return B.add(a),B}),x?.("Folder created.","success")}async function _(a,o){if(!n?.user)return;const w=o.trim();if(!(!w||w===a)){if(b.some(B=>B.toLowerCase()===w.toLowerCase())){x?.("Folder name already exists.","error");return}await St(n.user.uid,a,w),f(B=>B.map(m=>m===a?w:m)),g(B=>B.map(m=>m.folder===a?{...m,folder:w}:m)),$(B=>{const m=new Set(B);return m.has(a)&&(m.delete(a),m.add(w)),m}),x?.("Folder renamed.","success")}}async function c(a,o){if(n?.user){for(const w of a)try{await Ze(n.user.uid,w,o)}catch{}g(w=>w.map(B=>a.includes(B.id)?{...B,folder:o}:B)),x?.(o?`Moved ${a.length} round(s) to ${o}.`:`Cleared folder for ${a.length} round(s).`,"success")}}async function S(a,o){if(!n?.user)return;if(p.some(m=>m.id!==a.id&&(m.title||"").trim().toLowerCase()===o.toLowerCase())){x?.("Another round already has that title.","error");return}await et(n.user.uid,a.id,o),g(m=>m.map(h=>h.id===a.id?{...h,title:o}:h));const B=u.current.get(a.id);B&&u.current.set(a.id,{...B,title:o})}async function q(a){n?.user&&(await ze(n.user.uid,a),g(o=>o.filter(w=>w.id!==a)),I(o=>o.filter(w=>w!==a)),u.current.delete(a),x?.("Round deleted.","error"))}async function M(a,o=[]){if(n?.user){for(const w of o)try{await ze(n.user.uid,w)}catch{}try{await ds(n.user.uid,a)}catch{}g(w=>w.filter(B=>!o.includes(B.id))),I(w=>w.filter(B=>!o.includes(B))),f(w=>w.filter(B=>B!==a)),x?.("Folder and rounds deleted.","error")}}return{roundsIndex:p,setRoundsIndex:g,loadingUserRounds:F,roundFolders:b,setRoundFolders:f,foldersOpen:C,setFoldersOpen:$,selectedExcludeRoundIds:E,setSelectedExcludeRoundIds:I,excludeDetailCache:u,handleExcludeRoundToggle:R,refresh:A,createFolder:v,renameFolder:_,moveRoundsToFolder:c,renameRound:S,deleteRoundPermanently:q,deleteFolderAndRounds:M}}const z=Ts.create({page:{padding:16,fontSize:8,fontFamily:"Times-Roman"},title:{textAlign:"center",fontSize:11,fontWeight:"bold",marginBottom:4},legendBlock:{marginBottom:4},tiny:{fontSize:6.5},footer:{marginTop:4,textAlign:"center",fontSize:6.5},tablesWrap:{flexDirection:"row"},teamACol:{flex:1.1,marginRight:4},teamBCol:{flex:.9,marginLeft:4},headerRow:{flexDirection:"row",backgroundColor:"#eee"},bodyRow:{flexDirection:"row"},cell:{borderWidth:.5,borderColor:"#000",paddingVertical:1.5,paddingHorizontal:2,justifyContent:"center",textAlign:"center",minHeight:12},headCellText:{fontWeight:"bold",fontSize:6.5},qnCell:{fontSize:6.5,fontWeight:"bold"},subjCell:{fontSize:6.5},attempt:{fontSize:6.5,fontWeight:"bold"},nameHead:{fontSize:6,fontWeight:"bold"},spacer:{width:4}});function Ps(n){return[4,7,6,...Array(n).fill(9),7,6,7]}function zs(n){return[...Array(n).fill(9),7,6,7]}function _s({playerLabels:n=[],cols:x}){const p=["Q","Subj","Type",...n,"Bonus","Pen","Score"];return e.jsx(G,{style:z.headerRow,children:p.map((g,F)=>{const T=x[F];return e.jsx(G,{style:[z.cell,{flexGrow:T,flexBasis:T}],children:e.jsx(Y,{style:z.headCellText,children:g})},F)})})}function qs({playerLabels:n=[],cols:x}){const p=[...n,"Bonus","Pen","Score"];return e.jsx(G,{style:z.headerRow,children:p.map((g,F)=>{const T=x[F];return e.jsx(G,{style:[z.cell,{flexGrow:T,flexBasis:T}],children:e.jsx(Y,{style:z.headCellText,children:g})},F)})})}function Us({r:n,seatPlayers:x,outRows:p,cols:g}){if(!n||n.pad)return e.jsx(G,{style:z.bodyRow,children:g.map((R,A)=>e.jsx(G,{style:[z.cell,{flexGrow:R,flexBasis:R}],children:A===0&&n?.index?e.jsx(Y,{style:z.qnCell,children:n.index}):null},A))});const F=(n.attempts||[]).filter(R=>R&&R.playerId!=null);function T(R){if(!R)return"";const A=F.filter(_=>_.playerId===R.id);if(!A.length)return"";const v=A[A.length-1];return v.result==="correct"?v.interrupt?"CI":"C":v.result==="incorrect"?v.interrupt?"II":"I":""}const b=n.bonusA,f=n.penaltyA,C=n.cumA;function $(R,A){let v=T(R);return!v&&R&&p[R.id]===n.index&&(v="out"),e.jsx(G,{style:[z.cell,{flexGrow:A,flexBasis:A}],children:e.jsx(Y,{style:z.attempt,children:v})},R?R.id:Math.random())}const E=g.slice(0,3),I=g.slice(3,3+x.length),u=g.slice(3+x.length);return e.jsxs(G,{style:z.bodyRow,children:[e.jsx(G,{style:[z.cell,{flexGrow:E[0],flexBasis:E[0]}],children:e.jsx(Y,{style:z.qnCell,children:n.index})}),e.jsx(G,{style:[z.cell,{flexGrow:E[1],flexBasis:E[1]}],children:e.jsx(Y,{style:z.subjCell,children:n.subject})}),e.jsx(G,{style:[z.cell,{flexGrow:E[2],flexBasis:E[2]}],children:e.jsx(Y,{style:z.subjCell,children:n.type})}),x.map((R,A)=>$(R,I[A])),e.jsx(G,{style:[z.cell,{flexGrow:u[0],flexBasis:u[0]}],children:e.jsx(Y,{children:b?String(b):""})}),e.jsx(G,{style:[z.cell,{flexGrow:u[1],flexBasis:u[1]}],children:e.jsx(Y,{children:f?String(f):""})}),e.jsx(G,{style:[z.cell,{flexGrow:u[2],flexBasis:u[2]}],children:e.jsx(Y,{children:C!=null?String(C):""})})]})}function Os({r:n,seatPlayers:x,outRows:p,cols:g}){if(!n||n.pad)return e.jsx(G,{style:z.bodyRow,children:g.map((u,R)=>e.jsx(G,{style:[z.cell,{flexGrow:u,flexBasis:u}]},R))});const F=(n.attempts||[]).filter(u=>u&&u.playerId!=null);function T(u){if(!u)return"";const R=F.filter(v=>v.playerId===u.id);if(!R.length)return"";const A=R[R.length-1];return A.result==="correct"?A.interrupt?"CI":"C":A.result==="incorrect"?A.interrupt?"II":"I":""}const b=n.bonusB,f=n.penaltyB,C=n.cumB;function $(u,R){let A=T(u);return!A&&u&&p[u.id]===n.index&&(A="out"),e.jsx(G,{style:[z.cell,{flexGrow:R,flexBasis:R}],children:e.jsx(Y,{style:z.attempt,children:A})},u?u.id:Math.random())}const E=g.slice(0,x.length),I=g.slice(x.length);return e.jsxs(G,{style:z.bodyRow,children:[x.map((u,R)=>$(u,E[R])),e.jsx(G,{style:[z.cell,{flexGrow:I[0],flexBasis:I[0]}],children:e.jsx(Y,{children:b?String(b):""})}),e.jsx(G,{style:[z.cell,{flexGrow:I[1],flexBasis:I[1]}],children:e.jsx(Y,{children:f?String(f):""})}),e.jsx(G,{style:[z.cell,{flexGrow:I[2],flexBasis:I[2]}],children:e.jsx(Y,{children:C!=null?String(C):""})})]})}function Gs({sheetRows:n=[],players:x=[],metadata:p={}}){const g=x.filter(a=>a.team==="A").sort((a,o)=>(a.seat||0)-(o.seat||0)),F=x.filter(a=>a.team==="B").sort((a,o)=>(a.seat||0)-(o.seat||0)),T=g.filter(a=>(a.seat||0)>=1&&(a.seat||0)<=4).sort((a,o)=>a.seat-o.seat),b=F.filter(a=>(a.seat||0)>=1&&(a.seat||0)<=4).sort((a,o)=>a.seat-o.seat),f=g.find(a=>(a.seat||0)===5&&a.status==="active"),C=F.find(a=>(a.seat||0)===5&&a.status==="active"),$=f?[...T,f]:[...T],E=C?[...b,C]:[...b],I=(a,o)=>a&&a.name?Vs(a.name,9):o,u=$.map((a,o)=>I(a,["Captain","P1","P2","P3","Sub"][o]||"P"+(o+1))),R=E.map((a,o)=>I(a,["Captain","P1","P2","P3","Sub"][o]||"P"+(o+1))),A=Ps($.length),v=zs(E.length);function _(a,o){if(!a.length)return{};const w={};for(const m of n){if(!m||m.pad)continue;const h=m.index;for(const L of m.attempts||[])!L||L.team!==o||a.includes(L.playerId)&&(w[L.playerId]=h)}const B={};for(const m of a){const h=w[m];h&&h<25&&(B[m]=h+1)}return B}const c=g.filter(a=>a.status==="replaced").map(a=>a.id),S=F.filter(a=>a.status==="replaced").map(a=>a.id),q=_(c,"A"),M=_(S,"B");return e.jsx(Fs,{children:e.jsxs(Is,{size:"LETTER",style:z.page,orientation:"landscape",children:[e.jsx(Y,{style:z.title,children:"Coaches Scoresheet"}),e.jsxs(G,{style:z.legendBlock,children:[e.jsx(Y,{style:z.tiny,children:"Subjects: E ESS | C Chemistry | B Bio | M Math | P Physics | EN Energy"}),e.jsx(Y,{style:z.tiny,children:"Types: MC Multiple Choice | SA Short Answer | Markers: C / CI / I / II | 'out' = player substituted"})]}),e.jsxs(G,{style:z.tablesWrap,children:[e.jsxs(G,{style:z.teamACol,children:[e.jsx(_s,{playerLabels:u,cols:A}),n.slice(0,25).map(a=>e.jsx(Us,{r:a,seatPlayers:$,outRows:q,cols:A},"A-"+a.index))]}),e.jsxs(G,{style:z.teamBCol,children:[e.jsx(qs,{playerLabels:R,cols:v}),n.slice(0,25).map(a=>e.jsx(Os,{r:a,seatPlayers:E,outRows:M,cols:v},"B-"+a.index))]})]}),e.jsxs(Y,{style:z.footer,children:["Generated ",p.generatedAt||""," | scibowl.app"]})]})})}function Vs(n,x){return n?n.length<=x?n:n.slice(0,x-1)+"…":""}function Ws({pair:n,index:x,scorekeeping:p=!1,currentIndex:g=0,tossupResults:F=[],showBonusContent:T,questionRef:b}){const f=n.tossup?Ce(n.tossup):[],C=n.bonus?Ce(n.bonus):[],$=!p||x===g,[E,I]=J.useState(null),[u,R]=J.useState(!1);return J.useEffect(()=>{let A=!1;async function v(){I(null);const _=n?.bonus;if(!_||!(_.is_visual_bonus===!0||String(_.visual||"").toLowerCase()==="true"))return;const S=await kt({tournament:_.tournament,round:_.round,question_number:_.question_number}).catch(()=>null);A||I(S)}return T&&v(),()=>{A=!0}},[n?.bonus?.tournament,n?.bonus?.round,n?.bonus?.question_number,T]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:b,className:`glass p-6 space-y-4 min-w-0 relative ${p&&!$?"opacity-50 blur-sm select-none pointer-events-none":""}`,children:[p&&x===g&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 rounded-lg pointer-events-none border-2 border-green-500 shadow-[0_0_0_3px_rgba(34,197,94,0.35)]",style:{boxShadow:"0 0 0 3px rgba(34,197,94,0.35), 0 4px 12px -2px rgba(16,185,129,0.5)"}}),e.jsx("div",{className:"absolute -top-3 left-4 px-3 py-1 bg-green-600 text-white rounded-full text-[11px] font-semibold shadow-lg",children:"Active"})]}),n.tossup&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm text-black/60 dark:text-white/80 mb-2",children:[e.jsx("span",{className:"font-semibold",children:String(n.tossup.tournament).toUpperCase()})," • ","Round ",n.tossup.round??"—"," • ",n.tossup.category,n.tossup.question_number!=null&&e.jsxs(e.Fragment,{children:[" • ","Q",n.tossup.question_number]}),e.jsx("span",{className:"ml-2 inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold tracking-wide border "+(f.length>0?"bg-blue-50 text-blue-700 border-blue-200 dark:bg-blue-900/20 dark:text-blue-200 dark:border-blue-700":"bg-purple-50 text-purple-700 border-purple-200 dark:bg-purple-900/20 dark:text-purple-200 dark:border-purple-700"),children:f.length>0?"MULTIPLE CHOICE":"SHORT ANSWER"})]}),e.jsxs("div",{className:"font-medium mb-2",children:["Toss-up ",x+1]}),e.jsx("div",{className:"mb-3 whitespace-pre-line",children:e.jsx(ae,{children:n.tossup.question})}),f.length>0&&e.jsx("div",{className:"mb-3",children:f.map(([A,v])=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:`gen-tossup-${x}`,className:"accent-tint",disabled:!0}),e.jsxs("span",{children:[A.toUpperCase(),") ",e.jsx(ae,{children:v})]})]},A))}),e.jsxs("div",{className:"text-sm text-black/70 dark:text-white/80",children:[e.jsx("span",{className:"uppercase text-black/60 dark:text-white/60",children:"Answer:"})," ",e.jsx("span",{className:"text-black dark:text-white",children:e.jsx(ae,{children:n.tossup.answer})})]})]}),n.bonus&&T&&e.jsxs("div",{className:n.tossup?"mt-6 pt-4 border-t":"mt-2",children:[e.jsxs("div",{className:"text-sm text-black/60 dark:text-white/80 mb-2",children:[e.jsx("span",{className:"font-semibold",children:String(n.tossup?n.tossup.tournament:n.bonus.tournament).toUpperCase()})," • ","Round ",n.bonus.round??"—"," • ",n.bonus.category,n.bonus.question_number!=null&&e.jsxs(e.Fragment,{children:[" • ","Q",n.bonus.question_number]}),e.jsx("span",{className:"ml-2 inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold tracking-wide border "+(C.length>0?"bg-blue-50 text-blue-700 border-blue-200 dark:bg-blue-900/20 dark:text-blue-200 dark:border-blue-700":"bg-purple-50 text-purple-700 border-purple-200 dark:bg-purple-900/20 dark:text-purple-200 dark:border-purple-700"),children:C.length>0?"MULTIPLE CHOICE":"SHORT ANSWER"})]}),e.jsxs("div",{className:"font-semibold mb-2",children:["Bonus ",x+1]}),E&&e.jsxs("div",{className:"mb-3",children:[e.jsx("img",{src:E,alt:`Visual bonus${n?.bonus?.tournament?` • ${n.bonus.tournament}`:""}${n?.bonus?.round?` • Round ${n.bonus.round}`:""}${n?.bonus?.question_number!=null?` • Q${n.bonus.question_number}`:""}`,className:"max-h-64 rounded-md border border-black/10 dark:border-white/10 object-contain cursor-zoom-in hover:opacity-95 transition",onClick:()=>R(!0)}),e.jsx("div",{className:"text-xs text-black/60 dark:text-white/60 mt-1",children:"Click image to view full screen"})]}),e.jsx("div",{className:"mb-2 whitespace-pre-line",children:e.jsx(ae,{children:n.bonus.question})}),C.length>0&&e.jsx("div",{className:"mb-3",children:C.map(([A,v])=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:`gen-bonus-${x}`,className:"accent-tint",disabled:!0}),e.jsxs("span",{children:[A.toUpperCase(),") ",e.jsx(ae,{children:v})]})]},A))}),e.jsxs("div",{className:"text-sm text-black/70 dark:text-white/80",children:[e.jsx("span",{className:"uppercase text-black/60 dark:text-white/60",children:"Answer:"})," ",e.jsx("span",{className:"text-black dark:text-white",children:e.jsx(ae,{children:n.bonus.answer})})]})]})]}),u&&E&&e.jsxs("div",{className:"fixed inset-0 z-[90] flex items-center justify-center",role:"dialog","aria-modal":"true","aria-label":"Visual bonus image",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80",onClick:()=>R(!1)}),e.jsxs("div",{className:"relative max-w-[96vw] max-h-[96vh] p-2",children:[e.jsx("img",{src:E,alt:"Visual bonus full screen",className:"max-w-[96vw] max-h-[92vh] object-contain rounded shadow-2xl"}),e.jsx("button",{type:"button",className:"absolute -top-3 -right-3 bg-white text-black rounded-full shadow p-2 hover:bg-white/90 focus:outline-none","aria-label":"Close full screen image",onClick:()=>R(!1),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"h-4 w-4",children:e.jsx("path",{fillRule:"evenodd",d:"M4.22 4.22a.75.75 0 011.06 0L10 8.94l4.72-4.72a.75.75 0 111.06 1.06L11.06 10l4.72 4.72a.75.75 0 11-1.06 1.06L10 11.06l-4.72 4.72a.75.75 0 01-1.06-1.06L8.94 10 4.22 5.28a.75.75 0 010-1.06z",clipRule:"evenodd"})})})]}),e.jsx(Hs,{onClose:()=>R(!1)})]})]})}function Hs({onClose:n}){return J.useEffect(()=>{const x=p=>{p.key==="Escape"&&n?.()};return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[n]),null}function Qs({displayPairs:n,QUESTIONS_PER_PAGE:x=2,pdfRef:p}){const[g,F]=J.useState({});return J.useEffect(()=>{let T=!1;return(async()=>{const b={};for(let f=0;f<n.length;f++){const C=n[f]?.bonus;if(!(!C||!(C.is_visual_bonus===!0||String(C.visual||"").toLowerCase()==="true")))try{const E=await kt({tournament:C.tournament,round:C.round,question_number:C.question_number});E&&(b[f]=E)}catch{}}T||F(b)})(),()=>{T=!0}},[n]),e.jsx("div",{"aria-hidden":"true",style:{position:"fixed",left:"-10000px",top:0,width:816,pointerEvents:"none",opacity:0,visibility:"visible"},children:e.jsxs("div",{ref:p,className:"pdf-root",children:[e.jsx("style",{children:`
          .pdf-root, .pdf-root * { box-sizing: border-box; }
          .html2pdf__page-break + .pdf-header { margin-top: 0 !important; }
          @page { margin: 12mm; }
          .pdf-root { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Noto Sans, 'Apple Color Emoji', 'Segoe UI Emoji'; color: #000; margin: 0; padding: 0; }
          .pdf-page { width: 720px; margin: 0 auto; padding: 2mm 4px 0 4px; }
          .pdf-page { page-break-after: always; }
          .pdf-page:last-child { page-break-after: auto; }
          .pdf-header { text-align: center; font-size: 16px; font-weight: bold; margin-bottom: 2mm; padding: 0 2px; }
          .pdf-q { page-break-inside: avoid; break-inside: avoid; margin-bottom: 4mm; }
          .pdf-hr { border: none; border-top: 1px solid #888; margin: 8px 0; }
          .pdf-meta { font-size: 11px; color: #333; margin-bottom: 2mm; }
          .pdf-title { font-weight: 600; margin-bottom: 2mm; }
          .pdf-body { white-space: pre-wrap; line-height: 1.4; word-break: break-word; overflow-wrap: anywhere; }
          .pdf-choices { margin: 2mm 0; break-inside: avoid; }
          .pdf-choice { display: flex; align-items: flex-start; gap: 4px; line-height: 1.35; }
          .pdf-choice-key { font-weight: 600; width: 16px; flex: 0 0 auto; }
          .pdf-choice-val { flex: 1; }
          .pdf-ans { font-size: 12px; margin-top: 2mm; }
          .pdf-footer { text-align: center; font-size: 12px; color: #888; margin-top: 2mm; }
          .katex-display { margin: 0; }
        `}),(()=>{const T=[];for(let C=0;C<n.length;C+=x){const $=n.slice(C,C+x);$.length>0&&T.push($)}const b=new Date().toLocaleDateString(),f="scibowl.app";return T.map((C,$)=>{const E=$*x,I=$+1;return e.jsxs("div",{className:"pdf-page",children:[e.jsxs("div",{className:"pdf-header",children:[f," — ",b]}),C.map((u,R)=>{const A=E+R,v=u.tossup?Ce(u.tossup):[],_=u.bonus?Ce(u.bonus):[];return e.jsxs(J.Fragment,{children:[e.jsxs("div",{className:"pdf-q",children:[u.tossup&&e.jsxs("div",{children:[e.jsxs("div",{className:"pdf-meta",children:[u.tossup.tournament," • Round ",u.tossup.round??"—"," • ",u.tossup.category,u.tossup.question_number!=null?` • Q${u.tossup.question_number}`:"",e.jsx("span",{style:v.length>0?Pe("mc"):Pe("sa"),children:v.length>0?"MULTIPLE CHOICE":"SHORT ANSWER"})]}),e.jsxs("div",{className:"pdf-title",children:["Toss-up ",A+1]}),e.jsx("div",{className:"pdf-body",children:e.jsx(ae,{children:u.tossup.question})}),v.length>0&&e.jsx("div",{className:"pdf-choices",children:v.map(([c,S])=>e.jsxs("div",{className:"pdf-choice",children:[e.jsxs("span",{className:"pdf-choice-key",children:[c.toUpperCase(),")"]}),e.jsx("span",{className:"pdf-choice-val",children:e.jsx(ae,{children:S})})]},c))}),e.jsxs("div",{className:"pdf-ans",children:[e.jsx("span",{style:{opacity:.7},children:"Answer:"})," ",e.jsx(ae,{children:u.tossup.answer})]})]}),u.bonus&&e.jsxs("div",{style:{marginTop:u.tossup?"6mm":0,paddingTop:u.tossup?"2mm":0,borderTop:u.tossup?"1px solid #ddd":"none"},children:[e.jsxs("div",{className:"pdf-meta",children:[u.tossup?u.tossup.tournament:u.bonus.tournament," • Round ",u.bonus.round??"—"," • ",u.bonus.category,u.bonus.question_number!=null?` • Q${u.bonus.question_number}`:"",e.jsx("span",{style:_.length>0?Pe("mc"):Pe("sa"),children:_.length>0?"MULTIPLE CHOICE":"SHORT ANSWER"})]}),e.jsxs("div",{className:"pdf-title",children:["Bonus ",A+1]}),g[A]&&e.jsx("div",{className:"pdf-body",style:{marginBottom:"2mm"},children:e.jsx("img",{src:g[A],alt:"Visual bonus",style:{maxHeight:220,width:"100%",objectFit:"contain",border:"1px solid #e5e7eb",borderRadius:6}})}),e.jsx("div",{className:"pdf-body",children:e.jsx(ae,{children:u.bonus.question})}),_.length>0&&e.jsx("div",{className:"pdf-choices",children:_.map(([c,S])=>e.jsxs("div",{className:"pdf-choice",children:[e.jsxs("span",{className:"pdf-choice-key",children:[c.toUpperCase(),")"]}),e.jsx("span",{className:"pdf-choice-val",children:e.jsx(ae,{children:S})})]},c))}),e.jsxs("div",{className:"pdf-ans",children:[e.jsx("span",{style:{opacity:.7},children:"Answer:"})," ",e.jsx(ae,{children:u.bonus.answer})]})]})]}),R<C.length-1&&e.jsx("hr",{className:"pdf-hr"})]},`pdf-${A}`)}),e.jsxs("div",{className:"pdf-footer",children:["Page ",I," of ",T.length]})]},`pdf-group-${$}`)})})()]})})}function Pe(n){return n==="mc"?{marginLeft:6,border:"1px solid #bfdbfe",background:"#eff6ff",color:"#1d4ed8",borderRadius:9999,padding:"1px 6px",fontSize:10,fontWeight:600}:{marginLeft:6,border:"1px solid #e9d5ff",background:"#faf5ff",color:"#6b21a8",borderRadius:9999,padding:"1px 6px",fontSize:10,fontWeight:600}}function Ys({searchInput:n,setSearchInput:x,committedSearch:p,setCommittedSearch:g}){return e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold mb-2 flex items-center gap-2",children:["Search",p&&e.jsx("button",{type:"button",className:"chip px-2 py-0.5 text-xs",onClick:()=>{x(""),g("")},"aria-label":"Clear search",children:"Clear"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ks,{className:"h-4 w-4 absolute left-2 top-1/2 -translate-y-1/2 text-black/50 dark:text-white/50 pointer-events-none"}),e.jsx("input",{type:"text",value:n,onChange:F=>x(F.target.value),onKeyDown:F=>{F.key==="Enter"&&g(n)},placeholder:"Find text in questions or answers...",className:"w-full pl-8 pr-3 py-1.5 rounded-lg border border-black/10 bg-white dark:bg-darkcard text-black dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500","aria-label":"Search questions"})]}),e.jsx("button",{type:"button",className:"btn btn-sm btn-primary whitespace-nowrap",disabled:!n.trim()||n.trim()===p.trim(),onClick:()=>g(n),children:"Search"})]}),p.trim()&&e.jsxs("div",{className:"text-xs mt-1 opacity-70",children:['Showing all matches containing "',p,'" (ignores other filters except selected tournaments for loading).']})]})}function Ks({headerOffset:n,close:x,currentIndex:p,displayPairs:g,awaitingPlayer:F,interruptArmed:T,setAwaitingPlayer:b,setInterruptArmed:f,isTossupFinal:C,recordNoAnswer:$,throwOutAndReplace:E,tossupResults:I,bonusResults:u,saveFixedBonus:R,players:A,handleSeatClick:v,allowedTeams:_,totalPoints:c,teamPoints:S,saveBonusPoints:q,subMode:M,setSubMode:a,resetScorekeeping:o,exportCoachesScoresheetPdf:w,coachesSheetLoading:B,tryoutsMode:m,setTryoutsMode:h,questionType:L}){return e.jsxs("div",{className:"fixed right-0 z-50 w-[400px] bg-white dark:bg-darkcard border-l border-black/10 dark:border-white/10 shadow-xl flex flex-col",style:{top:n,height:`calc(100vh - ${n}px)`},children:[e.jsxs("div",{className:"px-4 py-3 border-b border-black/10 dark:border-white/10 flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold text-sm",children:"Scorekeeper"}),e.jsx("button",{className:"text-xs chip",onClick:x,children:"Close"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-4 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{children:["Q ",Math.min(p+1,g.length)," / ",g.length]}),e.jsx("div",{className:"text-[10px] mt-0.5 opacity-70",children:_.length===0?"No buzz":"Buzz: "+_.join("/")})]}),e.jsxs("div",{className:"font-semibold text-xs leading-tight flex flex-col items-end",children:[e.jsxs("span",{children:["Total ",c]}),e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:["A ",S.A]}),e.jsxs("span",{className:"text-blue-600 dark:text-blue-400",children:["B ",S.B]})]})]}),p>=g.length&&e.jsx("div",{className:"p-2 rounded bg-emerald-600 text-white text-center text-xs",children:"Round complete"}),p<g.length&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-[11px] font-medium",children:[e.jsx("input",{type:"checkbox",className:"scale-110",checked:!!m,onChange:N=>h(N.target.checked),disabled:L!=="tossup",title:L==="tossup"?"Tryouts mode: an incorrect buzz only locks that player; others may continue buzzing.":"Switch question type to Toss-ups to enable Tryouts mode."}),"Tryouts"]}),L!=="tossup"&&e.jsx("span",{className:"text-[10px] opacity-60",children:"Toss-ups only"})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-2",children:[e.jsxs("button",{className:`col-span-2 chip flex items-center justify-center gap-1 text-xs disabled:opacity-40 disabled:cursor-not-allowed disabled:brightness-75 ${F?.type==="incorrect"?"ring-2 ring-red-500":""}`,onClick:()=>b({type:"incorrect",interrupt:T}),disabled:C(p),title:"Mark incorrect then click player seat (then select player)",children:[e.jsx(Ns,{color:"#ff2600",className:"h-4 w-4"})," Incorrect"]}),e.jsxs("button",{className:`col-span-2 chip flex items-center justify-center gap-1 text-xs disabled:opacity-40 disabled:cursor-not-allowed disabled:brightness-75 ${F?.type==="correct"?"ring-2 ring-green-500":""}`,onClick:()=>b({type:"correct",interrupt:T}),disabled:C(p),title:"Mark correct then click player seat",children:[e.jsx(Ss,{color:"#00f900",className:"h-4 w-4"})," Correct"]}),e.jsx("button",{className:`col-span-2 chip flex items-center justify-center gap-1 text-xs disabled:opacity-40 disabled:cursor-not-allowed disabled:brightness-75 ${T?"bg-purple-600 text-white ring-2 ring-purple-500":""}`,onClick:()=>f(N=>!N),disabled:C(p),title:"Toggle interrupt (applies to next correct/incorrect)",children:T?"Interrupt ON":"Interrupt"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{className:"chip text-xs disabled:opacity-40 disabled:cursor-not-allowed",onClick:$,disabled:C(p),title:"Record as no answer and advance (attempts already made remain in the log)",children:"No Answer"}),e.jsx("button",{className:"chip text-xs",onClick:E,children:"Throw Out & Replace"})]}),I[p]?.result==="correct"&&g[p]?.bonus&&g[p]?.tossup&&!u[p]&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("button",{className:"chip text-xs bg-green-600 text-white hover:bg-green-700",onClick:()=>{R(!0)},children:"Award +10"}),e.jsx("button",{className:"chip text-xs bg-red-600 text-white hover:bg-red-700",onClick:()=>{R(!1)},children:"No Bonus"})]}),u[p]&&e.jsxs("div",{className:"text-xs",children:["Bonus: ",u[p].points," pts"]}),F&&e.jsxs("div",{className:"text-xs text-center text-blue-600 dark:text-blue-300",children:["Select a player seat to apply a ",F.interrupt?"Interrupt ":"",F.type,"."]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-2 justify-between",children:[e.jsxs("span",{children:["Players ",M&&e.jsx("span",{className:"text-[10px] font-normal px-1.5 py-0.5 rounded bg-purple-600 text-white",children:"SUB MODE"})]}),e.jsx("button",{type:"button",className:"chip px-2 py-1 text-[11px]",onClick:()=>a(!0),title:"Open substitution modal",children:"Substitute"})]}),e.jsx("div",{className:"space-y-6",children:["A","B"].map(N=>e.jsxs("div",{children:[e.jsxs("div",{className:`text-[12px] font-semibold mb-2 tracking-wide ${N==="A"?"text-green-600 dark:text-green-400":"text-blue-600 dark:text-blue-400"}`,children:["Team ",N]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:A.filter(j=>j.team===N).map(j=>{const X=A.findIndex(Z=>Z.id===j.id);let K=j.status==="replaced"||F&&!_.includes(j.team);return m&&L==="tossup"&&F&&((I[p]?.attempts||[]).some(Ae=>Ae.playerId===j.id)?K=!0:K=j.status==="replaced"),e.jsxs("button",{onClick:()=>v(X),className:`relative flex flex-col items-center justify-center h-24 rounded-xl border border-black/10 dark:border-white/10 ${K?"bg-black/10 dark:bg-white/10 opacity-40 cursor-not-allowed":"bg-gradient-to-br from-black/5 to-black/10 dark:from-white/10 dark:to-white/5 hover:from-black/10 hover:to-black/20 dark:hover:from-white/20 dark:hover:to-white/10"} transition text-[11px] font-medium ${F&&!K&&j.status!=="replaced"?"ring-2 ring-offset-2 ring-green-500 dark:ring-green-400 animate-pulse-slow":""}`,title:j.name||`Seat ${N}${j.seat??(j.id<=4?j.id:j.id-4)}`,disabled:j.status==="replaced",children:[e.jsx(Cs,{className:"h-7 w-7 opacity-70"}),e.jsx("span",{className:"mt-2 truncate max-w-[120px] px-2 text-center leading-tight",children:j.name||`Seat ${N}${j.seat??(j.id<=4?j.id:j.id-4)}`}),j.status==="replaced"&&e.jsx("span",{className:"absolute top-1 left-1 text-[10px] bg-red-600 text-white px-1 rounded",children:"OUT"}),j.stats.correct+j.stats.correctInterrupt>0&&e.jsx("span",{className:"absolute top-0 right-0 text-[10px] bg-green-600 text-white rounded-bl px-1",children:j.stats.correct+j.stats.correctInterrupt})]},j.id)})})]},N))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium mb-1",children:"Player Stats"}),e.jsxs("table",{className:"w-full text-[10px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[9px] text-black/70 dark:text-white/70",children:[e.jsx("th",{className:"text-left",children:"Player"}),e.jsx("th",{children:"Tm"}),e.jsx("th",{children:"C"}),e.jsx("th",{children:"I"}),e.jsx("th",{children:"CI"}),e.jsx("th",{children:"II"})]})}),e.jsx("tbody",{children:A.filter(N=>N.name).map(N=>e.jsxs("tr",{className:"odd:bg-black/0 even:bg-black/5 dark:even:bg-white/5",children:[e.jsx("td",{className:"truncate max-w-[90px] pr-1",children:N.name}),e.jsx("td",{className:"text-center",children:N.team}),e.jsx("td",{className:"text-center",children:N.stats.correct}),e.jsx("td",{className:"text-center",children:N.stats.incorrect}),e.jsx("td",{className:"text-center",children:N.stats.correctInterrupt}),e.jsx("td",{className:"text-center",children:N.stats.incorrectInterrupt})]},N.id))})]})]}),p>=g.length&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{className:"btn btn-orange w-full justify-center",onClick:w,disabled:B,children:B?"Generating…":"Coaches Scoresheet PDF"}),e.jsx("button",{className:"btn btn-ghost w-full justify-center",onClick:()=>o(),children:"Reset Scorekeeping"})]})]})]})}function Xs({open:n,onClose:x,players:p,onSubmit:g,initialTeam:F="A"}){const[T,b]=k.useState(F),[f,C]=k.useState(null),[$,E]=k.useState(""),[I,u]=k.useState(!1);if(k.useEffect(()=>{if(n){b(F);const c=p.filter(S=>S.team===F)[0];C(c?.id??null),E(""),u(!1)}},[n,F,p]),!n)return null;const R=p.filter(c=>c.team===T),v=p.filter(c=>c.team===T).length>=5,_=$.trim().length>0&&f!=null&&!v;return p.find(c=>c.id===f),e.jsxs("div",{className:"fixed inset-0 z-[75] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:x}),e.jsxs("div",{className:"relative bg-white dark:bg-darkcard rounded-lg shadow-xl w-full max-w-md border border-black/10 dark:border-white/10 p-6 flex flex-col gap-5",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Substitute Player"}),e.jsx("button",{type:"button",className:"chip text-xs",onClick:x,children:"Close"})]}),e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"font-medium text-xs uppercase tracking-wide",children:"Team"}),e.jsx("div",{className:"flex gap-2",children:["A","B"].map(c=>e.jsxs("button",{type:"button",className:`chip px-3 py-1 text-sm ${T===c?"ring-2 ring-tint bg-tint/10":""}`,onClick:()=>{b(c);const S=p.filter(q=>q.team===c)[0];C(S?.id??null)},children:["Team ",c]},c))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"font-medium text-xs uppercase tracking-wide",children:"Outgoing Seat"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:R.map(c=>e.jsxs("button",{type:"button",onClick:()=>C(c.id),className:`chip flex flex-col items-center gap-1 py-2 ${f===c.id?"ring-2 ring-tint bg-tint/10":""}`,children:[e.jsx("span",{className:"text-[11px] font-semibold",children:c.name||`Seat ${T}${c.seat??(c.id<=4?c.id:c.id-4)}`}),c.name&&e.jsxs("span",{className:"text-[10px] opacity-60",children:[c.stats.correct+c.stats.correctInterrupt," C / ",c.stats.incorrect+c.stats.incorrectInterrupt," I"]})]},c.id))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"font-medium text-xs uppercase tracking-wide",htmlFor:"new-player-name",children:"New Player Name"}),e.jsx("input",{id:"new-player-name",type:"text",className:"w-full rounded-lg border border-black/10 dark:border-white/10 bg-white dark:bg-darkcard px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-tint",placeholder:"Enter name",value:$,onChange:c=>{E(c.target.value),u(!0)},autoFocus:!0}),I&&$.trim()===""&&e.jsx("div",{className:"text-[11px] text-red-600 mt-1",children:"Name required."})]}),v&&e.jsx("div",{className:"text-[11px] text-red-600",children:"Team already has a substitute (5 players shown). Further substitutions disabled."})]}),e.jsxs("div",{className:"flex flex-col gap-2 pt-2",children:[e.jsx("button",{type:"button",disabled:!_,onClick:()=>{_&&(g({team:T,playerId:f,newName:$.trim()}),x())},className:"btn btn-primary w-full justify-center disabled:opacity-40 disabled:cursor-not-allowed",children:"Apply Substitution"}),e.jsx("button",{type:"button",onClick:x,className:"btn btn-ghost w-full justify-center",children:"Cancel"})]})]})]})}function Pr({questions:n=[],lazy:x=null,auth:p=null}){const{isLazy:g,tournaments:F,tournamentGroups:T,selectedTournaments:b,setSelectedTournaments:f,selectedCategories:C,setSelectedCategories:$,tournamentGroupsOpen:E,setTournamentGroupsOpen:I,tournamentVisibleEntriesMainRef:u,handleTournamentToggle:R,loadedQuestions:A,validQuestions:v,categories:_,roundRanges:c,setRoundRanges:S,roundsByTournament:q,globalNumericRoundMax:M,inRanges:a}=ps({questions:n,lazy:x}),[o,w]=k.useState(!1),[B,m]=k.useState([]);function h(t,s="info",i=4e3){const l=Math.random().toString(36).slice(2),d=Date.now();m(r=>[...r,{id:l,message:t,type:s,ttl:i,created:d}]),i>0&&setTimeout(()=>m(r=>r.filter(y=>y.id!==l)),i+50)}const{roundsIndex:L,setRoundsIndex:N,loadingUserRounds:j,roundFolders:X,setRoundFolders:K,foldersOpen:Z,setFoldersOpen:Ae,selectedExcludeRoundIds:oe,setSelectedExcludeRoundIds:ce,excludeDetailCache:_e,handleExcludeRoundToggle:At,refresh:Rt,deleteFolderAndRounds:Bt}=Es({auth:p,pushToast:h});k.useRef(null),k.useRef(null);const[Lt,Tt]=k.useState(!1),[le,Mt]=k.useState(10),[de,ye]=k.useState([]),[re,ve]=k.useState("both"),tt=J.useRef(null),Ft=2,[st,nt]=k.useState(!1),[Re,rt]=k.useState(!1),[It,Dt]=k.useState(!1),[$t,Et]=k.useState(()=>{try{return document.documentElement.classList.contains("dark")}catch{return!1}});J.useEffect(()=>{try{const t=document.documentElement,s=()=>Et(t.classList.contains("dark"));s();const i=new MutationObserver(s);i.observe(t,{attributes:!0,attributeFilter:["class"]});const l=window.matchMedia("(prefers-color-scheme: dark)");return l.addEventListener("change",s),()=>{i.disconnect(),l.removeEventListener("change",s)}}catch{}},[]);const[ee,at]=k.useState(!1),Pt=k.useRef(9),[W,Be]=k.useState(()=>Array.from({length:8},(t,s)=>({id:s+1,team:s<4?"A":"B",seat:s<4?s+1:s-3,name:"",status:"active",stats:{correct:0,incorrect:0,correctInterrupt:0,incorrectInterrupt:0}}))),[V,qe]=k.useState(0),[te,ge]=k.useState(null),[zt,ke]=k.useState(!1),[ne,Le]=k.useState([]),[ue,Te]=k.useState([]),[_t,me]=k.useState(null),[ot,ie]=k.useState(["A","B"]),[Ne,lt]=k.useState(!1);J.useEffect(()=>{try{localStorage.getItem("sb_tryoutsMode")==="1"&&lt(!0)}catch{}},[]),J.useEffect(()=>{try{localStorage.setItem("sb_tryoutsMode",Ne?"1":"0")}catch{}},[Ne]);const[qt,it]=k.useState(!1),[Js,Zs]=k.useState("A"),[Ut,ct]=k.useState(!1),[Ot,Ue]=k.useState(""),[Oe,dt]=k.useState(0),ut=k.useRef([]);J.useEffect(()=>{function t(){const s=document.querySelector("header, .site-header, .app-header, .top-bar");if(s){const i=s.getBoundingClientRect();dt(i.height)}else dt(0)}return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),J.useEffect(()=>{if(!ee)return;const t=ut.current[V];if(t&&typeof t.scrollIntoView=="function"){const s=Math.max(Oe+12,0),i=t.getBoundingClientRect(),l=window.scrollY+i.top-s;window.scrollTo({top:l,behavior:"smooth"})}},[V,ee,Oe]);const Gt=k.useMemo(()=>{let t=0;return ne.forEach(s=>{s&&(Array.isArray(s.attempts)?s.attempts.forEach(i=>{typeof i.points=="number"&&(t+=i.points)}):typeof s.points=="number"&&(t+=s.points))}),ue.forEach(s=>{s&&typeof s.points=="number"&&(t+=s.points)}),t},[ne,ue]),Vt=k.useMemo(()=>{const t={A:0,B:0};return ne.forEach(s=>{if(s){if(Array.isArray(s.attempts)&&s.attempts.length)s.attempts.forEach(i=>{const l=W.find(d=>d.id===i.playerId)?.team;l&&(t[l]+=i.points||0)});else if(s.playerId){const i=W.find(l=>l.id===s.playerId)?.team;i&&(t[i]+=s.points||0)}}}),ue.forEach(s=>{s?.team&&(t[s.team]+=s.points||0)}),t},[ne,ue,W]);function Ge(){qe(0),ge(null),Le([]),Te([]),Ue(""),me(null),ie(["A","B"]),it(!1)}function Wt(t){const s=W[t];if(s){if(s.status==="replaced"){h("Cannot buzz: seat replaced.","error");return}if(te){if(!ot.includes(s.team)){h(`Team ${s.team} not allowed to buzz now.`,"error");return}const{type:i,interrupt:l}=te,d=_t==null;if(Le(r=>{const y=[...r],D=i==="correct"?4:i==="incorrect"&&l?-4:0,P=y[V]||{},U=Array.isArray(P.attempts)?[...P.attempts]:[];return U.push({playerId:s.id,team:s.team,result:i,interrupt:l,points:D}),i==="correct"?y[V]={...P,attempts:U,result:"correct",playerId:s.id,interrupt:l,points:D}:d?y[V]={...P,attempts:U,result:"incorrect",playerId:s.id,interrupt:l,points:D}:y[V]={...P,attempts:U,result:"incorrect",playerId:s.id,interrupt:l,points:D},y}),Be(r=>r.map(y=>y.id===s.id?{...y,stats:{...y.stats,correct:y.stats.correct+(te.type==="correct"&&!te.interrupt?1:0),incorrect:y.stats.incorrect+(te.type==="incorrect"&&!te.interrupt?1:0),correctInterrupt:y.stats.correctInterrupt+(te.type==="correct"&&te.interrupt?1:0),incorrectInterrupt:y.stats.incorrectInterrupt+(te.type==="incorrect"&&te.interrupt?1:0)}}:y)),ge(null),ke(!1),d&&te.type==="incorrect")Ne&&re==="tossup"?(me(null),ie(["A","B"])):(me(s.team),ie([s.team==="A"?"B":"A"]));else if(te.type==="incorrect")me(null),ie([]),setTimeout(()=>Me(),200);else if(te.type==="correct"){me(null),ie([]);const r=se[V];r?.bonus&&r.tossup?Ue(""):setTimeout(()=>Me(),150)}return}if(s.name){const i=window.prompt("Rename player",s.name);i!=null&&Be(l=>l.map((d,r)=>r===t?{...d,name:i.trim()}:d))}else{const i=window.prompt("Enter player name (seat "+(t+1)+")","");i!=null&&Be(l=>l.map((d,r)=>r===t?{...d,name:i.trim()}:d))}}}function Ht(){Le(t=>{const s=[...t],i=s[V]||{},l=Array.isArray(i.attempts)?i.attempts:[];return s[V]={...i,attempts:l,result:"no-answer",points:i.points||0},s}),ge(null),ke(!1),ie([]),setTimeout(()=>Me(),150)}function Me(){const t=se[V],s=ne[V];t?.bonus&&t?.tossup&&s?.result==="correct"&&!ue[V]||(qe(i=>Math.min(i+1,se.length)),me(null),ie(["A","B"]))}function Qt(){const t=Number(Ot);if(!Number.isFinite(t)||t<0)return;const s=Math.min(10,Math.max(0,t)),i=ne[V],l=i?.playerId&&W.find(d=>d.id===i.playerId)?.team||"A";Te(d=>{const r=[...d];return r[V]={points:s,team:l},r}),Ue(""),setTimeout(()=>Me(),100)}function Yt(t){const s=ne[t];if(!s)return!1;if(s.result==="replaced"||s.result==="no-answer"||s.result==="correct")return!0;if(Ne&&re==="tossup"){const d=s.attempts||[],r=new Set(d.map(D=>D.playerId));return W.filter(D=>D.status!=="replaced").filter(D=>!r.has(D.id)).length===0}const i=s.attempts||[];return new Set(i.map(d=>W.find(r=>r.id===d.playerId)?.team).filter(Boolean)).size>=2&&s.result==="incorrect"}function Kt(t){const s=t?10:0,i=ne[V],l=i?.playerId&&W.find(d=>d.id===i.playerId)?.team||"A";Te(d=>{const r=[...d];return r[V]={points:s,team:l},r}),ge(null),ke(!1),me(null),ie(["A","B"]),qe(d=>Math.min(d+1,se.length))}function Xt(){if(!se[V])return;const s=new Set(se.flatMap(d=>[d.tossup?.id,d.bonus?.id].filter(Boolean))),i=Ee(),l=i.find(d=>!s.has(d.tossup?.id)&&!s.has(d.bonus?.id))||i[0];ye(d=>d.map((r,y)=>y===V?l:r)),Le(d=>{const r=[...d];return r[V]=void 0,r}),Te(d=>{const r=[...d];return r[V]=void 0,r}),me(null),ie(["A","B"]),ge(null),ke(!1),h("Question replaced.","info")}const[Jt,mt]=k.useState(!1);async function Zt(){mt(!0);try{const t=await Ms(e.jsx(Gs,{sheetRows:os,players:W,metadata:{generatedAt:new Date().toLocaleString()}})).toBlob(),s=URL.createObjectURL(t),i=document.createElement("a");i.href=s,i.download="Coaches-Scoresheet-"+new Date().toISOString().slice(0,10)+".pdf",document.body.appendChild(i),i.click(),setTimeout(()=>{URL.revokeObjectURL(s),i.remove()},1e3)}catch(t){console.error("Failed to export coaches scoresheet (react-pdf):",t),window.alert?.("Failed to export coaches scoresheet: "+(t.message||String(t)))}finally{mt(!1)}}const pt=25,[es,ts]=k.useState(""),[he,ht]=k.useState(""),[ss,Ve]=k.useState(!1),[ns,Se]=k.useState(!1),[fe,Fe]=k.useState(null),[Ie,ft]=k.useState(!1),[rs,We]=k.useState(!1),[xe,be]=k.useState(new Set),[we,De]=k.useState(null),[$e,xt]=k.useState(!1);k.useRef([]),k.useRef(null),J.useEffect(()=>{const t=()=>{try{const s=window.scrollY||document.documentElement.scrollTop||0;Dt(s>300)}catch{}};return window.addEventListener("scroll",t,{passive:!0}),t(),()=>window.removeEventListener("scroll",t)},[]);function Ee(){const t=new Set;oe.filter(l=>!_e.current.has(l));for(const l of oe){const d=_e.current.get(l);if(d){const r=us(d);for(const y of r)t.add(y)}}function s(l,d){if(l.length===0||d<=0)return[];const r=new Map;for(const O of l)r.has(O.category)||r.set(O.category,[]),r.get(O.category).push(O);let y=Array.from(r.keys());if(C.length){const O=new Set(C);y=y.filter(pe=>O.has(pe))}if(y=y.filter(O=>(r.get(O)?.length||0)>0),y.length===0)return[];const D=[...y].sort(()=>Math.random()-.5),P=Math.floor(d/D.length);let U=d%D.length;const H=[],Q=new Set;for(let O=0;O<D.length;O++){const pe=D[O],je=[...r.get(pe)];je.sort(()=>Math.random()-.5);const cs=Math.min(P+(U>0?1:0),je.length);U>0&&U--;for(let Qe=0;Qe<cs;Qe++){const Ye=je[Qe];Q.has(Ye.id)||(H.push(Ye),Q.add(Ye.id))}}if(H.length<d){const O=[];for(const pe of y)for(const je of r.get(pe))Q.has(je.id)||O.push(je);O.sort(()=>Math.random()-.5);for(const pe of O){if(H.length>=d)break;H.push(pe),Q.add(pe.id)}}return H.slice(0,d)}let i=[];if(re==="tossup"){const l=v.filter(r=>(b.length?b.includes(r.tournament):!0)&&a(r)&&r.question_type?.toLowerCase()==="tossup"&&!t.has(r.id)),d=l.length<=le?[...l]:s(l,le);for(let r=d.length-1;r>0;r--){const y=Math.floor(Math.random()*(r+1));[d[r],d[y]]=[d[y],d[r]]}i=d.map(r=>({tossup:r,bonus:null}))}else if(re==="bonus"){const l=v.filter(r=>(b.length?b.includes(r.tournament):!0)&&a(r)&&r.question_type?.toLowerCase()==="bonus"&&!Ke(r)&&!t.has(r.id)),d=l.length<=le?[...l]:s(l,le);for(let r=d.length-1;r>0;r--){const y=Math.floor(Math.random()*(r+1));[d[r],d[y]]=[d[y],d[r]]}i=d.map(r=>({tossup:null,bonus:r}))}else if(re==="visual-bonus"){const l=v.filter(r=>(b.length?b.includes(r.tournament):!0)&&a(r)&&r.question_type?.toLowerCase()==="bonus"&&Ke(r)&&!t.has(r.id)),d=l.length<=le?[...l]:s(l,le);for(let r=d.length-1;r>0;r--){const y=Math.floor(Math.random()*(r+1));[d[r],d[y]]=[d[y],d[r]]}i=d.map(r=>({tossup:null,bonus:r}))}else{const l=v.filter(r=>(b.length?b.includes(r.tournament):!0)&&a(r)&&r.question_type?.toLowerCase()==="tossup"&&!t.has(r.id)),d=l.length<=le?[...l]:s(l,le);for(let r=d.length-1;r>0;r--){const y=Math.floor(Math.random()*(r+1));[d[r],d[y]]=[d[y],d[r]]}i=d.map(r=>{const y=xs(r,v),D=y&&!Ke(y)&&!t.has(y.id)?y:null;return{tossup:r,bonus:D}})}return i}J.useEffect(()=>{g&&b.length!==0&&x.ensureLoaded(b)},[g,x,b]);const as=k.useMemo(()=>{const t=he.trim().toLowerCase();return t?v.filter(s=>[s.question,s.answer,s.category,s.tournament,s.round].some(l=>l!=null&&String(l).toLowerCase().includes(t))).map(s=>({tossup:s.question_type?.toLowerCase()==="tossup"?s:null,bonus:s.question_type?.toLowerCase()==="bonus"?s:null})):[]},[he,v]),se=he.trim()?as:de,os=k.useMemo(()=>{const t=[];for(let l=0;l<Math.min(se.length,pt);l++){const d=se[l],r=d.tossup,y=ne[l],D=ue[l],P=r?Ce(r).length>0:!1,U=y?.attempts||[],H={A:U.filter(Q=>W.find(O=>O.id===Q.playerId)?.team==="A"),B:U.filter(Q=>W.find(O=>O.id===Q.playerId)?.team==="B")};t.push({index:l+1,subject:hs(r?.category||d.bonus?.category),type:P?"MC":"SA",attempts:U,byTeam:H,bonusA:D&&D.team==="A"?D.points:0,bonusB:D&&D.team==="B"?D.points:0,penaltyA:U.filter(Q=>W.find(O=>O.id===Q.playerId)?.team==="A"&&(Q.points||0)<0).reduce((Q,O)=>Q+Math.abs(O.points||0),0),penaltyB:U.filter(Q=>W.find(O=>O.id===Q.playerId)?.team==="B"&&(Q.points||0)<0).reduce((Q,O)=>Q+Math.abs(O.points||0),0),bonusAwardedTeam:D?.team||null})}for(;t.length<pt;)t.push({pad:!0,index:t.length+1});let s=0,i=0;return t.forEach(l=>{if(l.pad){l.cumA=s,l.cumB=i;return}const d=(l.attempts||[]).filter(y=>W.find(D=>D.id===y.playerId)?.team==="A").reduce((y,D)=>y+(D.points||0),0),r=(l.attempts||[]).filter(y=>W.find(D=>D.id===y.playerId)?.team==="B").reduce((y,D)=>y+(D.points||0),0);s+=d+(l.bonusA||0),i+=r+(l.bonusB||0),l.cumA=s,l.cumB=i}),t},[se,ne,ue,W]);async function He(t={}){const{force:s=!1}=t;if(he.trim())return;if(Tt(!0),!s&&de.length>0&&ss){Se(!0);return}try{g&&b.length>0&&await x.ensureLoaded(b)}catch{}console.group("RoundGenerator.generate"),console.log("Filters:",{selectedTournaments:b,selectedCategories:C,roundRanges:c,count:le,questionType:re});const i=Ee();ye(i),i.length===0&&h("No questions match the criteria provided.","error",5e3),Ve(!0),console.groupEnd()}async function bt(){if(!p?.user){window.alert?.("Please log in to save rounds.");return}rt(!0);try{let t=de;if((!t||t.length===0)&&(t=Ee(),ye(t)),!t||t.length===0)return;const s=new Date,l={title:`Round at ${s.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})} on ${s.toLocaleDateString()}`,questionType:re,count:t.length,tournaments:b,categories:C,roundRanges:c,pairs:t.map(r=>({tossupId:r.tossup?.id||null,bonusId:r.bonus?.id||null,tossupMeta:r.tossup?{tournament:r.tossup.tournament,round:r.tossup.round,question_number:r.tossup.question_number,category:r.tossup.category}:null,bonusMeta:r.bonus?{tournament:r.bonus.tournament,round:r.bonus.round,question_number:r.bonus.question_number,category:r.bonus.category}:null}))},d=await ms(p.user.uid,l);N(r=>[{id:d,title:l.title,createdAt:{seconds:Math.floor(Date.now()/1e3)},count:l.count},...r]),h("Round saved to your account.","success"),Ve(!1)}catch(t){console.error(t),window.alert?.(`Failed to save round: ${t.message||String(t)}`),h(`Failed to save round: ${t.message||String(t)}`,"error",6e3)}finally{rt(!1)}}async function ls(){if(g&&b.length===0&&de.length===0&&(A?.length??0)===0){window.alert?.("Select at least one tournament to generate a PDF.");return}nt(!0);try{let t=[];if(he.trim()?t=se:(t=de,(!t||t.length===0)&&(t=Ee(),ye(t),await new Promise(d=>requestAnimationFrame(()=>d())).then(()=>new Promise(d=>setTimeout(d,0))))),!t||t.length===0)return;const s=tt.current;if(!s)return;const i=await bs(),l={margin:[12,12,12,12],filename:`SciBowl-Round-${new Date().toISOString().slice(0,10)}.pdf`,image:{type:"jpeg",quality:.95},html2canvas:{scale:2,useCORS:!0,letterRendering:!0,scrollY:0},pagebreak:{mode:["css","legacy"]},jsPDF:{unit:"mm",format:"letter",orientation:"portrait"}};await i().from(s).set(l).save()}finally{nt(!1)}}async function is(t){try{if(!p?.user||!t?.id)return;const s=await Ct(p.user.uid,t.id).catch(()=>null);if(!s){h("Failed to open round details.","error");return}const i=new Set;for(const P of s.pairs||[])P?.tossupMeta?.tournament&&i.add(P.tossupMeta.tournament),P?.bonusMeta?.tournament&&i.add(P.bonusMeta.tournament);const l=Array.from(i);try{g&&l.length&&await x.ensureLoaded(l)}catch{}const d=g?x.getLoadedQuestions(l.length?l:b):v,r=new Map;for(const P of d)r.set(P.id,P);let y=(s.pairs||[]).map(P=>({tuId:P.tossupId||null,boId:P.bonusId||null,tossup:P.tossupId&&r.get(P.tossupId)||null,bonus:P.bonusId&&r.get(P.bonusId)||null}));if(y.some(P=>P.tuId&&!P.tossup||P.boId&&!P.bonus)){const P=g?x.getLoadedQuestions(Array.from(new Set([...l||[],...b]))):v,U=new Map;for(const H of P)U.set(H.id,H);y=y.map(H=>({...H,tossup:H.tossup||H.tuId&&U.get(H.tuId)||null,bonus:H.bonus||H.boId&&U.get(H.boId)||null}))}const D=y.map(({tossup:P,bonus:U})=>({tossup:P,bonus:U})).filter(P=>P.tossup||P.bonus);if(!D.length){h("Round questions are not available in the current dataset.","error");return}ye(D),Ve(!1),ht("");try{Array.isArray(s.tournaments)&&s.tournaments.length&&f(s.tournaments),Array.isArray(s.categories)&&$(s.categories),s.roundRanges&&S(s.roundRanges),s.questionType&&ve(s.questionType)}catch{}Ge(),window.scrollTo({top:0,behavior:"smooth"}),h("Round opened.","success")}catch(s){h(s?.message||"Failed to open round.","error")}}return e.jsxs("div",{className:`grid gap-6 md:grid-cols-3 max-w-[100vw] w-full overflow-x-hidden ${ee?"transition-all":""}`,style:ee?{paddingRight:420}:void 0,children:[e.jsx("div",{className:`md:self-start ${ee?"hidden":""}`,children:e.jsxs("div",{className:"glass p-6 space-y-6 overflow-x-hidden min-w-0",children:[e.jsx(Ys,{searchInput:es,setSearchInput:ts,committedSearch:he,setCommittedSearch:ht}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Question Type"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("label",{className:"chip cursor-pointer",children:[e.jsx("input",{type:"radio",name:"qtype",value:"both",checked:re==="both",onChange:()=>ve("both"),className:"mr-1"})," Both"]}),e.jsxs("label",{className:"chip cursor-pointer",children:[e.jsx("input",{type:"radio",name:"qtype",value:"tossup",checked:re==="tossup",onChange:()=>ve("tossup"),className:"mr-1"})," Toss-ups"]}),e.jsxs("label",{className:"chip cursor-pointer",children:[e.jsx("input",{type:"radio",name:"qtype",value:"bonus",checked:re==="bonus",onChange:()=>ve("bonus"),className:"mr-1"})," Bonuses"]}),e.jsxs("label",{className:"chip cursor-pointer",title:"Bonuses that have associated visual images",children:[e.jsx("input",{type:"radio",name:"qtype",value:"visual-bonus",checked:re==="visual-bonus",onChange:()=>ve("visual-bonus"),className:"mr-1"})," Visual bonuses"]})]})]}),b.length===0&&e.jsxs("div",{role:"alert","aria-live":"polite",className:"flex items-start gap-2 rounded-lg border-l-4 border-amber-500 bg-amber-50 text-amber-900 dark:border-amber-400 dark:bg-amber-900/20 dark:text-amber-100 px-3 py-2",children:[e.jsx(As,{className:"mt-0.5 h-4 w-4 shrink-0"}),e.jsx("div",{className:"text-sm",children:"No tournaments selected."})]}),e.jsx(fs,{tournaments:F,tournamentGroups:T,selectedTournaments:b,setSelectedTournaments:f,tournamentGroupsOpen:E,setTournamentGroupsOpen:I,handleTournamentToggle:R,tournamentVisibleEntriesMainRef:u,isDark:$t,showTournamentModal:o,setShowTournamentModal:w}),p?.user&&e.jsx($s,{auth:p,roundsIndex:L,setRoundsIndex:N,roundFolders:X,setRoundFolders:K,loadingUserRounds:j,refresh:Rt,selectedExcludeRoundIds:oe,setSelectedExcludeRoundIds:ce,foldersOpen:Z,setFoldersOpen:Ae,handleExcludeRoundToggle:At,pushToast:h,setManagerSelection:be,setShowRoundsManager:We,setFolderDeleteTarget:De,setDeleteTarget:Fe,onViewRound:is}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold mb-2 flex items-center gap-2",children:["Categories",e.jsx("button",{className:"chip px-2 py-0.5 text-xs",onClick:()=>$([]),children:"Clear"}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs",onClick:()=>$(_),children:"Select All"}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs",onClick:()=>{new Set(_),$(t=>_.filter(s=>!t.includes(s)))},children:"Invert"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 min-w-0",children:_.map(t=>{const s=C.includes(t);return e.jsxs("label",{className:`chip cursor-pointer ${s?"ring-1 ring-tint bg-tint/10":""}`,title:t,children:[e.jsx("input",{type:"checkbox",className:"mr-1",checked:s,onChange:()=>$(i=>i.includes(t)?i.filter(l=>l!==t):[...i,t])}),e.jsx("span",{className:"truncate max-w-[12rem] inline-block align-middle",children:t})]},t)})})]}),e.jsx(Ds,{selectedTournaments:b,tournaments:F,roundRanges:c,setRoundRanges:S,roundsByTournament:q,globalNumericRoundMax:M}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"text-black dark:text-white",children:"Count"}),e.jsx("input",{type:"number",min:1,max:50,className:"w-24 rounded-lg border border-black/10 bg-white dark:bg-darkcard text-black dark:text-white px-2 py-1",value:le,onChange:t=>Mt(Number(t.target.value))})]}),e.jsxs("div",{className:"pt-2 flex flex-wrap justify-center gap-4 w-full",children:[e.jsxs("button",{className:"btn btn-fancy flex items-center gap-2 hover-lift",onClick:He,style:{minWidth:140},children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 4V2m0 20v-2m7-7h-2M4 12H2m16.24-6.24l-1.42 1.42M6.34 17.66l-1.42 1.42M17.66 17.66l-1.42-1.42M6.34 6.34l-1.42-1.42M12 8a4 4 0 100 8 4 4 0 000-8z"})}),"Generate"]}),p?.user?e.jsxs("button",{className:"btn btn-outline-fancy flex items-center gap-2 hover-lift disabled:opacity-50 disabled:cursor-not-allowed",onClick:bt,disabled:Re||de.length===0,style:{minWidth:140},children:[e.jsx(vt,{className:"h-5 w-5"}),Re?"Saving…":"Save Round"]}):e.jsxs("button",{className:"btn btn-outline-fancy flex items-center gap-2 hover-lift disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>window.alert?.("Log in to save rounds."),disabled:de.length===0,style:{minWidth:140},children:[e.jsx(vt,{className:"h-5 w-5"}),"Save Round"]}),e.jsx("button",{className:"btn btn-ghost btn-sm hover-lift disabled:opacity-50 disabled:cursor-not-allowed",disabled:st,onClick:ls,title:"Generate and export as PDF",children:st?e.jsxs("span",{className:"inline-flex items-center",children:[e.jsx("span",{className:"h-4 w-4 mr-2 inline-block animate-spin rounded-full border-2 border-current border-t-transparent","aria-hidden":"true"}),"Generating..."]}):e.jsxs("span",{className:"inline-flex items-center",children:[e.jsx(Rs,{className:"h-4 w-4 mr-1"})," Generate PDF"]})}),e.jsxs("button",{className:`btn flex items-center gap-2 hover-lift disabled:opacity-50 disabled:cursor-not-allowed ${ee?"btn-orange":"btn-fancy"}`,onClick:()=>{ee||Ge(),at(t=>!t)},style:{minWidth:140},title:ee?"Close Scorekeeper":"Open Scorekeeper",disabled:de.length===0,children:[e.jsx(Bs,{className:"h-5 w-5"})," ",ee?"Close":"Scorekeeper"]})]})]})}),e.jsxs("div",{className:`${ee?"md:col-span-3":"md:col-span-2"} space-y-4 min-w-0 overflow-x-hidden`,children:[null,se.length===0&&e.jsx("div",{className:"glass p-6",role:"status","aria-live":"polite",children:he.trim()?"No matches found.":Lt?"No questions match the criteria provided.":"No questions generated yet."}),se.map((t,s)=>{const l=(!ee||s===V)&&(!ee||!t.tossup||ne[s]?.result==="correct"||s<V);return e.jsx(Ws,{pair:t,index:s,scorekeeping:ee,currentIndex:V,tossupResults:ne,showBonusContent:l,questionRef:d=>{ut.current[s]=d}},`${t.tossup?.id??"tu"}-${t.bonus?.id??"bo"}-${s}`)})]}),ee&&e.jsx(Ks,{headerOffset:Oe,close:()=>at(!1),currentIndex:V,displayPairs:se,awaitingPlayer:te,interruptArmed:zt,setAwaitingPlayer:ge,setInterruptArmed:ke,isTossupFinal:Yt,recordNoAnswer:Ht,throwOutAndReplace:Xt,tossupResults:ne,bonusResults:ue,saveFixedBonus:Kt,players:W,handleSeatClick:Wt,allowedTeams:ot,totalPoints:Gt,teamPoints:Vt,saveBonusPoints:Qt,subMode:qt,setSubMode:()=>{ct(!0)},resetScorekeeping:Ge,exportCoachesScoresheetPdf:Zt,coachesSheetLoading:Jt,tryoutsMode:Ne,setTryoutsMode:lt,questionType:re}),e.jsx(Qs,{displayPairs:se,QUESTIONS_PER_PAGE:Ft,pdfRef:tt}),It&&e.jsxs("button",{type:"button",onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),"aria-label":"Back to top",className:"fixed bottom-6 right-6 z-40 inline-flex items-center gap-2 rounded-full bg-tint text-white shadow-lg px-4 py-2 hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-tint",children:[e.jsx(Ls,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Top"})]}),ns&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>Se(!1)}),e.jsxs("div",{className:"relative bg-white dark:bg-darkcard rounded-lg shadow-xl max-w-sm w-full p-6 space-y-4 border border-black/10 dark:border-white/10",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Unsaved round"}),e.jsx("p",{className:"text-sm leading-relaxed text-black/70 dark:text-white/70",children:"You already have a generated round that hasn't been saved. What would you like to do?"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{disabled:Re,onClick:async()=>{await bt(),Se(!1),He({force:!0})},className:"btn btn-primary w-full justify-center disabled:opacity-60",children:Re?"Saving…":"Save & Generate New"}),e.jsx("button",{onClick:()=>{Se(!1),console.log("Discarding unsaved round and generating new"),He({force:!0})},className:"btn btn-orange w-full justify-center",children:"Generate Without Saving"}),e.jsx("button",{onClick:()=>Se(!1),className:"btn btn-ghost w-full justify-center",children:"Cancel"})]})]})]}),fe&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>!Ie&&Fe(null)}),e.jsxs("div",{className:"relative bg-white dark:bg-darkcard rounded-lg shadow-xl max-w-sm w-full p-6 space-y-5 border border-black/10 dark:border-white/10",children:[e.jsx("h2",{className:"text-lg font-semibold flex items-center gap-2 text-red-600 dark:text-red-300",children:"Delete Round"}),e.jsxs("div",{className:"text-sm leading-relaxed text-black/70 dark:text-white/70",children:["Are you sure you want to delete",e.jsxs("span",{className:"font-medium text-black dark:text-white",children:[" ",fe.title||"this round"]}),"? This action cannot be undone."]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{disabled:Ie,onClick:async()=>{if(!(!p?.user||!fe)){ft(!0);try{await ze(p.user.uid,fe.id),N(t=>t.filter(s=>s.id!==fe.id)),ce(t=>t.filter(s=>s!==fe.id)),_e.current.delete(fe.id),Fe(null),h("Round deleted.","error")}catch(t){console.error(t),h(t?.message||"Failed to delete round.","error",6e3)}finally{ft(!1)}}},className:"btn btn-orange w-full justify-center disabled:opacity-60",children:Ie?"Deleting…":"Delete Permanently"}),e.jsx("button",{disabled:Ie,onClick:()=>Fe(null),className:"btn btn-ghost w-full justify-center",children:"Cancel"})]})]})]}),we&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>!$e&&De(null)}),e.jsxs("div",{className:"relative bg-white dark:bg-darkcard rounded-lg shadow-xl max-w-sm w-full p-6 space-y-5 border border-black/10 dark:border-white/10",children:[e.jsx("h2",{className:"text-lg font-semibold flex items-center gap-2 text-red-600 dark:text-red-300",children:"Delete Folder"}),e.jsxs("div",{className:"text-sm leading-relaxed text-black/70 dark:text-white/70",children:["Delete folder ",e.jsx("span",{className:"font-semibold text-black dark:text-white",children:we.name})," and its ",we.count," round(s)? This cannot be undone."]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{disabled:$e,onClick:async()=>{if(p?.user){xt(!0);try{await Bt(we.name,we.roundIds),K(t=>t.filter(s=>s!==we.name)),be(new Set),De(null)}finally{xt(!1)}}},className:"btn btn-orange w-full justify-center disabled:opacity-60",children:$e?"Deleting…":"Delete Permanently"}),e.jsx("button",{disabled:$e,onClick:()=>De(null),className:"btn btn-ghost w-full justify-center",children:"Cancel"})]})]})]}),e.jsx(Xs,{open:Ut,onClose:()=>{ct(!1),it(!1)},players:W,onSubmit:({team:t,playerId:s,newName:i})=>{Be(l=>{if(l.filter(U=>U.team===t).length>=5)return l;const r=l.map(U=>U.id===s?{...U,status:"replaced"}:U),y=r.filter(U=>U.team===t).map(U=>U.seat).filter(Boolean),D=Math.max(0,...y,4)+(y.includes(5)?0:1),P={id:Pt.current++,team:t,seat:D>5?D:5,name:i,status:"active",stats:{correct:0,incorrect:0,correctInterrupt:0,incorrectInterrupt:0}};return[...r,P]}),h(`Substitution: ${i} entered for Team ${t}.`,"success")}}),rs&&e.jsxs("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>We(!1)}),e.jsxs("div",{className:"relative bg-white dark:bg-darkcard rounded-lg shadow-xl max-w-3xl w-full p-6 space-y-4 border border-black/10 dark:border-white/10 flex flex-col max-h-[85vh]",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Manage Saved Rounds"}),e.jsx("button",{className:"btn btn-ghost btn-sm",onClick:()=>We(!1),children:"Close"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{className:"chip px-3 py-1",onClick:()=>be(new Set(L.map(t=>t.id))),children:"Select All"}),e.jsx("button",{className:"chip px-3 py-1",onClick:()=>be(new Set),children:"Clear"}),e.jsx("button",{className:"chip px-3 py-1",onClick:()=>be(t=>new Set(L.filter(s=>!t.has(s.id)).map(s=>s.id))),children:"Invert"}),e.jsx("button",{className:"chip px-3 py-1",onClick:()=>{ce(Array.from(xe)),h("Excluded rounds updated.","success")},children:"Apply Exclusions"}),e.jsx("button",{className:"chip px-3 py-1 text-red-600 border-red-200 hover:bg-red-50 dark:text-red-300 dark:border-red-700 dark:hover:bg-red-900/30",onClick:async()=>{if(!p?.user)return;if(xe.size===0){h("No rounds selected.","error");return}if(!window.confirm(`Delete ${xe.size} selected round(s)? This cannot be undone.`))return;const t=Array.from(xe);let s=0;for(const i of t)try{await ze(p.user.uid,i),s++}catch{}N(i=>i.filter(l=>!xe.has(l.id))),ce(i=>i.filter(l=>!xe.has(l))),be(new Set),h(`Deleted ${s} round(s).`,"error")},children:"Delete Selected"})]}),e.jsx("div",{className:"flex-1 overflow-auto rounded border border-black/10 dark:border-white/10",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-black/5 dark:bg-white/10 backdrop-blur",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-3 py-2 w-10",children:"Sel"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Title"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Folder"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Count"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Created"})]})}),e.jsx("tbody",{children:L.map(t=>{const s=t.createdAt?.seconds?new Date(t.createdAt.seconds*1e3):null;return e.jsxs("tr",{className:"odd:bg-black/0 even:bg-black/5 dark:even:bg-white/5 hover:bg-tint/10",children:[e.jsx("td",{className:"px-3 py-1.5",children:e.jsx("input",{type:"checkbox",checked:xe.has(t.id),onChange:()=>be(i=>{const l=new Set(i);return l.has(t.id)?l.delete(t.id):l.add(t.id),l})})}),e.jsx("td",{className:"px-3 py-1.5 truncate max-w-[280px]",title:t.title,children:t.title||"Untitled"}),e.jsx("td",{className:"px-3 py-1.5",children:t.folder||""}),e.jsx("td",{className:"px-3 py-1.5",children:t.count??""}),e.jsx("td",{className:"px-3 py-1.5 whitespace-nowrap",children:s?s.toLocaleDateString():""})]},t.id)})})]})})]})]}),e.jsx("div",{className:"fixed top-4 right-4 z-[60] flex flex-col gap-3 w-[min(92vw,360px)] pointer-events-none",children:B.map(t=>e.jsxs("div",{className:"group pointer-events-auto relative overflow-hidden rounded-md px-4 py-3 pr-10 text-sm shadow-lg flex items-start gap-3 animate-toast-enter "+(t.type==="success"?"bg-emerald-600 text-white":t.type==="error"?"bg-red-600 text-white":"bg-neutral-800 text-white"),role:"status","aria-live":"polite",children:[e.jsx("div",{className:"flex-1 break-words leading-relaxed",children:t.message}),e.jsx("button",{className:"absolute top-1.5 right-1.5 rounded p-1 text-white/70 hover:text-white hover:bg-white/10 transition-colors","aria-label":"Dismiss notification",onClick:()=>m(s=>s.filter(i=>i.id!==t.id)),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"h-4 w-4",children:e.jsx("path",{fillRule:"evenodd",d:"M4.22 4.22a.75.75 0 011.06 0L10 8.94l4.72-4.72a.75.75 0 111.06 1.06L11.06 10l4.72 4.72a.75.75 0 11-1.06 1.06L10 11.06l-4.72 4.72a.75.75 0 01-1.06-1.06L8.94 10 4.22 5.28a.75.75 0 010-1.06z",clipRule:"evenodd"})})}),e.jsx("span",{className:"absolute bottom-0 left-0 h-0.5 bg-white/70 group-hover:bg-white",style:{width:"100%",transformOrigin:"left",animation:`toast-bar-${t.id} ${t.ttl}ms linear forwards`}}),e.jsx("style",{children:`@keyframes toast-disappear { to { opacity:0; transform: translateY(-4px); } }
                @keyframes toast-enter { from { opacity:0; transform: translateY(-4px) scale(.98); } to { opacity:1; transform: translateY(0) scale(1); } }
                .animate-toast-enter { animation: toast-enter 160ms cubic-bezier(.4,0,.2,1); }
              `}),e.jsx("style",{children:`@keyframes toast-bar-${t.id} { from { transform: scaleX(1); } to { transform: scaleX(0); } }`})]},t.id))})]})}export{Pr as default};
