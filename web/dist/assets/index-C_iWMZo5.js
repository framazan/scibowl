const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PracticeMode-Cz-HKjRG.js","assets/vendor-react-DpsG3A-O.js","assets/vendor-abs-svg-path-DCUpb6Nw.js","assets/visualBonuses-DFQrNomD.js","assets/vendor-firebase-storage-D1N4MLec.js","assets/vendor-firebase-app-DqcDUDC6.js","assets/vendor-firebase-component-B9jxOSis.js","assets/vendor-firebase-util-CIVODmCg.js","assets/vendor-firebase-logger-CNz1B4Yj.js","assets/vendor-idb-BXWtuYvb.js","assets/vendor-lucide-react-DoOgXp02.js","assets/vendor-react-dom-D1u-fJLi.js","assets/vendor-scheduler-CoSDG3-6.js","assets/vendor-firebase-BZrYkTdu.js","assets/vendor-firebase-app-check-Co35-rT3.js","assets/vendor-firebase-firestore-BRp-7IKb.js","assets/vendor-firebase-webchannel-wrapper-QS5lB7L3.js","assets/vendor-firebase-database-DcYXcGm3.js","assets/vendor-react-helmet-async-bvMvt1Ax.js","assets/vendor-react-fast-compare-BCtOC5yC.js","assets/vendor-invariant-DW3JcdOx.js","assets/vendor-shallowequal-Df9Q-7bk.js","assets/vendor-react-router-dom-D6uELkfw.js","assets/vendor-react-router-B_FrsTVh.js","assets/vendor-remix-run-router-9r-WWGj9.js","assets/vendor-mui-material-DksXbHt-.js","assets/vendor-mui-utils-B23qfrSe.js","assets/vendor-clsx-B-dksMZM.js","assets/vendor-mui-system-BndTH9qf.js","assets/vendor-mui-styled-engine-CPmDJbkS.js","assets/vendor-emotion-styled-5vLscvJp.js","assets/vendor-babel-runtime-WXw8LxeR.js","assets/vendor-emotion-serialize-B6qc6euy.js","assets/vendor-emotion-hash-WldOFDRm.js","assets/vendor-emotion-unitless-x5IvBceT.js","assets/vendor-emotion-memoize-3S_6p140.js","assets/vendor-emotion-use-insertion-effect-with-fallbacks-B--OEmuQ.js","assets/vendor-emotion-utils-BijCJQMc.js","assets/vendor-emotion-is-prop-valid-DOnQZHJ6.js","assets/vendor-emotion-react-DrbGOuDy.js","assets/vendor-hoist-non-react-statics-mDtaWys7.js","assets/vendor-react-is-CnyDuYXe.js","assets/vendor-emotion-cache-DvsOMRO7.js","assets/vendor-emotion-sheet-6IwnyhEX.js","assets/vendor-stylis-DDa9OTMq.js","assets/vendor-react-transition-group-Q1VPUTjR.js","assets/vendor-katex-DP_4UPSs.js","assets/vendor-katex-CIur2ABi.css","assets/Admin-CVVe3Ql1.js","assets/RoundGenerator-Db1e6qGS.js","assets/vendor-react-pdf-renderer-DfOTdHag.js","assets/vendor-queue-IZnSDwnG.js","assets/vendor-inherits-BICa84dG.js","assets/vendor-events-DQ172AOg.js","assets/vendor-react-pdf-font-ByacAZ2x.js","assets/vendor-cross-fetch-DvOI2u39.js","assets/vendor-fontkit-5mDwoQ7O.js","assets/vendor-restructure-DwIbRzqP.js","assets/vendor-swc-helpers-DIxjOVuh.js","assets/vendor-fast-deep-equal-DtIvihjZ.js","assets/vendor-unicode-properties-BbL32wKl.js","assets/vendor-base64-js-BJmSPyJr.js","assets/vendor-unicode-trie-rSh8NucD.js","assets/vendor-tiny-inflate-BmeP50H3.js","assets/vendor-dfa-DFRa2UL2.js","assets/vendor-clone-DniFCc4t.js","assets/vendor-brotli-CUuIRSoC.js","assets/vendor-tslib-kHcLnhpD.js","assets/vendor-react-pdf-render-DYs5yDRr.js","assets/vendor-react-pdf-primitives-B6ApagcG.js","assets/vendor-react-pdf-fns-DIcDsgsD.js","assets/vendor-parse-svg-path-Bi0KIs1g.js","assets/vendor-normalize-svg-path-CFWHe3yZ.js","assets/vendor-svg-arc-to-cubic-bezier-DEq50KMd.js","assets/vendor-color-string-BKSasjlw.js","assets/vendor-color-name-Dju3oUBS.js","assets/vendor-simple-swizzle-3gX0Onlb.js","assets/vendor-is-arrayish-DyGeW-O8.js","assets/vendor-react-pdf-pdfkit-CgWEQEi-.js","assets/vendor-pako-CNe1bWpJ.js","assets/vendor-crypto-js-C9XMI5TL.js","assets/vendor-jay-peg-DnV82Tak.js","assets/vendor-react-pdf-png-js-D_OjzuBh.js","assets/vendor-react-pdf-layout-CVT9JNgr.js","assets/vendor-react-pdf-stylesheet-B2kC1IpU.js","assets/vendor-postcss-value-parser-DOXmp8r9.js","assets/vendor-hsl-to-hex-CDkcI7Vq.js","assets/vendor-hsl-to-rgb-for-reals-jL61FXS_.js","assets/vendor-media-engine-BWjc9dwl.js","assets/vendor-react-pdf-textkit-R3VqYnwu.js","assets/vendor-bidi-js-DLACMwmw.js","assets/vendor-hyphen-B2aENclZ.js","assets/vendor-yoga-layout-nAHjiEuJ.js","assets/vendor-react-pdf-image-BJ1YGwqv.js","assets/vendor-object-assign-Dm9xdUEz.js","assets/vendor-react-katex-CCCXQq7R.js","assets/vendor-prop-types-Chjiymov.js"])))=>i.map(i=>d[i]);
import{r as f,j as e,b as B}from"./vendor-react-DpsG3A-O.js";import{c as Pn}from"./vendor-react-dom-D1u-fJLi.js";import{g as Tn,o as Ln,G as Bn,s as Dn,a as Un,c as _n,b as In,d as $n}from"./vendor-firebase-BZrYkTdu.js";import{i as Fn,a as Gn,g as Hn}from"./vendor-firebase-app-check-Co35-rT3.js";import{g as _t,a as re,d as H,c as Xe,b as Wn,s as me,u as W,e as ze,f as Ht,r as Wt,h as Jn,i as qn,j as Ze,o as xt,q as vs,w as Ss}from"./vendor-firebase-firestore-BRp-7IKb.js";import{c as As,i as Kn}from"./vendor-firebase-app-DqcDUDC6.js";import"./vendor-firebase-logger-CNz1B4Yj.js";import{g as Qn}from"./vendor-firebase-storage-D1N4MLec.js";import{H as Jt,a as Vn}from"./vendor-react-helmet-async-bvMvt1Ax.js";import{L as Ds,c as Yn,R as Xn}from"./vendor-react-router-dom-D6uELkfw.js";import{s as Zn,S as er}from"./vendor-mui-material-DksXbHt-.js";import{c as Se,d as qt,f as yt,g as tr}from"./vendor-react-router-B_FrsTVh.js";import"./vendor-katex-DP_4UPSs.js";import{g as wt,r as V,o as ie,a as ee,q as Kt,l as Us,b as Qt,s as Le,c as sr,d as nr,u as K,e as ge,f as Me,h as Oe,p as Vt,i as rr,j as ar,k as ir}from"./vendor-firebase-database-DcYXcGm3.js";import{L as It,S as $t,M as or,C as Rt,a as Mt,b as Cs,A as cr,P as lr,c as dr,H as ur}from"./vendor-lucide-react-DoOgXp02.js";import"./vendor-abs-svg-path-DCUpb6Nw.js";import"./vendor-scheduler-CoSDG3-6.js";import"./vendor-firebase-util-CIVODmCg.js";import"./vendor-firebase-component-B9jxOSis.js";import"./vendor-firebase-webchannel-wrapper-QS5lB7L3.js";import"./vendor-idb-BXWtuYvb.js";import"./vendor-react-fast-compare-BCtOC5yC.js";import"./vendor-invariant-DW3JcdOx.js";import"./vendor-shallowequal-Df9Q-7bk.js";import"./vendor-remix-run-router-9r-WWGj9.js";import"./vendor-mui-utils-B23qfrSe.js";import"./vendor-clsx-B-dksMZM.js";import"./vendor-mui-system-BndTH9qf.js";import"./vendor-mui-styled-engine-CPmDJbkS.js";import"./vendor-emotion-styled-5vLscvJp.js";import"./vendor-babel-runtime-WXw8LxeR.js";import"./vendor-emotion-serialize-B6qc6euy.js";import"./vendor-emotion-hash-WldOFDRm.js";import"./vendor-emotion-unitless-x5IvBceT.js";import"./vendor-emotion-memoize-3S_6p140.js";import"./vendor-emotion-use-insertion-effect-with-fallbacks-B--OEmuQ.js";import"./vendor-emotion-utils-BijCJQMc.js";import"./vendor-emotion-is-prop-valid-DOnQZHJ6.js";import"./vendor-emotion-react-DrbGOuDy.js";import"./vendor-hoist-non-react-statics-mDtaWys7.js";import"./vendor-react-is-CnyDuYXe.js";import"./vendor-emotion-cache-DvsOMRO7.js";import"./vendor-emotion-sheet-6IwnyhEX.js";import"./vendor-stylis-DDa9OTMq.js";import"./vendor-react-transition-group-Q1VPUTjR.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function a(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=a(i);fetch(i.href,n)}})();const mr="modulepreload",hr=function(t){return"/"+t},Es={},Be=function(s,a,r){let i=Promise.resolve();if(a&&a.length>0){let l=function(m){return Promise.all(m.map(d=>Promise.resolve(d).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),c=o?.nonce||o?.getAttribute("nonce");i=l(a.map(m=>{if(m=hr(m),m in Es)return;Es[m]=!0;const d=m.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${u}`))return;const y=document.createElement("link");if(y.rel=d?"stylesheet":mr,d||(y.as="script"),y.crossOrigin="",y.href=m,c&&y.setAttribute("nonce",c),document.head.appendChild(y),d)return new Promise((h,w)=>{y.addEventListener("load",h),y.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${m}`)))})}))}function n(o){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=o,window.dispatchEvent(c),!c.defaultPrevented)throw o}return i.then(o=>{for(const c of o||[])c.status==="rejected"&&n(c.reason);return s().catch(n)})},fr={apiKey:"AIzaSyC-4y146WLvcjfTg1IrnRgpLJGLir3Kv6E",authDomain:"sciencebowl.org",projectId:"scibowl-analytics",storageBucket:"scibowl-analytics.firebasestorage.app",messagingSenderId:"579454885012",appId:"1:579454885012:web:2015104d8f5e3a6a302881"};let Ot;function De(){return As().length?Ot=As()[0]:Ot=Kn(fr),Ot}function G(){return Ue(),_t(De())}function oe(){return Ue(),Tn(De())}function Mi(){return Ue(),Qn(De())}let Pt=null;function Ue(){try{window.FIREBASE_APPCHECK_DEBUG_TOKEN==="true"&&(self.FIREBASE_APPCHECK_DEBUG_TOKEN=!0);const t=De();if(!Pt){const a="6LdP4s8rAAAAAH5skwAWa08TPDuqwlRul6Ild4xl";a&&(Pt=Fn(t,{provider:new Gn(a),isTokenAutoRefreshEnabled:!0}))}return Pt}catch{return null}}async function pr(t=!1){try{const s=Ue();return s&&(await Hn(s,t))?.token||null}catch{return null}}function jt(t={}){const s=t.roundSubcollection||"rounds",[a,r]=f.useState([]),[i,n]=f.useState(!0),[o,c]=f.useState(null),[l,m]=f.useState(!1),[d,u]=f.useState(null),y=f.useRef(new Map),h=7200*60*1e3,w=f.useRef(null);function p(){return new Promise((j,v)=>{if(w.current)return j(w.current);const k=indexedDB.open("scibowl-rounds-cache",1);k.onupgradeneeded=()=>{const z=k.result;z.objectStoreNames.contains("rounds")||z.createObjectStore("rounds")},k.onsuccess=()=>{w.current=k.result,j(k.result)},k.onerror=()=>v(k.error)})}async function E(j){try{const v=await p();return await new Promise((k,z)=>{const P=v.transaction("rounds","readonly").objectStore("rounds").get(j);P.onsuccess=()=>k(P.result||null),P.onerror=()=>z(P.error)})}catch{return null}}async function g(j,v){try{const k=await p();await new Promise((z,N)=>{const T=k.transaction("rounds","readwrite").objectStore("rounds").put(v,j);T.onsuccess=()=>z(),T.onerror=()=>N(T.error)})}catch{}}f.useEffect(()=>{let j=!1;return(async()=>{try{n(!0);const v=await E("meta:tournaments");v&&!j&&r(v.list||[]);const k=G(),z=await re(H(k,"meta","tournaments"));if(!z.exists())throw new Error("meta/tournaments document not found");const N=z.data().list||[];j||r(N),g("meta:tournaments",{list:N,updatedAt:Date.now()})}catch(v){j||c(v)}finally{j||n(!1)}})(),()=>{j=!0}},[]);async function S(j,{force:v=!1}={}){const k=(j||[]).filter(Boolean);if(k.length===0)return;m(!0),u(null);const z=G();try{for(const N of k){if(y.current.get(N)&&!v)continue;const P=await E(`t:${N}`),T=P&&typeof P.updatedAt=="number"&&Date.now()-P.updatedAt<=h;if(P&&T&&!v){y.current.set(N,P.payload);continue}const $=Xe(z,"tournaments",N,s),_=await Wn($),Z={},D=[];_.forEach(F=>{const q=F.data(),I=F.id;Z[I]={id:I,...q};const ce=Array.isArray(q.tossups)?q.tossups:[],we=Array.isArray(q.bonuses)?q.bonuses:[];for(const U of ce){const Y=U._origId||U.origId||U.id;D.push({...U,id:Y||`${N}__${I}__tu__${U.question_number}`,tournament:N,round:I})}for(const U of we){const Y=U._origId||U.origId||U.id;D.push({...U,id:Y||`${N}__${I}__bo__${U.question_number}`,tournament:N,round:I})}}),y.current.set(N,{rounds:Z,flatQuestions:D}),g(`t:${N}`,{payload:{rounds:Z,flatQuestions:D},updatedAt:Date.now()})}}catch(N){u(N)}finally{m(!1)}}function C(j){const v=[];for(const k of j||[]){const z=y.current.get(k);z?.flatQuestions&&v.push(...z.flatQuestions)}return v}function x(j){const v=y.current.get(j);return v?Object.values(v.rounds).sort((k,z)=>k.round?.localeCompare?.(z.round||"")||0):[]}return{tournaments:a,loadingTournaments:i,errorTournaments:o,loading:l,error:d,ensureLoaded:S,getLoadedQuestions:C,getRounds:x}}const xr="scibowl-user-cache",br=1;let mt=null;const _s=7200*60*1e3;function _e(){return mt||(mt=new Promise((t,s)=>{const a=indexedDB.open(xr,br);a.onupgradeneeded=()=>{const r=a.result;r.objectStoreNames.contains("roundsIndex")||r.createObjectStore("roundsIndex"),r.objectStoreNames.contains("roundDetails")||r.createObjectStore("roundDetails")},a.onsuccess=()=>t(a.result),a.onerror=()=>s(a.error)}),mt)}async function he(t){try{const s=await _e();return await new Promise((a,r)=>{const o=s.transaction("roundsIndex","readonly").objectStore("roundsIndex").get(t);o.onsuccess=()=>a(o.result||null),o.onerror=()=>r(o.error)})}catch{return null}}async function fe(t,s){try{const a=await _e();await new Promise((r,i)=>{const c=a.transaction("roundsIndex","readwrite").objectStore("roundsIndex").put(s,t);c.onsuccess=()=>r(),c.onerror=()=>i(c.error)})}catch{}}async function Yt(t,s){try{const a=await _e();return await new Promise((r,i)=>{const c=a.transaction("roundDetails","readonly").objectStore("roundDetails").get(`${t}::${s}`);c.onsuccess=()=>r(c.result||null),c.onerror=()=>i(c.error)})}catch{return null}}async function Nt(t,s,a){try{const r=await _e();await new Promise((i,n)=>{const l=r.transaction("roundDetails","readwrite").objectStore("roundDetails").put(a,`${t}::${s}`);l.onsuccess=()=>i(),l.onerror=()=>n(l.error)})}catch{}}async function gr(t,s){try{const a=await _e();await new Promise(r=>{const o=a.transaction("roundDetails","readwrite").objectStore("roundDetails").delete(`${t}::${s}`);o.onsuccess=()=>r(),o.onerror=()=>r()})}catch{}}async function yr(t){try{const s=await _e();await new Promise((a,r)=>{const i=s.transaction(["roundsIndex","roundDetails"],"readwrite"),n=i.objectStore("roundsIndex"),o=i.objectStore("roundDetails"),c=n.delete(t);c.onerror=()=>r(c.error),c.onsuccess=()=>{const l=o.getAllKeys();l.onsuccess=()=>{const m=(l.result||[]).filter(u=>typeof u=="string"&&u.startsWith(`${t}::`));let d=m.length;if(d===0){a();return}m.forEach(u=>{const y=o.delete(u);y.onsuccess=()=>{--d===0&&a()},y.onerror=()=>{--d===0&&a()}})},l.onerror=()=>a()}})}catch{}}async function Oi(t,s){if(!t)throw new Error("Not authenticated");const a=G(),r=Xe(a,"users",t,"rounds"),i=await qn(r,{...s,createdAt:Ze()}),n=H(a,"users",t,"meta","roundsIndex"),o={title:s.title,count:s.count,createdAt:Ze()};await me(n,{entries:{[i.id]:o}},{merge:!0});try{const c=Math.floor(Date.now()/1e3),l=await he(t),m=l?.entries?{...l.entries}:{};m[i.id]={title:s.title,count:s.count,createdAt:{seconds:c}},await fe(t,{entries:m,updatedAt:Date.now()}),await Nt(t,i.id,{data:{id:i.id,...s,createdAt:{seconds:c}},updatedAt:Date.now()})}catch{}return i.id}async function Pi(t,{force:s=!1}={}){if(!t)return[];if(!s){const m=await he(t);if(m&&m.entries&&!(typeof m.updatedAt=="number"?Date.now()-m.updatedAt>_s:!0)){const u=Object.entries(m.entries).map(([y,h])=>({id:y,...h}));return u.sort((y,h)=>(h.createdAt?.seconds||0)-(y.createdAt?.seconds||0)),u}}const a=G(),r=H(a,"users",t,"meta","roundsIndex"),i=await re(r);if(!i.exists())return await fe(t,{entries:{},updatedAt:Date.now()}),[];const n=i.data()||{};let o=n.entries||{};const c=n.folders||{};if(!o||Object.keys(o).length===0){const m={};for(const[d,u]of Object.entries(n))if(d.startsWith("entries.")){const y=d.slice(8);y&&(m[y]=u)}Object.keys(m).length>0&&(o=m)}await fe(t,{entries:o,folders:c,updatedAt:Date.now()});const l=Object.entries(o).map(([m,d])=>({id:m,...d}));return l.sort((m,d)=>{const u=m.createdAt?.seconds||0;return(d.createdAt?.seconds||0)-u}),l}async function Ti(t,s,{force:a=!1}={}){if(!t||!s)return null;const r=await Yt(t,s);if(r&&!a&&r&&typeof r=="object"&&"data"in r&&"updatedAt"in r&&!(typeof r.updatedAt=="number"?Date.now()-r.updatedAt>_s:!0))return r.data;const i=G(),n=H(i,"users",t,"rounds",s),o=await re(n);if(!o.exists())return null;const c={id:o.id,...o.data()};return await Nt(t,s,{data:c,updatedAt:Date.now()}),c}async function Li(t,{force:s=!1}={}){if(!t)return[];if(!s){const l=await he(t),m=l?.folders?Object.keys(l.folders):null;if(m)return m}const a=G(),r=H(a,"users",t,"meta","roundsIndex"),i=await re(r),o=(i.exists()?i.data()||{}:{}).folders||{},c=await he(t);return await fe(t,{entries:c?.entries||{},folders:o,updatedAt:Date.now()}),Object.keys(o)}async function Bi(t,s){if(!t)throw new Error("Not authenticated");const a=(s??"").toString().trim();if(!a)throw new Error("Folder name required");const r=G(),i=H(r,"users",t,"meta","roundsIndex");await me(i,{folders:{[a]:!0}},{merge:!0});const n=await he(t),o={...n?.folders||{},[a]:!0};return await fe(t,{entries:n?.entries||{},folders:o,updatedAt:Date.now()}),!0}async function Di(t,s,a){if(!t)throw new Error("Not authenticated");const r=(s??"").toString().trim(),i=(a??"").toString().trim();if(!r)throw new Error("Source folder name required");if(!i)throw new Error("Destination folder name required");if(r===i)return!0;const n=G(),o=H(n,"users",t,"meta","roundsIndex"),c=await re(o);if(!c.exists())throw new Error("No folders meta found");const l=c.data()||{},m={...l.entries||{}},d={...l.folders||{}};if(!d[r])throw new Error("Folder does not exist");if(d[i])throw new Error("A folder with that name already exists");const u={};for(const[h,w]of Object.entries(m))w&&w.folder===r&&(u[`entries.${h}.folder`]=i,m[h]={...w,folder:i});await W(o,{[`folders.${r}`]:ze(),[`folders.${i}`]:!0}).catch(async()=>{const h={folders:{[i]:!0}};await me(o,h,{merge:!0})}),Object.keys(u).length>0&&await W(o,u).catch(async()=>{await me(o,{entries:m},{merge:!0})});const y=Object.entries(m).filter(([,h])=>h.folder===i).map(([h])=>h);for(const h of y)try{const w=H(n,"users",t,"rounds",h);await W(w,{folder:i})}catch{}try{const h=await he(t);if(h){const w={...h.folders||{}};delete w[r],w[i]=!0;const p={...h.entries||{}};for(const[E,g]of Object.entries(p))g&&g.folder===r&&(p[E]={...g,folder:i});await fe(t,{entries:p,folders:w,updatedAt:Date.now()})}}catch{}return!0}async function Ui(t,s){if(!t)throw new Error("Not authenticated");const a=(s??"").toString().trim();if(!a)throw new Error("Folder name required");const r=G(),i=H(r,"users",t,"meta","roundsIndex"),n=await re(i);if(!n.exists())return!0;const o=n.data()||{};if(!{...o.folders||{}}[a])return!0;const l={...o.entries||{}},m={};for(const[d,u]of Object.entries(l))u&&u.folder===a&&(m[`entries.${d}.folder`]=ze(),delete l[d].folder);try{await W(i,{[`folders.${a}`]:ze()})}catch{}if(Object.keys(m).length>0)try{await W(i,m)}catch{await me(i,{entries:l},{merge:!0})}for(const[d,u]of Object.entries(l))if(!u.folder)try{const y=H(r,"users",t,"rounds",d);await W(y,{folder:ze()})}catch{}try{const d=await he(t);if(d){const u={...d.folders||{}};delete u[a];const y={...d.entries||{}};for(const[h,w]of Object.entries(y))if(w&&w.folder===a){const{folder:p,...E}=w;y[h]=E}await fe(t,{entries:y,folders:u,updatedAt:Date.now()})}}catch{}return!0}async function _i(t,s){if(!t||!s)throw new Error("Missing uid/roundId");const a=G(),r=H(a,"users",t,"rounds",s);try{await Ht(r)}catch{}const i=H(a,"users",t,"meta","roundsIndex");try{await W(i,{[`entries.${s}`]:ze()})}catch{try{const o=await re(i),l={...(o.exists()?o.data()||{}:{}).entries||{}};s in l&&delete l[s],await me(i,{entries:l},{merge:!0})}catch{}}try{const n=await he(t);if(n?.entries&&s in n.entries){const{[s]:o,...c}=n.entries;await fe(t,{entries:c,updatedAt:Date.now()})}await gr(t,s)}catch{}return!0}async function Ii(t,s,a){if(!t||!s)throw new Error("Missing uid/roundId");const r=G(),i=H(r,"users",t,"rounds",s),n=H(r,"users",t,"meta","roundsIndex");try{a&&a.trim().length>0?await W(i,{folder:a.trim()}):await W(i,{folder:ze()})}catch{}try{a&&a.trim().length>0?await W(n,{[`entries.${s}.folder`]:a.trim()}):await W(n,{[`entries.${s}.folder`]:ze()})}catch{a&&a.trim().length>0&&await me(n,{entries:{[s]:{folder:a.trim()}}},{merge:!0})}try{const o=await he(t);if(o?.entries){const l={...o.entries};if(l[s]||(l[s]={}),a&&a.trim().length>0)l[s]={...l[s],folder:a.trim()};else{const{folder:m,...d}=l[s];l[s]=d}await fe(t,{entries:l,updatedAt:Date.now()})}const c=await Yt(t,s);if(c&&c.data){const l={...c.data};a&&a.trim().length>0?l.folder=a.trim():delete l.folder,await Nt(t,s,{data:l,updatedAt:Date.now()})}}catch{}return!0}function $i(t){const s=new Set,a=t?.pairs||[];for(const r of a)r.tossupId&&s.add(r.tossupId),r.bonusId&&s.add(r.bonusId);return s}async function Fi(t,s,a){if(!t)throw new Error("Not authenticated");if(!s)throw new Error("Missing roundId");const r=(a??"").toString().trim();if(r.length===0)throw new Error("Title cannot be empty");const i=G(),n=H(i,"users",t,"rounds",s);await W(n,{title:r});const o=H(i,"users",t,"meta","roundsIndex");try{await W(o,{[`entries.${s}.title`]:r})}catch{await me(o,{entries:{[s]:{title:r}}},{merge:!0})}try{const c=await he(t);c&&c.entries&&c.entries[s]&&(c.entries[s]={...c.entries[s],title:r},await fe(t,{...c,updatedAt:Date.now()}));const l=await Yt(t,s);if(l&&l.data){const m={...l,data:{...l.data,title:r},updatedAt:Date.now()};await Nt(t,s,m)}}catch{}return!0}async function Gi({questionType:t="both",categories:s=[],count:a=1,adminUid:r="fkLJJ2R6HbdwqoXSxrLUybZ0IdH2"}={}){const i=G(),n=H(i,"users",r,"meta","presets");let o=[];try{const p=await re(n),E=p.exists()?p.data()||{}:{};o=Array.isArray(E?.set)?[...E.set]:[]}catch{return{roundId:null}}if(!o||o.length===0)return{roundId:null};const c=Math.max(1,Number(a)||1),l=Array.isArray(s)&&s.length?new Set(s.map(p=>String(p).toUpperCase())):null,m=(t||"both").toLowerCase();function d(p){if(!Array.isArray(p))return 0;let E=[];return m==="tossup"?E=p.filter(g=>!!g?.tossupMeta&&(!l||l.has(String(g.tossupMeta.category||"").toUpperCase()))):m==="bonus"?E=p.filter(g=>!!g?.bonusMeta&&(!l||l.has(String(g.bonusMeta.category||"").toUpperCase()))):E=p.filter(g=>!!g?.tossupMeta&&(!l||l.has(String(g.tossupMeta.category||"").toUpperCase()))),E.length}const u=[];let y=null;for(let p=0;p<o.length;p++){const E=o[p];try{const g=await re(H(i,"users",r,"rounds",E));if(!g.exists())continue;const S=g.data()?.pairs||[];d(S)>=c&&u.push({index:p,rid:E,pairs:S})}catch{}}if(u.length===0)return{roundId:null};const h=u[Math.floor(Math.random()*u.length)],w=h.rid;y=h.pairs;try{await Wt(i,async p=>{const E=await p.get(n),g=E.exists()?E.data()||{}:{},S=Array.isArray(g.set)?[...g.set]:[],C=S.indexOf(w);C!==-1&&(S.splice(C,1),p.set(n,{set:S},{merge:!0}))})}catch{try{await W(n,{set:Jn(w)})}catch{}}return{roundId:w,pairs:y}}function pe(){const[t,s]=f.useState(null),[a,r]=f.useState(!0),[i,n]=f.useState(null);f.useEffect(()=>{const d=oe(),u=Ln(d,y=>{s(y),r(!1)},y=>{n(y),r(!1)});return()=>u()},[]);const o=f.useCallback(async()=>{const d=oe(),u=new Bn;await Dn(d,u)},[]),c=f.useCallback(async(d,u)=>{const y=oe();await Un(y,d,u)},[]),l=f.useCallback(async(d,u)=>{const y=oe();await _n(y,d,u)},[]),m=f.useCallback(async()=>{const d=oe(),u=d.currentUser?.uid;await In(d),u&&await yr(u)},[]);return{user:t,loading:a,error:i,loginWithGoogle:o,loginWithEmail:c,signupWithEmail:l,logout:m}}function wr(){const t={"@context":"https://schema.org","@type":"BreadcrumbList",itemListElement:[{"@type":"ListItem",position:1,name:"Home",item:"https://sciencebowl.org/"},{"@type":"ListItem",position:2,name:"Round Generator",item:"https://sciencebowl.org/round-generator"}]};return e.jsxs(Jt,{children:[e.jsx("title",{children:"Round Generator & Practice | DA SciBowl"}),e.jsx("meta",{name:"description",content:"Generate custom Science Bowl practice rounds instantly. Filter by tournament, practice toss-ups and bonuses, and prepare for competitions."}),e.jsx("link",{rel:"canonical",href:"https://sciencebowl.org/round-generator"}),e.jsx("script",{type:"application/ld+json",children:JSON.stringify(t)})]})}function jr(){const t={"@context":"https://schema.org","@type":"BreadcrumbList",itemListElement:[{"@type":"ListItem",position:1,name:"Home",item:"https://sciencebowl.org/"},{"@type":"ListItem",position:2,name:"Practice",item:"https://sciencebowl.org/practice"}]};return e.jsxs(Jt,{children:[e.jsx("title",{children:"Science Bowl Practice Mode | Davidson Science Bowl"}),e.jsx("meta",{name:"description",content:"Practice Science Bowl questions by selecting tournaments and generating custom practice sets."}),e.jsx("link",{rel:"canonical",href:"https://sciencebowl.org/practice"}),e.jsx("script",{type:"application/ld+json",children:JSON.stringify(t)}),e.jsx("meta",{name:"robots",content:"follow"})]})}function Nr(){return e.jsxs(Jt,{children:[e.jsx("title",{children:"Sign In | Science Bowl Practice"}),e.jsx("meta",{name:"robots",content:"noindex,nofollow"}),e.jsx("meta",{name:"description",content:"Sign in to access Science Bowl round generation and practice features."}),e.jsx("link",{rel:"canonical",href:"https://sciencebowl.org/signin"})]})}const kr="scibowl_current_cache",vr=1,bt="kv";function Sr(){return new Promise((t,s)=>{const a=indexedDB.open(kr,vr);a.onerror=()=>s(a.error),a.onupgradeneeded=()=>{const r=a.result;r.objectStoreNames.contains(bt)||r.createObjectStore(bt)},a.onsuccess=()=>t(a.result)})}async function Xt(t,s){const a=await Sr();return new Promise((r,i)=>{const n=a.transaction(bt,t),o=n.objectStore(bt);let c=!1;n.oncomplete=()=>{c||r()},n.onerror=()=>{c||i(n.error)};const l=s(o);Promise.resolve(l).then(m=>{c=!0,r(m)},m=>{c=!0,i(m)})})}async function Ar(t){return Xt("readonly",s=>new Promise((a,r)=>{const i=s.get(t);i.onsuccess=()=>a(i.result??null),i.onerror=()=>r(i.error)}))}async function Ft(t,s){return Xt("readwrite",a=>new Promise((r,i)=>{const n=a.put(s,t);n.onsuccess=()=>r(!0),n.onerror=()=>i(n.error)}))}async function ht(t){return Xt("readwrite",s=>new Promise((a,r)=>{const i=s.delete(t);i.onsuccess=()=>a(!0),i.onerror=()=>r(i.error)}))}const Is=f.createContext(null);function Cr({children:t}){const[s,a]=f.useState([]),[r,i]=f.useState([]),n=m=>{try{return Array.isArray(m)?m.map(d=>({t:d?.tossup?.id||null,b:d?.bonus?.id||null})):[]}catch{return[]}},o=m=>{try{return Array.isArray(m)?m.map(d=>({tu:d?.tossup?{id:d.tossup.id,tournament:d.tossup.tournament}:null,bo:d?.bonus?{id:d.bonus.id,tournament:d.bonus.tournament}:null})):[]}catch{return[]}},c=m=>{a(d=>{const u=typeof m=="function"?m(d):m;try{window.__sbGeneratedPairs=u,Ft("sb_current_round",n(u)),Ft("sb_current_round_meta",o(u))}catch{}return u})},l=m=>{i(d=>[...d,m]),c(m)};return f.useEffect(()=>{let m=!0;return(async()=>{if(m){try{await ht("sb_generated_history")}catch{}try{await ht("sb_generated_history_meta")}catch{}try{await ht("sb_current_round")}catch{}try{await ht("sb_current_round_meta")}catch{}}})(),()=>{m=!1}},[]),e.jsx(Is.Provider,{value:{generatedPairs:s,setGeneratedPairs:c,history:r,pushGeneratedRound:l},children:t})}function $s(){const t=f.useContext(Is);if(!t)throw new Error("useRoundSession must be used within a RoundSessionProvider");return t}const Er=Zn(er)(({theme:t})=>({width:62,height:34,padding:7,"& .MuiSwitch-switchBase":{margin:1,padding:0,transform:"translateX(6px)","&.Mui-checked":{color:"#fff",transform:"translateX(22px)","& .MuiSwitch-thumb:before":{backgroundImage:`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 20 20"><path fill="%23fff" d="M4.2 2.5l-.7 1.8-1.8.7 1.8.7.7 1.8.6-1.8L6.7 5l-1.9-.7-.6-1.8zm15 8.3a6.7 6.7 0 11-6.6-6.6 5.8 5.8 0 006.6 6.6z"/></svg>')`},"& + .MuiSwitch-track":{opacity:1,backgroundColor:t.palette.mode==="dark"?"#8796A5":"#aab4be"}}},"& .MuiSwitch-thumb":{backgroundColor:t.palette.mode==="dark"?"#003892":"#001e3c",width:32,height:32,"&::before":{content:"''",position:"absolute",width:"100%",height:"100%",left:0,top:0,backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundImage:`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 20 20"><path fill="%23fff" d="M9.305 1.667V3.75h1.389V1.667h-1.39zm-4.707 1.95l-.982.982L5.09 6.072l.982-.982-1.473-1.473zm10.802 0L13.927 5.09l.982.982 1.473-1.473-.982-.982zM10 5.139a4.872 4.872 0 00-4.862 4.86A4.872 4.872 0 0010 14.862 4.872 4.872 0 0014.86 10 4.872 4.872 0 0010 5.139zm0 1.389A3.462 3.462 0 0113.471 10a3.462 3.462 0 01-3.473 3.472A3.462 3.462 0 016.527 10 3.462 3.462 0 0110 6.528zM1.665 9.305v1.39h2.083v-1.39H1.666zm14.583 0v1.39h2.084v-1.39h-2.084zM5.09 13.928L3.616 15.4l.982.982 1.473-1.473-.982-.982zm9.82 0l-.982.982 1.473 1.473.982-.982-1.473-1.473zM9.305 16.25v2.083h1.389V16.25h-1.39z"/></svg>')`}},"& .MuiSwitch-track":{opacity:1,backgroundColor:t.palette.mode==="dark"?"#8796A5":"#aab4be",borderRadius:20/2}}));function Fs({checked:t,onChange:s,label:a}){const r=f.useCallback(()=>{s(!t)},[t,s]);return e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:12},children:[e.jsx(Er,{checked:t,onChange:i=>s(i.target.checked),inputProps:{"aria-label":"Toggle dark mode"}}),a?e.jsx("button",{type:"button",onClick:r,style:{border:"none",background:"transparent",padding:0,margin:0,color:"inherit",font:"inherit",cursor:"pointer",display:"inline-flex",alignItems:"center"},children:a}):null]})}const gt="themePreference";function zr(){try{return!!(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches)}catch{return!1}}function Re(t){return t==="dark"?!0:t==="light"?!1:zr()}async function Gs(){try{const t=localStorage.getItem(gt);if(t==="light"||t==="dark"||t==="system")return t}catch{}try{const t=await Ar(gt);if(t==="light"||t==="dark"||t==="system")return t}catch{}return"system"}async function Hs(t){try{await Ft(gt,t)}catch{}try{localStorage.setItem(gt,t)}catch{}}function Ws(t){let s;try{s=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)")}catch{}if(!s)return()=>{};const a=r=>{t(!!r.matches)};return s.addEventListener?s.addEventListener("change",a):s.addListener&&s.addListener(a),()=>{s.removeEventListener?s.removeEventListener("change",a):s.removeListener&&s.removeListener(a)}}function Rr(){const[t,s]=B.useState("system"),[a,r]=B.useState(()=>{try{return document.documentElement.classList.contains("dark")}catch{return Re("system")}});B.useEffect(()=>{let n=!0;return Gs().then(o=>{n&&(s(o),r(Re(o)))}),()=>{n=!1}},[]),B.useEffect(()=>{document.documentElement.classList.toggle("dark",a),a?document.body.classList.add("dark-bg"):document.body.classList.remove("dark-bg");let n=document.querySelector('meta[name="theme-color"]');n||(n=document.createElement("meta"),n.setAttribute("name","theme-color"),document.head.appendChild(n)),n.setAttribute("content",a?"#000000":"#ffffff")},[a]),B.useEffect(()=>{try{Hs(t)}catch{}},[t]),B.useEffect(()=>{if(t!=="system")return;r(Re("system"));const n=Ws(o=>r(!!o));return()=>n&&n()},[t]);const i=B.useCallback(n=>{s(n?"dark":"light"),r(!!n)},[]);return{themePref:t,setThemePref:s,dark:a,setDark:i}}function Ie({className:t="glass p-6",text:s="Loading…"}){return e.jsx("div",{className:t,children:s})}function Zt({auth:t}){const{themePref:s,setThemePref:a,dark:r,setDark:i}=Rr(),n=Se(),o=qt(),c=o.pathname.startsWith("/practice")?"practice":o.pathname.startsWith("/admin")?"admin":o.pathname.startsWith("/multiplayer")?"multiplayer":o.pathname.startsWith("/buzzer")?"buzzer":"generate",l=t?.user?.uid==="fkLJJ2R6HbdwqoXSxrLUybZ0IdH2",m=B.useMemo(()=>{const w=[{key:"practice",label:"Practice",path:"/practice"},{key:"generate",label:"Round Generator",path:"/round-generator"},{key:"multiplayer",label:"Multiplayer",path:"/multiplayer"},{key:"buzzer",label:"Buzzer",path:"/buzzer"}];return l&&w.push({key:"admin",label:"Admin",path:"/admin"}),w},[l]),[d,u]=B.useState({width:"0px",transform:"translateX(0px)"}),y=B.useRef([]),h=B.useRef(null);return B.useEffect(()=>{const p=m.map(g=>g.key).indexOf(c),E=p!==-1?y.current[p]?.current:null;if(E&&E.parentElement){const g=E.getBoundingClientRect(),S=E.parentElement.getBoundingClientRect();u(C=>{const x={width:`${g.width}px`,transform:`translateX(${g.left-S.left}px)`};return C.width===x.width&&C.transform===x.transform?C:x})}},[c,o.pathname,m]),B.useEffect(()=>{const w=()=>{try{if(!h.current)return;const E=h.current.getBoundingClientRect();if(E&&E.height){const g=Math.ceil(E.height);document.documentElement.style.setProperty("--header-h",`${g}px`)}}catch{}};w();const p="ResizeObserver"in window?new ResizeObserver(w):null;return p&&h.current&&p.observe(h.current),window.addEventListener("resize",w),()=>{window.removeEventListener("resize",w),p&&p.disconnect()}},[c,r]),e.jsx("header",{ref:h,className:"header-bar",style:{overflow:"visible"},children:e.jsxs("div",{className:"w-full px-3 sm:px-4 py-2 sm:py-3 flex items-center justify-between",style:{position:"relative",zIndex:10},children:[e.jsxs("div",{className:"brand-cluster flex items-center gap-2",children:[e.jsx("img",{src:"/logo.png",alt:"atombowl Logo",className:"w-8 h-8 sm:w-9 sm:h-9"}),e.jsx("div",{className:"font-semibold tracking-tight hidden lg:block",style:{color:"rgba(18, 25, 48, 1)"},children:"atombowl"}),e.jsx("div",{className:"font-semibold tracking-tight hidden sm:block lg:hidden",style:{color:"rgba(18, 25, 48, 1)"},children:"DSB"})]}),e.jsxs("nav",{className:"tabs flex items-center gap-2 relative overflow-x-auto whitespace-nowrap",style:{position:"relative"},children:[m.map((w,p)=>e.jsx("div",{ref:E=>{y.current[p]||(y.current[p]={current:null}),y.current[p].current=E},className:`tab ${c===w.key?"active":""}`,style:{padding:"16px 24px",cursor:"pointer",textAlign:"center",position:"relative",zIndex:11,color:c===w.key?"#ffffff":r?"rgba(229, 231, 235, 0.9)":"#1f2a44",fontWeight:c===w.key?"600":"500",background:c===w.key?r?"rgba(60, 80, 255, 0.35)":"linear-gradient(135deg, rgba(59,130,246,0.92), rgba(99,102,241,0.9))":r?"rgba(255,255,255,0.08)":"rgba(17, 25, 40, 0.06)",borderRadius:"16px",transition:"background 0.3s, color 0.3s, box-shadow 0.3s",boxShadow:c===w.key?r?"0 2px 12px -2px rgba(60,80,255,0.18)":"0 6px 18px -6px rgba(37, 99, 235, 0.45)":r?"none":"inset 0 0 0 1px rgba(17, 25, 40, 0.08)"},onClick:()=>{try{w.key==="admin"?(document.body.classList.add("admin-border-on"),document.documentElement.classList.add("admin-border-on")):(document.body.classList.remove("admin-border-on"),document.documentElement.classList.remove("admin-border-on"))}catch{}n(w.path)},children:w.label},w.path)),e.jsx("div",{className:"slider",style:{position:"absolute",bottom:0,left:0,height:r?"4px":"6px",background:r?"linear-gradient(90deg,rgba(60,80,255,0.7),rgba(120,80,255,0.7))":"linear-gradient(90deg, #3b82f6, #a78bfa)",borderRadius:r?"2px":"3px",boxShadow:r?"0 2px 8px rgba(60,80,255,0.18)":"0 6px 18px -6px rgba(37, 99, 235, 0.5)",transition:"transform 0.3s cubic-bezier(.4,0,.2,1), width 0.3s cubic-bezier(.4,0,.2,1)",zIndex:10,...d}}),e.jsx("div",{className:"ml-2 sm:ml-4",children:e.jsxs("div",{className:"relative inline-flex items-center group",children:[s!=="system"&&e.jsx("button",{type:"button",onClick:()=>{a("system")},className:"mr-2 hidden group-hover:inline-flex items-center px-2 py-1 rounded text-xs border border-black/10 dark:border-white/20 bg-white/70 dark:bg-black/40 backdrop-blur-sm text-black dark:text-white hover:bg-white/90 dark:hover:bg-black/60 transition","aria-label":"Follow system theme",title:"Follow system",children:"Follow system"}),e.jsx(Fs,{checked:r,onChange:w=>i(w)})]})}),e.jsx("div",{className:"ml-2 sm:ml-3",children:t?.loading?e.jsx(Ie,{className:"text-sm opacity-70"}):t?.user?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm opacity-80 max-w-[12rem] truncate hidden md:inline",children:t.user.email||t.user.displayName}),e.jsx("button",{className:"btn btn-top-maroon",onClick:t.logout,children:"Logout"})]}):e.jsx(Ds,{to:"/signin",className:"btn btn-primary hidden xs:inline-flex",children:"Sign in"})})]})]})})}function Ye({children:t,auth:s}){return e.jsxs(e.Fragment,{children:[e.jsx(Zt,{auth:s}),e.jsx("main",{className:"w-full px-4 pb-8 app-main text-black dark:text-white",children:t}),e.jsx("footer",{className:"w-full px-4 pb-8 text-center text-black/60 dark:text-white/60",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:"Built with Firebase • Vite • Tailwind"}),e.jsxs("div",{className:"text-xs flex flex-wrap gap-2 justify-center","aria-label":"Legal and policy links",children:[e.jsx("a",{href:"/terms-of-service",className:"hover:underline focus:outline-none focus:ring-1 focus:ring-current",rel:"nofollow",children:"Terms of Service"}),e.jsx("span",{"aria-hidden":"true",children:"•"}),e.jsx("a",{href:"/privacy-policy",className:"hover:underline focus:outline-none focus:ring-1 focus:ring-current",rel:"nofollow",children:"Privacy Policy"})]})]})})]})}const Mr=f.lazy(()=>Be(()=>import("./PracticeMode-Cz-HKjRG.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47]))),Or=f.lazy(()=>Be(()=>import("./Admin-CVVe3Ql1.js"),__vite__mapDeps([48,1,2,15,5,6,7,8,9,16,3,4,10,11,12,13,14,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47]))),Pr=f.lazy(()=>Be(()=>import("./RoundGenerator-Db1e6qGS.js"),__vite__mapDeps([49,1,2,3,4,5,6,7,8,9,10,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,31,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47])));function Tt(){const t=jt(),s=pe(),a=qt();Se();const{generatedPairs:r,setGeneratedPairs:i,pushGeneratedRound:n}=$s(),o=a.pathname.startsWith("/practice")?"practice":a.pathname.startsWith("/admin")?"admin":a.pathname.startsWith("/buzzer")?"buzzer":"generate";return e.jsxs("div",{className:"min-h-screen app-radial-bg dark:app-radial-bg transition-colors glass-backdrop",children:[o==="practice"?e.jsx(jr,{}):e.jsx(wr,{}),e.jsxs(Ye,{auth:s,children:[t.loadingTournaments&&e.jsx("div",{className:"glass p-6",children:"Loading tournaments…"}),t.errorTournaments&&e.jsxs("div",{className:"glass p-6 text-red-600",children:["Failed to load tournaments: ",String(t.errorTournaments)]}),!t.loadingTournaments&&!t.errorTournaments&&e.jsx("div",{className:"space-y-6",children:e.jsx(f.Suspense,{fallback:e.jsx("div",{className:"glass p-6",children:"Loading…"}),children:o==="practice"?e.jsx(Mr,{lazy:t}):o==="admin"?e.jsx(Or,{auth:s}):e.jsx(Pr,{lazy:t,auth:s,persistedGenerated:r,setPersistedGenerated:i,onNewRound:n})})})]})]})}function Ae(t,s){return H(t,"games",String(s).toUpperCase())}function es(t,s,a){return H(t,"games",String(s).toUpperCase(),"players",a)}function Tr(t=6){const s="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";let a="";for(let r=0;r<t;r++)a+=s[Math.floor(Math.random()*s.length)];return a}async function Lr({hostUid:t,hostName:s}){if(!t)throw new Error("Not authenticated");const a=G();for(let r=0;r<5;r++){const i=Tr(),n=Ae(a,i);if(!(await re(n)).exists())return await me(n,{code:i,hostUid:t,createdAt:Ze(),phase:"lobby",state:{buzzerOpen:!1,cycle:0,winnerUid:null,winnerName:null,winnerAt:null}}),i}throw new Error("Failed to create game code")}async function Js({code:t,uid:s,displayName:a}){if(!s)throw new Error("Not authenticated");const r=G(),i=Ae(r,t);if(!(await re(i)).exists())throw new Error("Game not found");return await me(es(r,t,s),{uid:s,displayName:a||"Player",joinedAt:Ze(),score:0,stats:{correct:0,incorrect:0,interruptsCorrect:0,interruptsIncorrect:0}},{merge:!0}),!0}function qs({code:t,onGame:s,onPlayers:a}){const r=G(),i=xt(Ae(r,t),o=>{s?.(o.exists()?{id:o.id,...o.data()}:null)}),n=xt(Xe(r,"games",String(t).toUpperCase(),"players"),o=>{const c=[];o.forEach(l=>c.push({id:l.id,...l.data()})),c.sort((l,m)=>(l.displayName||"").localeCompare(m.displayName||"")),a?.(c)});return()=>{try{i()}catch{}try{n()}catch{}}}async function Ks({code:t,open:s,actorUid:a}){const r=G(),i=Ae(r,t);s?await W(i,{"state.buzzerOpen":!0,"state.cycle":(await re(i)).data()?.state?.cycle+1||1,"state.winnerUid":null,"state.winnerName":null,"state.winnerAt":null}).catch(async()=>{await Wt(r,async n=>{const o=await n.get(i);if(!o.exists())throw new Error("Game missing");const l=(o.data()||{}).state||{},m=(typeof l.cycle=="number"?l.cycle:0)+1;n.update(i,{"state.buzzerOpen":!0,"state.cycle":m,"state.winnerUid":null,"state.winnerName":null,"state.winnerAt":null})})}):await W(i,{"state.buzzerOpen":!1})}async function Br({code:t,uid:s,displayName:a}){const r=G(),i=Ae(r,t);try{return await Wt(r,async o=>{const c=await o.get(i);if(!c.exists())throw new Error("Game missing");const m=(c.data()||{}).state||{};return m.buzzerOpen?m.winnerUid?{ok:!1,reason:"already",winnerUid:m.winnerUid}:(o.update(i,{"state.winnerUid":s,"state.winnerName":a||null,"state.winnerAt":Ze(),"state.buzzerOpen":!1}),{ok:!0,winnerUid:s}):{ok:!1,reason:"closed",winnerUid:m.winnerUid||null}})}catch(n){return{ok:!1,error:n?.message||String(n)}}}async function Qe({code:t}){const s=G(),a=Ae(s,t);await W(a,{"state.winnerUid":null,"state.winnerName":null,"state.winnerAt":null})}async function Dr({code:t,newHostUid:s}){const a=G();await W(Ae(a,t),{hostUid:s});const r=es(a,t,s);try{await Ht(r)}catch{}}async function Ur({code:t,pairs:s,meta:a={}}){const r=G(),i=Ae(r,t),n=(Array.isArray(s)?s:[]).map(o=>({tossupId:o?.tossup?.id||o?.tossupId||null,bonusId:o?.bonus?.id||o?.bonusId||null}));await W(i,{roundPairs:n,phase:"round",roundMeta:{questionType:a.questionType||null,count:n.length,categories:a.categories||[],tournaments:a.tournaments||[]}})}async function zs({code:t,uid:s,delta:a={}}){const r=G(),i=es(r,t,s),n=await re(i),o=n.exists()?n.data()||{}:{},c=o.stats||{},l={stats:{correct:(c.correct||0)+(a.correct||0),incorrect:(c.incorrect||0)+(a.incorrect||0),interruptsCorrect:(c.interruptsCorrect||0)+(a.interruptsCorrect||0),interruptsIncorrect:(c.interruptsIncorrect||0)+(a.interruptsIncorrect||0)},score:(o.score||0)+(a.points||0)};await W(i,l)}function ye({children:t}){const s=pe();return e.jsxs("div",{className:"min-h-screen app-radial-bg dark:app-radial-bg transition-colors glass-backdrop",children:[e.jsx(Zt,{auth:s}),e.jsx("main",{className:"w-full px-4 py-8 app-main text-black dark:text-white",children:t}),e.jsx("footer",{className:"w-full px-4 pb-8 text-center text-black/60 dark:text-white/60",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:"Built with Firebase • Vite • Tailwind"}),e.jsxs("div",{className:"text-xs flex flex-wrap gap-2 justify-center","aria-label":"Legal and policy links",children:[e.jsx("a",{href:"/terms-of-service",className:"hover:underline focus:outline-none focus:ring-1 focus:ring-current",rel:"nofollow",children:"Terms of Service"}),e.jsx("span",{"aria-hidden":"true",children:"•"}),e.jsx("a",{href:"/privacy-policy",className:"hover:underline focus:outline-none focus:ring-1 focus:ring-current",rel:"nofollow",children:"Privacy Policy"})]})]})})]})}function _r(){const t=pe(),s=Se(),[a,r]=f.useState(""),[i,n]=f.useState(!1),[o,c]=f.useState(""),[l,m]=f.useState([]),[d,u]=f.useState([]);if(f.useEffect(()=>{if(!t.user)return;const p=_t(),E=vs(Xe(p,"games"),Ss("hostUid","==",t.user.uid)),g=xt(E,x=>{const j=x.docs.map(v=>({id:v.id,...v.data()}));m(j)}),S=vs(Xe(p,"games"),Ss("players","array-contains",t.user.uid)),C=xt(S,x=>{const j=x.docs.map(v=>({id:v.id,...v.data()}));u(j)});return()=>{g(),C()}},[t.user]),t.loading)return e.jsx(ye,{children:e.jsx(Ie,{})});if(!t.user)return e.jsx(ye,{children:e.jsxs("div",{className:"glass p-6 max-w-lg mx-auto text-center space-y-4",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Buzzer"}),e.jsx("p",{children:"Please sign in to host or join a game."}),e.jsx("button",{className:"btn btn-primary",onClick:()=>s("/signin"),children:"Sign in"})]})});async function y(){n(!0),c("");try{const p=await Lr({hostUid:t.user.uid,hostName:t.user.displayName||t.user.email});s(`/buzzer/${p}`)}catch(p){c(p?.message||String(p))}finally{n(!1)}}async function h(p){p?.preventDefault();const E=(a||"").trim().toUpperCase();if(E){n(!0),c("");try{await Js({code:E,uid:t.user.uid,displayName:t.user.displayName||t.user.email}),s(`/buzzer/${E}`)}catch(g){c(g?.message||String(g))}finally{n(!1)}}}async function w(p){if(confirm("Are you sure you want to end this game? This action cannot be undone."))try{const E=_t();await Ht(H(E,"games",p))}catch(E){c(E?.message||String(E))}}return e.jsx(ye,{children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsxs("div",{className:"glass p-6 space-y-3",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Host a Game"}),e.jsx("p",{className:"text-sm opacity-80",children:"Create a room and share the code with players."}),e.jsx("button",{className:"btn btn-fancy",onClick:y,disabled:i,children:"Create Game"})]}),e.jsxs("div",{className:"glass p-6 space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Join a Game"}),e.jsxs("form",{onSubmit:h,className:"flex gap-2",children:[e.jsx("input",{type:"text",inputMode:"text",pattern:"[A-Za-z0-9]{4,8}",maxLength:8,placeholder:"Enter code",value:a,onChange:p=>r(p.target.value.toUpperCase()),className:"rounded-lg border border-black/10 dark:border-white/10 px-3 py-2 bg-white dark:bg-darkcard flex-1"}),e.jsx("button",{type:"submit",className:"btn btn-fancy",disabled:i||!a,children:"Join"})]}),o&&e.jsx("div",{className:"text-red-600 text-sm",children:o})]}),(l.length>0||d.length>0)&&e.jsxs("div",{className:"glass p-6 space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Active Games"}),l.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-medium",children:"Hosting"}),e.jsx("ul",{className:"space-y-1",children:l.map(p=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsxs("span",{children:["Room ",p.id," (",p.players?p.players.length:0," players)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-rejoin",onClick:()=>s(`/buzzer/${p.id}`),children:"Rejoin"}),e.jsx("button",{className:"btn btn-sm btn-red",onClick:()=>w(p.id),children:"End Game"})]})]},p.id))})]}),d.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-medium",children:"Playing"}),e.jsx("ul",{className:"space-y-1",children:d.map(p=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsxs("span",{children:["Room ",p.id," (",p.players?p.players.length:0," players)"]}),e.jsx("button",{className:"btn btn-sm btn-rejoin",onClick:()=>s(`/buzzer/${p.id}`),children:"Rejoin"})]},p.id))})]})]})]})})}function Ir(){const{code:t}=yt(),s=Se(),a=pe(),[r,i]=f.useState(null),[n,o]=f.useState([]),[c,l]=f.useState(!1),m=a?.user?.uid;f.useEffect(()=>{if(!t)return;const h=qs({code:t,onGame:i,onPlayers:o});return()=>h&&h()},[t]),f.useEffect(()=>{!a?.user||!t||!r||a.user.uid!==r.hostUid&&Js({code:t,uid:a.user.uid,displayName:a.user.displayName||a.user.email}).catch(()=>{})},[a?.user,t,r]);const d=!!(r&&m&&r.hostUid===m),u=r?.state?.winnerUid?n.find(h=>h.uid===r.state.winnerUid)||{displayName:r.state.winnerName}:null;if(a.loading||!r)return e.jsx(ye,{children:e.jsx(Ie,{})});if(!a.user)return e.jsx(ye,{children:e.jsx("div",{className:"glass p-6",children:"Please sign in to access this room."})});async function y(){if(r?.state?.buzzerOpen){l(!0);try{const h=await Br({code:t,uid:m,displayName:a.user.displayName||a.user.email})}finally{l(!1)}}}return e.jsx(ye,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"glass p-6 flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm opacity-75",children:"Room"}),e.jsx("div",{className:"text-2xl font-semibold tracking-tight",children:t}),e.jsxs("div",{className:"text-sm opacity-75",children:["Host: ",r?.hostUid===m?"You":n.find(h=>h.uid===r?.hostUid)?.displayName||"Unknown"]})]}),d&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:`btn ${r?.state?.buzzerOpen?"btn-orange":"btn-fancy"}`,onClick:()=>Ks({code:t,open:!r?.state?.buzzerOpen,actorUid:m}),children:r?.state?.buzzerOpen?"Close Buzzer":"Open Buzzer"}),e.jsx("button",{className:"btn btn-ghost",onClick:()=>Qe({code:t}),children:"Clear"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>s(`/buzzer/${t}/generate`),children:"Start Game"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4 items-start",children:[e.jsx("div",{className:"glass p-6 md:col-span-2 space-y-4 text-center",children:u?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm opacity-75",children:"Buzz winner"}),e.jsx("div",{className:"text-3xl font-bold",children:u.displayName||"Unknown"})]}):d?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm opacity-75",children:"Buzzer status"}),e.jsx("div",{className:"text-2xl font-semibold",children:r?.state?.buzzerOpen?"Open":"Closed"}),e.jsx("div",{className:"opacity-70 text-sm",children:"Hosts don't buzz. Use the controls to open/close."})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm opacity-75",children:"Press to buzz"}),e.jsx("button",{disabled:c||!r?.state?.buzzerOpen,onClick:y,className:`inline-flex items-center justify-center w-56 h-56 rounded-full text-2xl font-bold shadow-lg transition ${r?.state?.buzzerOpen?"bg-emerald-600 hover:bg-emerald-700 text-white":"bg-gray-300 dark:bg-gray-700 text-gray-600 dark:text-gray-400"} ${c?"opacity-70":""}`,"aria-live":"polite",children:"Buzz"}),!r?.state?.buzzerOpen&&e.jsx("div",{className:"text-sm opacity-75",children:"Waiting for host to open buzzer…"})]})}),e.jsxs("div",{className:"glass p-6 space-y-3",children:[e.jsx("div",{className:"font-semibold",children:"Players"}),e.jsx("ul",{className:"space-y-1",children:n.map(h=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"truncate pr-2",children:h.displayName||h.uid}),d&&h.uid!==r.hostUid&&e.jsx("button",{className:"chip",onClick:()=>Dr({code:t,newHostUid:h.uid}),children:"Make host"})]},h.uid))})]})]})]})})}const $r=f.lazy(()=>Be(()=>import("./RoundGenerator-Db1e6qGS.js"),__vite__mapDeps([49,1,2,3,4,5,6,7,8,9,10,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,31,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47])));function Fr({children:t}){const s=pe();return e.jsxs("div",{className:"min-h-screen app-radial-bg dark:app-radial-bg transition-colors glass-backdrop",children:[e.jsx(Zt,{auth:s}),e.jsx("main",{className:"w-full px-4 py-8 app-main text-black dark:text-white",children:t}),e.jsx("footer",{className:"w-full px-4 pb-8 text-center text-black/60 dark:text-white/60",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:"Built with Firebase • Vite • Tailwind"}),e.jsxs("div",{className:"text-xs flex flex-wrap gap-2 justify-center","aria-label":"Legal and policy links",children:[e.jsx("a",{href:"/terms-of-service",className:"hover:underline focus:outline-none focus:ring-1 focus:ring-current",rel:"nofollow",children:"Terms of Service"}),e.jsx("span",{"aria-hidden":"true",children:"•"}),e.jsx("a",{href:"/privacy-policy",className:"hover:underline focus:outline-none focus:ring-1 focus:ring-current",rel:"nofollow",children:"Privacy Policy"})]})]})})]})}function Gr(){const{code:t}=yt(),s=Se(),{generatedPairs:a,setGeneratedPairs:r,pushGeneratedRound:i}=$s(),n=pe(),o=jt();async function c(){if(!a||a.length===0){window.alert?.("Generate a round first.");return}const l=new Set,m=new Set;a.forEach(d=>{d?.tossup&&(d.tossup.tournament&&l.add(d.tossup.tournament),d.tossup.category&&m.add(d.tossup.category)),d?.bonus&&(d.bonus.tournament&&l.add(d.bonus.tournament),d.bonus.category&&m.add(d.bonus.category))}),await Ur({code:t,pairs:a,meta:{tournaments:Array.from(l),categories:Array.from(m)}}),s(`/buzzer/${t}/round`)}return e.jsx(Fr,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"glass p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm opacity-70",children:"Room"}),e.jsx("div",{className:"text-xl font-semibold",children:t})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-ghost",onClick:()=>s(`/buzzer/${t}`),children:"Back to Lobby"}),e.jsx("button",{className:"btn btn-primary",onClick:c,children:"Use This Round"})]})]}),e.jsx(f.Suspense,{fallback:e.jsx("div",{className:"glass p-6",children:"Loading…"}),children:e.jsx($r,{lazy:o,auth:n,persistedGenerated:a,setPersistedGenerated:r,onNewRound:i})})]})})}const Hr=B.lazy(()=>Be(()=>import("./vendor-react-katex-CCCXQq7R.js").then(t=>t.r),__vite__mapDeps([95,2,1,96,46,47])).then(t=>({default:t.BlockMath}))),Wr=B.lazy(()=>Be(()=>import("./vendor-react-katex-CCCXQq7R.js").then(t=>t.r),__vite__mapDeps([95,2,1,96,46,47])).then(t=>({default:t.InlineMath})));function ve({children:t}){if(typeof t!="string")return e.jsx(e.Fragment,{children:t});const s=/(\$\$[\s\S]+?\$\$|\$[^\$\n]+?\$)/g,a=[];let r=0,i,n=0;for(;(i=s.exec(t))!==null;){i.index>r&&a.push(t.slice(r,i.index));const o=i[0];o.startsWith("$$")?a.push(e.jsx(f.Suspense,{fallback:e.jsx("span",{children:"[math]"},n++),children:e.jsx(Hr,{children:o.slice(2,-2)},n++)})):o.startsWith("$")&&a.push(e.jsx(f.Suspense,{fallback:e.jsx("span",{children:"[math]"},n++),children:e.jsx(Wr,{children:o.slice(1,-1)},n++)})),r=s.lastIndex}return r<t.length&&a.push(t.slice(r)),e.jsx(e.Fragment,{children:a})}function Jr(){const{code:t}=yt(),s=pe(),a=Se(),[r,i]=f.useState(null),[n,o]=f.useState([]),c=jt(),l=!!(s?.user&&r?.hostUid===s.user.uid);f.useEffect(()=>{if(!t)return;const v=qs({code:t,onGame:i,onPlayers:o});return()=>v&&v()},[t]);const m=Array.from(new Set(r?.roundMeta?.tournaments||[]));f.useEffect(()=>{m.length!==0&&(async()=>{try{await c.ensureLoaded(m)}catch{}})()},[JSON.stringify(m)]);const d=f.useMemo(()=>c.getLoadedQuestions(m),[c,JSON.stringify(m)]),u=f.useMemo(()=>{const v=new Map;for(const k of d)v.set(k.id,k);return v},[d]),y=f.useMemo(()=>(Array.isArray(r?.roundPairs)?r.roundPairs:[]).map(k=>({tossup:k.tossupId&&u.get(k.tossupId)||null,bonus:k.bonusId&&u.get(k.bonusId)||null})),[r?.roundPairs,u]),[h,w]=f.useState(0);f.useEffect(()=>{w(0)},[r?.id]);const p=r?.state?.winnerUid||null,E=p&&n.find(v=>v.uid===p)||null;if(!s.user)return e.jsx(ye,{children:e.jsx("div",{className:"glass p-6",children:"Please sign in."})});if(!r)return e.jsx(ye,{children:e.jsx(Ie,{})});const g=m.length>0&&d.length===0,S=y[h]||null;async function C(){!l||!p||(await zs({code:t,uid:p,delta:{correct:1,points:4}}),await Qe({code:t}),w(v=>Math.min(v+1,y.length-1)))}async function x(){!l||!p||(await zs({code:t,uid:p,delta:{incorrect:1,points:0}}),await Qe({code:t}))}async function j(){l&&(await Qe({code:t}),w(v=>Math.min(v+1,y.length-1)))}return e.jsx(ye,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"glass p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm opacity-70",children:"Room"}),e.jsx("div",{className:"text-xl font-semibold",children:t})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-ghost",onClick:()=>a(`/buzzer/${t}`),children:"Back"}),l&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`btn ${r?.state?.buzzerOpen?"btn-orange":"btn-fancy"}`,onClick:()=>Ks({code:t,open:!r?.state?.buzzerOpen}),children:r?.state?.buzzerOpen?"Close Buzzer":"Open Buzzer"}),e.jsx("button",{className:"btn btn-ghost",onClick:()=>Qe({code:t}),children:"Clear"})]})]})]}),e.jsxs("div",{className:"glass p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm opacity-75",children:["Question ",h+1," / ",y.length||0]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"chip",onClick:()=>w(v=>Math.max(0,v-1)),children:"Prev"}),e.jsx("button",{className:"chip",onClick:()=>w(v=>Math.min(y.length-1,v+1)),children:"Next"})]})]}),g?e.jsx("div",{className:"opacity-70",children:"Loading questions…"}):S?e.jsxs("div",{className:"space-y-4",children:[S.tossup&&e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs uppercase tracking-wide opacity-70",children:["Toss-up • ",S.tossup.category]}),e.jsx("div",{className:"prose dark:prose-invert max-w-none whitespace-pre-wrap",children:e.jsx(ve,{children:S.tossup.question})})]}),S.bonus&&e.jsxs("div",{className:"mt-4 p-3 rounded-lg bg-black/5 dark:bg-white/10",children:[e.jsxs("div",{className:"text-xs uppercase tracking-wide opacity-70",children:["Bonus • ",S.bonus.category]}),e.jsx("div",{className:"prose dark:prose-invert max-w-none whitespace-pre-wrap",children:e.jsx(ve,{children:S.bonus.question})})]})]}):e.jsx("div",{className:"opacity-70",children:"No question loaded."}),e.jsxs("div",{className:"pt-2 flex items-center gap-3 flex-wrap",children:[e.jsxs("div",{className:"text-sm opacity-75",children:["Winner: ",E?E.displayName||E.uid:"—"]}),l&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-fancy",onClick:C,disabled:!E,children:"Correct"}),e.jsx("button",{className:"btn btn-orange",onClick:x,disabled:!E,children:"Incorrect"}),e.jsx("button",{className:"btn btn-ghost",onClick:j,children:"Stale"})]})]})]}),e.jsxs("div",{className:"glass p-6",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Scores"}),e.jsx("ul",{className:"grid sm:grid-cols-2 md:grid-cols-3 gap-2",children:n.map(v=>e.jsxs("li",{className:"flex items-center justify-between rounded-lg bg-black/5 dark:bg-white/10 px-3 py-2",children:[e.jsx("span",{className:"truncate pr-2",children:v.displayName||v.uid}),e.jsx("span",{className:"font-semibold",children:v.score||0})]},v.uid))})]})]})})}const et="mpGuestUid",tt="mpGuestName";function qr(t=12){const s="abcdefghjkmnpqrstuvwxyzABCDEFGHJKMNPQRSTUVWXYZ23456789";let a="";for(let r=0;r<t;r++)a+=s[Math.floor(Math.random()*s.length)];return a}function ue(){const s=oe?.()?.currentUser||null;if(s)return{uid:s.uid,displayName:s.displayName||s.email||"Player",isGuest:!1};const a=localStorage.getItem(et),r=localStorage.getItem(tt);return a&&r?{uid:a,displayName:r,isGuest:!0}:null}function Kr(t){let s=localStorage.getItem(et);s||(s=`guest_${qr(16)}`,localStorage.setItem(et,s)),t&&localStorage.setItem(tt,t);const a=localStorage.getItem(tt)||t||"Guest";return{uid:s,displayName:a,isGuest:!0}}function Qr(){try{localStorage.removeItem(et)}catch{}try{localStorage.removeItem(tt)}catch{}}function Vr(){const t=localStorage.getItem(et),s=localStorage.getItem(tt);return t&&s?{uid:t,displayName:s,isGuest:!0}:null}let Qs=0,ft=!1,pt=[];function Yr(){if(!ft)try{Ue();const t=wt(De()),s=V(t,".info/serverTimeOffset"),a=ie(s,r=>{const i=Number(r.val()||0);Qs=Number.isFinite(i)?i:0,ft||(ft=!0,pt.forEach(n=>{try{n()}catch{}}),pt=[])});return()=>ee(s,"value",a)}catch{ft=!0,pt.forEach(t=>{try{t()}catch{}}),pt=[]}}function st(){return Yr(),Date.now()+(Qs||0)}function ae(){return Ue(),wt(De())}function J(t){return V(ae(),`mp/rooms/${t}`)}function kt(t){return V(ae(),`mp/roomMembers/${t}`)}function nt(t,s){return V(ae(),`mp/roomMembers/${t}/${s}`)}function Vs(t){return V(ae(),`mp/roomMessages/${t}`)}function Ys(t){return V(ae(),`mp/roomSettings/${t}`)}function Xr(t){return V(ae(),`mp/roomAnswers/${t}`)}function Zr(t,s,a){return V(ae(),`mp/roomAnswers/${t}/${s}/${a}`)}function ea(t){return V(ae(),`mp/roomBuzzes/${t}`)}function Xs(t,s){return V(ae(),`mp/roomBuzzes/${t}/${s}`)}function Zs(t){return V(ae(),`mp/roomHistory/${t}`)}function rt(t){return V(ae(),`mp/userRooms/${t}`)}async function at(t){try{await K(J(t),{lastActiveAt:Date.now()})}catch{}}function ta(t=6){const s="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";let a="";for(let r=0;r<t;r++)a+=s[Math.floor(Math.random()*s.length)];return a}async function en(t){try{const a=new TextEncoder().encode(String(t||"")),r=await(self.crypto||window.crypto).subtle.digest("SHA-256",a),i=new Uint8Array(r);return Array.from(i).map(n=>n.toString(16).padStart(2,"0")).join("")}catch{return String(t||"")}}async function sa({name:t="Room",isPrivate:s=!1,passcode:a=""}){for(let r=0;r<5;r++){const i=ta(),n=J(i);if((await ge(n)).exists())continue;let c=null;if(s&&a)try{c=await en(a)}catch{c=String(a)}return await Le(n,{name:t,isPrivate:!!s,status:"open",createdAt:Date.now(),state:{buzzerOpen:!1,winnerUid:null,winnerName:null,winnerAt:null,awaitNext:!1,perWordMs:200,perChoiceMs:400,streamedWordsBase:0,streamStartAt:null,stemFinishedAt:null,choicesBase:0,choicesStartAt:null},game:{currentId:null,tournaments:[],used:null},passHash:c||null,lastActiveAt:Date.now()}),i}throw new Error("Failed to create room")}async function Ve({roomId:t,uid:s,displayName:a,passcode:r,passHashOverride:i}){const o=oe()?.currentUser,c=o?{uid:o.uid,displayName:o.displayName||o.email||"Player"}:ue()||{},l=s||c.uid,m=a||c.displayName||"Player";if(!l)throw new Error("No identity available");let d=null;try{d=await ge(J(t))}catch{}const u=d?.exists()?d.val():null,y=!!u?.isPrivate,h=u?.passHash||null;let w=null;if(y&&h){if(i)w=String(i);else if(r)w=await en(r);else try{w=window.localStorage.getItem(`mp_pass_hash_${t}`)}catch{}if(!w||w!==h)throw new Error("Incorrect or missing passcode")}await K(nt(t,l),{uid:l,displayName:m,typing:!1,draft:"",lastTypedAt:Date.now(),...w?{passHash:w}:{}});try{o?.uid&&await K(Me(rt(l),t),{roomId:t,joinedAt:Date.now(),lastActiveAt:Date.now()})}catch{}at(t);const p=Me(nt(t,l),"score");return await Oe(p,E=>typeof E=="number"?E:0),!0}function na({roomId:t,onRoom:s,onMembers:a,onMessages:r,onSettings:i,onAnswers:n}){const o=[],c=J(t),l=kt(t),m=Kt(Vs(t),Qt("createdAt"),Us(200)),d=Ys(t),u=Xr(t),y=ie(c,g=>{const S=g.exists()?{id:t,...g.val()}:null;s?.(S)});o.push(()=>ee(c,"value",y));const h=ie(d,g=>{const S=g.val()||{};i?.(S)});o.push(()=>ee(d,"value",h));const w=ie(l,g=>{const S=g.val()||{},C=Object.values(S);C.sort((x,j)=>{const v=x.score||0,k=j.score||0;if(k!==v)return k-v;const z=(x.displayName||"").toLowerCase(),N=(j.displayName||"").toLowerCase(),M=z.localeCompare(N);if(M!==0)return M;const P=String(x.uid||""),T=String(j.uid||"");return P.localeCompare(T)}),a?.(C)});o.push(()=>ee(l,"value",w));const p=ie(m,g=>{const S=g.val()||{},C=Object.entries(S).map(([x,j])=>({id:x,...j})).sort((x,j)=>(x.createdAt||0)-(j.createdAt||0));r?.(C)});o.push(()=>ee(m,"value",p));const E=ie(u,g=>{const S=g.val()||{};n?.(S)});return o.push(()=>ee(u,"value",E)),()=>{o.forEach(g=>{try{g()}catch{}})}}function ra({roomId:t,onBuzzes:s}){const a=ea(t),r=ie(a,i=>{const n=i.val()||{},o={};Object.entries(n).forEach(([c,l])=>{const m=Object.entries(l||{}).map(([d,u])=>({id:d,...u}));m.sort((d,u)=>(d.at||0)-(u.at||0)),o[c]=m}),s?.(o)});return()=>ee(a,"value",r)}function aa({roomId:t,onTyping:s}){const a=kt(t),r=o=>{const c=o.val()||{},l=c.uid||o.key;s?.({uid:l,displayName:c.displayName||l,typing:!!c.typing,draft:String(c.draft||""),lastTypedAt:Number(c.lastTypedAt||0)})},i=sr(a,r),n=nr(a,r);return()=>{try{ee(a,"child_added",i)}catch{}try{ee(a,"child_changed",n)}catch{}}}async function ia({roomId:t,text:s}){const r=oe()?.currentUser,i=r?{uid:r.uid,displayName:r.displayName||r.email||"Player"}:ue()||{},n=i?.uid;if(!n)return!1;const o=i.displayName||"Player",c=Vt(Vs(t));await Le(c,{uid:n,displayName:o,text:s,createdAt:Date.now()}),await at(t);try{r?.uid&&await K(Me(rt(n),t),{lastActiveAt:Date.now()})}catch{}return!0}async function oa({roomId:t,uid:s,delta:a}){const r=Me(nt(t,s),"score");await Oe(r,i=>(i||0)+(Number(a)||0)),await at(t);try{oe()?.currentUser?.uid&&await K(Me(rt(s),t),{lastActiveAt:Date.now()})}catch{}return!0}async function ca({roomId:t,patch:s,requireHost:a=!1}){if(oe()?.currentUser?.uid,!t||!s||typeof s!="object")return!1;try{const i={...s};if(Object.prototype.hasOwnProperty.call(s,"selectedTournaments")){const n=Array.isArray(s.selectedTournaments)?s.selectedTournaments.slice(0,20):[];await K(J(t),{"game/tournaments":n})}return Object.keys(i).length>0&&await K(Ys(t),i),!0}catch{return!1}}async function la({roomId:t,questionId:s,uid:a,displayName:r,data:i}){if(!t||!s||!a)return!1;const n={uid:a,displayName:r,status:i?.status,text:i?.text||"",choice:i?.choice||"",correct:typeof i?.correct=="boolean"?i.correct:null,points:Number.isFinite(i?.points)?Number(i.points):null,updatedAt:Date.now()};await Le(Zr(t,s,a),n),await at(t);try{await K(Me(rt(a),t),{lastActiveAt:Date.now()})}catch{}await K(nt(t,a),{lastQuestionId:s,lastAnswerStatus:n.status,lastAnswerCorrect:n.correct,lastAnswerAt:n.updatedAt});try{const l=((await ge(J(t))).val()?.state||{}).currentBuzzKey;if(l){const m=Me(Xs(t,s),l),u=(await ge(m)).val();u&&(!u.uid||u.uid===a)&&await K(m,{status:n.status,text:n.text,correct:n.correct,points:n.points,checkedAt:Date.now()})}}catch{}return!0}async function da({roomId:t,uid:s}){if(!t||!s)return!1;const a=nt(t,s);return await Le(a,null),!0}async function Lt({roomId:t,open:s}){const a=st();await Oe(J(t),r=>{const i=r||{},n=i.state||{},o=Number(n.perWordMs||200),c=Number(n.perChoiceMs||400);if(!s){const m=n.streamStartAt?Math.max(0,a-Number(n.streamStartAt)):0,d=o>0?Math.floor(m/o):0,u=Math.max(0,Number(n.streamedWordsBase||0))+Math.max(0,d),y=n.choicesStartAt?Math.max(0,a-Number(n.choicesStartAt)):0,h=c>0?Math.floor(y/c):0,w=Math.min(4,Math.max(0,Number(n.choicesBase||0))+Math.max(0,h));return{...i,state:{...n,buzzerOpen:!1,streamStartAt:null,streamedWordsBase:u,choicesStartAt:null,choicesBase:w}}}const l={...i,state:{...n,buzzerOpen:!0}};return n.streamStartAt||(l.state.streamStartAt=a),n.stemFinishedAt&&!n.choicesStartAt&&Number(n.choicesBase||0)<4&&(l.state.choicesStartAt=a),l})}async function Rs({roomId:t,grading:s}){await K(J(t),{"state/grading":!!s})}async function ua({roomId:t,uid:s,displayName:a}){const r=J(t);try{let i={ok:!1};if(await Oe(r,n=>{const o=n||{},c=o.state||{},l=c.lockedOut&&typeof c.lockedOut=="object"?c.lockedOut:{};if(l&&s&&l[s])return i={ok:!1,reason:"locked"},n;if(!c.buzzerOpen)return i={ok:!1,reason:"closed",winnerUid:c.winnerUid||null},n;if(c.winnerUid)return i={ok:!1,reason:"already",winnerUid:c.winnerUid},n;const m=st(),d=Number(c.perWordMs||200),u=c.streamStartAt?Math.max(0,m-Number(c.streamStartAt)):0,y=d>0?Math.floor(u/d):0,h=Math.max(0,Number(c.streamedWordsBase||0))+Math.max(0,y),w=Number(c.perChoiceMs||400),p=c.choicesStartAt?Math.max(0,m-Number(c.choicesStartAt)):0,E=w>0?Math.floor(p/w):0,g=Math.min(4,Math.max(0,Number(c.choicesBase||0))+Math.max(0,E)),S={...o,state:{...o.state||{},buzzerOpen:!1,winnerUid:s,winnerName:a||null,winnerAt:Date.now(),streamStartAt:null,streamedWordsBase:h,choicesStartAt:null,choicesBase:g,currentBuzzKey:null}};return i={ok:!0,winnerUid:s},S}),i.ok){const o=(await ge(J(t))).val()||{},c=o?.game?.currentId||null;if(c){const l=Vt(Xs(t,c)),m=l.key,d=!o?.state?.stemFinishedAt;await Le(l,{uid:s,displayName:a,at:Date.now(),interrupt:d}),await K(J(t),{"state/currentBuzzKey":m})}}return i}catch(i){return{ok:!1,error:i?.message||String(i)}}}async function Ms({roomId:t}){await K(J(t),{"state/winnerUid":null,"state/winnerName":null,"state/winnerAt":null})}async function ma({roomId:t,questionId:s,tournaments:a=[]}){let r=null;await Oe(J(t),i=>{const n=i||{},o=n.game||{},c=o.currentId||null;r=c;const l=o.used&&typeof o.used=="object"?o.used:{},m={...n};return m.game={...m.game||{},currentId:s||null,tournaments:Array.isArray(a)?a.slice(0,20):[],used:{...l}},c&&(m.game.used[c]=!0),m.state={...m.state||{},buzzerOpen:!1,winnerUid:null,winnerName:null,winnerAt:null,awaitNext:!1,currentBuzzKey:null,lockedOut:null,perWordMs:200,perChoiceMs:400,streamedWordsBase:0,streamStartAt:null,stemFinishedAt:null,choicesBase:0,choicesStartAt:null},m});try{if(r){const i=Vt(Zs(t));await Le(i,{questionId:r,at:Date.now()})}}catch{}}async function ha({roomId:t,at:s}){const a=Number(s||st());await Oe(J(t),r=>{const i=r||{},n=i.state||{};return n.stemFinishedAt?r:{...i,state:{...n,stemFinishedAt:a}}})}async function fa({roomId:t,uid:s}){return!t||!s?!1:(await Oe(J(t),a=>{const r=a||{},i=r.state||{},o={...i.lockedOut&&typeof i.lockedOut=="object"?i.lockedOut:{},[s]:!0};return{...r,state:{...i,lockedOut:o}}}),!0)}async function Os({roomId:t}){await K(J(t),{"state/lockedOut":null})}async function Ps({roomId:t,value:s}){await K(J(t),{"state/awaitNext":!!s}),await at(t)}function pa({onRooms:t}){const s=Kt(V(ae(),"mp/rooms"),Qt("createdAt"),Us(50)),a=new Map;let r=[],i={};const n=()=>{const m=r.map(d=>({...d,memberCount:typeof d.memberCount=="number"?d.memberCount:i[d.id]||0}));t?.(m)},o=m=>{if(a.has(m))return;const d=kt(m),u=ie(d,y=>{const h=y.val()||{};i[m]=Object.keys(h).length,n()});a.set(m,()=>ee(d,"value",u))},c=m=>{for(const[d,u]of a.entries())if(!m.includes(d)){try{u()}catch{}a.delete(d),delete i[d]}},l=ie(s,m=>{const d=m.val()||{},u=Object.entries(d).map(([h,w])=>({id:h,...w})).filter(h=>h.status==="open"&&h.isPrivate===!1).sort((h,w)=>(w.createdAt||0)-(h.createdAt||0));r=u;const y=u.map(h=>h.id);y.forEach(o),c(y),n()});return()=>{ee(s,"value",l);for(const m of a.values())try{m()}catch{}a.clear()}}function xa({uid:t,onRooms:s}){if(!t)return()=>{};const a=rt(t),r=new Map;let i=[],n={};const o=()=>{const d=i.map(u=>({...u,memberCount:n[u.id]||0}));d.sort((u,y)=>(y.lastActiveAt||0)-(u.lastActiveAt||0)),s?.(d)},c=d=>{if(r.has(d))return;const u=kt(d),y=ie(u,h=>{const w=h.val()||{};n[d]=Object.keys(w).length,o()});r.set(d,()=>ee(u,"value",y))},l=d=>{for(const[u,y]of r.entries())if(!d.includes(u)){try{y()}catch{}r.delete(u),delete n[u]}},m=ie(a,async d=>{const u=d.val()||{},y=Object.keys(u),h=[];for(const w of y)try{const p=await ge(J(w));p.exists()&&h.push({id:w,...p.val()})}catch{}i=h,y.forEach(c),l(y),o()});return()=>{ee(a,"value",m);for(const d of r.values())try{d()}catch{}r.clear()}}function ba({roomId:t,onHistory:s}){const a=Zs(t),r=ie(a,i=>{const n=i.val()||{},o=Object.entries(n).map(([c,l])=>({id:c,...l||{}})).sort((c,l)=>(l.at||0)-(c.at||0));s?.(o)});return()=>ee(a,"value",r)}async function ga({queryText:t}){const s=String(t||"").trim();if(!s)return null;try{const r=await ge(J(s));if(r.exists())return{id:s,...r.val()}}catch{}const a=s.toUpperCase();if(a!==s)try{const r=await ge(J(a));if(r.exists())return{id:a,...r.val()}}catch{}try{const r=Kt(V(ae(),"mp/rooms"),Qt("name"),rr(s)),n=(await ge(r)).val()||{},o=Object.entries(n)[0];if(o){const[c,l]=o;return{id:c,...l||{}}}}catch{}return null}function ya(){const t=pe(),s=Se(),[a,r]=f.useState([]),[i,n]=f.useState([]),o=B.useCallback(N=>{r(M=>JSON.stringify(M)===JSON.stringify(N)?M:N)},[]),[c,l]=f.useState(!1),[m,d]=f.useState(""),[u,y]=f.useState(""),[h,w]=f.useState(!1),[p,E]=f.useState(""),[g,S]=f.useState(""),[C,x]=f.useState(""),[j,v]=f.useState(!1);f.useEffect(()=>{const N=pa({onRooms:o});return()=>N()},[o]),f.useEffect(()=>{if(!t?.user?.uid)return;const N=xa({uid:t.user.uid,onRooms:n});return()=>N()},[t?.user?.uid]);async function k(N){if(N?.preventDefault(),!t?.user){s("/signin");return}l(!0),d("");try{const M=await sa({name:(u||"").trim()||"Room",isPrivate:h,passcode:h?p:""});await Ve({roomId:M}),s(`/multiplayer/${M}`)}catch(M){d(M?.message||String(M))}finally{l(!1)}}async function z(N){N?.preventDefault(),v(!0),d("");try{const M=(g||"").trim();if(!M)throw new Error("Enter a room name or code");const P=await ga({queryText:M});if(!P)throw new Error("Room not found");s(`/multiplayer/${P.id}`,{state:{passcode:(C||"").trim()}})}catch(M){d(M?.message||String(M))}finally{v(!1)}}return e.jsx("div",{className:"min-h-screen app-radial-bg dark:app-radial-bg transition-colors glass-backdrop",children:e.jsx(Ye,{auth:t,children:t.loading?e.jsx(Ie,{}):e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"glass p-6 space-y-3",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Multiplayer"}),e.jsx("p",{className:"text-sm opacity-80",children:"Join a public room or create your own. Private rooms require a passcode."}),e.jsxs("form",{onSubmit:z,className:"grid sm:grid-cols-4 gap-2 items-end",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-sm opacity-75 mb-1",children:"Room name or code"}),e.jsx("input",{className:"rounded-lg border border-black/10 dark:border-white/10 px-3 py-2 bg-white dark:bg-darkcard w-full",value:g,onChange:N=>S(N.target.value),placeholder:"e.g., Friday Practice or ABC123"})]}),e.jsx("div",{className:"hidden sm:block"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm opacity-75 mb-1",children:"Passcode (if required)"}),e.jsx("input",{className:"rounded-lg border border-black/10 dark:border-white/10 px-3 py-2 bg-white dark:bg-darkcard w-full",value:C,onChange:N=>x(N.target.value),placeholder:"Room passcode"})]}),e.jsx("div",{className:"sm:col-span-4 flex gap-2",children:e.jsx("button",{className:"btn btn-primary",type:"submit",disabled:j||!g,children:j?"Joining…":"Join room"})})]}),e.jsx("div",{className:"text-sm opacity-80",children:"Create a new room to practice live buzzing. Share the code to invite others, or keep it public for everyone to see. Set a passcode to keep it private."}),(()=>{const N=!t?.user,M=N?"opacity-60 pointer-events-none":"",P=N?"Sign in to create rooms":"";return e.jsxs("form",{onSubmit:k,className:"grid sm:grid-cols-4 gap-2 items-end","aria-disabled":N,title:P,children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-sm opacity-75 mb-1",children:"Room name"}),e.jsx("input",{className:`rounded-lg border border-black/10 dark:border-white/10 px-3 py-2 bg-white dark:bg-darkcard w-full ${M}`,value:u,onChange:T=>y(T.target.value),placeholder:"e.g., Friday Practice",disabled:N})]}),e.jsx("div",{className:`flex items-center gap-2 ${M}`,children:e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:T=>w(T.target.checked),disabled:N})," Private"]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm opacity-75 mb-1",children:["Passcode ",h?"":"(optional)"]}),e.jsx("input",{className:`rounded-lg border border-black/10 dark:border-white/10 px-3 py-2 bg-white dark:bg-darkcard w-full ${M}`,value:p,onChange:T=>E(T.target.value),disabled:N||!h,placeholder:"Set a passcode"})]}),e.jsxs("div",{className:"sm:col-span-4 flex gap-2 items-center",children:[e.jsx("button",{className:`btn btn-fancy ${N?"opacity-60 cursor-not-allowed":""}`,type:"submit",disabled:N||c||h&&!p,children:c?"Creating…":"Create room"}),N&&e.jsx("span",{className:"text-xs opacity-80",children:"Sign in to create a room"}),m&&e.jsx("div",{className:"text-sm text-red-600",children:m})]})]})})()]}),t?.user&&e.jsxs("div",{className:"glass p-6 space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Active sessions"}),i.length===0?e.jsx("div",{className:"opacity-70 text-sm",children:"No active rooms yet."}):e.jsx("ul",{className:"divide-y divide-black/5 dark:divide-white/10",children:i.map(N=>e.jsxs("li",{className:"py-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:N.name||N.id}),e.jsxs("div",{className:"text-sm opacity-70",children:[N.memberCount||0," online • Active ",new Date(N.lastActiveAt||N.createdAt||0).toLocaleString()]})]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>s(`/multiplayer/${N.id}`),children:"Rejoin"})]},N.id))})]}),e.jsxs("div",{className:"glass p-6 space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Public rooms"}),a.length===0?e.jsx("div",{className:"opacity-70 text-sm",children:"No public rooms right now."}):e.jsx("ul",{className:"divide-y divide-black/5 dark:divide-white/10",children:a.map(N=>e.jsxs("li",{className:"py-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:N.name||N.id}),e.jsxs("div",{className:"text-sm opacity-70",children:[N.memberCount||0," online"]})]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>s(`/multiplayer/${N.id}`),children:"Join"})]},N.id))})]})]})})})}const wa="vertex-gateway-7e74h6s4.uc.gateway.dev",ja="AIzaSyBxfXewuANeaSgDisu5U4cD1JF70VJuP_U";function Na(t){const s=`https://${wa}`,a=t.startsWith("/")?t:`/${t}`,r=new URL(s+a);return r.searchParams.set("key",ja),r.toString()}async function tn(t,s){const a=Na(t),r={"Content-Type":"application/json"};try{const n=await pr();n&&(r["X-Firebase-AppCheck"]=n)}catch{}return await fetch(a,{method:"POST",headers:r,body:JSON.stringify(s??{})})}async function ka(t){return tn("/checkAnswerMC",t)}async function Ts(t){return tn("/checkAnswerBonus",t)}function Ls(t){if(!t)return!1;try{return String(t).split("-")[0].toLowerCase()==="ms"}catch{return!1}}function va({tournaments:t,tournamentGroups:s,selectedTournaments:a,setSelectedTournaments:r,tournamentGroupsOpen:i,setTournamentGroupsOpen:n,handleTournamentToggle:o,tournamentVisibleEntriesMainRef:c,isDark:l,showTournamentModal:m,setShowTournamentModal:d}){return e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold mb-2 flex items-center flex-wrap gap-2",children:["Tournaments",e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Clear selection",onClick:()=>r([]),children:e.jsx(It,{size:16})}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Select all",onClick:()=>r((t||[]).filter(u=>!Ls(u))),children:e.jsx($t,{size:16})}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs inline-flex items-center gap-1","aria-label":"Expand tournament list",title:"Expand to modal",onClick:()=>d(!0),children:e.jsx(or,{size:14})})]}),e.jsx("div",{className:"border rounded-lg max-h-56 overflow-y-auto overflow-x-hidden",children:e.jsx("ul",{role:"tree",className:"divide-y divide-black/5 dark:divide-white/10",children:(()=>{const u=[],y=s.map(h=>{const w=h.all.length>1,p=w&&i.has(h.base),E=h.all.every(C=>a.includes(C)),g=!E&&h.all.some(C=>a.includes(C));let S={};if(w){const C=h.all.filter(k=>a.includes(k)).length,x=h.all.length>0?C/h.all.length:0,j=Math.pow(x,.85),v=120*j;if(C>0)if(l){const k=28+j*8;S={backgroundColor:`hsl(${v.toFixed(0)} 60% ${k}%)`,color:"#fff"}}else{const k=92-j*8;S={backgroundColor:`hsl(${v.toFixed(0)} 70% ${k}%)`}}}if(!w){const C=h.all[0],x=a.includes(C);return u.push({type:"key",key:C,base:h.base}),e.jsx("li",{role:"treeitem",className:"select-none",children:e.jsxs("label",{className:"flex items-center gap-2 px-2 py-1.5 rounded cursor-pointer min-w-0 "+(x?"bg-blue-100 dark:bg-blue-900/40":"hover:bg-black/5 dark:hover:bg-white/10"),children:[e.jsx("span",{className:"inline-block w-5 shrink-0","aria-hidden":"true"}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("input",{type:"checkbox",className:"accent-tint",checked:x,onChange:j=>o(j,C,"main")}),e.jsx("span",{className:"font-medium truncate min-w-0",title:C,children:C})]})]})},h.base)}return e.jsxs("li",{role:"treeitem","aria-expanded":p,className:"select-none",children:[e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1.5 rounded min-w-0 "+(w?"transition-colors ":"")+(w&&(g||E)?"":"hover:bg-black/5 dark:hover:bg-white/10"),style:S,children:[w&&e.jsx("button",{type:"button",className:"shrink-0 p-0.5 rounded hover:bg-black/10 dark:hover:bg-white/10",onClick:()=>n(C=>{const x=new Set(C);return x.has(h.base)?x.delete(h.base):x.add(h.base),x}),"aria-label":p?"Collapse":"Expand",children:p?e.jsx(Rt,{size:16}):e.jsx(Mt,{size:16})}),e.jsx("input",{type:"checkbox",className:"accent-tint",checked:E,ref:C=>{C&&(C.indeterminate=g)},onChange:C=>{const x=C.target.checked||g;r(j=>{const v=new Set(j);return x?h.all.forEach(k=>v.add(k)):h.all.forEach(k=>v.delete(k)),Array.from(v)})}}),e.jsx("span",{className:"font-medium truncate",title:h.base,children:`${h.base} (${h.all.length})`})]}),(u.push({type:"group",base:h.base,keys:h.all}),null),p&&e.jsx("ul",{role:"group",className:"pl-10 py-1 overflow-x-hidden min-w-0",children:h.years.map(C=>{const x=a.includes(C.key);return u.push({type:"key",key:C.key,base:h.base}),e.jsx("li",{role:"treeitem","aria-selected":x,className:"px-2 min-w-0 text-xs",children:e.jsxs("label",{className:"flex items-center gap-2 px-2 py-1 rounded cursor-pointer min-w-0 "+(x?"bg-blue-100 dark:bg-blue-900/40":"hover:bg-black/5 dark:hover:bg-white/10"),children:[e.jsx("input",{type:"checkbox",className:"accent-tint",checked:x,onChange:j=>o(j,C.key,"main")}),e.jsx("span",{className:"truncate min-w-0",title:C.label,children:C.label})]})},C.key)})})]},h.base)});return c.current=u,y})()})}),m&&e.jsxs("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>d(!1)}),e.jsxs("div",{className:"relative bg-white dark:bg-darkcard rounded-lg shadow-xl max-w-3xl w-full p-6 space-y-4 border border-black/10 dark:border-white/10 flex flex-col max-h-[85vh]",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Select Tournaments"}),e.jsx("button",{className:"btn btn-ghost btn-sm",onClick:()=>d(!1),children:"Close"})]}),e.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Clear selection",onClick:()=>r([]),children:e.jsx(It,{size:16})}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Select all",onClick:()=>r((t||[]).filter(u=>!Ls(u))),children:e.jsx($t,{size:16})}),e.jsxs("button",{className:"chip px-2 py-0.5 text-xs inline-flex items-center gap-1","aria-label":"Expand all groups",title:"Expand all groups",onClick:()=>n(new Set(s.filter(u=>u.all.length>1).map(u=>u.base))),children:[e.jsx(Cs,{size:15}),e.jsx(Mt,{size:15})]}),e.jsxs("button",{className:"chip px-2 py-0.5 text-xs inline-flex items-center gap-1","aria-label":"Collapse all groups",title:"Collapse all groups",onClick:()=>n(new Set),children:[e.jsx(Cs,{size:15}),e.jsx(Rt,{size:15})]})]}),e.jsx("div",{className:"border rounded-lg max-h-[65vh] overflow-y-auto overflow-x-hidden",children:e.jsx("ul",{role:"tree",className:"divide-y divide-black/5 dark:divide-white/10",children:(()=>{const u=[];return s.map(h=>{const w=h.all.length>1,p=w&&i.has(h.base),E=h.all.every(S=>a.includes(S)),g=!E&&h.all.some(S=>a.includes(S));return e.jsxs("li",{role:"treeitem","aria-expanded":p,className:"select-none",children:[e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1.5 rounded min-w-0 "+(w?"transition-colors ":""),children:[w&&e.jsx("button",{type:"button",className:"shrink-0 p-0.5 rounded hover:bg-black/10 dark:hover:bg-white/10",onClick:()=>n(S=>{const C=new Set(S);return C.has(h.base)?C.delete(h.base):C.add(h.base),C}),"aria-label":p?"Collapse":"Expand",children:p?e.jsx(Rt,{size:16}):e.jsx(Mt,{size:16})}),e.jsx("input",{type:"checkbox",className:"accent-tint",checked:E,ref:S=>{S&&(S.indeterminate=g)},onChange:S=>{const C=S.target.checked||g;r(x=>{const j=new Set(x);return C?h.all.forEach(v=>j.add(v)):h.all.forEach(v=>j.delete(v)),Array.from(j)})}}),e.jsx("span",{className:"font-medium truncate",title:h.base,children:`${h.base} (${h.all.length})`})]}),p&&e.jsx("ul",{role:"group",className:"pl-10 py-1 overflow-x-hidden min-w-0",children:h.years.map(S=>{const C=a.includes(S.key);return u.push({type:"key",key:S.key,base:h.base}),e.jsx("li",{role:"treeitem","aria-selected":C,className:"px-2 min-w-0 text-xs",children:e.jsxs("label",{className:`flex items-center gap-2 px-2 py-1 rounded cursor-pointer min-w-0 ${C?"bg-blue-100 dark:bg-blue-900/40":"hover:bg-black/5 dark:hover:bg-white/10"}`,children:[e.jsx("input",{type:"checkbox",className:"accent-tint",checked:C,onChange:x=>o(x,S.key,"modal")}),e.jsx("span",{className:"truncate min-w-0",title:S.label,children:S.label})]})},S.key)})})]},h.base)})})()})})]})]}),e.jsx("div",{className:"mt-2 text-[11px] text-gray-500 dark:text-gray-400",children:" * Select All does not include MS rounds."})]})}function Sa({categories:t,selectedCategories:s,setSelectedCategories:a}){return e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold mb-2 flex items-center gap-2",children:["Categories",e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Clear selection",onClick:()=>a([]),children:e.jsx(It,{size:16})}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Select all",onClick:()=>a(t),children:e.jsx($t,{size:16})}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Invert selection",onClick:()=>a(r=>t.filter(i=>!r.includes(i))),children:e.jsx(cr,{size:16})})]}),e.jsx("div",{className:"rounded-lg max-h-56 overflow-y-auto overflow-x-hidden",children:e.jsx("div",{className:"flex flex-wrap gap-2 min-w-0 p-2",children:t.map(r=>{const i=s.includes(r);return e.jsxs("label",{className:`chip cursor-pointer ${i?"ring-1 ring-tint bg-tint/10":""}`,title:r,children:[e.jsx("input",{type:"checkbox",className:"mr-1",checked:i,onChange:()=>a(n=>n.includes(r)?n.filter(o=>o!==r):[...n,r])}),e.jsx("span",{className:"truncate max-w-[12rem] inline-block align-middle",children:r})]},r)})})})]})}function Aa({selectedTournaments:t,tournaments:s,roundRanges:a,setRoundRanges:r,roundsByTournament:i,globalNumericRoundMax:n}){return e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold mb-2 flex items-center justify-between gap-2",children:[e.jsx("span",{children:"Round ranges"}),e.jsx("button",{type:"button",className:`chip px-2 py-1 ${t.length===0?"opacity-50 cursor-not-allowed":""}`,"aria-label":"Add round range",title:"Add range",disabled:t.length===0,onClick:()=>{if(t.length===0)return;const c=t.length===1?t[0]:"";r([...a,{from:1,to:3,tournament:c}])},children:e.jsx(lr,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[a.length===0&&e.jsx("div",{className:"text-xs italic text-black/70 dark:text-white/60 px-1",children:"All rounds included (no range filters). Add a range to limit rounds."}),a.map((o,c)=>{const l=t.length>0?t:s,m=t.length===1,d=t.length===0&&s.length===1,u=m||d||l.length===1,y=u&&(t[0]||l[0])||"",h=u?y:o.tournament||"",w=u?y:o.tournament||null,p=w?i[w]??[]:[],E=p.length>0&&p.every(g=>/^\d+$/.test(g));return e.jsxs("div",{className:"round-range-row w-full overflow-hidden",children:[e.jsx("div",{className:"select-wrapper flex-1 min-w-0",children:e.jsx("select",{className:"sb-select-range rounded-lg border px-3 py-1.5 shadow-none focus:outline-none "+(u?"bg-gray-100 dark:bg-white/10 text-gray-500 dark:text-gray-400 border-gray-300 dark:border-white/20 cursor-not-allowed pointer-events-none":"bg-white text-black border-black/10 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20"),value:h,disabled:u,onChange:g=>{if(u)return;const S=[...a];S[c]={...S[c],tournament:g.target.value},r(S)},title:h||"All Tournaments",children:u?e.jsx("option",{value:y,children:y}):t.length===0?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"",children:"All Tournaments"}),l.map(g=>e.jsx("option",{value:g,children:g},g))]}):l.map(g=>e.jsx("option",{value:g,children:g},g))})}),w?E?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"select-wrapper sb-select-round",children:e.jsx("select",{className:"rounded-lg border border-black/10 bg-white text-black px-2 py-1 shadow-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20 shrink-0 sb-select-round",value:o.from!=null&&p.includes(String(o.from))?String(o.from):p[0]??"",onChange:g=>{const S=[...a];let C=Number(g.target.value),x=Number(S[c].to);(!Number.isFinite(x)||x<C)&&(x=C),S[c]={...S[c],from:C,to:x,dFrom:void 0,dTo:void 0},r(S)},children:p.map(g=>e.jsx("option",{value:g,children:g},g))})}),e.jsx("span",{className:"text-black dark:text-white",children:"to"}),e.jsx("div",{className:"select-wrapper sb-select-round",children:e.jsx("select",{className:"rounded-lg border border-black/10 bg-white text-black px-2 py-1 shadow-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20 shrink-0 sb-select-round",value:o.to!=null&&p.includes(String(o.to))?String(o.to):p[p.length-1]??"",onChange:g=>{const S=[...a];let C=Number(g.target.value),x=Number(S[c].from);(!Number.isFinite(x)||x>C)&&(x=C),S[c]={...S[c],from:x,to:C,dFrom:void 0,dTo:void 0},r(S)},children:p.map(g=>e.jsx("option",{value:g,children:g},g))})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"select-wrapper sb-select-round",children:e.jsx("select",{className:"rounded-lg border border-black/10 bg-white text-black px-2 py-1 shadow-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20 shrink-0 sb-select-round",value:o.dFrom??p[0]??"",onChange:g=>{const S=[...a],C=g.target.value;let x=S[c].dTo;if(x){const j=p.indexOf(C),v=p.indexOf(x);j!==-1&&v!==-1&&j>v&&(x=C)}S[c]={...S[c],dFrom:C,dTo:x},r(S)},children:p.map(g=>e.jsx("option",{value:g,children:g},g))})}),e.jsx("span",{className:"text-black dark:text-white",children:"to"}),e.jsx("div",{className:"select-wrapper sb-select-round",children:e.jsx("select",{className:"rounded-lg border border-black/10 bg-white text-black px-2 py-1 shadow-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20 shrink-0 sb-select-round",value:o.dTo??p[p.length-1]??"",onChange:g=>{const S=[...a],C=g.target.value;let x=S[c].dFrom;if(x){const j=p.indexOf(x),v=p.indexOf(C);j!==-1&&v!==-1&&j>v&&(x=C)}S[c]={...S[c],dFrom:x??C,dTo:C},r(S)},children:p.map(g=>e.jsx("option",{value:g,children:g},g))})})]}):(()=>{const g=Array.from({length:n},(x,j)=>j+1),S=o.from!=null&&o.from>=1?o.from:g[0],C=o.to!=null&&o.to>=S||o.to!=null?o.to:g[g.length-1];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"select-wrapper sb-select-round",children:e.jsx("select",{className:"rounded-lg border border-black/10 bg-white text-black px-2 py-1 shadow-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20 shrink-0 sb-select-round",value:String(S),onChange:x=>{const j=[...a];let v=Number(x.target.value),k=Number(j[c].to);(!Number.isFinite(k)||k<v)&&(k=v),j[c]={...j[c],from:v,to:k,dFrom:void 0,dTo:void 0},r(j)},children:g.map(x=>e.jsx("option",{value:x,children:x},x))})}),e.jsx("span",{className:"text-black dark:text-white",children:"to"}),e.jsx("div",{className:"select-wrapper sb-select-round",children:e.jsx("select",{className:"rounded-lg border border-black/10 bg-white text-black px-2 py-1 shadow-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20 shrink-0 sb-select-round",value:String(C),onChange:x=>{const j=[...a];let v=Number(x.target.value),k=Number(j[c].from);(!Number.isFinite(k)||k>v)&&(k=v),j[c]={...j[c],from:k,to:v,dFrom:void 0,dTo:void 0},r(j)},children:g.map(x=>e.jsx("option",{value:x,children:x},x))})})]})})(),e.jsx("button",{className:"chip shrink-0","aria-label":"Remove round range",title:"Remove range",onClick:()=>r(a.filter((g,S)=>S!==c)),children:e.jsx(dr,{className:"h-4 w-4"})})]},c)})]})]})}function Bs(t){return Array.from(new Set(t))}function Hi(t,s){return t?s.find(a=>a.question_type?.toLowerCase()==="bonus"&&a.round===t.round&&a.tournament===t.tournament&&a.question_number===t.question_number):null}function Gt(t){if(!t)return[];const s=["w","x","y","z"],a=n=>{if(n==null)return null;const c=String(n).replace(/[.)\s]/g,"").toLowerCase()[0];return s.includes(c)?c:null},r=n=>n==null?null:typeof n=="string"||typeof n=="number"?String(n):typeof n=="object"?n.text??n.value??n.choice??n.content??n.answer??n.option??n.label??n.name??null:null;let i=t.choices??null;if(!i){const n={w:t.w??t.W,x:t.x??t.X,y:t.y??t.Y,z:t.z??t.Z};if(Object.values(n).some(o=>o!=null&&String(o).trim()!==""))i=n;else return[]}if(Array.isArray(i)){const n=i.slice(0,4).map((c,l)=>{const m=r(c);return m?[s[l],m]:null}).filter(Boolean),o=new Map(n);return s.map(c=>[c,o.get(c)]).filter(([,c])=>c!=null)}if(i&&typeof i=="object"){const n=Object.entries(i).map(([c,l])=>{const m=r(l),d=a(c);return!m||!d?null:[d,m]}).filter(Boolean),o=new Map(n);return s.map(c=>[c,o.get(c)]).filter(([,c])=>c!=null)}return[]}function Wi(t){if(!t)return"";const s=String(t).toUpperCase();return s.startsWith("PHYS")?"P":s.startsWith("CHEM")?"C":s.startsWith("BIO")?"B":s.startsWith("MATH")?"M":s.startsWith("EARTH")?"E":s.startsWith("ASTRO")?"A":s.startsWith("ENERG")?"EN":s.startsWith("GEN")?"G":s[0]}async function Ji(){return typeof window<"u"&&window.html2pdf||await new Promise((t,s)=>{const a=document.querySelector("script[data-html2pdf]");if(a){a.addEventListener("load",()=>t()),a.addEventListener("error",()=>s(new Error("Failed to load html2pdf.js")));return}const r=document.createElement("script");r.src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js",r.async=!0,r.defer=!0,r.setAttribute("data-html2pdf","true"),r.onload=()=>t(),r.onerror=()=>s(new Error("Failed to load html2pdf.js")),document.head.appendChild(r)}),window.html2pdf}function Ca({questions:t=[],lazy:s=null}){const a=!!s,[r,i]=f.useState([]),[n,o]=f.useState([]),[c,l]=f.useState(()=>new Set),m=f.useMemo(()=>[...a?s.tournaments||[]:Bs(t.map(N=>N.tournament))].filter(Boolean).sort((N,M)=>String(N).localeCompare(String(M))),[a,s,t]),d=f.useRef([]),u=f.useRef([]),y=f.useRef(null),h=f.useRef(null);function w(z,N,M="main"){const P=z?.nativeEvent?.shiftKey||z?.shiftKey,T=(M==="modal"?u.current:d.current)||[],$=T.findIndex(F=>F?.type==="key"&&F.key===N),_=r.includes(N),Z=!_,D=M==="modal"?h:y;if(P&&D.current!=null&&$!==-1&&D.current!==$){const[F,q]=[D.current,$].sort((U,Y)=>U-Y),I=T.slice(F,q+1),ce=[],we=new Set(I.filter(U=>U&&U.type==="key"&&U.base).map(U=>U.base));I.forEach(U=>{U&&(U.type==="key"&&U.key?ce.push(U.key):U.type==="group"&&Array.isArray(U.keys)&&(we.has(U.base)||U.keys.forEach(Y=>ce.push(Y))))}),i(U=>{const Y=new Set(U);return Z?ce.forEach(le=>Y.add(le)):ce.forEach(le=>Y.delete(le)),Array.from(Y)}),D.current=$}else i(F=>{const q=new Set(F);return _?q.delete(N):q.add(N),Array.from(q)}),D.current=$}const p=f.useMemo(()=>{const z=new Map;for(const N of m){if(!N)continue;const[M,P]=String(N).split("-"),T=M||N,$=P&&/\d{4}/.test(P)?P:null;z.has(T)||z.set(T,{base:T,years:[],all:[]});const _=z.get(T);_.all.push(N),$?_.years.push({label:N,year:Number($)||$,key:N}):_.years.push({label:N,year:null,key:N})}for(const N of z.values())N.years.sort((M,P)=>String(M.label).localeCompare(String(P.label)));return Array.from(z.values()).sort((N,M)=>N.base.localeCompare(M.base))},[m]);f.useEffect(()=>{a&&r.length!==0&&s.ensureLoaded(r)},[a,s,r]);const E=f.useMemo(()=>(a?s.getLoadedQuestions(r):t).map(z=>{let N=z.category;if(typeof N=="string"){const M=N.trim();N=M?M.toUpperCase():null}return{...z,category:N}}),[a,s,r,t]),g=f.useMemo(()=>E.filter(z=>z.category!=null&&String(z.category).trim()!==""),[E]),S=f.useMemo(()=>Bs(g.map(z=>z.category)),[g]),[C,x]=f.useState([]),j=f.useMemo(()=>{const z=new Map,N=E;for(const P of N){const T=P.tournament,$=P.round;if(T==null||$==null)continue;const _=z.get(T)??[],Z=String($);_.includes(Z)||_.push(Z),z.set(T,_)}const M={};for(const[P,T]of z.entries())M[P]=[...T].sort(($,_)=>String($).localeCompare(String(_)));return M},[E]),v=f.useMemo(()=>{let z=0;for(const N of E){const M=N.round;if(M!=null&&/^\d+$/.test(String(M))){const P=Number(M);P>z&&(z=P)}}return z||30},[E]);f.useEffect(()=>{if(r.length===1){const z=r[0];x(N=>{let M=!1;const P=N.map(T=>T.tournament!==z?(M=!0,{...T,tournament:z}):T);return M?P:N})}},[r]);function k(z){return!C.length||z?.round==null?!0:C.some(({from:N,to:M,tournament:P,dFrom:T,dTo:$})=>{const _=r.length===1?r[0]:P||null;if(!(!_||z.tournament===_))return!1;if(_){const F=j[_]??[];if(F.length>0&&F.every(I=>/^\d+$/.test(I))){const I=Number(z.round);return I>=Number(N)&&I<=Number(M)}else{if(!F.length)return!0;const I=F.indexOf(String(z.round));if(I===-1)return!1;const ce=T?F.indexOf(T):0,we=$?F.indexOf($):F.length-1,[U,Y]=[ce,we].sort((le,it)=>le-it);return I>=U&&I<=Y}}const D=Number(z.round);return Number.isNaN(D)?!1:D>=Number(N)&&D<=Number(M)})}return{isLazy:a,tournaments:m,tournamentGroups:p,selectedTournaments:r,setSelectedTournaments:i,selectedCategories:n,setSelectedCategories:o,tournamentGroupsOpen:c,setTournamentGroupsOpen:l,tournamentVisibleEntriesMainRef:d,tournamentVisibleEntriesModalRef:u,lastTournamentClickIndexMainRef:y,lastTournamentClickIndexModalRef:h,handleTournamentToggle:w,loadedQuestions:E,validQuestions:g,categories:S,roundRanges:C,setRoundRanges:x,roundsByTournament:j,globalNumericRoundMax:v,inRanges:k}}function Ea({room:t,roomId:s,membersCount:a,onBack:r,members:i,currentQ:n,answersMap:o}){const[c,l]=f.useState(!1),m=i.filter(u=>u.online!==!1),d=i.filter(u=>u.online===!1);return e.jsxs("div",{className:"glass p-4 flex items-start justify-between",children:[e.jsxs("div",{className:"flex gap-6 flex-1 min-w-0",children:[e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("div",{className:"text-sm opacity-70",children:"Room"}),e.jsx("div",{className:"text-xl font-semibold",children:t?.name||s}),e.jsxs("div",{className:"text-sm opacity-70",children:["Participants: ",a]})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Players"}),e.jsx("div",{className:"grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))] gap-x-4 gap-y-1 max-h-32 overflow-y-auto",children:m.map(u=>e.jsxs("div",{className:"flex items-center justify-between gap-2 text-sm min-w-0",children:[e.jsxs("span",{className:"truncate pr-2 flex-1 flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"truncate",children:u.displayName||u.uid}),u.lastQuestionId===n?.id&&u.lastAnswerStatus&&e.jsx("span",{className:`ml-2 text-xs rounded px-2 py-0.5 flex-shrink-0 ${u.lastAnswerStatus==="correct"?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200":u.lastAnswerStatus==="incorrect"?"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200":"bg-black/10 dark:bg-white/10 text-black/70 dark:text-white/70"}`,children:u.lastAnswerStatus})]}),e.jsx("span",{className:"font-semibold tabular-nums flex-shrink-0",children:u.score||0})]},u.uid))}),d.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("button",{className:"text-sm font-medium text-black/60 dark:text-white/60 hover:text-black dark:hover:text-white flex items-center gap-1",onClick:()=>l(!c),children:[e.jsxs("span",{children:["Disconnected (",d.length,")"]}),e.jsx("svg",{className:`w-4 h-4 transition-transform ${c?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),c&&e.jsx("div",{className:"mt-1 grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))] gap-x-4 gap-y-1 max-h-24 overflow-y-auto",children:d.map(u=>e.jsxs("div",{className:"flex items-center justify-between gap-2 text-sm min-w-0 opacity-60",children:[e.jsxs("span",{className:"truncate pr-2 flex-1 flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"truncate",children:u.displayName||u.uid}),e.jsx("span",{className:"text-xs rounded px-2 py-0.5 bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200 flex-shrink-0",children:"disconnected"}),u.lastQuestionId===n?.id&&u.lastAnswerStatus&&e.jsx("span",{className:`ml-2 text-xs rounded px-2 py-0.5 flex-shrink-0 ${u.lastAnswerStatus==="correct"?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200":u.lastAnswerStatus==="incorrect"?"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200":"bg-black/10 dark:bg-white/10 text-black/70 dark:text-white/70"}`,children:u.lastAnswerStatus})]}),e.jsx("span",{className:"font-semibold tabular-nums flex-shrink-0",children:u.score||0})]},u.uid))})]})]})]}),e.jsx("div",{className:"flex gap-2 ml-4",children:e.jsx("button",{className:"btn btn-ghost",onClick:r,children:"Back"})})]})}function za({onStartNext:t,onTogglePause:s,isPaused:a,winnerActive:r}){return e.jsxs("div",{className:"font-semibold flex items-center justify-between",children:[e.jsx("span",{children:"Play"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"chip",onClick:t,children:"Start/Next"}),e.jsx("button",{className:"chip",onClick:s,disabled:!!r,children:a?"Resume (P)":"Pause (P)"})]})]})}function Ra({passPrompt:t,setPassPrompt:s,onJoin:a,busy:r,error:i}){return e.jsxs("div",{className:"glass p-6 space-y-3 max-w-md",children:[e.jsx("div",{className:"font-medium",children:"This room is private"}),e.jsx("input",{className:"rounded-lg border border-black/10 dark:border-white/10 px-3 py-2 bg-white dark:bg-darkcard w-full",placeholder:"Enter passcode",value:t,onChange:n=>s(n.target.value)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-primary",onClick:a,disabled:r||!t,children:"Join"}),i&&e.jsx("div",{className:"text-sm text-red-600",children:i})]})]})}function Ma(){return e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("svg",{width:"40",height:"40",viewBox:"0 0 40 40",className:"animate-spin",children:[e.jsx("path",{d:"M20 5 Q25 10 20 15 Q15 20 20 25 Q25 30 20 35",stroke:"#3b82f6",strokeWidth:"2",fill:"none",className:"animate-pulse"}),e.jsx("path",{d:"M20 5 Q15 10 20 15 Q25 20 20 25 Q15 30 20 35",stroke:"#3b82f6",strokeWidth:"2",fill:"none",className:"animate-pulse",style:{animationDelay:"0.5s"}})]})})}function Oa({grading:t,currentQ:s,words:a,displayedWordCount:r,plainQuestionText:i,showBuzzHint:n,fullMcChoices:o,choiceStreamCount:c,resultBanner:l}){return e.jsx("div",{className:"rounded-lg bg-black/5 dark:bg-white/10 p-4 min-h-32 text-black dark:text-white",children:t?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ma,{}),e.jsx("span",{className:"ml-4 text-lg font-semibold",children:"Checking answer..."})]})}):s?e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-black/60 dark:text-white/80 mb-2",children:[e.jsx("span",{className:"font-semibold",children:String(s.tournament).toUpperCase()})," • ","ROUND ",s.round??"—"," • ",s.category," • ",e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold ${String(s?.question_type||"").toLowerCase()==="bonus"?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-100":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-100"}`,children:String(s?.question_type||"").toLowerCase()==="bonus"?"BONUS":"TOSS-UP"})," • ",e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold ${(o||[]).length>0?"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-100":"bg-pink-100 text-pink-800 dark:bg-pink-900/30 dark:text-pink-100"}`,children:(o||[]).length>0?"MULTIPLE CHOICE":"SHORT ANSWER"})]}),r>=a.length?e.jsx("div",{className:"text-base whitespace-pre-line text-black dark:text-white",children:e.jsx(ve,{children:i})}):e.jsxs("div",{className:"text-base whitespace-pre-line text-black dark:text-white",children:[e.jsx(ve,{children:a.slice(0,Math.min(r,a.length)).join(" ")}),n&&e.jsx("div",{className:"mt-2 text-xs opacity-70 text-black dark:text-white",children:"Press Space to buzz"})]}),(o||[]).length>0&&e.jsx("div",{className:"mt-4 space-y-2 text-base text-black dark:text-white",children:o.map(([m,d],u)=>e.jsxs("div",{className:"practice-katex text-black dark:text-white",children:[e.jsxs("span",{className:"font-semibold mr-1 text-black dark:text-white",children:[m.toUpperCase(),")"]}),u<c&&d?e.jsx(ve,{children:d}):e.jsx("span",{className:"opacity-50",children:"…"})]},m))}),l&&e.jsxs("div",{className:`mt-3 rounded-lg px-3 py-2 ${l.correct?"bg-green-100 text-green-900 dark:bg-green-900/20 dark:text-green-100":"bg-red-100 text-red-900 dark:bg-red-900/20 dark:text-red-100"}`,children:[l.correct?"Correct":"Incorrect",l.reason?` — ${l.reason}`:""]})]}):e.jsx("div",{className:"opacity-70 text-sm",children:"No question selected yet."})})}function Pa({currentQId:t,buzzes:s,answersForQ:a,selfUid:r,members:i,typingMap:n,winnerUid:o,awaitNext:c,mcTypedAnswer:l,setMcTypedAnswer:m,onSubmit:d,onUpdateTyping:u,mcInputRef:y}){return!t||!Array.isArray(s)||s.length===0?null:e.jsx("div",{className:"mt-2 space-y-2",children:s.slice().reverse().map((h,w,p)=>{const E=o===h.uid&&w===0,g=a?.[h.uid]||null,S=!!g,C=!!g?.correct,x=r===h.uid,j=n?.[h.uid]?.draft||i.find(k=>k.uid===h.uid)?.draft||"",v=h.displayName||i.find(k=>k.uid===h.uid)?.displayName||h.uid;return e.jsx("div",{className:"rounded-lg bg-black/5 dark:bg-white/10 p-3",children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-semibold text-black dark:text-white",children:v}),e.jsx("span",{className:"chip text-xs bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200",children:"buzzed"}),e.jsxs("span",{className:"text-[10px] opacity-60",children:["#",p.length-w]}),S?e.jsx("span",{className:"ml-2 px-2 py-1 rounded bg-black/10 dark:bg-white/10 text-sm whitespace-pre-wrap break-words",children:g?.text||""}):E?x?e.jsx("form",{onSubmit:d,className:"flex-1 min-w-[200px]",children:e.jsx("input",{className:"rounded-lg border border-black/10 dark:border-white/10 px-3 py-1.5 bg-white dark:bg-darkcard w-full",placeholder:"Type your answer and press Enter",value:l,onChange:k=>{m(k.target.value),u(!!k.target.value,String(k.target.value).slice(0,200))},ref:y,autoFocus:!0})}):e.jsx("span",{className:"ml-2 text-sm text-black/80 dark:text-white/80 whitespace-pre-wrap break-words",children:j}):null,S&&e.jsx("span",{className:`chip text-xs ${C?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200"}`,children:C?"correct":"incorrect"}),c&&C&&E&&e.jsx("span",{className:"ml-2 text-xs opacity-70",children:"Press ‘n’ for next"})]})},h.id||`${h.uid}-${w}`)})})}function Ta({history:t,page:s,setPage:a,pageSize:r,byId:i,buzzesMap:n,answersMap:o,members:c}){return!Array.isArray(t)||t.length===0?null:e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold text-black/60 dark:text-white/60",children:"Previous Questions"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("button",{className:"chip",disabled:s<=0,onClick:()=>a(l=>Math.max(0,l-1)),children:"Prev"}),e.jsxs("span",{className:"opacity-70",children:["Page ",s+1]}),e.jsx("button",{className:"chip",disabled:(s+1)*r>=t.length,onClick:()=>a(l=>l+1),children:"Next"})]})]}),t.slice(s*r,s*r+r).map((l,m)=>{const d=i.get(l.questionId)||{id:l.questionId};return e.jsxs("details",{className:"rounded-lg bg-black/5 dark:bg-white/10",children:[e.jsx("summary",{className:"cursor-pointer px-3 py-2 text-sm",children:d.tournament?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold",children:String(d.tournament).toUpperCase()})," • Round ",d.round," • ",d.category,d.question_number&&e.jsxs(e.Fragment,{children:[" • Q",d.question_number]})," • ",e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold ${String(d?.question_type||"").toLowerCase()==="bonus"?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-100":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-100"}`,children:String(d?.question_type||"").toLowerCase()==="bonus"?"BONUS":"TOSS-UP"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"font-semibold",children:["Question ",d.id]}),e.jsx("span",{className:"ml-2 opacity-70",children:"(Load tournaments to view details)"})]})}),d.question&&e.jsx("div",{className:"px-3 pb-3 whitespace-pre-wrap",children:e.jsx(ve,{children:d.question})}),(()=>{const u=Gt(d);return u.length>0&&e.jsx("div",{className:"px-3 pb-3 space-y-1",children:u.map(([y,h])=>e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"font-semibold mr-2",children:[y.toUpperCase(),")"]}),e.jsx(ve,{children:h})]},y))})})(),e.jsx("div",{className:"px-3 pb-1 flex items-center gap-2",children:e.jsx("span",{className:"text-xs uppercase tracking-wide text-black/60 dark:text-white/60",children:"ANSWER"})}),d.answer&&e.jsx("div",{className:"px-3 pb-3",children:e.jsx(ve,{children:String(d.answer).toUpperCase()})}),d.id&&Array.isArray(n[d.id])&&n[d.id].length>0&&e.jsxs("div",{className:"px-3 pb-3 space-y-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-black/60 dark:text-white/60",children:"Buzz History"}),n[d.id].slice().reverse().map((u,y,h)=>{const w=o?.[d.id]?.[u.uid]||null,p=!!w?.correct,E=u.displayName||c.find(g=>g.uid===u.uid)?.displayName||u.uid;return e.jsxs("div",{className:"text-sm flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium",children:E}),e.jsx("span",{className:"chip text-xs bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200",children:"buzzed"}),e.jsxs("span",{className:"text-[10px] opacity-60",children:["#",h.length-y]}),w?.text&&e.jsx("span",{className:"ml-2 px-2 py-0.5 rounded bg-black/10 dark:bg-white/10 whitespace-pre-wrap break-words",children:w.text}),w&&e.jsx("span",{className:`chip text-xs ${p?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200"}`,children:p?"correct":"incorrect"})]},u.id||`${u.uid}-${y}`)})]})]},l.id||l.questionId||m)})]})}function La({roomId:t,messages:s,typingMap:a,selfUid:r,onSendMessage:i,onUpdateTyping:n,disabled:o,inputRef:c}){const[l,m]=f.useState(""),d=f.useRef(null),[u,y]=f.useState(!0),h=f.useRef(null),w=f.useRef(null),p=(x=!0,j=180)=>{try{const v=d.current;if(!v)return;const k=v.scrollHeight;if(!x){v.scrollTop=k,y(!0);return}if(w.current){try{cancelAnimationFrame(w.current)}catch{}w.current=null}const z=v.scrollTop,N=k-z;if(Math.abs(N)<1){y(!0);return}const M=performance.now(),P=Math.max(60,Math.min(400,j)),T=_=>1-Math.pow(1-_,3),$=_=>{const Z=_-M,D=Math.min(1,Z/P),F=T(D);v.scrollTop=z+N*F,D<1?w.current=requestAnimationFrame($):(w.current=null,y(!0))};w.current=requestAnimationFrame($),y(!0)}catch{}};f.useEffect(()=>{try{const x=d.current;if(!x)return;(x.scrollHeight-x.scrollTop-x.clientHeight<=48||u)&&p(!0,140)}catch{}},[s?.length,u]),f.useEffect(()=>{const x=d.current;if(!x||typeof ResizeObserver>"u")return;const j=new ResizeObserver(()=>{try{if(!u)return;x.scrollTop=x.scrollHeight}catch{}});return j.observe(x),()=>{try{j.disconnect()}catch{}}},[u]),f.useEffect(()=>{try{const x=d.current;if(!x)return;x.scrollHeight-x.scrollTop-x.clientHeight<=160&&(x.scrollTop=x.scrollHeight,y(!0))}catch{}},[JSON.stringify(a)]),f.useEffect(()=>{const x=setTimeout(()=>p(!0,160),0);return()=>clearTimeout(x)},[]);const E=f.useMemo(()=>{const x=[];return Object.values(a||{}).forEach(j=>{!j||!j.typing||j.draft&&j.uid!==r&&x.push({uid:j.uid,name:j.displayName||j.uid,draft:String(j.draft||"")})}),x},[JSON.stringify(a),r]),g=()=>{try{const x=d.current;if(!x)return;const v=x.scrollHeight-x.scrollTop-x.clientHeight<=48;y(v),v?h.current&&(clearTimeout(h.current),h.current=null):(h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{p(!0,220)},2e3))}catch{}},S=x=>{const j=x.target.value;m(j),n?.(!!j,String(j).slice(0,500))},C=async x=>{x?.preventDefault?.();const j=String(l||"").trim();if(j)try{try{n?.(!1,"")}catch{}await i?.(j)}finally{m("")}};return e.jsxs("div",{className:"flex flex-col h-[520px] max-h-[60vh]",children:[e.jsxs("div",{ref:d,onScroll:g,className:"relative flex-1 overflow-y-auto pr-1 pb-6 space-y-2",children:[(s||[]).map(x=>{const j=x.uid===r;return e.jsx("div",{className:`flex ${j?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[75%] px-3 py-2 rounded-2xl text-sm whitespace-pre-wrap break-words ${j?"bg-blue-600 text-white rounded-br-md":"bg-black/5 dark:bg-white/10 text-black dark:text-white rounded-bl-md"}`,children:[!j&&e.jsx("div",{className:"text-[10px] opacity-70 mb-0.5",children:x.displayName||x.uid}),e.jsx("div",{children:x.text})]})},x.id)}),E.map(x=>e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"max-w-[75%] px-3 py-2 rounded-2xl text-sm whitespace-pre-wrap break-words bg-black/5 dark:bg-white/10 text-black dark:text-white rounded-bl-md border border-dashed border-black/10 dark:border-white/10",children:[e.jsxs("div",{className:"text-[10px] opacity-70 mb-0.5",children:[x.name," (typing…)"]}),e.jsx("div",{children:x.draft})]})},`live-${x.uid}`)),!u&&e.jsx("div",{className:"absolute bottom-3 right-3",children:e.jsx("button",{type:"button",onClick:()=>p(!0),className:"px-3 py-1.5 rounded-full text-sm bg-white/90 dark:bg-darkcard/90 shadow border border-black/10 dark:border-white/10 hover:bg-white dark:hover:bg-darkcard",children:"Go to bottom"})})]}),e.jsx("form",{onSubmit:C,className:"pt-2",children:e.jsx("textarea",{ref:c,disabled:o,rows:2,className:"w-full rounded-lg border border-black/10 dark:border-white/10 px-3 py-2 bg-white dark:bg-darkcard disabled:opacity-60 resize-y min-h-[44px]",placeholder:o?"Chat disabled while you are answering":"Type a message… (Enter to send, Shift+Enter for newline)",value:l,onChange:S,onBlur:()=>{try{n?.(!1,"")}catch{}},onKeyDown:x=>{if(x.key==="Enter"&&x.shiftKey){x.stopPropagation();return}x.key==="Enter"&&!x.shiftKey&&(x.preventDefault(),C())}})})]})}function Ba(){async function t(){if(!n?.state?.buzzerOpen)return;const b=ue(),A=b?.uid,R=b?.displayName||"Player";p(!0);try{await ua({roomId:s,uid:A,displayName:R})}finally{p(!1)}}const{roomId:s}=yt(),a=qt(),r=Se(),i=pe(),[n,o]=f.useState(null),c=B.useCallback(b=>{o(A=>JSON.stringify(A)===JSON.stringify(b)?A:b)},[]),[l,m]=f.useState([]),d=B.useCallback(b=>{m(A=>JSON.stringify(A)===JSON.stringify(b)?A:b)},[]),[u,y]=f.useState([]),h=B.useCallback(b=>{y(A=>JSON.stringify(A)===JSON.stringify(b)?A:b)},[]),[w,p]=f.useState(!1),[E,g]=f.useState(""),[S,C]=f.useState(""),[x,j]=f.useState(""),[v,k]=f.useState(!1),[z,N]=f.useState(!1),[M,P]=f.useState(""),[T,$]=f.useState("");f.useRef(null);const _=jt(),Z=ue(),D=Z?.uid||null;Z?.displayName;const[F,q]=f.useState(""),[I,ce]=f.useState({selectedTournaments:[],selectedCategories:[],roundRanges:[]}),we=B.useCallback(b=>{ce(A=>JSON.stringify(A)===JSON.stringify(b)?A:b)},[]),[U,Y]=f.useState([]),[le,it]=f.useState("settings"),[ts,sn]=f.useState(()=>Date.now()),[$e,ss]=f.useState(0),[nn,rn]=f.useState(0),an=10,[ot,ct]=f.useState(null),on=!!n?.state?.grading,[ns,cn]=f.useState({}),[rs,ln]=f.useState({}),[Fe,dn]=f.useState({}),[as,vt]=f.useState(0),[Pe,lt]=f.useState(0),[is,os]=f.useState(!1),[cs,ls]=f.useState(""),[de,ds]=f.useState({tossup:!0,bonus:!0});f.useRef(null);const us=f.useRef(null),ms=f.useRef(null);f.useEffect(()=>{if(s)return na({roomId:s,onRoom:c,onMembers:d,onMessages:h,onSettings:we,onAnswers:dn})},[s,c,d,h,we]),f.useEffect(()=>{if(!s||!i?.user)return;const b=Vr();!b||!l.some(R=>R.uid===b.uid)||(async()=>{try{await da({roomId:s,uid:b.uid})}catch{}try{Qr()}catch{}})()},[s,i?.user?.uid,JSON.stringify(l.map(b=>b.uid))]),f.useEffect(()=>{if(s)return aa({roomId:s,onTyping:b=>{cn(A=>({...A,[b.uid]:b}))}})},[s]),f.useEffect(()=>{if(s)return ra({roomId:s,onBuzzes:ln})},[s]),f.useEffect(()=>{const b=D;if(!s||!b)return;const A=wt(),R=V(A,`mp/roomMembers/${s}/${b}`);try{ar(R).update({online:!1,lastSeenAt:ir()})}catch{}return(async()=>{try{await K(R,{online:!0,lastSeenAt:Date.now()})}catch{}})(),()=>{try{K(R,{online:!1,lastSeenAt:Date.now()})}catch{}}},[s,D]),f.useEffect(()=>{if(s)return ba({roomId:s,onHistory:Y})},[s]);const hs=String(n?.game?.currentId||"")||"",St=f.useMemo(()=>{const b=hs.match(/^([^_]+)__[^_]+__(?:tu|bo)__\d+$/i);return b?b[1]:null},[hs]),je=f.useMemo(()=>{const b=Array.isArray(I?.selectedTournaments)&&I.selectedTournaments.length?I.selectedTournaments:[],A=Array.isArray(n?.game?.tournaments)?n.game.tournaments:[],R=new Set([...b||[],...A||[]]);return St&&R.add(St),Array.from(R)},[JSON.stringify(I?.selectedTournaments||[]),JSON.stringify(n?.game?.tournaments||[]),St]);f.useEffect(()=>{!je||je.length===0||(async()=>{try{await _.ensureLoaded(je)}catch{}})()},[JSON.stringify(je)]);const fs=B.useMemo(()=>_.getLoadedQuestions(je),[_,JSON.stringify(je)]),ps=B.useMemo(()=>{const b=new Map;for(const A of fs)b.set(A.id,A);return b},[fs]),L=n?.game?.currentId&&ps.get(n.game.currentId)||null,Ge=B.useMemo(()=>{const A=ue()?.uid;return A?l.some(R=>R.uid===A):!1},[l,i?.user?.uid]),{tournamentGroups:un,selectedTournaments:xe,setSelectedTournaments:xs,selectedCategories:Ne,setSelectedCategories:bs,tournamentGroupsOpen:mn,setTournamentGroupsOpen:hn,tournamentVisibleEntriesMainRef:fn,handleTournamentToggle:pn,categories:xn,roundRanges:He,setRoundRanges:gs,roundsByTournament:bn,globalNumericRoundMax:gn,inRanges:yn}=Ca({questions:[],lazy:_}),[wn,jn]=f.useState(!1),[Nn,kn]=f.useState(()=>{try{return document.documentElement.classList.contains("dark")}catch{return!1}});f.useEffect(()=>{try{const b=document.documentElement,A=()=>kn(b.classList.contains("dark"));A();const R=new MutationObserver(A);R.observe(b,{attributes:!0,attributeFilter:["class"]});const O=window.matchMedia("(prefers-color-scheme: dark)");return O.addEventListener("change",A),()=>{R.disconnect(),O.removeEventListener("change",A)}}catch{}},[]);const At=B.useRef(!1),dt=()=>{At.current=!0},vn=b=>{xs(b),dt()},Sn=b=>{bs(b),dt()},An=b=>{gs(b),dt()},ys=b=>{const A=typeof b=="function"?b(de):b;ds(A),dt()},Ct=JSON.stringify(I);f.useEffect(()=>{try{const b=JSON.parse(Ct||"{}");if(Array.isArray(b.selectedTournaments)&&JSON.stringify(b.selectedTournaments)!==JSON.stringify(xe)&&xs(b.selectedTournaments),Array.isArray(b.selectedCategories)&&JSON.stringify(b.selectedCategories)!==JSON.stringify(Ne)&&bs(b.selectedCategories),Array.isArray(b.roundRanges)&&JSON.stringify(b.roundRanges)!==JSON.stringify(He)&&gs(b.roundRanges),b.selectedTypes&&(b.selectedTypes.tossup!==void 0||b.selectedTypes.bonus!==void 0)){const A={tossup:b.selectedTypes.tossup??!0,bonus:b.selectedTypes.bonus??!0};JSON.stringify(A)!==JSON.stringify(de)&&ds(A)}}catch{}},[Ct]),f.useEffect(()=>{if(!s)return;const b={selectedTournaments:Array.isArray(xe)?xe:[],selectedCategories:Array.isArray(Ne)?Ne:[],roundRanges:Array.isArray(He)?He:[],selectedTypes:de||{tossup:!0,bonus:!0}};if(!At.current||(()=>{try{const O=I||{};return JSON.stringify(O.selectedTournaments||[])===JSON.stringify(b.selectedTournaments)&&JSON.stringify(O.selectedCategories||[])===JSON.stringify(b.selectedCategories)&&JSON.stringify(O.roundRanges||[])===JSON.stringify(b.roundRanges)&&JSON.stringify(O.selectedTypes||{})===JSON.stringify(b.selectedTypes)}catch{return!1}})())return;const R=setTimeout(()=>{ca({roomId:s,patch:b}),At.current=!1},200);return()=>clearTimeout(R)},[s,JSON.stringify(xe),JSON.stringify(Ne),JSON.stringify(He),JSON.stringify(de),Ct]),f.useEffect(()=>{if(!n)return;const b=ue();if(!b&&!i?.user){N(!0);return}(async()=>{try{const A=`mp_pass_ok_${s}`,R=typeof window<"u"?window.localStorage.getItem(A)==="1":!1,O=a?.state?.passcode?String(a.state.passcode).trim():"";if(n.isPrivate&&!Ge&&!R)if(O){await Ve({roomId:s,passcode:O,uid:b?.uid,displayName:b?.displayName});try{window.localStorage.setItem(A,"1"),n?.passHash&&window.localStorage.setItem(`mp_pass_hash_${s}`,String(n.passHash))}catch{}k(!1)}else k(!0);else Ge||await Ve({roomId:s,uid:b?.uid,displayName:b?.displayName})}catch(A){g(A?.message||String(A))}})()},[!!n,i?.user?.uid,Ge]),f.useEffect(()=>{const b=A=>{try{Dt(s,!1,"")}catch{}};return window.addEventListener("beforeunload",b),()=>window.removeEventListener("beforeunload",b)},[s]);const Et=f.useMemo(()=>String(L?.question||L?.text||""),[L?.id]),We=f.useMemo(()=>Et.split(/\s+/).filter(Boolean),[Et]),Je=as>=We.length;String(L?.question_type||"").toLowerCase();const ke=f.useMemo(()=>Gt(L),[L?.id]),Cn=f.useMemo(()=>{if(!Array.isArray(ke)||ke.length===0)return[];const b=new Map(ke);return["w","x","y","z"].map(A=>[A,b.get(A)])},[ke]);f.useEffect(()=>{vt(0),lt(0),os(!1),ls(""),ct(null)},[L?.id]),f.useEffect(()=>{function b(R){return R&&(R.tagName==="INPUT"||R.tagName==="TEXTAREA"||R.isContentEditable)}const A=R=>{const O=R.key;if(O===" "||O==="Spacebar"){if(!b(R.target)){const te=ue()?.uid,se=n?.state?.lockedOut&&typeof n.state.lockedOut=="object"?n.state.lockedOut:{};!!L&&!!n?.state?.buzzerOpen&&!n?.state?.winnerUid&&(!te||!se[te])&&(R.preventDefault(),t())}}else String(O).toLowerCase()==="p"&&(b(R.target)||(R.preventDefault(),Ns()))};return window.addEventListener("keydown",A),()=>window.removeEventListener("keydown",A)},[n?.state?.buzzerOpen,n?.state?.winnerUid,n?.state?.lockedOut,!!L]),f.useEffect(()=>{const b=R=>{if(!R)return!1;const O=(R.tagName||"").toUpperCase();return O==="INPUT"||O==="TEXTAREA"||R.isContentEditable},A=R=>{if(R.altKey||R.ctrlKey||R.metaKey||R.shiftKey||String(R.key)!=="Enter")return;const O=R.target||document.activeElement;b(O)||D&&n?.state?.winnerUid===D||(R.preventDefault(),it("chat"),setTimeout(()=>{try{ms.current?.focus?.()}catch{}},0))};return window.addEventListener("keydown",A),()=>window.removeEventListener("keydown",A)},[D,n?.state?.winnerUid]),f.useEffect(()=>{const b=Array.isArray(u)?u:[];if(le==="chat"){const O=b.reduce((Q,te)=>Math.max(Q,Number(te.createdAt||0)),0);sn(O||Date.now()),$e!==0&&ss(0);return}const A=Number(ts||0),R=b.reduce((O,Q)=>O+(Number(Q.createdAt||0)>A&&Q.uid!==D?1:0),0);R!==$e&&ss(R)},[le,u,ts,D]);const ws=!!(D&&n?.state?.winnerUid===D);f.useEffect(()=>{if(!L||!ws||!!(D&&Fe?.[L.id]?.[D]))return;const A=us.current;A&&typeof A.focus=="function"&&setTimeout(()=>{try{A.focus(),A.select?.()}catch{}},0)},[ws,L?.id,Fe,D]),f.useEffect(()=>{const b=R=>{if(!R)return!1;const O=(R.tagName||"").toUpperCase();return O==="INPUT"||O==="TEXTAREA"||R.isContentEditable},A=R=>{if(R.altKey||R.ctrlKey||R.metaKey)return;const O=R.target||document.activeElement;if(b(O))return;String(R.key||"").toLowerCase()==="n"&&(R.preventDefault(),On())};return window.addEventListener("keydown",A),()=>window.removeEventListener("keydown",A)},[L?.id]),f.useEffect(()=>{if(!L)return;const b=Number(n?.state?.perWordMs||200),A=Number(n?.state?.streamedWordsBase||0),R=Number(n?.state?.streamStartAt||0)||null;let O=null;const Q=()=>{const te=st(),se=R?Math.max(0,Math.floor((te-R)/Math.max(1,b))):0,Te=Math.min(We.length,A+se);n?.state?.awaitNext?vt(We.length):vt(Te)};return!n?.state?.awaitNext&&n?.state?.buzzerOpen&&!n?.state?.winnerUid&&(O=setInterval(Q,80)),Q(),()=>{O&&clearInterval(O)}},[L?.id,We.length,n?.state?.buzzerOpen,n?.state?.winnerUid,n?.state?.perWordMs,n?.state?.streamedWordsBase,n?.state?.streamStartAt,n?.state?.awaitNext]),f.useEffect(()=>{if(!L||ke.length===0||!Je)return;const b=Number(n?.state?.perChoiceMs||400);if(!Number(n?.state?.stemFinishedAt||0))return;if(n?.state?.awaitNext){Pe<4&&lt(4);return}if(n?.state?.winnerUid||!n?.state?.buzzerOpen||Pe>=4)return;const R=setInterval(()=>{lt(O=>Math.min(4,O+1))},b);return()=>clearInterval(R)},[L?.id,ke.length,Je,n?.state?.winnerUid,n?.state?.buzzerOpen,n?.state?.perChoiceMs,n?.state?.stemFinishedAt,n?.state?.awaitNext,Pe]),f.useEffect(()=>{if(!L||ke.length===0||!ot||!ot.correct||Pe>=4)return;is||os(!0);const b=setInterval(()=>lt(A=>A<4?A+1:4),150);return()=>clearInterval(b)},[ot,L?.id,ke.length,Pe,is]),f.useEffect(()=>{L&&Je&&(n?.state?.stemFinishedAt||(async()=>{try{await ha({roomId:s,at:st()})}catch{}})())},[Je,L?.id,!!n?.state?.stemFinishedAt]);async function En(){try{p(!0),g(""),await Ve({roomId:s,passcode:x});try{window.localStorage.setItem(`mp_pass_ok_${s}`,"1"),n?.passHash&&window.localStorage.setItem(`mp_pass_hash_${s}`,String(n.passHash))}catch{}k(!1)}catch(b){g(b?.message||String(b))}finally{p(!1)}}async function zn(){$("");const b=String(M||"").trim();if(!b||b.length<2){$("Enter a username (min 2 chars)");return}if(l.some(O=>(O.displayName||"").toLowerCase()===b.toLowerCase())){$("Username is taken in this room");return}const R=Kr(b);try{p(!0),await Ve({roomId:s,uid:R.uid,displayName:R.displayName}),N(!1)}catch(O){$(O?.message||String(O))}finally{p(!1)}}if(i.loading||!n)return e.jsx("div",{className:"min-h-screen app-radial-bg dark:app-rad-bg transition-colors glass-backdrop",children:e.jsx(Ye,{auth:i,children:e.jsx(Ie,{})})});const Rn=!!ue();if(!i.user&&!Rn)return e.jsx("div",{className:"min-h-screen app-radial-bg dark:app-rad-bg transition-colors glass-backdrop",children:e.jsx(Ye,{auth:i,children:e.jsxs("div",{className:"glass p-6 space-y-3 max-w-md",children:[e.jsx("div",{className:"font-medium",children:"Enter a username to join"}),e.jsx("input",{className:"rounded-lg border border-black/10 dark:border-white/10 px-3 py-2 bg-white dark:bg-darkcard w-full",placeholder:"Username",value:M,onChange:b=>P(b.target.value)}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{className:"btn btn-primary",onClick:zn,disabled:w||!M,children:"Join"}),T&&e.jsx("div",{className:"text-sm text-red-600",children:T})]}),e.jsx("div",{className:"text-xs opacity-70",children:"You can sign in later; your guest slot will be removed automatically."})]})})});async function js(){try{q("");const b=be=>{const X=String(be||"").trim().toUpperCase();return X&&(X==="PHYSICAL SCIENCE"?"PHYSICS":X==="LIFE SCIENCE"?"BIOLOGY":X==="EARTH AND SPACE SCIENCE"?"EARTH AND SPACE":X==="PHYS"?"PHYSICS":X==="CHEM"?"CHEMISTRY":X)};let A=xe&&xe.length?xe:I.selectedTournaments&&I.selectedTournaments.length?I.selectedTournaments:je.length?je:(_.tournaments||[]).slice(0,2);if(!A.length){q("No tournaments loaded yet.");return}await _.ensureLoaded(A);const R=_.getLoadedQuestions(A),O=n?.game?.used&&typeof n.game.used=="object"?n.game.used:{},Q=Ne&&Ne.length?Ne:I.selectedCategories||[],te=new Set(Q||[]),se=R.filter(be=>{const X=String(be.category||"").toUpperCase(),qe=b(X),Ke=!te.size||X&&(te.has(qe)||te.has(X)),ne=String(be.question_type||"").toLowerCase(),zt=de.tossup&&ne==="tossup"||de.bonus&&ne==="bonus",Ce=!O[be.id];return Ke&&yn(be)&&zt&&Ce});if(!de.tossup&&!de.bonus){q("Select at least one type: Toss-up or Bonus");return}if(se.length===0){q("No questions available (all used for current filters).");return}const Te=se[Math.floor(Math.random()*se.length)];await ma({roomId:s,questionId:Te.id,tournaments:A}),await Os({roomId:s}),await Lt({roomId:s,open:!0}),ct(null)}catch(b){q(b?.message||String(b))}}async function Ns(){try{if(n?.state?.winnerUid)return;const b=!!n?.state?.buzzerOpen;await Lt({roomId:s,open:!b})}catch{}}async function Mn(b){b?.preventDefault();const A=Gt(L),R=(A||[]).length>0,O=(cs||"").trim(),Q=O;if(!Q){ct({correct:!1,reason:"No answer provided"});return}if(!L)return;const te=ue(),se=te?.uid,Te=te?.displayName||"Player";se&&n?.state?.winnerUid,await Rs({roomId:s,grading:!0});const be=String(L?.question_type||"").toLowerCase()==="tossup",X=A,qe=String(L?.question||L?.leadin||L?.text||"").trim(),Ke=String(L?.answer??(Array.isArray(L?.answers)?L.answers[0]:"")??"").trim();let ne=null;try{if(be)R?ne=await(await ka({userAnswer:O,correctAnswer:Ke,question:qe,choices:X})).json():ne=await(await Ts({userAnswer:O,correctAnswer:Ke,question:qe})).json();else{const ut={userAnswer:O,correctAnswer:Ke,question:qe,...R?{choices:X}:{}};ne=await(await Ts(ut)).json()}}catch{ne={correct:!1,reason:"Grading failed"}}ct(ne),C(""),await Rs({roomId:s,grading:!1});const zt=!Je;let Ce=0;be?Ce=ne.correct?4:zt?-4:0:Ce=ne.correct?10:0,await la({roomId:s,questionId:L.id,uid:se,displayName:Te,data:{status:ne.correct?"correct":"incorrect",text:Q,correct:!!ne.correct,points:Ce}}),Ce!==0&&await oa({roomId:s,uid:se,delta:Ce}),ne.correct?await Ps({roomId:s,value:!0}):(await fa({roomId:s,uid:se}),await Ms({roomId:s}),await Lt({roomId:s,open:!0}))}async function On(){try{await Ps({roomId:s,value:!1}),await Ms({roomId:s}),await Os({roomId:s}),await js()}catch{}}return e.jsxs("div",{className:"min-h-screen app-radial-bg dark:app-radial-bg transition-colors glass-backdrop",children:[e.jsx(Ye,{auth:i,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ea,{room:n,roomId:s,membersCount:l.length,onBack:()=>r("/multiplayer"),members:l,currentQ:L,answersMap:Fe}),v&&!Ge&&e.jsx(Ra,{passPrompt:x,setPassPrompt:j,onJoin:En,busy:w,error:E}),(!v||Ge)&&e.jsxs("div",{className:"grid lg:grid-cols-3 gap-4 items-start",children:[e.jsxs("div",{className:"glass p-6 lg:col-span-2 space-y-4",children:[e.jsx(za,{onStartNext:js,onTogglePause:Ns,isPaused:!n?.state?.buzzerOpen,winnerActive:n?.state?.winnerUid}),F&&e.jsx("div",{className:"text-sm text-red-600",children:F}),e.jsx(Oa,{grading:on,currentQ:L,words:We,displayedWordCount:as,plainQuestionText:Et,showBuzzHint:!n?.state?.winnerUid&&n?.state?.buzzerOpen,fullMcChoices:Cn,choiceStreamCount:Pe,resultBanner:ot}),e.jsx(Pa,{currentQId:L?.id,buzzes:L?rs[L.id]:[],answersForQ:L?Fe?.[L.id]:{},selfUid:D,members:l,typingMap:ns,winnerUid:n?.state?.winnerUid,awaitNext:n?.state?.awaitNext,mcTypedAnswer:cs,setMcTypedAnswer:ls,onSubmit:Mn,onUpdateTyping:(b,A)=>Dt(s,b,A),mcInputRef:us}),e.jsx(Ta,{history:U,page:nn,setPage:rn,pageSize:an,byId:ps,buzzesMap:rs,answersMap:Fe,members:l}),E&&e.jsx("div",{className:"text-sm text-red-600",children:E})]}),e.jsxs("div",{className:"glass p-6 space-y-6",children:[e.jsx("div",{className:"flex border-b border-black/10 dark:border-white/10 mb-3",children:["settings","chat"].map(b=>{const A=le===b,R=b==="settings"?"Settings":"Chat";return e.jsxs("button",{className:`relative px-3 py-2 -mb-px border-b-2 text-sm font-medium mr-2 ${A?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent opacity-70 hover:opacity-100"}`,onClick:()=>it(b),children:[R,b==="chat"&&!A&&$e>0&&e.jsx("span",{className:"absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1 rounded-full bg-red-600 text-white text-[10px] leading-[18px] text-center shadow",children:$e>99?"99+":$e})]},b)})}),le==="settings"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Selection"}),e.jsx(va,{tournaments:_.tournaments||[],tournamentGroups:un,selectedTournaments:xe,setSelectedTournaments:vn,tournamentGroupsOpen:mn,setTournamentGroupsOpen:hn,handleTournamentToggle:pn,tournamentVisibleEntriesMainRef:fn,isDark:Nn,showTournamentModal:wn,setShowTournamentModal:jn})]}),e.jsx(Sa,{categories:xn,selectedCategories:Ne,setSelectedCategories:Sn}),e.jsxs("div",{className:"pt-2",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Question Type"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:de.tossup,onChange:b=>ys(A=>({...A,tossup:b.target.checked}))}),"Toss-up"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:de.bonus,onChange:b=>ys(A=>({...A,bonus:b.target.checked}))}),"Bonus"]})]})]}),e.jsx(Aa,{selectedTournaments:xe,tournaments:_.tournaments||[],roundRanges:He,setRoundRanges:An,roundsByTournament:bn,globalNumericRoundMax:gn})]}):e.jsx(La,{roomId:s,messages:u,typingMap:ns,selfUid:D,onSendMessage:async b=>{try{await ia({roomId:s,text:b})}catch{}},onUpdateTyping:(b,A)=>Dt(s,b,A),disabled:!!(D&&n?.state?.winnerUid===D),inputRef:ms})]})]})]})}),(()=>{const b=n?.state?.lockedOut&&typeof n.state.lockedOut=="object"?n.state.lockedOut:{},A=!!L&&!!n?.state?.buzzerOpen&&!n?.state?.winnerUid&&(!D||!b[D]);return e.jsx("div",{className:"md:hidden fixed bottom-0 inset-x-0 z-40 p-3 pb-[calc(env(safe-area-inset-bottom)+12px)] pointer-events-none",children:e.jsx("div",{className:"max-w-3xl mx-auto pointer-events-auto",children:e.jsx("button",{className:`w-full py-4 rounded-2xl text-white text-lg font-bold shadow-xl active:scale-[0.98] transition ${A?"bg-red-600":"bg-red-300 cursor-not-allowed"}`,onClick:()=>{A&&t()},"aria-label":"Buzz",disabled:!A,children:A?"BUZZ":n?.state?.winnerUid?"BUZZ LOCKED":"BUZZ DISABLED"})})})})()]})}let Bt=null,Ee={roomId:null,typing:null,draft:null,at:0};async function Dt(t,s,a){const r=wt(),i=Date.now(),n=a||"",o=!s||n.length===0||i-(Ee.at||0)>300||Ee.typing!==!!s,c=async()=>{try{const l=ue?.()||null,m=l?.uid,d=l?.displayName||"Player";if(!m)return;const u=Date.now();if(Ee.roomId===t&&Ee.typing===!!s&&Ee.draft===n&&u-(Ee.at||0)<120)return;const y=V(r,`mp/roomMembers/${t}/${m}`);await K(y,{uid:m,displayName:d,typing:!!s,draft:n,lastTypedAt:Date.now()}),Ee={roomId:t,typing:!!s,draft:n,at:u}}catch{}};Bt&&clearTimeout(Bt),o?await c():Bt=setTimeout(c,120)}function Ut({children:t,dark:s,setDark:a,themePref:r,setThemePref:i,userChangedPrefRef:n}){return e.jsxs("div",{className:"min-h-screen app-radial-bg dark:app-radial-bg transition-colors glass-backdrop text-black dark:text-white flex flex-col items-center px-4 py-10",children:[e.jsxs("div",{className:"w-full max-w-md flex items-center justify-between mb-4 gap-2",children:[e.jsxs(Ds,{to:"/round-generator",className:"inline-flex items-center gap-1 text-xs px-3 py-1 rounded-full border border-black/10 dark:border-white/20 hover:bg-black/5 dark:hover:bg-white/10 transition","aria-label":"Back to home",children:[e.jsx("span",{"aria-hidden":"true",className:"-ml-0.5 mr-0.5",children:"←"}),e.jsx(ur,{size:14,"aria-hidden":"true"}),e.jsx("span",{children:"Home"})]}),e.jsxs("div",{className:"relative inline-flex items-center group",children:[r!=="system"&&e.jsx("button",{type:"button",onClick:()=>{n.current=!0,i("system"),a(Re("system"))},className:"mr-2 hidden group-hover:inline-flex items-center px-2 py-1 rounded text-xs border border-black/10 dark:border-white/20 bg-white/70 dark:bg-black/40 backdrop-blur-sm text-black dark:text-white hover:bg-white/90 dark:hover:bg-black/60 transition","aria-label":"Follow system theme",title:"Follow system",children:"Follow system"}),e.jsx(Fs,{checked:s,onChange:o=>{n.current=!0,i(o?"dark":"light"),a(o)}})]})]}),t]})}function Da(){const t=pe(),[s,a]=B.useState(""),[r,i]=B.useState(""),[n,o]=B.useState(!1),[c,l]=B.useState(""),[m,d]=B.useState(!1),[u,y]=B.useState(""),[h,w]=B.useState("system"),[p,E]=B.useState(()=>{try{return document.documentElement.classList.contains("dark")}catch{return Re("system")}}),g=B.useRef(!1);B.useEffect(()=>{let k=!0;return Gs().then(z=>{k&&(w(z),E(Re(z)))}),()=>{k=!1}},[]),B.useEffect(()=>{document.documentElement.classList.toggle("dark",p),p?document.body.classList.add("dark-bg"):document.body.classList.remove("dark-bg");let k=document.querySelector('meta[name="theme-color"]');k||(k=document.createElement("meta"),k.name="theme-color",document.head.appendChild(k)),k.setAttribute("content",p?"#000000":"#ffffff")},[p]),B.useEffect(()=>{g.current&&Hs(h)},[h]),B.useEffect(()=>{if(h!=="system")return;E(Re("system"));const k=Ws(z=>{E(!!z)});return()=>k&&k()},[h]);const S=/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(s),C=r.length>=10,x=async()=>{if(l(""),!S){l("Enter a valid email.");return}if(!C){l("Password must be at least 10 characters.");return}o(!0);try{await t.loginWithEmail(s,r)}catch(k){const z=k?.code||"";l(z==="auth/invalid-credential"||z==="auth/wrong-password"||z==="auth/user-not-found"?"Wrong email or password.":z==="auth/too-many-requests"?"Too many attempts. Try again later.":z==="auth/invalid-email"?"Enter a valid email.":k?.message||"Login failed.")}finally{o(!1)}},j=async()=>{if(l(""),!S){l("Enter a valid email.");return}if(!C){l("Password isn’t safe. Use at least 10 characters.");return}o(!0);try{await t.signupWithEmail(s,r)}catch(k){const z=k?.code||"";l(z==="auth/email-already-in-use"?"That email already exists. Try signing in.":z==="auth/weak-password"?"Password isn’t safe. Use at least 10 characters.":z==="auth/invalid-email"?"Enter a valid email.":k?.message||"Sign up failed.")}finally{o(!1)}},v=async()=>{l(""),o(!0);try{await t.loginWithGoogle()}catch(k){const z=k?.code||"";l(z==="auth/popup-closed-by-user"?"Sign-in was canceled.":z==="auth/cancelled-popup-request"?"Another sign-in is already in progress.":k?.message||"Google sign-in failed.")}finally{o(!1)}};return t.user?e.jsx(Ut,{dark:p,setDark:E,themePref:h,setThemePref:w,userChangedPrefRef:g,children:e.jsxs("div",{className:"mx-auto w-full max-w-md p-6 glass space-y-4",children:[e.jsxs("div",{className:"mb-3",children:["You’re signed in as ",e.jsx("strong",{children:t.user.email||t.user.displayName}),"."]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("a",{href:"/",className:"btn btn-primary",children:"Go to app"}),e.jsx("button",{className:"btn btn-ghost",onClick:t.logout,children:"Logout"})]})]})}):m?e.jsx(Ut,{dark:p,setDark:E,themePref:h,setThemePref:w,userChangedPrefRef:g,children:e.jsxs("div",{className:"mx-auto w-full max-w-md p-6 glass space-y-4 flex flex-col items-center",children:[e.jsx("h1",{className:"text-xl font-semibold gradient-text",children:"Reset password"}),u&&e.jsx("div",{className:"rounded-lg border border-green-300/60 bg-green-50 text-green-800 dark:bg-green-900/20 dark:text-green-200 dark:border-green-400/40 px-3 py-2 text-sm",children:u}),c&&e.jsx("div",{className:"rounded-lg border border-red-300/60 bg-red-50 text-red-800 dark:bg-red-900/20 dark:text-red-200 dark:border-red-400/40 px-3 py-2 text-sm",children:c}),e.jsx("input",{className:"w-full rounded-lg border border-black/10 bg-white dark:bg-darkcard text-black dark:text-white px-2 py-2",placeholder:"Enter your email",type:"email",autoComplete:"email",value:s,onChange:k=>a(k.target.value)}),e.jsxs("div",{className:"flex flex-col items-center gap-2 w-full mt-2",children:[e.jsxs("button",{className:"btn btn-primary flex items-center justify-center gap-2 w-full",disabled:n||!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(s),onClick:async()=>{l(""),y(""),o(!0);try{await $n(oe(),s),y("Password reset email sent, if you have an account with us! Check your inbox.")}catch(k){k?.code==="auth/user-not-found"?l("No account found for that email."):k?.code==="auth/invalid-email"?l("Enter a valid email."):l(k?.message||"Failed to send reset email.")}finally{o(!1)}},children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M22 2L11 13"}),e.jsx("path",{d:"M22 2l-7 20-4-9-9-4 20-7z"})]}),"Send reset email"]}),e.jsxs("button",{className:"btn btn-ghost flex items-center justify-center gap-2 w-full",onClick:()=>{d(!1),l(""),y("")},children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back"]})]})]})}):e.jsx(Ut,{dark:p,setDark:E,themePref:h,setThemePref:w,userChangedPrefRef:g,children:e.jsxs("div",{className:"mx-auto w-full max-w-md p-6 glass mt-0 space-y-4 flex flex-col items-center",children:[e.jsx(Nr,{}),e.jsx("h1",{className:"text-xl font-semibold gradient-text",children:"Sign in"}),c&&e.jsx("div",{className:"rounded-lg border border-red-300/60 bg-red-50 text-red-800 dark:bg-red-900/20 dark:text-red-200 dark:border-red-400/40 px-3 py-2 text-sm",role:"alert","aria-live":"polite",children:c}),e.jsxs("button",{className:"btn btn-google w-full bg-white text-[#1f1f1f] border border-black/10 hover:bg-white/90 dark:bg-white dark:text-[#1f1f1f] dark:hover:bg-white/90 flex items-center justify-center text-base",style:{maxWidth:320,minHeight:48,paddingTop:8,paddingBottom:8},disabled:n,onClick:v,children:[e.jsx("span",{className:"google-icon",style:{width:28,height:28,marginRight:14,display:"flex",alignItems:"center",justifyContent:"center"},"aria-hidden":!0}),e.jsx("span",{style:{lineHeight:"28px"},children:"Sign in with Google"})]}),e.jsx("div",{className:"text-center opacity-60 text-sm",children:"or"}),e.jsx("input",{className:"w-full rounded-lg border border-black/10 bg-white dark:bg-darkcard text-black dark:text-white px-2 py-2",placeholder:"email",type:"email",autoComplete:"email",value:s,onChange:k=>a(k.target.value)}),e.jsx("input",{className:"w-full rounded-lg border border-black/10 bg-white dark:bg-darkcard text-black dark:text-white px-2 py-2",placeholder:"password",type:"password",autoComplete:"current-password",value:r,onChange:k=>i(k.target.value)}),e.jsxs("div",{className:"flex flex-col w-full mt-2 gap-2 items-center",children:[e.jsxs("div",{className:"flex gap-2 w-full justify-center",children:[e.jsxs("button",{className:"btn btn-fancy flex items-center justify-center gap-2 text-sm font-medium",disabled:n,onClick:x,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 12h14M12 5l7 7-7 7"})}),"Login"]}),e.jsxs("button",{className:"btn btn-orange flex items-center justify-center gap-2 text-sm font-medium hover-lift",disabled:n,onClick:j,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Sign up"]})]}),e.jsx("button",{className:"text-xs text-red-500 hover:underline focus:underline font-normal w-full mt-2 flex items-center justify-center gap-1 bg-transparent border-none p-0",type:"button",style:{cursor:"pointer"},onClick:()=>{d(!0),l(""),y("")},children:"Forgot password?"})]})]})})}const Ua=Yn([{path:"/",element:e.jsx(tr,{to:"/round-generator",replace:!0})},{path:"/round-generator",element:e.jsx(Tt,{})},{path:"/practice",element:e.jsx(Tt,{})},{path:"/admin",element:e.jsx(Tt,{})},{path:"/signin",element:e.jsx(Da,{})},{path:"/buzzer",element:e.jsx(_r,{})},{path:"/buzzer/:code",element:e.jsx(Ir,{})},{path:"/buzzer/:code/generate",element:e.jsx(Gr,{})},{path:"/buzzer/:code/round",element:e.jsx(Jr,{})},{path:"/multiplayer",element:e.jsx(ya,{})},{path:"/multiplayer/:roomId",element:e.jsx(Ba,{})}]);Pn.createRoot(document.getElementById("root")).render(e.jsx(B.StrictMode,{children:e.jsx(Vn,{children:e.jsx(Cr,{children:e.jsx(Xn,{router:Ua})})})}));export{Sa as C,ve as L,Aa as R,va as T,Ts as a,Ie as b,ka as c,Bi as d,Fi as e,Hi as f,G as g,Pi as h,Li as i,_i as j,Ui as k,Ti as l,$s as m,Wi as n,Ar as o,Gt as p,$i as q,Di as r,Ii as s,Gi as t,Ca as u,Oi as v,Ji as w,Mi as x};
