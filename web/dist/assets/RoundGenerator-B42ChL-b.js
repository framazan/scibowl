import{j as e,r as x,b as X}from"./vendor-react-DpsG3A-O.js";import{e as cs,r as ds,s as Tt,h as It,i as ss,j as ns,k as ct,l as ln,m as us,p as Fe,L as pe,u as cn,n as dn,a as un,o as mn,q as pn,T as fn,C as hn,R as xn,t as bn,c as gn,b as yn,v as wn,f as rs,w as jn,x as vn,y as kn}from"./index-DL2fJqf5.js";import{g as ms,i as ze}from"./visualBonuses-m3ufG0uO.js";import{L as Nn,R as Sn,F as Cn,a as os,j as An,k as Bt,l as Lt,h as as,m as Rn,X as Bn,g as Ln,U as Tn,d as is,e as In,f as Mn,T as En,n as ls,o as Pn,p as $n,q as Dn}from"./vendor-lucide-react-DoOgXp02.js";import{S as zn,p as Fn}from"./vendor-react-pdf-renderer-DfOTdHag.js";import{D as _n,P as Un,T as ee,V as Q}from"./vendor-react-pdf-primitives-B6ApagcG.js";import"./vendor-abs-svg-path-DCUpb6Nw.js";import"./vendor-react-dom-D1u-fJLi.js";import"./vendor-scheduler-CoSDG3-6.js";import"./vendor-firebase-BZrYkTdu.js";import"./vendor-firebase-app-DqcDUDC6.js";import"./vendor-firebase-component-B9jxOSis.js";import"./vendor-firebase-util-CIVODmCg.js";import"./vendor-firebase-logger-CNz1B4Yj.js";import"./vendor-idb-BXWtuYvb.js";import"./vendor-firebase-app-check-Co35-rT3.js";import"./vendor-firebase-firestore-BRp-7IKb.js";import"./vendor-firebase-webchannel-wrapper-QS5lB7L3.js";import"./vendor-firebase-storage-D1N4MLec.js";import"./vendor-firebase-database-DcYXcGm3.js";import"./vendor-react-helmet-async-bvMvt1Ax.js";import"./vendor-react-fast-compare-BCtOC5yC.js";import"./vendor-invariant-DW3JcdOx.js";import"./vendor-shallowequal-Df9Q-7bk.js";import"./vendor-react-router-dom-D6uELkfw.js";import"./vendor-react-router-B_FrsTVh.js";import"./vendor-remix-run-router-9r-WWGj9.js";import"./vendor-mui-material-DksXbHt-.js";import"./vendor-mui-utils-B23qfrSe.js";import"./vendor-clsx-B-dksMZM.js";import"./vendor-mui-system-BndTH9qf.js";import"./vendor-mui-styled-engine-CPmDJbkS.js";import"./vendor-emotion-styled-5vLscvJp.js";import"./vendor-babel-runtime-WXw8LxeR.js";import"./vendor-emotion-serialize-B6qc6euy.js";import"./vendor-emotion-hash-WldOFDRm.js";import"./vendor-emotion-unitless-x5IvBceT.js";import"./vendor-emotion-memoize-3S_6p140.js";import"./vendor-emotion-use-insertion-effect-with-fallbacks-B--OEmuQ.js";import"./vendor-emotion-utils-BijCJQMc.js";import"./vendor-emotion-is-prop-valid-DOnQZHJ6.js";import"./vendor-emotion-react-DrbGOuDy.js";import"./vendor-hoist-non-react-statics-mDtaWys7.js";import"./vendor-react-is-CnyDuYXe.js";import"./vendor-emotion-cache-DvsOMRO7.js";import"./vendor-emotion-sheet-6IwnyhEX.js";import"./vendor-stylis-DDa9OTMq.js";import"./vendor-react-transition-group-Q1VPUTjR.js";import"./vendor-three-CGYwrSEf.js";import"./vendor-katex-DP_4UPSs.js";import"./vendor-queue-IZnSDwnG.js";import"./vendor-inherits-BICa84dG.js";import"./vendor-events-DQ172AOg.js";import"./vendor-react-pdf-font-ByacAZ2x.js";import"./vendor-cross-fetch-DvOI2u39.js";import"./vendor-fontkit-5mDwoQ7O.js";import"./vendor-restructure-DwIbRzqP.js";import"./vendor-swc-helpers-DIxjOVuh.js";import"./vendor-fast-deep-equal-DtIvihjZ.js";import"./vendor-unicode-properties-BbL32wKl.js";import"./vendor-base64-js-BJmSPyJr.js";import"./vendor-unicode-trie-rSh8NucD.js";import"./vendor-tiny-inflate-BmeP50H3.js";import"./vendor-dfa-DFRa2UL2.js";import"./vendor-clone-DniFCc4t.js";import"./vendor-brotli-CUuIRSoC.js";import"./vendor-tslib-kHcLnhpD.js";import"./vendor-react-pdf-render-DYs5yDRr.js";import"./vendor-react-pdf-fns-DIcDsgsD.js";import"./vendor-parse-svg-path-Bi0KIs1g.js";import"./vendor-normalize-svg-path-CFWHe3yZ.js";import"./vendor-svg-arc-to-cubic-bezier-DEq50KMd.js";import"./vendor-color-string-BKSasjlw.js";import"./vendor-color-name-Dju3oUBS.js";import"./vendor-simple-swizzle-3gX0Onlb.js";import"./vendor-is-arrayish-DyGeW-O8.js";import"./vendor-react-pdf-pdfkit-CgWEQEi-.js";import"./vendor-pako-CNe1bWpJ.js";import"./vendor-crypto-js-C9XMI5TL.js";import"./vendor-jay-peg-DnV82Tak.js";import"./vendor-react-pdf-png-js-D_OjzuBh.js";import"./vendor-react-pdf-layout-CVT9JNgr.js";import"./vendor-react-pdf-stylesheet-B2kC1IpU.js";import"./vendor-postcss-value-parser-DOXmp8r9.js";import"./vendor-hsl-to-hex-CDkcI7Vq.js";import"./vendor-hsl-to-rgb-for-reals-jL61FXS_.js";import"./vendor-media-engine-BWjc9dwl.js";import"./vendor-react-pdf-textkit-R3VqYnwu.js";import"./vendor-bidi-js-DLACMwmw.js";import"./vendor-hyphen-B2aENclZ.js";import"./vendor-yoga-layout-nAHjiEuJ.js";import"./vendor-react-pdf-image-BJ1YGwqv.js";import"./vendor-object-assign-Dm9xdUEz.js";function qn({auth:r,roundsIndex:p,setRoundsIndex:f,roundFolders:y,setRoundFolders:L,loadingUserRounds:j,refresh:E,selectedExcludeRoundIds:A,setSelectedExcludeRoundIds:T,foldersOpen:v,setFoldersOpen:P,handleExcludeRoundToggle:z,pushToast:u,setManagerSelection:C,setShowRoundsManager:R,setFolderDeleteTarget:F,setDeleteTarget:O,onViewRound:B}){return r?.user?e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold mb-2 flex items-center gap-2",children:["Exclude rounds",e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Clear selection",onClick:()=>T([]),children:e.jsx(Nn,{size:16})}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs inline-flex items-center","aria-label":"Refresh rounds & folders",title:"Refresh",onClick:E,children:e.jsx(Sn,{size:14})}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs inline-flex items-center","aria-label":"Create folder",title:"Create folder",onClick:async()=>{if(!r?.user)return;const _=window.prompt("Folder name");if(_==null)return;const K=_.trim();if(!K){u("Folder name cannot be empty.","error");return}const te=K.toLowerCase();if(y.some(c=>c.toLowerCase()===te)){u("Folder already exists.","error");return}try{await cs(r.user.uid,K),L(c=>[...c,K].sort((a,w)=>a.localeCompare(w))),P(c=>{const a=new Set(c);return a.add(K),a}),u("Folder created.","success")}catch(c){u(c.message||"Failed to create folder.","error")}},children:e.jsx(Cn,{size:14})}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs inline-flex items-center","aria-label":"Open rounds manager",title:"Manage saved rounds",onClick:()=>{C(new Set(A)),R(!0)},children:e.jsx(os,{size:14})})]}),j?e.jsx("div",{className:"text-sm opacity-70",children:"Loading your rounds…"}):p.length===0?e.jsx("div",{className:"text-sm opacity-70",children:"No saved rounds yet."}):e.jsx("div",{className:"border rounded-lg max-h-64 overflow-y-auto overflow-x-hidden divide-y divide-black/10 dark:divide-white/10",children:(()=>{const _=[],K=y.sort((a,w)=>a.localeCompare(w)).map(a=>{const w=v.has(a),N=p.filter(m=>m.folder===a);return e.jsxs("div",{className:"select-none",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 hover:bg-black/5 dark:hover:bg-white/10 cursor-pointer",onClick:()=>P(m=>{const g=new Set(m);return g.has(a)?g.delete(a):g.add(a),g}),onDragOver:m=>{m.preventDefault(),m.dataTransfer.dropEffect="move"},onDrop:async m=>{if(m.preventDefault(),!r?.user)return;const g=m.dataTransfer.getData("text/round-ids");if(!g)return;const M=g.split(",").filter(Boolean);for(const U of M)try{await Tt(r.user.uid,U,a)}catch{}f(U=>U.map(h=>M.includes(h.id)?{...h,folder:a}:h)),u(`Moved ${M.length} round(s) to ${a}.`,"success")},children:[e.jsx("button",{type:"button",className:"p-0.5 rounded hover:bg-black/10 dark:hover:bg-white/10","aria-label":w?"Collapse folder":"Expand folder",children:w?e.jsx(os,{size:15}):e.jsx(An,{size:15})}),e.jsx("input",{type:"checkbox",className:"accent-tint",ref:m=>{if(!m)return;const g=p.filter(h=>h.folder===a),M=g.length,U=g.filter(h=>A.includes(h.id)).length;m.indeterminate=U>0&&U<M},checked:(()=>{const m=p.filter(g=>g.folder===a);return m.length>0&&m.every(g=>A.includes(g.id))})(),onChange:()=>{const g=p.filter(M=>M.folder===a).map(M=>M.id);T(M=>{const U=new Set(M);return g.every(J=>U.has(J))?g.forEach(J=>U.delete(J)):g.forEach(J=>U.add(J)),Array.from(U)})},"aria-label":`Select all rounds in folder ${a}`,title:"Select all in folder"}),e.jsxs("span",{className:"font-medium flex-1 truncate",title:a,children:[a," ",e.jsxs("span",{className:"opacity-60 text-xs",children:["(",N.length,")"]})]}),e.jsx("button",{type:"button",className:"chip px-2 py-0.5 text-[11px] inline-flex items-center","aria-label":"Rename folder",title:"Rename folder",onClick:m=>{m.stopPropagation();const g=window.prompt("Rename folder",a);if(g==null)return;const M=g.trim();if(!(!M||M===a)){if(y.some(U=>U.toLowerCase()===M.toLowerCase())){u("Folder name already exists.","error");return}(async()=>{try{await ds(r.user.uid,a,M),L(U=>U.map(h=>h===a?M:h)),f(U=>U.map(h=>h.folder===a?{...h,folder:M}:h)),P(U=>{const h=new Set(U);return h.has(a)&&(h.delete(a),h.add(M)),h}),u("Folder renamed.","success")}catch(U){u(U.message||"Failed to rename folder.","error")}})()}},children:e.jsx(Bt,{size:13})}),e.jsx("button",{type:"button",className:"chip px-2 py-0.5 text-[11px] inline-flex items-center text-red-600 border-red-200 hover:bg-red-50 dark:text-red-300 dark:border-red-700 dark:hover:bg-red-900/30","aria-label":"Delete folder and its rounds",title:"Delete folder",onClick:m=>{m.stopPropagation();const g=p.filter(M=>M.folder===a);F({name:a,count:g.length,roundIds:g.map(M=>M.id)})},children:e.jsx(Lt,{className:"h-3.5 w-3.5"})})]}),w&&e.jsx("ul",{className:"divide-y divide-black/5 dark:divide-white/10",role:"group",children:N.map(m=>{_.push(m.id);const g=m.createdAt?.seconds?new Date(m.createdAt.seconds*1e3):null,M=g?`${g.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})} on ${g.toLocaleDateString()}`:m.title||"Untitled",U=A.includes(m.id);return e.jsx("li",{draggable:!0,onDragStart:h=>{h.dataTransfer.effectAllowed="move";const J=A.includes(m.id)?A:[m.id];h.dataTransfer.setData("text/round-ids",J.join(","))},children:e.jsxs("div",{className:`group flex items-center justify-between gap-2 pl-10 pr-3 py-2 ${U?"bg-tint/10 ring-1 ring-tint":""}`,children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer flex-1 min-w-0",title:m.title||`Round ${M}`,children:[e.jsx("input",{type:"checkbox",checked:U,onChange:h=>z(h,m.id)}),e.jsx("span",{className:"block whitespace-normal overflow-visible group-hover:truncate group-focus-within:truncate",children:m.title||`Round ${M}`})]}),e.jsx("button",{type:"button",className:"chip px-2 py-0.5 text-xs shrink-0 opacity-0 group-hover:opacity-100 focus:opacity-100 inline-flex items-center","aria-label":"View round",title:"View round",onClick:h=>{h.stopPropagation(),B?.(m)},children:e.jsx(as,{size:13})}),e.jsx("button",{type:"button",className:"chip px-2 py-0.5 text-xs shrink-0 opacity-0 group-hover:opacity-100 focus:opacity-100 inline-flex items-center","aria-label":"Rename round",title:"Rename round",onClick:async h=>{h.stopPropagation();const J=m.title||`Round ${M}`,se=window.prompt("Rename round",J);if(se==null)return;const oe=se.trim();if(!oe||oe===J)return;if(p.some(fe=>fe.id!==m.id&&(fe.title||"").trim().toLowerCase()===oe.toLowerCase())){u("Another round already has that title.","error");return}try{await It(r.user.uid,m.id,oe),f(fe=>fe.map(ye=>ye.id===m.id?{...ye,title:oe}:ye))}catch(fe){window.alert?.(fe?.message||"Failed to rename round.")}},children:e.jsx(Bt,{size:13})}),e.jsx("button",{type:"button",className:"chip px-2 py-0.5 text-xs shrink-0 text-red-600 border-red-200 hover:bg-red-50 dark:text-red-300 dark:border-red-700 dark:hover:bg-red-900/30",title:"Delete round",onClick:h=>{h.stopPropagation(),O(m)},children:e.jsx(Lt,{className:"h-3.5 w-3.5"})})]})},m.id)})})]},a)}),te=p.filter(a=>!a.folder),c=e.jsxs("div",{className:"select-none",onDragOver:a=>{a.preventDefault(),a.dataTransfer.dropEffect="move"},onDrop:async a=>{if(a.preventDefault(),!r?.user)return;const w=a.dataTransfer.getData("text/round-ids");if(!w)return;const N=w.split(",").filter(Boolean);for(const m of N)try{await Tt(r.user.uid,m,"")}catch{}f(m=>m.map(g=>N.includes(g.id)?(()=>{const{folder:M,...U}=g;return U})():g)),u(`Cleared folder for ${N.length} round(s).`,"success")},children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-black/5 dark:bg-white/10 font-medium",children:["Unfiled ",e.jsxs("span",{className:"opacity-60 text-xs",children:["(",te.length,")"]})]}),e.jsx("ul",{className:"divide-y divide-black/5 dark:divide-white/10",role:"group",children:te.map(a=>{_.push(a.id);const w=a.createdAt?.seconds?new Date(a.createdAt.seconds*1e3):null,N=w?`${w.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})} on ${w.toLocaleDateString()}`:a.title||"Untitled",m=A.includes(a.id);return e.jsx("li",{draggable:!0,onDragStart:g=>{g.dataTransfer.effectAllowed="move";const M=A.includes(a.id)?A:[a.id];g.dataTransfer.setData("text/round-ids",M.join(","))},children:e.jsxs("div",{className:`group flex items-center justify-between gap-2 pl-6 pr-3 py-2 ${m?"bg-tint/10 ring-1 ring-tint":""}`,children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer flex-1 min-w-0",title:a.title||`Round ${N}`,children:[e.jsx("input",{type:"checkbox",checked:m,onChange:g=>z(g,a.id)}),e.jsx("span",{className:"block whitespace-normal overflow-visible group-hover:truncate group-focus-within:truncate",children:a.title||`Round ${N}`})]}),e.jsx("button",{type:"button",className:"chip px-2 py-0.5 text-xs shrink-0 opacity-0 group-hover:opacity-100 focus:opacity-100 inline-flex items-center","aria-label":"View round",title:"View round",onClick:g=>{g.stopPropagation(),B?.(a)},children:e.jsx(as,{size:13})}),e.jsx("button",{type:"button",className:"chip px-2 py-0.5 text-xs shrink-0 opacity-0 group-hover:opacity-100 focus:opacity-100 inline-flex items-center","aria-label":"Rename round",title:"Rename round",onClick:async g=>{g.stopPropagation();const M=a.title||`Round ${N}`,U=window.prompt("Rename round",M);if(U==null)return;const h=U.trim();if(!h||h===M)return;if(p.some(se=>se.id!==a.id&&(se.title||"").trim().toLowerCase()===h.toLowerCase())){u("Another round already has that title.","error");return}try{await It(r.user.uid,a.id,h),f(se=>se.map(oe=>oe.id===a.id?{...oe,title:h}:oe))}catch(se){window.alert?.(se?.message||"Failed to rename round.")}},children:e.jsx(Bt,{size:13})}),e.jsx("button",{type:"button",className:"chip px-2 py-0.5 text-xs shrink-0 text-red-600 border-red-200 hover:bg-red-50 dark:text-red-300 dark:border-red-700 dark:hover:bg-red-900/30",title:"Delete round",onClick:g=>{g.stopPropagation(),O(a)},children:e.jsx(Lt,{className:"h-3.5 w-3.5"})})]})},a.id)})})]},"__unfiled__");return e.jsxs(e.Fragment,{children:[K,c]})})()})]}):null}function On({auth:r,pushToast:p}){const[f,y]=x.useState([]),[L,j]=x.useState(!1),[E,A]=x.useState([]),[T,v]=x.useState(()=>new Set),[P,z]=x.useState([]),u=x.useRef(new Map);x.useEffect(()=>{let c=!1;async function a(){if(!r?.user){y([]),u.current.clear(),A([]);return}j(!0);try{const w=await ss(r.user.uid).catch(()=>[]);c||y(w);const N=await ns(r.user.uid).catch(()=>[]);c||A(N)}finally{c||j(!1)}}return a(),()=>{c=!0}},[r?.user?.uid]);async function C(c,a){c?.nativeEvent?.shiftKey||c?.shiftKey;const w=P.includes(a),N=!w;if(z(m=>{const g=new Set(m);return w?g.delete(a):g.add(a),Array.from(g)}),N&&r?.user&&!u.current.has(a))try{const m=await us(r.user.uid,a);m&&u.current.set(a,m)}catch{}}async function R(){if(r?.user){j(!0);try{y(await ss(r.user.uid,{force:!0})),A(await ns(r.user.uid,{force:!0}))}finally{j(!1)}}}async function F(c){if(!r?.user)return;if(!c?.trim()){p?.("Folder name cannot be empty.","error");return}const a=c.toLowerCase();if(E.some(w=>w.toLowerCase()===a)){p?.("Folder already exists.","error");return}await cs(r.user.uid,c),A(w=>[...w,c].sort((N,m)=>N.localeCompare(m))),v(w=>{const N=new Set(w);return N.add(c),N}),p?.("Folder created.","success")}async function O(c,a){if(!r?.user)return;const w=a.trim();if(!(!w||w===c)){if(E.some(N=>N.toLowerCase()===w.toLowerCase())){p?.("Folder name already exists.","error");return}await ds(r.user.uid,c,w),A(N=>N.map(m=>m===c?w:m)),y(N=>N.map(m=>m.folder===c?{...m,folder:w}:m)),v(N=>{const m=new Set(N);return m.has(c)&&(m.delete(c),m.add(w)),m}),p?.("Folder renamed.","success")}}async function B(c,a){if(r?.user){for(const w of c)try{await Tt(r.user.uid,w,a)}catch{}y(w=>w.map(N=>c.includes(N.id)?{...N,folder:a}:N)),p?.(a?`Moved ${c.length} round(s) to ${a}.`:`Cleared folder for ${c.length} round(s).`,"success")}}async function _(c,a){if(!r?.user)return;if(f.some(m=>m.id!==c.id&&(m.title||"").trim().toLowerCase()===a.toLowerCase())){p?.("Another round already has that title.","error");return}await It(r.user.uid,c.id,a),y(m=>m.map(g=>g.id===c.id?{...g,title:a}:g));const N=u.current.get(c.id);N&&u.current.set(c.id,{...N,title:a})}async function K(c){r?.user&&(await ct(r.user.uid,c),y(a=>a.filter(w=>w.id!==c)),z(a=>a.filter(w=>w!==c)),u.current.delete(c),p?.("Round deleted.","error"))}async function te(c,a=[]){if(r?.user){for(const w of a)try{await ct(r.user.uid,w)}catch{}try{await ln(r.user.uid,c)}catch{}y(w=>w.filter(N=>!a.includes(N.id))),z(w=>w.filter(N=>!a.includes(N))),A(w=>w.filter(N=>N!==c)),p?.("Folder and rounds deleted.","error")}}return{roundsIndex:f,setRoundsIndex:y,loadingUserRounds:L,roundFolders:E,setRoundFolders:A,foldersOpen:T,setFoldersOpen:v,selectedExcludeRoundIds:P,setSelectedExcludeRoundIds:z,excludeDetailCache:u,handleExcludeRoundToggle:C,refresh:R,createFolder:F,renameFolder:O,moveRoundsToFolder:B,renameRound:_,deleteRoundPermanently:K,deleteFolderAndRounds:te}}const D=zn.create({page:{padding:16,fontSize:8,fontFamily:"Times-Roman"},title:{textAlign:"center",fontSize:11,fontWeight:"bold",marginBottom:4},legendBlock:{marginBottom:4},tiny:{fontSize:6.5},footer:{marginTop:4,textAlign:"center",fontSize:6.5},tablesWrap:{flexDirection:"row"},teamACol:{flex:1.1,marginRight:4},teamBCol:{flex:.9,marginLeft:4},headerRow:{flexDirection:"row",backgroundColor:"#eee"},bodyRow:{flexDirection:"row"},cell:{borderWidth:.5,borderColor:"#000",paddingVertical:1.5,paddingHorizontal:2,justifyContent:"center",textAlign:"center",minHeight:12},headCellText:{fontWeight:"bold",fontSize:6.5},qnCell:{fontSize:6.5,fontWeight:"bold"},subjCell:{fontSize:6.5},attempt:{fontSize:6.5,fontWeight:"bold"},nameHead:{fontSize:6,fontWeight:"bold"},spacer:{width:4}});function Gn(r){return[4,7,6,...Array(r).fill(9),7,6,7]}function Wn(r){return[...Array(r).fill(9),7,6,7]}function Hn({playerLabels:r=[],cols:p}){const f=["Q","Subj","Type",...r,"Bonus","Pen","Score"];return e.jsx(Q,{style:D.headerRow,children:f.map((y,L)=>{const j=p[L];return e.jsx(Q,{style:[D.cell,{flexGrow:j,flexBasis:j}],children:e.jsx(ee,{style:D.headCellText,children:y})},L)})})}function Vn({playerLabels:r=[],cols:p}){const f=[...r,"Bonus","Pen","Score"];return e.jsx(Q,{style:D.headerRow,children:f.map((y,L)=>{const j=p[L];return e.jsx(Q,{style:[D.cell,{flexGrow:j,flexBasis:j}],children:e.jsx(ee,{style:D.headCellText,children:y})},L)})})}function Qn({r,seatPlayers:p,outRows:f,cols:y}){if(!r||r.pad)return e.jsx(Q,{style:D.bodyRow,children:y.map((C,R)=>e.jsx(Q,{style:[D.cell,{flexGrow:C,flexBasis:C}],children:R===0&&r?.index?e.jsx(ee,{style:D.qnCell,children:r.index}):null},R))});const L=(r.attempts||[]).filter(C=>C&&C.playerId!=null);function j(C){if(!C)return"";const R=L.filter(O=>O.playerId===C.id);if(!R.length)return"";const F=R[R.length-1];return F.result==="correct"?F.interrupt?"CI":"C":F.result==="incorrect"?F.interrupt?"II":"I":""}const E=r.bonusA,A=r.penaltyA,T=r.cumA;function v(C,R){let F=j(C);return!F&&C&&f[C.id]===r.index&&(F="out"),e.jsx(Q,{style:[D.cell,{flexGrow:R,flexBasis:R}],children:e.jsx(ee,{style:D.attempt,children:F})},C?C.id:Math.random())}const P=y.slice(0,3),z=y.slice(3,3+p.length),u=y.slice(3+p.length);return e.jsxs(Q,{style:D.bodyRow,children:[e.jsx(Q,{style:[D.cell,{flexGrow:P[0],flexBasis:P[0]}],children:e.jsx(ee,{style:D.qnCell,children:r.index})}),e.jsx(Q,{style:[D.cell,{flexGrow:P[1],flexBasis:P[1]}],children:e.jsx(ee,{style:D.subjCell,children:r.subject})}),e.jsx(Q,{style:[D.cell,{flexGrow:P[2],flexBasis:P[2]}],children:e.jsx(ee,{style:D.subjCell,children:r.type})}),p.map((C,R)=>v(C,z[R])),e.jsx(Q,{style:[D.cell,{flexGrow:u[0],flexBasis:u[0]}],children:e.jsx(ee,{children:E?String(E):""})}),e.jsx(Q,{style:[D.cell,{flexGrow:u[1],flexBasis:u[1]}],children:e.jsx(ee,{children:A?String(A):""})}),e.jsx(Q,{style:[D.cell,{flexGrow:u[2],flexBasis:u[2]}],children:e.jsx(ee,{children:T!=null?String(T):""})})]})}function Xn({r,seatPlayers:p,outRows:f,cols:y}){if(!r||r.pad)return e.jsx(Q,{style:D.bodyRow,children:y.map((u,C)=>e.jsx(Q,{style:[D.cell,{flexGrow:u,flexBasis:u}]},C))});const L=(r.attempts||[]).filter(u=>u&&u.playerId!=null);function j(u){if(!u)return"";const C=L.filter(F=>F.playerId===u.id);if(!C.length)return"";const R=C[C.length-1];return R.result==="correct"?R.interrupt?"CI":"C":R.result==="incorrect"?R.interrupt?"II":"I":""}const E=r.bonusB,A=r.penaltyB,T=r.cumB;function v(u,C){let R=j(u);return!R&&u&&f[u.id]===r.index&&(R="out"),e.jsx(Q,{style:[D.cell,{flexGrow:C,flexBasis:C}],children:e.jsx(ee,{style:D.attempt,children:R})},u?u.id:Math.random())}const P=y.slice(0,p.length),z=y.slice(p.length);return e.jsxs(Q,{style:D.bodyRow,children:[p.map((u,C)=>v(u,P[C])),e.jsx(Q,{style:[D.cell,{flexGrow:z[0],flexBasis:z[0]}],children:e.jsx(ee,{children:E?String(E):""})}),e.jsx(Q,{style:[D.cell,{flexGrow:z[1],flexBasis:z[1]}],children:e.jsx(ee,{children:A?String(A):""})}),e.jsx(Q,{style:[D.cell,{flexGrow:z[2],flexBasis:z[2]}],children:e.jsx(ee,{children:T!=null?String(T):""})})]})}function Yn({sheetRows:r=[],players:p=[],metadata:f={}}){const y=p.filter(c=>c.team==="A").sort((c,a)=>(c.seat||0)-(a.seat||0)),L=p.filter(c=>c.team==="B").sort((c,a)=>(c.seat||0)-(a.seat||0)),j=y.filter(c=>(c.seat||0)>=1&&(c.seat||0)<=4).sort((c,a)=>c.seat-a.seat),E=L.filter(c=>(c.seat||0)>=1&&(c.seat||0)<=4).sort((c,a)=>c.seat-a.seat),A=y.find(c=>(c.seat||0)===5&&c.status==="active"),T=L.find(c=>(c.seat||0)===5&&c.status==="active"),v=A?[...j,A]:[...j],P=T?[...E,T]:[...E],z=(c,a)=>c&&c.name?Kn(c.name,9):a,u=v.map((c,a)=>z(c,["Captain","P1","P2","P3","Sub"][a]||"P"+(a+1))),C=P.map((c,a)=>z(c,["Captain","P1","P2","P3","Sub"][a]||"P"+(a+1))),R=Gn(v.length),F=Wn(P.length);function O(c,a){if(!c.length)return{};const w={};for(const m of r){if(!m||m.pad)continue;const g=m.index;for(const M of m.attempts||[])!M||M.team!==a||c.includes(M.playerId)&&(w[M.playerId]=g)}const N={};for(const m of c){const g=w[m];g&&g<25&&(N[m]=g+1)}return N}const B=y.filter(c=>c.status==="replaced").map(c=>c.id),_=L.filter(c=>c.status==="replaced").map(c=>c.id),K=O(B,"A"),te=O(_,"B");return e.jsx(_n,{children:e.jsxs(Un,{size:"LETTER",style:D.page,orientation:"landscape",children:[e.jsx(ee,{style:D.title,children:"Coaches Scoresheet"}),e.jsxs(Q,{style:D.legendBlock,children:[e.jsx(ee,{style:D.tiny,children:"Subjects: E ESS | C Chemistry | B Bio | M Math | P Physics | EN Energy"}),e.jsx(ee,{style:D.tiny,children:"Types: MC Multiple Choice | SA Short Answer | Markers: C / CI / I / II | 'out' = player substituted"})]}),e.jsxs(Q,{style:D.tablesWrap,children:[e.jsxs(Q,{style:D.teamACol,children:[e.jsx(Hn,{playerLabels:u,cols:R}),r.slice(0,25).map(c=>e.jsx(Qn,{r:c,seatPlayers:v,outRows:K,cols:R},"A-"+c.index))]}),e.jsxs(Q,{style:D.teamBCol,children:[e.jsx(Vn,{playerLabels:C,cols:F}),r.slice(0,25).map(c=>e.jsx(Xn,{r:c,seatPlayers:P,outRows:te,cols:F},"B-"+c.index))]})]}),e.jsxs(ee,{style:D.footer,children:["Generated ",f.generatedAt||""," | atombowl"]})]})})}function Kn(r,p){return r?r.length<=p?r:r.slice(0,p-1)+"…":""}function Jn({pair:r,index:p,scorekeeping:f=!1,currentIndex:y=0,tossupResults:L=[],showBonusContent:j,questionRef:E}){const A=r.tossup?Fe(r.tossup):[],T=r.bonus?Fe(r.bonus):[],v=!f||p===y,[P,z]=X.useState(null),[u,C]=X.useState(!1);return X.useEffect(()=>{let R=!1;async function F(){z(null);const O=r?.bonus;if(!O||!(O.is_visual_bonus===!0||String(O.visual||"").toLowerCase()==="true"))return;const _=await ms({tournament:O.tournament,round:O.round,question_number:O.question_number}).catch(()=>null);R||z(_)}return j&&F(),()=>{R=!0}},[r?.bonus?.tournament,r?.bonus?.round,r?.bonus?.question_number,j]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:E,className:`glass p-6 space-y-4 min-w-0 relative ${f&&!v?"opacity-50 blur-sm select-none pointer-events-none":""}`,children:[f&&p===y&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 rounded-lg pointer-events-none border-2 border-green-500 shadow-[0_0_0_3px_rgba(34,197,94,0.35)]",style:{boxShadow:"0 0 0 3px rgba(34,197,94,0.35), 0 4px 12px -2px rgba(16,185,129,0.5)"}}),e.jsx("div",{className:"absolute -top-3 left-4 px-3 py-1 bg-green-600 text-white rounded-full text-[11px] font-semibold shadow-lg",children:"Active"})]}),r.tossup&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm text-black/60 dark:text-white/80 mb-2",children:[e.jsx("span",{className:"font-semibold",children:String(r.tossup.tournament).toUpperCase()})," • ","Round ",r.tossup.round??"—"," • ",r.tossup.category,r.tossup.question_number!=null&&e.jsxs(e.Fragment,{children:[" • ","Q",r.tossup.question_number]}),e.jsx("span",{className:"ml-2 inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold tracking-wide border "+(A.length>0?"bg-blue-50 text-blue-700 border-blue-200 dark:bg-blue-900/20 dark:text-blue-200 dark:border-blue-700":"bg-purple-50 text-purple-700 border-purple-200 dark:bg-purple-900/20 dark:text-purple-200 dark:border-purple-700"),children:A.length>0?"MULTIPLE CHOICE":"SHORT ANSWER"})]}),e.jsxs("div",{className:"font-medium mb-2",children:["Toss-up ",p+1]}),e.jsx("div",{className:"mb-3 whitespace-pre-line",children:e.jsx(pe,{children:r.tossup.question})}),A.length>0&&e.jsx("div",{className:"mb-3",children:A.map(([R,F])=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:`gen-tossup-${p}`,className:"accent-tint",disabled:!0}),e.jsxs("span",{children:[R.toUpperCase(),") ",e.jsx(pe,{children:F})]})]},R))}),e.jsxs("div",{className:"text-sm text-black/70 dark:text-white/80",children:[e.jsx("span",{className:"uppercase text-black/60 dark:text-white/60",children:"Answer:"})," ",e.jsx("span",{className:"text-black dark:text-white",children:e.jsx(pe,{children:r.tossup.answer})})]})]}),r.bonus&&j&&e.jsxs("div",{className:r.tossup?"mt-6 pt-4 border-t":"mt-2",children:[e.jsxs("div",{className:"text-sm text-black/60 dark:text-white/80 mb-2",children:[e.jsx("span",{className:"font-semibold",children:String(r.tossup?r.tossup.tournament:r.bonus.tournament).toUpperCase()})," • ","Round ",r.bonus.round??"—"," • ",r.bonus.category,r.bonus.question_number!=null&&e.jsxs(e.Fragment,{children:[" • ","Q",r.bonus.question_number]}),e.jsx("span",{className:"ml-2 inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold tracking-wide border "+(T.length>0?"bg-blue-50 text-blue-700 border-blue-200 dark:bg-blue-900/20 dark:text-blue-200 dark:border-blue-700":"bg-purple-50 text-purple-700 border-purple-200 dark:bg-purple-900/20 dark:text-purple-200 dark:border-purple-700"),children:T.length>0?"MULTIPLE CHOICE":"SHORT ANSWER"})]}),e.jsxs("div",{className:"font-semibold mb-2",children:["Bonus ",p+1]}),P&&e.jsxs("div",{className:"mb-3",children:[e.jsx("img",{src:P,alt:`Visual bonus${r?.bonus?.tournament?` • ${r.bonus.tournament}`:""}${r?.bonus?.round?` • Round ${r.bonus.round}`:""}${r?.bonus?.question_number!=null?` • Q${r.bonus.question_number}`:""}`,className:"max-h-64 rounded-md border border-black/10 dark:border-white/10 object-contain cursor-zoom-in hover:opacity-95 transition",onClick:()=>C(!0)}),e.jsx("div",{className:"text-xs text-black/60 dark:text-white/60 mt-1",children:"Click image to view full screen"})]}),e.jsx("div",{className:"mb-2 whitespace-pre-line",children:e.jsx(pe,{children:r.bonus.question})}),T.length>0&&e.jsx("div",{className:"mb-3",children:T.map(([R,F])=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:`gen-bonus-${p}`,className:"accent-tint",disabled:!0}),e.jsxs("span",{children:[R.toUpperCase(),") ",e.jsx(pe,{children:F})]})]},R))}),e.jsxs("div",{className:"text-sm text-black/70 dark:text-white/80",children:[e.jsx("span",{className:"uppercase text-black/60 dark:text-white/60",children:"Answer:"})," ",e.jsx("span",{className:"text-black dark:text-white",children:e.jsx(pe,{children:r.bonus.answer})})]})]})]}),u&&P&&e.jsxs("div",{className:"fixed inset-0 z-[90] flex items-center justify-center",role:"dialog","aria-modal":"true","aria-label":"Visual bonus image",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80",onClick:()=>C(!1)}),e.jsxs("div",{className:"relative max-w-[96vw] max-h-[96vh] p-2",children:[e.jsx("img",{src:P,alt:"Visual bonus full screen",className:"max-w-[96vw] max-h-[92vh] object-contain rounded shadow-2xl"}),e.jsx("button",{type:"button",className:"absolute -top-3 -right-3 bg-white text-black rounded-full shadow p-2 hover:bg-white/90 focus:outline-none","aria-label":"Close full screen image",onClick:()=>C(!1),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"h-4 w-4",children:e.jsx("path",{fillRule:"evenodd",d:"M4.22 4.22a.75.75 0 011.06 0L10 8.94l4.72-4.72a.75.75 0 111.06 1.06L11.06 10l4.72 4.72a.75.75 0 11-1.06 1.06L10 11.06l-4.72 4.72a.75.75 0 01-1.06-1.06L8.94 10 4.22 5.28a.75.75 0 010-1.06z",clipRule:"evenodd"})})})]}),e.jsx(Zn,{onClose:()=>C(!1)})]})]})}function Zn({onClose:r}){return X.useEffect(()=>{const p=f=>{f.key==="Escape"&&r?.()};return window.addEventListener("keydown",p),()=>window.removeEventListener("keydown",p)},[r]),null}function er({displayPairs:r,QUESTIONS_PER_PAGE:p=2,pdfRef:f}){const[y,L]=X.useState({});return X.useEffect(()=>{let j=!1;return(async()=>{const E={};for(let A=0;A<r.length;A++){const T=r[A]?.bonus;if(!(!T||!(T.is_visual_bonus===!0||String(T.visual||"").toLowerCase()==="true")))try{const P=await ms({tournament:T.tournament,round:T.round,question_number:T.question_number});P&&(E[A]=P)}catch{}}j||L(E)})(),()=>{j=!0}},[r]),e.jsx("div",{"aria-hidden":"true",style:{position:"fixed",left:"-10000px",top:0,width:816,pointerEvents:"none",opacity:0,visibility:"visible"},children:e.jsxs("div",{ref:f,className:"pdf-root",children:[e.jsx("style",{children:`
          .pdf-root, .pdf-root * { box-sizing: border-box; }
          .html2pdf__page-break + .pdf-header { margin-top: 0 !important; }
          @page { margin: 12mm; }
          .pdf-root { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Noto Sans, 'Apple Color Emoji', 'Segoe UI Emoji'; color: #000; margin: 0; padding: 0; }
          .pdf-page { width: 720px; margin: 0 auto; padding: 2mm 4px 0 4px; }
          .pdf-page { page-break-after: always; }
          .pdf-page:last-child { page-break-after: auto; }
          .pdf-header { text-align: center; font-size: 16px; font-weight: bold; margin-bottom: 2mm; padding: 0 2px; }
          .pdf-q { page-break-inside: avoid; break-inside: avoid; margin-bottom: 4mm; }
          .pdf-hr { border: none; border-top: 1px solid #888; margin: 8px 0; }
          .pdf-meta { font-size: 11px; color: #333; margin-bottom: 2mm; }
          .pdf-title { font-weight: 600; margin-bottom: 2mm; }
          .pdf-body { white-space: pre-wrap; line-height: 1.4; word-break: break-word; overflow-wrap: anywhere; }
          .pdf-choices { margin: 2mm 0; break-inside: avoid; }
          .pdf-choice { display: flex; align-items: flex-start; gap: 4px; line-height: 1.35; }
          .pdf-choice-key { font-weight: 600; width: 16px; flex: 0 0 auto; }
          .pdf-choice-val { flex: 1; }
          .pdf-ans { font-size: 12px; margin-top: 2mm; }
          .pdf-footer { text-align: center; font-size: 12px; color: #888; margin-top: 2mm; }
          .katex-display { margin: 0; }
        `}),(()=>{const j=[];for(let T=0;T<r.length;T+=p){const v=r.slice(T,T+p);v.length>0&&j.push(v)}const E=new Date().toLocaleDateString(),A="atombowl";return j.map((T,v)=>{const P=v*p,z=v+1;return e.jsxs("div",{className:"pdf-page",children:[e.jsxs("div",{className:"pdf-header",children:[A," — ",E]}),T.map((u,C)=>{const R=P+C,F=u.tossup?Fe(u.tossup):[],O=u.bonus?Fe(u.bonus):[];return e.jsxs(X.Fragment,{children:[e.jsxs("div",{className:"pdf-q",children:[u.tossup&&e.jsxs("div",{children:[e.jsxs("div",{className:"pdf-meta",children:[u.tossup.tournament," • Round ",u.tossup.round??"—"," • ",u.tossup.category,u.tossup.question_number!=null?` • Q${u.tossup.question_number}`:"",e.jsx("span",{style:F.length>0?lt("mc"):lt("sa"),children:F.length>0?"MULTIPLE CHOICE":"SHORT ANSWER"})]}),e.jsxs("div",{className:"pdf-title",children:["Toss-up ",R+1]}),e.jsx("div",{className:"pdf-body",children:e.jsx(pe,{children:u.tossup.question})}),F.length>0&&e.jsx("div",{className:"pdf-choices",children:F.map(([B,_])=>e.jsxs("div",{className:"pdf-choice",children:[e.jsxs("span",{className:"pdf-choice-key",children:[B.toUpperCase(),")"]}),e.jsx("span",{className:"pdf-choice-val",children:e.jsx(pe,{children:_})})]},B))}),e.jsxs("div",{className:"pdf-ans",children:[e.jsx("span",{style:{opacity:.7},children:"Answer:"})," ",e.jsx(pe,{children:u.tossup.answer})]})]}),u.bonus&&e.jsxs("div",{style:{marginTop:u.tossup?"6mm":0,paddingTop:u.tossup?"2mm":0,borderTop:u.tossup?"1px solid #ddd":"none"},children:[e.jsxs("div",{className:"pdf-meta",children:[u.tossup?u.tossup.tournament:u.bonus.tournament," • Round ",u.bonus.round??"—"," • ",u.bonus.category,u.bonus.question_number!=null?` • Q${u.bonus.question_number}`:"",e.jsx("span",{style:O.length>0?lt("mc"):lt("sa"),children:O.length>0?"MULTIPLE CHOICE":"SHORT ANSWER"})]}),e.jsxs("div",{className:"pdf-title",children:["Bonus ",R+1]}),y[R]&&e.jsx("div",{className:"pdf-body",style:{marginBottom:"2mm"},children:e.jsx("img",{src:y[R],alt:"Visual bonus",style:{maxHeight:220,width:"100%",objectFit:"contain",border:"1px solid #e5e7eb",borderRadius:6}})}),e.jsx("div",{className:"pdf-body",children:e.jsx(pe,{children:u.bonus.question})}),O.length>0&&e.jsx("div",{className:"pdf-choices",children:O.map(([B,_])=>e.jsxs("div",{className:"pdf-choice",children:[e.jsxs("span",{className:"pdf-choice-key",children:[B.toUpperCase(),")"]}),e.jsx("span",{className:"pdf-choice-val",children:e.jsx(pe,{children:_})})]},B))}),e.jsxs("div",{className:"pdf-ans",children:[e.jsx("span",{style:{opacity:.7},children:"Answer:"})," ",e.jsx(pe,{children:u.bonus.answer})]})]})]}),C<T.length-1&&e.jsx("hr",{className:"pdf-hr"})]},`pdf-${R}`)}),e.jsxs("div",{className:"pdf-footer",children:["Page ",z," of ",j.length]})]},`pdf-group-${v}`)})})()]})})}function lt(r){return r==="mc"?{marginLeft:6,border:"1px solid #bfdbfe",background:"#eff6ff",color:"#1d4ed8",borderRadius:9999,padding:"1px 6px",fontSize:10,fontWeight:600}:{marginLeft:6,border:"1px solid #e9d5ff",background:"#faf5ff",color:"#6b21a8",borderRadius:9999,padding:"1px 6px",fontSize:10,fontWeight:600}}function tr({searchInput:r,setSearchInput:p,committedSearch:f,setCommittedSearch:y,hasGenerated:L=!1}){return e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold mb-2 flex items-center gap-2",children:["Search",f&&e.jsx("button",{type:"button",className:"chip px-2 py-0.5 text-xs",onClick:()=>{p(""),y("")},"aria-label":"Clear search",children:"Clear"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Rn,{className:"h-4 w-4 absolute left-2 top-1/2 -translate-y-1/2 text-black/50 dark:text-white/50 pointer-events-none"}),e.jsx("input",{type:"text",value:r,onChange:j=>p(j.target.value),onKeyDown:j=>{j.key==="Enter"&&y(r)},placeholder:"Find text in generated round...",className:"w-full pl-8 pr-3 py-1.5 rounded-lg border border-black/10 bg-white dark:bg-darkcard text-black dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Search questions",disabled:!L})]}),e.jsx("button",{type:"button",className:"btn btn-fancy whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed",disabled:!L||!r.trim()||r.trim()===f.trim(),onClick:()=>y(r),children:"Search"})]}),f.trim()&&e.jsxs("div",{className:"text-xs mt-1 opacity-70",children:['Showing all matches containing "',f,'" (ignores other filters except selected tournaments for loading).']})]})}function sr({headerOffset:r,close:p,currentIndex:f,displayPairs:y,awaitingPlayer:L,interruptArmed:j,setAwaitingPlayer:E,setInterruptArmed:A,typedAnswerActive:T,setTypedAnswerActive:v,typedAnswerText:P,setTypedAnswerText:z,typedAnswerPlayerId:u,typedAnswerLoading:C,typedAnswerReason:R,checkTypedAnswer:F,isTossupFinal:O,recordNoAnswer:B,throwOutAndReplace:_,tossupResults:K,bonusResults:te,saveFixedBonus:c,players:a,handleSeatClick:w,allowedTeams:N,totalPoints:m,teamPoints:g,saveBonusPoints:M,subMode:U,setSubMode:h,resetScorekeeping:J,exportCoachesScoresheetPdf:se,coachesSheetLoading:oe,tryoutsMode:_e,setTryoutsMode:fe,questionType:ye}){return e.jsxs("div",{className:"fixed right-0 z-50 w-[400px] bg-white dark:bg-darkcard border-l border-black/10 dark:border-white/10 shadow-xl flex flex-col",style:{top:r,height:`calc(100vh - ${r}px)`},children:[e.jsxs("div",{className:"px-4 py-3 border-b border-black/10 dark:border-white/10 flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold text-sm",children:"Scorekeeper"}),e.jsx("button",{className:"text-xs chip",onClick:p,children:"Close"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-4 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{children:["Q ",Math.min(f+1,y.length)," / ",y.length]}),e.jsx("div",{className:"text-[10px] mt-0.5 opacity-70",children:N.length===0?"No buzz":"Buzz: "+N.join("/")})]}),e.jsxs("div",{className:"font-semibold text-xs leading-tight flex flex-col items-end",children:[e.jsxs("span",{children:["Total ",m]}),e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:["A ",g.A]}),e.jsxs("span",{className:"text-blue-600 dark:text-blue-400",children:["B ",g.B]})]})]}),f>=y.length&&e.jsx("div",{className:"p-2 rounded bg-emerald-600 text-white text-center text-xs",children:"Round complete"}),f<y.length&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-[11px] font-medium",children:[e.jsx("input",{type:"checkbox",className:"scale-110",checked:!!_e,onChange:V=>fe(V.target.checked),disabled:ye!=="tossup",title:ye==="tossup"?"Tryouts mode: an incorrect buzz only locks that player; others may continue buzzing.":"Switch question type to Toss-ups to enable Tryouts mode."}),"Tryouts"]}),ye!=="tossup"&&e.jsx("span",{className:"text-[10px] opacity-60",children:"Toss-ups only"})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-2",children:[e.jsxs("button",{className:`col-span-2 chip flex items-center justify-center gap-1 text-xs disabled:opacity-40 disabled:cursor-not-allowed disabled:brightness-75 ${L?.type==="incorrect"?"ring-2 ring-red-500":""}`,onClick:()=>E({type:"incorrect",interrupt:j}),disabled:O(f),title:"Mark incorrect then click player seat (then select player)",children:[e.jsx(Bn,{color:"#ff2600",className:"h-4 w-4"})," Incorrect"]}),e.jsxs("button",{className:`col-span-2 chip flex items-center justify-center gap-1 text-xs disabled:opacity-40 disabled:cursor-not-allowed disabled:brightness-75 ${L?.type==="correct"?"ring-2 ring-green-500":""}`,onClick:()=>E({type:"correct",interrupt:j}),disabled:O(f),title:"Mark correct then click player seat",children:[e.jsx(Ln,{color:"#00f900",className:"h-4 w-4"})," Correct"]}),e.jsx("button",{className:`col-span-2 chip flex items-center justify-center gap-1 text-xs disabled:opacity-40 disabled:cursor-not-allowed disabled:brightness-75 ${j?"bg-purple-600 text-white ring-2 ring-purple-500":""}`,onClick:()=>A(V=>!V),disabled:O(f),title:"Toggle interrupt (applies to next correct/incorrect)",children:j?"Interrupt ON":"Interrupt"})]}),j&&y[f]?.tossup&&!O(f)&&e.jsxs("div",{className:"space-y-1 rounded-md border border-black/10 dark:border-white/10 p-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-[11px] font-medium",children:"Typed answer (AI check)"}),e.jsx("button",{type:"button",className:`chip text-[11px] px-2 py-0.5 ${T?"bg-purple-600 text-white":""}`,onClick:()=>v(V=>!V),title:"Toggle typed answer entry for interrupts",children:T?"Hide":"Type Answer"})]}),T&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-[10px] opacity-70",children:"Select a player seat, then enter the answer as given and check with AI."}),e.jsx("input",{type:"text",className:"w-full rounded border border-black/10 dark:border-white/10 bg-white dark:bg-darkcard px-2 py-1 text-xs",placeholder:"Type the player’s answer…",value:P,onChange:V=>z(V.target.value),disabled:C}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"text-[10px]",children:["Seat: ",u?"selected":"—"]}),e.jsx("button",{type:"button",className:"chip text-[11px] bg-tint text-white disabled:opacity-50 disabled:cursor-not-allowed",onClick:F,disabled:C||!u||!P.trim(),children:C?"Checking…":"Check with AI"})]}),R&&e.jsxs("div",{className:"text-[10px] opacity-80",children:["AI: ",R]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{className:"chip text-xs disabled:opacity-40 disabled:cursor-not-allowed",onClick:B,disabled:O(f),title:"Record as no answer and advance (attempts already made remain in the log)",children:"No Answer"}),e.jsx("button",{className:"chip text-xs",onClick:_,children:"Throw Out & Replace"})]}),K[f]?.result==="correct"&&y[f]?.bonus&&y[f]?.tossup&&!te[f]&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("button",{className:"chip text-xs bg-green-600 text-white hover:bg-green-700",onClick:()=>{c(!0)},children:"Award +10"}),e.jsx("button",{className:"chip text-xs bg-red-600 text-white hover:bg-red-700",onClick:()=>{c(!1)},children:"No Bonus"})]}),te[f]&&e.jsxs("div",{className:"text-xs",children:["Bonus: ",te[f].points," pts"]}),L&&e.jsxs("div",{className:"text-xs text-center text-blue-600 dark:text-blue-300",children:["Select a player seat to apply a ",L.interrupt?"Interrupt ":"",L.type,"."]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-2 justify-between",children:[e.jsxs("span",{children:["Players ",U&&e.jsx("span",{className:"text-[10px] font-normal px-1.5 py-0.5 rounded bg-purple-600 text-white",children:"SUB MODE"})]}),e.jsx("button",{type:"button",className:"chip px-2 py-1 text-[11px]",onClick:()=>h(!0),title:"Open substitution modal",children:"Substitute"})]}),e.jsx("div",{className:"space-y-6",children:["A","B"].map(V=>e.jsxs("div",{children:[e.jsxs("div",{className:`text-[12px] font-semibold mb-2 tracking-wide ${V==="A"?"text-green-600 dark:text-green-400":"text-blue-600 dark:text-blue-400"}`,children:["Team ",V]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:a.filter(H=>H.team===V).map(H=>{const Ie=a.findIndex(Xe=>Xe.id===H.id);let ve=H.status==="replaced"||L&&!N.includes(H.team);return _e&&ye==="tossup"&&L&&((K[f]?.attempts||[]).some(dt=>dt.playerId===H.id)?ve=!0:ve=H.status==="replaced"),e.jsxs("button",{onClick:()=>w(Ie),className:`relative flex flex-col items-center justify-center h-24 rounded-xl border border-black/10 dark:border-white/10 ${ve?"bg-black/10 dark:bg-white/10 opacity-40 cursor-not-allowed":"bg-gradient-to-br from-black/5 to-black/10 dark:from-white/10 dark:to-white/5 hover:from-black/10 hover:to-black/20 dark:hover:from-white/20 dark:hover:to-white/10"} transition text-[11px] font-medium ${L&&!ve&&H.status!=="replaced"?"ring-2 ring-offset-2 ring-green-500 dark:ring-green-400 animate-pulse-slow":""}`,title:H.name||`Seat ${V}${H.seat??(H.id<=4?H.id:H.id-4)}`,disabled:H.status==="replaced",children:[e.jsx(Tn,{className:"h-7 w-7 opacity-70"}),e.jsx("span",{className:"mt-2 truncate max-w-[120px] px-2 text-center leading-tight",children:H.name||`Seat ${V}${H.seat??(H.id<=4?H.id:H.id-4)}`}),H.status==="replaced"&&e.jsx("span",{className:"absolute top-1 left-1 text-[10px] bg-red-600 text-white px-1 rounded",children:"OUT"}),H.stats.correct+H.stats.correctInterrupt>0&&e.jsx("span",{className:"absolute top-0 right-0 text-[10px] bg-green-600 text-white rounded-bl px-1",children:H.stats.correct+H.stats.correctInterrupt})]},H.id)})})]},V))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium mb-1",children:"Player Stats"}),e.jsxs("table",{className:"w-full text-[10px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[9px] text-black/70 dark:text-white/70",children:[e.jsx("th",{className:"text-left",children:"Player"}),e.jsx("th",{children:"Tm"}),e.jsx("th",{children:"C"}),e.jsx("th",{children:"I"}),e.jsx("th",{children:"CI"}),e.jsx("th",{children:"II"})]})}),e.jsx("tbody",{children:a.filter(V=>V.name).map(V=>e.jsxs("tr",{className:"odd:bg-black/0 even:bg-black/5 dark:even:bg-white/5",children:[e.jsx("td",{className:"truncate max-w-[90px] pr-1",children:V.name}),e.jsx("td",{className:"text-center",children:V.team}),e.jsx("td",{className:"text-center",children:V.stats.correct}),e.jsx("td",{className:"text-center",children:V.stats.incorrect}),e.jsx("td",{className:"text-center",children:V.stats.correctInterrupt}),e.jsx("td",{className:"text-center",children:V.stats.incorrectInterrupt})]},V.id))})]})]}),f>=y.length&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{className:"btn btn-orange w-full justify-center",onClick:se,disabled:oe,children:oe?"Generating…":"Coaches Scoresheet PDF"}),e.jsx("button",{className:"btn btn-ghost w-full justify-center",onClick:()=>J(),children:"Reset Scorekeeping"})]})]})]})}function nr({open:r,onClose:p,players:f,onSubmit:y,initialTeam:L="A"}){const[j,E]=x.useState(L),[A,T]=x.useState(null),[v,P]=x.useState(""),[z,u]=x.useState(!1);if(x.useEffect(()=>{if(r){E(L);const B=f.filter(_=>_.team===L)[0];T(B?.id??null),P(""),u(!1)}},[r,L,f]),!r)return null;const C=f.filter(B=>B.team===j),F=f.filter(B=>B.team===j).length>=5,O=v.trim().length>0&&A!=null&&!F;return f.find(B=>B.id===A),e.jsxs("div",{className:"fixed inset-0 z-[75] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:p}),e.jsxs("div",{className:"relative bg-white dark:bg-darkcard rounded-lg shadow-xl w-full max-w-md border border-black/10 dark:border-white/10 p-6 flex flex-col gap-5",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Substitute Player"}),e.jsx("button",{type:"button",className:"chip text-xs",onClick:p,children:"Close"})]}),e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"font-medium text-xs uppercase tracking-wide",children:"Team"}),e.jsx("div",{className:"flex gap-2",children:["A","B"].map(B=>e.jsxs("button",{type:"button",className:`chip px-3 py-1 text-sm ${j===B?"ring-2 ring-tint bg-tint/10":""}`,onClick:()=>{E(B);const _=f.filter(K=>K.team===B)[0];T(_?.id??null)},children:["Team ",B]},B))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"font-medium text-xs uppercase tracking-wide",children:"Outgoing Seat"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:C.map(B=>e.jsxs("button",{type:"button",onClick:()=>T(B.id),className:`chip flex flex-col items-center gap-1 py-2 ${A===B.id?"ring-2 ring-tint bg-tint/10":""}`,children:[e.jsx("span",{className:"text-[11px] font-semibold",children:B.name||`Seat ${j}${B.seat??(B.id<=4?B.id:B.id-4)}`}),B.name&&e.jsxs("span",{className:"text-[10px] opacity-60",children:[B.stats.correct+B.stats.correctInterrupt," C / ",B.stats.incorrect+B.stats.incorrectInterrupt," I"]})]},B.id))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"font-medium text-xs uppercase tracking-wide",htmlFor:"new-player-name",children:"New Player Name"}),e.jsx("input",{id:"new-player-name",type:"text",className:"w-full rounded-lg border border-black/10 dark:border-white/10 bg-white dark:bg-darkcard px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-tint",placeholder:"Enter name",value:v,onChange:B=>{P(B.target.value),u(!0)},autoFocus:!0}),z&&v.trim()===""&&e.jsx("div",{className:"text-[11px] text-red-600 mt-1",children:"Name required."})]}),F&&e.jsx("div",{className:"text-[11px] text-red-600",children:"Team already has a substitute (5 players shown). Further substitutions disabled."})]}),e.jsxs("div",{className:"flex flex-col gap-2 pt-2",children:[e.jsx("button",{type:"button",disabled:!O,onClick:()=>{O&&(y({team:j,playerId:A,newName:v.trim()}),p())},className:"btn btn-primary w-full justify-center disabled:opacity-40 disabled:cursor-not-allowed",children:"Apply Substitution"}),e.jsx("button",{type:"button",onClick:p,className:"btn btn-ghost w-full justify-center",children:"Cancel"})]})]})]})}function rr({leftPaneCollapsed:r,leftPanePinned:p,leftPaneHovered:f,setLeftPaneCollapsed:y,setLeftPanePinned:L,setLeftPaneHovered:j}){return e.jsx("button",{className:"absolute top-2 -right-2 bg-white dark:bg-darkcard border border-black/10 dark:border-white/20 rounded-full p-1 shadow hover:bg-gray-50 dark:hover:bg-white/10 transition z-10",onClick:()=>{r||!p?(y(!1),L(!0)):(L(!1),y(!0))},onMouseEnter:()=>j(!0),onMouseLeave:()=>j(!1),title:r?"Expand panel":p?"Unpin panel":"Pin panel",children:r?f?e.jsx(is,{className:"h-4 w-4"}):e.jsx(In,{className:"h-4 w-4 transition-transform rotate-180"}):p?e.jsx(Mn,{className:"h-4 w-4"}):e.jsx(is,{className:"h-4 w-4"})})}function Vo({questions:r=[],lazy:p=null,auth:f=null,persistedGenerated:y=null,setPersistedGenerated:L=null,onNewRound:j=null}){const{isLazy:E,tournaments:A,tournamentGroups:T,selectedTournaments:v,setSelectedTournaments:P,selectedCategories:z,setSelectedCategories:u,tournamentGroupsOpen:C,setTournamentGroupsOpen:R,tournamentVisibleEntriesMainRef:F,handleTournamentToggle:O,loadedQuestions:B,validQuestions:_,categories:K,roundRanges:te,setRoundRanges:c,roundsByTournament:a,globalNumericRoundMax:w,inRanges:N}=cn({questions:r,lazy:p}),[m,g]=x.useState(!1),[M,U]=x.useState([]);function h(t,s="info",l=4e3){const i=Math.random().toString(36).slice(2),o=Date.now();U(n=>[...n,{id:i,message:t,type:s,ttl:l,created:o}]),l>0&&setTimeout(()=>U(n=>n.filter(d=>d.id!==i)),l+50)}const{roundsIndex:J,setRoundsIndex:se,loadingUserRounds:oe,roundFolders:_e,setRoundFolders:fe,foldersOpen:ye,setFoldersOpen:V,selectedExcludeRoundIds:H,setSelectedExcludeRoundIds:Ie,excludeDetailCache:ve,handleExcludeRoundToggle:Xe,refresh:dt,deleteFolderAndRounds:ps}=On({auth:f,pushToast:h});x.useRef(null),x.useRef(null);const[fs,hs]=x.useState(!1),[de,xs]=x.useState(10),[bs,gs]=x.useState([]),he=Array.isArray(y)?y:bs,we=typeof L=="function"?L:gs,{history:Z,setHistory:ys}=dn(),[Ue,ut]=x.useState(null);X.useEffect(()=>{Array.isArray(Z)&&Z.length>0?ut(Z.length-1):ut(null)},[Z]);function Mt(t){if(!Array.isArray(Z)||Z.length===0||t<0||t>=Z.length)return;vt(""),ut(t);const s=Z[t]||[];we(s),Pe(!0),Ze();try{window.scrollTo({top:0,behavior:"smooth"})}catch{}try{bn(t+1).catch(()=>{})}catch{}}const[xe,ws]=x.useState(!0),[be,js]=x.useState(!0),[je,vs]=x.useState(!1),[re,Et]=x.useState("both"),mt=xe&&be&&je,Pt=!xe&&be&&je;X.useEffect(()=>{let t="both";xe&&be?t="both":xe&&!be?t="tossup":!xe&&be&&!je?t="bonus":!xe&&!be&&je?t="visual-bonus":!xe&&be&&je?t="bonus":t="both",Et(t)},[xe,be,je]);const $t=X.useRef(null),ks=2,[Dt,zt]=x.useState(!1),[Ft,_t]=x.useState(!1),[Ye,Ut]=x.useState(!1),[Ns,Ss]=x.useState(!1),{dark:Cs}=un(),As=!!Cs,[ae,qt]=x.useState(!1),Rs=x.useRef(9),[Y,qe]=x.useState(()=>Array.from({length:8},(t,s)=>({id:s+1,team:s<4?"A":"B",seat:s<4?s+1:s-3,name:"",status:"active",stats:{correct:0,incorrect:0,correctInterrupt:0,incorrectInterrupt:0}}))),[W,pt]=x.useState(0),[ie,Ne]=x.useState(null),[Bs,Me]=x.useState(!1),[ft,ht]=x.useState(!1),[Ot,xt]=x.useState(""),[bt,gt]=x.useState(null),[Ls,Gt]=x.useState(!1),[Ts,yt]=x.useState(""),[le,Oe]=x.useState([]),[ke,Ke]=x.useState([]),[Wt,ue]=x.useState(null),[wt,ce]=x.useState(["A","B"]),[Se,Ht]=x.useState(!1);X.useEffect(()=>{try{localStorage.getItem("sb_tryoutsMode")==="1"&&Ht(!0)}catch{}},[]),X.useEffect(()=>{try{localStorage.setItem("sb_tryoutsMode",Se?"1":"0")}catch{}},[Se]);const[Is,Vt]=x.useState(!1),[or,ar]=x.useState("A"),[Ms,Qt]=x.useState(!1),[Es,Je]=x.useState(""),[jt,Xt]=x.useState(0),Yt=x.useRef([]);X.useEffect(()=>{function t(){const s=document.querySelector("header, .site-header, .app-header, .top-bar");if(s){const l=s.getBoundingClientRect();Xt(l.height)}else Xt(0)}return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),X.useEffect(()=>{if(!ae)return;const t=Yt.current[W];if(t&&typeof t.scrollIntoView=="function"){const s=Math.max(jt+12,0),l=t.getBoundingClientRect(),i=window.scrollY+l.top-s;window.scrollTo({top:i,behavior:"smooth"})}},[W,ae,jt]);const Ps=x.useMemo(()=>{let t=0;return le.forEach(s=>{s&&(Array.isArray(s.attempts)?s.attempts.forEach(l=>{typeof l.points=="number"&&(t+=l.points)}):typeof s.points=="number"&&(t+=s.points))}),ke.forEach(s=>{s&&typeof s.points=="number"&&(t+=s.points)}),t},[le,ke]),$s=x.useMemo(()=>{const t={A:0,B:0};return le.forEach(s=>{if(s){if(Array.isArray(s.attempts)&&s.attempts.length)s.attempts.forEach(l=>{const i=Y.find(o=>o.id===l.playerId)?.team;i&&(t[i]+=l.points||0)});else if(s.playerId){const l=Y.find(i=>i.id===s.playerId)?.team;l&&(t[l]+=s.points||0)}}}),ke.forEach(s=>{s?.team&&(t[s.team]+=s.points||0)}),t},[le,ke,Y]);function Ze(){pt(0),Ne(null),Oe([]),Ke([]),Je(""),ue(null),ce(["A","B"]),Vt(!1)}function Ds(t){const s=Y[t];if(s){if(ft){if(!wt.includes(s.team)){h(`Team ${s.team} not allowed to buzz now.`,"error");return}if(s.status==="replaced"){h("Cannot buzz: seat replaced.","error");return}if(Se&&re==="tossup"&&(le[W]?.attempts||[]).some(i=>i.playerId===s.id)){h("This player already attempted this toss-up.","error");return}gt(s.id),h(`Selected ${s.name||`Seat ${s.team}${s.seat??""}`} for typed interrupt.`,"info",2500);return}if(s.status==="replaced"){h("Cannot buzz: seat replaced.","error");return}if(ie){if(!wt.includes(s.team)){h(`Team ${s.team} not allowed to buzz now.`,"error");return}const{type:l,interrupt:i}=ie,o=Wt==null;if(Oe(n=>{const d=[...n],b=l==="correct"?4:l==="incorrect"&&i?-4:0,k=d[W]||{},$=Array.isArray(k.attempts)?[...k.attempts]:[];return $.push({playerId:s.id,team:s.team,result:l,interrupt:i,points:b}),l==="correct"?d[W]={...k,attempts:$,result:"correct",playerId:s.id,interrupt:i,points:b}:o?d[W]={...k,attempts:$,result:"incorrect",playerId:s.id,interrupt:i,points:b}:d[W]={...k,attempts:$,result:"incorrect",playerId:s.id,interrupt:i,points:b},d}),qe(n=>n.map(d=>d.id===s.id?{...d,stats:{...d.stats,correct:d.stats.correct+(ie.type==="correct"&&!ie.interrupt?1:0),incorrect:d.stats.incorrect+(ie.type==="incorrect"&&!ie.interrupt?1:0),correctInterrupt:d.stats.correctInterrupt+(ie.type==="correct"&&ie.interrupt?1:0),incorrectInterrupt:d.stats.incorrectInterrupt+(ie.type==="incorrect"&&ie.interrupt?1:0)}}:d)),Ne(null),Me(!1),o&&ie.type==="incorrect")Se&&re==="tossup"?(ue(null),ce(["A","B"])):(ue(s.team),ce([s.team==="A"?"B":"A"]));else if(ie.type==="incorrect")ue(null),ce([]),setTimeout(()=>Ee(),200);else if(ie.type==="correct"){ue(null),ce([]);const n=ne[W];n?.bonus&&n.tossup?Je(""):setTimeout(()=>Ee(),150)}return}if(s.name){const l=window.prompt("Rename player",s.name);l!=null&&qe(i=>i.map((o,n)=>n===t?{...o,name:l.trim()}:o))}else{const l=window.prompt("Enter player name (seat "+(t+1)+")","");l!=null&&qe(i=>i.map((o,n)=>n===t?{...o,name:l.trim()}:o))}}}function zs({player:t,type:s,interrupt:l}){if(!t)return;const i=Wt==null;if(Oe(o=>{const n=[...o],d=s==="correct"?4:s==="incorrect"&&l?-4:0,b=n[W]||{},k=Array.isArray(b.attempts)?[...b.attempts]:[];return k.push({playerId:t.id,team:t.team,result:s,interrupt:l,points:d}),s==="correct"?n[W]={...b,attempts:k,result:"correct",playerId:t.id,interrupt:l,points:d}:n[W]={...b,attempts:k,result:"incorrect",playerId:t.id,interrupt:l,points:d},n}),qe(o=>o.map(n=>n.id===t.id?{...n,stats:{...n.stats,correct:n.stats.correct+0,incorrect:n.stats.incorrect+0,correctInterrupt:n.stats.correctInterrupt+(s==="correct"&&l?1:0),incorrectInterrupt:n.stats.incorrectInterrupt+(s==="incorrect"&&l?1:0)}}:n)),Ne(null),Me(!1),s==="incorrect")i?Se&&re==="tossup"?(ue(null),ce(["A","B"])):(ue(t.team),ce([t.team==="A"?"B":"A"])):(ue(null),ce([]),setTimeout(()=>Ee(),200));else if(s==="correct"){ue(null),ce([]);const o=ne[W];o?.bonus&&o.tossup?Je(""):setTimeout(()=>Ee(),150)}}async function Fs(){try{if(!ft)return;const s=ne[W]?.tossup;if(!s){h("No toss-up at this question.","error");return}if(!bt){h("Select a player seat first.","error");return}const l=Y.find(I=>I.id===bt);if(!l){h("Invalid player selection.","error");return}const i=String(Ot||"").trim();if(!i){h("Enter an answer to check.","error");return}Gt(!0),yt("");const o=Fe(s),n=Array.isArray(o)&&o.length>0,d={userAnswer:i,correctAnswer:s.answer,question:s.question};n&&(d.choices=o);const b=await(n?gn(d):yn(d)).catch(I=>({ok:!1,statusText:I?.message}));if(!b||!b.ok){h("AI check failed. You can record manually.","error");return}const k=await b.json().catch(()=>({})),$=!!k?.correct,S=typeof k?.reason=="string"?k.reason:"";yt(S||""),zs({player:l,type:$?"correct":"incorrect",interrupt:!0}),h($?"AI: Correct interrupt.":"AI: Incorrect interrupt.",$?"success":"error")}catch(t){console.error(t),h("AI check encountered an error.","error")}finally{Gt(!1),ht(!1),xt(""),gt(null),setTimeout(()=>yt(""),4e3)}}function _s(){Oe(t=>{const s=[...t],l=s[W]||{},i=Array.isArray(l.attempts)?l.attempts:[];return s[W]={...l,attempts:i,result:"no-answer",points:l.points||0},s}),Ne(null),Me(!1),ce([]),setTimeout(()=>Ee(),150)}function Ee(){const t=ne[W],s=le[W];t?.bonus&&t?.tossup&&s?.result==="correct"&&!ke[W]||(pt(l=>Math.min(l+1,ne.length)),ue(null),ce(["A","B"]))}function Us(){const t=Number(Es);if(!Number.isFinite(t)||t<0)return;const s=Math.min(10,Math.max(0,t)),l=le[W],i=l?.playerId&&Y.find(o=>o.id===l.playerId)?.team||"A";Ke(o=>{const n=[...o];return n[W]={points:s,team:i},n}),Je(""),setTimeout(()=>Ee(),100)}function qs(t){const s=le[t];if(!s)return!1;if(s.result==="replaced"||s.result==="no-answer"||s.result==="correct")return!0;if(Se&&re==="tossup"){const o=s.attempts||[],n=new Set(o.map(b=>b.playerId));return Y.filter(b=>b.status!=="replaced").filter(b=>!n.has(b.id)).length===0}const l=s.attempts||[];return new Set(l.map(o=>Y.find(n=>n.id===o.playerId)?.team).filter(Boolean)).size>=2&&s.result==="incorrect"}function Os(t){const s=t?10:0,l=le[W],i=l?.playerId&&Y.find(o=>o.id===l.playerId)?.team||"A";Ke(o=>{const n=[...o];return n[W]={points:s,team:i},n}),Ne(null),Me(!1),ue(null),ce(["A","B"]),pt(o=>Math.min(o+1,ne.length))}function Gs(){if(!ne[W])return;const s=new Set(ne.flatMap(o=>[o.tossup?.id,o.bonus?.id].filter(Boolean))),l=rt(),i=l.find(o=>!s.has(o.tossup?.id)&&!s.has(o.bonus?.id))||l[0];we(o=>o.map((n,d)=>d===W?i:n)),Oe(o=>{const n=[...o];return n[W]=void 0,n}),Ke(o=>{const n=[...o];return n[W]=void 0,n}),ue(null),ce(["A","B"]),Ne(null),Me(!1),ht(!1),xt(""),gt(null),h("Question replaced.","info")}const[Ws,Kt]=x.useState(!1);async function Hs(){Kt(!0);try{const t=await Fn(e.jsx(Yn,{sheetRows:Zs,players:Y,metadata:{generatedAt:new Date().toLocaleString()}})).toBlob(),s=URL.createObjectURL(t),l=document.createElement("a");l.href=s,l.download="Coaches-Scoresheet-"+new Date().toISOString().slice(0,10)+".pdf",document.body.appendChild(l),l.click(),setTimeout(()=>{URL.revokeObjectURL(s),l.remove()},1e3)}catch(t){console.error("Failed to export coaches scoresheet (react-pdf):",t),window.alert?.("Failed to export coaches scoresheet: "+(t.message||String(t)))}finally{Kt(!1)}}const Jt=25,[Vs,Qs]=x.useState(""),[Ce,vt]=x.useState(""),[Xs,Pe]=x.useState(!1),[Ys,Ge]=x.useState(!1),[Ae,et]=x.useState(null),[tt,Zt]=x.useState(!1),[Ks,kt]=x.useState(!1),[Re,Be]=x.useState(new Set),[$e,st]=x.useState(null),[nt,es]=x.useState(!1);x.useRef([]),x.useRef(null),X.useEffect(()=>{const t=()=>{try{const s=window.scrollY||document.documentElement.scrollTop||0;Ss(s>300)}catch{}};return window.addEventListener("scroll",t,{passive:!0}),t(),()=>window.removeEventListener("scroll",t)},[]);function rt(){const t=new Set;H.filter(i=>!ve.current.has(i));for(const i of H){const o=ve.current.get(i);if(o){const n=wn(o);for(const d of n)t.add(d)}}function s(i,o){if(i.length===0||o<=0)return[];const n=new Map;for(const G of i)n.has(G.category)||n.set(G.category,[]),n.get(G.category).push(G);let d=Array.from(n.keys());if(z.length){const G=new Set(z);d=d.filter(me=>G.has(me))}if(d=d.filter(G=>(n.get(G)?.length||0)>0),d.length===0)return[];const b=[...d].sort(()=>Math.random()-.5),k=Math.floor(o/b.length);let $=o%b.length;const S=[],I=new Set;for(let G=0;G<b.length;G++){const me=b[G],ge=[...n.get(me)];ge.sort(()=>Math.random()-.5);const Rt=Math.min(k+($>0?1:0),ge.length);$>0&&$--;for(let De=0;De<Rt;De++){const Qe=ge[De];I.has(Qe.id)||(S.push(Qe),I.add(Qe.id))}}if(S.length<o){const G=[];for(const me of d)for(const ge of n.get(me))I.has(ge.id)||G.push(ge);G.sort(()=>Math.random()-.5);for(const me of G){if(S.length>=o)break;S.push(me),I.add(me.id)}}return S.slice(0,o)}let l=[];if(re==="tossup"){const i=_.filter(n=>(v.length?v.includes(n.tournament):!0)&&N(n)&&n.question_type?.toLowerCase()==="tossup"&&!t.has(n.id)),o=i.length<=de?[...i]:s(i,de);for(let n=o.length-1;n>0;n--){const d=Math.floor(Math.random()*(n+1));[o[n],o[d]]=[o[d],o[n]]}l=o.map(n=>({tossup:n,bonus:null}))}else if(re==="bonus"){const i=_.filter(n=>(v.length?v.includes(n.tournament):!0)&&N(n)&&n.question_type?.toLowerCase()==="bonus"&&(Pt?!0:!ze(n))&&!t.has(n.id)),o=i.length<=de?[...i]:s(i,de);for(let n=o.length-1;n>0;n--){const d=Math.floor(Math.random()*(n+1));[o[n],o[d]]=[o[d],o[n]]}l=o.map(n=>({tossup:null,bonus:n}))}else if(re==="visual-bonus"){const i=_.filter(n=>(v.length?v.includes(n.tournament):!0)&&N(n)&&n.question_type?.toLowerCase()==="bonus"&&ze(n)&&!t.has(n.id)),o=i.length<=de?[...i]:s(i,de);for(let n=o.length-1;n>0;n--){const d=Math.floor(Math.random()*(n+1));[o[n],o[d]]=[o[d],o[n]]}l=o.map(n=>({tossup:null,bonus:n}))}else{const o=_.filter(d=>(v.length?v.includes(d.tournament):!0)&&N(d)&&d.question_type?.toLowerCase()==="tossup"&&!t.has(d.id)).filter(d=>{const b=rs(d,_);return!(!b||t.has(b.id)||!mt&&ze(b))}),n=o.length<=de?[...o]:s(o,de);for(let d=n.length-1;d>0;d--){const b=Math.floor(Math.random()*(d+1));[n[d],n[b]]=[n[b],n[d]]}l=n.map(d=>{const b=rs(d,_),k=b&&(mt||!ze(b))&&!t.has(b.id)?b:null;return{tossup:d,bonus:k}})}return l}X.useEffect(()=>{E&&v.length!==0&&p.ensureLoaded(v)},[E,p,v]);const Js=x.useMemo(()=>{const t=Ce.trim().toLowerCase();return t?_.filter(s=>[s.question,s.answer,s.category,s.tournament,s.round].some(i=>i!=null&&String(i).toLowerCase().includes(t))).map(s=>({tossup:s.question_type?.toLowerCase()==="tossup"?s:null,bonus:s.question_type?.toLowerCase()==="bonus"?s:null})):[]},[Ce,_]),ne=Ce.trim()&&he.length>0?Js:he,Zs=x.useMemo(()=>{const t=[];for(let i=0;i<Math.min(ne.length,Jt);i++){const o=ne[i],n=o.tossup,d=le[i],b=ke[i],k=n?Fe(n).length>0:!1,$=d?.attempts||[],S={A:$.filter(I=>Y.find(G=>G.id===I.playerId)?.team==="A"),B:$.filter(I=>Y.find(G=>G.id===I.playerId)?.team==="B")};t.push({index:i+1,subject:mn(n?.category||o.bonus?.category),type:k?"MC":"SA",attempts:$,byTeam:S,bonusA:b&&b.team==="A"?b.points:0,bonusB:b&&b.team==="B"?b.points:0,penaltyA:$.filter(I=>Y.find(G=>G.id===I.playerId)?.team==="A"&&(I.points||0)<0).reduce((I,G)=>I+Math.abs(G.points||0),0),penaltyB:$.filter(I=>Y.find(G=>G.id===I.playerId)?.team==="B"&&(I.points||0)<0).reduce((I,G)=>I+Math.abs(G.points||0),0),bonusAwardedTeam:b?.team||null})}for(;t.length<Jt;)t.push({pad:!0,index:t.length+1});let s=0,l=0;return t.forEach(i=>{if(i.pad){i.cumA=s,i.cumB=l;return}const o=(i.attempts||[]).filter(d=>Y.find(b=>b.id===d.playerId)?.team==="A").reduce((d,b)=>d+(b.points||0),0),n=(i.attempts||[]).filter(d=>Y.find(b=>b.id===d.playerId)?.team==="B").reduce((d,b)=>d+(b.points||0),0);s+=o+(i.bonusA||0),l+=n+(i.bonusB||0),i.cumA=s,i.cumB=l}),t},[ne,le,ke,Y]);async function Nt(t={}){const{force:s=!1}=t;if(Ce.trim())return;if(!xe&&!be&&!je){h("Select at least one question type (Toss-ups, Bonuses, or Visual bonuses).","error");return}if(hs(!0),!s&&he.length>0&&Xs){Ge(!0);return}const l=Number(de)>50;l&&_t(!0);try{try{E&&v.length>0&&await p.ensureLoaded(v)}catch{}console.group("RoundGenerator.generate"),console.log("Filters:",{selectedTournaments:v,selectedCategories:z,roundRanges:te,count:de,questionType:re});try{const o=Math.max(1,Number(de)||1);async function n(){const S=await jn({questionType:re,categories:z,count:o}).catch(()=>({roundId:null}));if(!(S?.roundId||null))return{pairs:[],tournaments:[]};const G=Array.isArray(S.pairs)?S.pairs:[];if(G.length===0)return{pairs:[],tournaments:[]};const me=new Set;for(const q of G){const at=q?.tossupMeta?.tournament;at&&me.add(at);const it=q?.bonusMeta?.tournament;it&&me.add(it)}const ge=Array.from(me);try{E&&ge.length&&await p.ensureLoaded(ge)}catch{}const Rt=E?p.getLoadedQuestions(ge):_,De=new Map(Rt.map(q=>[q.id,q])),Qe=new Set(z),ot=q=>!(!q||z.length&&!Qe.has(q.category));let Te=G.map(q=>({tossup:q.tossupId&&De.get(q.tossupId)||null,bonus:q.bonusId&&De.get(q.bonusId)||null}));return re==="tossup"?Te=Te.map(q=>q.tossup?{tossup:q.tossup,bonus:null}:null).filter(Boolean).filter(q=>ot(q.tossup)):re==="bonus"?Te=Te.map(q=>q.bonus?{tossup:null,bonus:q.bonus}:null).filter(Boolean).filter(q=>ot(q.bonus)).filter(q=>Pt?!0:!ze(q.bonus)):Te=Te.map(q=>{const at=ot(q.tossup),it=q.bonus?ot(q.bonus):!0,an=q.bonus?it&&(mt||!ze(q.bonus)):!0;return at?{tossup:q.tossup,bonus:an?q.bonus:null}:null}).filter(Boolean),{pairs:Te,tournaments:ge}}const d=[],b=new Set,k=S=>{let I="";re==="tossup"?I=S.tossup?.id?`tu:${S.tossup.id}`:"":re==="bonus"?I=S.bonus?.id?`bo:${S.bonus.id}`:"":I=S.tossup?.id?`tu:${S.tossup.id}`:S.bonus?.id?`bo:${S.bonus.id}`:"",!(!I||b.has(I))&&(b.add(I),d.push(S))};if((await n()).pairs.forEach(k),d.length>=o){const S=d.slice(0,o);typeof j=="function"?j(S):we(S),Pe(!0),console.groupEnd();return}if(d.length<o&&(await n()).pairs.forEach(k),d.length>=o){const S=d.slice(0,o);typeof j=="function"?j(S):we(S),Pe(!0),console.groupEnd();return}d.length>0&&h("Not enough preset questions matched filters; using normal generator.","info",5e3)}catch(o){console.warn("Preset round claim/materialization failed; falling back.",o)}const i=rt();typeof j=="function"?j(i):we(i),i.length===0&&h("No questions match the criteria provided.","error",5e3),Pe(!0),console.groupEnd()}finally{l&&_t(!1)}}async function ts(){if(!f?.user){window.alert?.("Please log in to save rounds.");return}Ut(!0);try{let t=he;if((!t||t.length===0)&&(t=rt(),we(t)),!t||t.length===0)return;const s=new Date,i={title:`Round at ${s.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})} on ${s.toLocaleDateString()}`,questionType:re,count:t.length,tournaments:v,categories:z,roundRanges:te,pairs:t.map(n=>({tossupId:n.tossup?.id||null,bonusId:n.bonus?.id||null,tossupMeta:n.tossup?{tournament:n.tossup.tournament,round:n.tossup.round,question_number:n.tossup.question_number,category:n.tossup.category}:null,bonusMeta:n.bonus?{tournament:n.bonus.tournament,round:n.bonus.round,question_number:n.bonus.question_number,category:n.bonus.category}:null}))},o=await vn(f.user.uid,i);se(n=>[{id:o,title:i.title,createdAt:{seconds:Math.floor(Date.now()/1e3)},count:i.count},...n]),h("Round saved to your account.","success"),Pe(!1)}catch(t){console.error(t),window.alert?.(`Failed to save round: ${t.message||String(t)}`),h(`Failed to save round: ${t.message||String(t)}`,"error",6e3)}finally{Ut(!1)}}async function en(){if(E&&v.length===0&&he.length===0&&(B?.length??0)===0){window.alert?.("Select at least one tournament to generate a PDF.");return}zt(!0);try{let t=[];if(Ce.trim()?t=ne:(t=he,(!t||t.length===0)&&(t=rt(),we(t),await new Promise(o=>requestAnimationFrame(()=>o())).then(()=>new Promise(o=>setTimeout(o,0))))),!t||t.length===0)return;const s=$t.current;if(!s)return;const l=await kn(),i={margin:[12,12,12,12],filename:`atombowl-Round-${new Date().toISOString().slice(0,10)}.pdf`,image:{type:"jpeg",quality:.95},html2canvas:{scale:2,useCORS:!0,letterRendering:!0,scrollY:0},pagebreak:{mode:["css","legacy"]},jsPDF:{unit:"mm",format:"letter",orientation:"portrait"}};await l().from(s).set(i).save()}finally{zt(!1)}}async function tn(t){try{if(!f?.user||!t?.id)return;const s=await us(f.user.uid,t.id).catch(()=>null);if(!s){h("Failed to open round details.","error");return}const l=new Set;for(const k of s.pairs||[])k?.tossupMeta?.tournament&&l.add(k.tossupMeta.tournament),k?.bonusMeta?.tournament&&l.add(k.bonusMeta.tournament);const i=Array.from(l);try{E&&i.length&&await p.ensureLoaded(i)}catch{}const o=E?p.getLoadedQuestions(i.length?i:v):_,n=new Map;for(const k of o)n.set(k.id,k);let d=(s.pairs||[]).map(k=>({tuId:k.tossupId||null,boId:k.bonusId||null,tossup:k.tossupId&&n.get(k.tossupId)||null,bonus:k.bonusId&&n.get(k.bonusId)||null}));if(d.some(k=>k.tuId&&!k.tossup||k.boId&&!k.bonus)){const k=E?p.getLoadedQuestions(Array.from(new Set([...i||[],...v]))):_,$=new Map;for(const S of k)$.set(S.id,S);d=d.map(S=>({...S,tossup:S.tossup||S.tuId&&$.get(S.tuId)||null,bonus:S.bonus||S.boId&&$.get(S.boId)||null}))}const b=d.map(({tossup:k,bonus:$})=>({tossup:k,bonus:$})).filter(k=>k.tossup||k.bonus);if(!b.length){h("Round questions are not available in the current dataset.","error");return}we(b),Pe(!1),vt("");try{Array.isArray(s.tournaments)&&s.tournaments.length&&P(s.tournaments),Array.isArray(s.categories)&&u(s.categories),s.roundRanges&&c(s.roundRanges),s.questionType&&Et(s.questionType)}catch{}Ze(),window.scrollTo({top:0,behavior:"smooth"}),h("Round opened.","success")}catch(s){h(s?.message||"Failed to open round.","error")}}X.useEffect(()=>{(async()=>{if(!((Z?.length||0)>0&&(he?.length||0)>0))try{const t=await pn();if(!Array.isArray(t)||t.length===0)return;const s=new Set;for(const S of t)for(const I of S||[])I?.tu?.tournament&&s.add(I.tu.tournament),I?.bo?.tournament&&s.add(I.bo.tournament);const l=Array.from(s);try{E&&l.length&&await p.ensureLoaded(l)}catch{}const i=E?p.getLoadedQuestions(l.length?l:v):_,o=new Map(i.map(S=>[S.id,S])),n=S=>(S||[]).map(I=>({tossup:I?.tu?.id&&o.get(I.tu.id)||null,bonus:I?.bo?.id&&o.get(I.bo.id)||null})).filter(I=>I.tossup||I.bonus),d=t.map(n).filter(S=>Array.isArray(S));if(d.length===0)return;const b=d[0]||[],k=d.slice(1);b.length>0&&we(b);const $=[...k,b].filter(S=>Array.isArray(S));$.length>0&&ys($)}catch{}})()},[E,p,_,v]);const[Le,sn]=x.useState(!1),[St,We]=x.useState(!1),[nn,rn]=x.useState(!0),[He,on]=x.useState(()=>{try{const t=localStorage.getItem("sb_leftPaneWidth_rounds"),s=Number(t);return Number.isFinite(s)&&s>=220&&s<=720?s:320}catch{return 320}}),Ve=X.useRef(!1),Ct=X.useRef(0),At=X.useRef(320);return X.useEffect(()=>{function t(l){if(!Ve.current)return;const o=(l.touches?l.touches[0].clientX:l.clientX)-Ct.current;let n=Math.round(At.current+o);n=Math.max(220,Math.min(720,n)),on(n)}function s(){if(Ve.current){Ve.current=!1;try{localStorage.setItem("sb_leftPaneWidth",String(He))}catch{}document.body.style.cursor="",document.body.style.userSelect=""}}return window.addEventListener("mousemove",t),window.addEventListener("mouseup",s),window.addEventListener("touchmove",t,{passive:!1}),window.addEventListener("touchend",s),()=>{window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",s),window.removeEventListener("touchmove",t),window.removeEventListener("touchend",s)}},[He]),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:`relative z-10 grid gap-6 max-w-[100vw] w-full overflow-x-hidden ${ae?"transition-all":""} md:[grid-template-columns:var(--left-pane-w)_minmax(0,1fr)]`,style:{...ae?{paddingRight:420}:{},"--left-pane-w":Le&&!St?"25px":`${He}px`},children:[e.jsxs("div",{className:`md:self-start ${ae?"hidden":""} relative`,children:[Le&&e.jsx("div",{className:"absolute inset-0 z-5",onMouseEnter:()=>We(!0),onMouseLeave:()=>We(!1)}),e.jsx(rr,{leftPaneCollapsed:Le,leftPanePinned:nn,leftPaneHovered:St,setLeftPaneCollapsed:sn,setLeftPanePinned:rn,setLeftPaneHovered:We}),e.jsxs("div",{className:`glass p-6 space-y-6 bg-white/80 dark:bg-darkcard/70 backdrop-blur min-w-0 transition-all duration-300 ${Le&&!St?"opacity-0 pointer-events-none scale-95":"opacity-100 scale-100"}`,onMouseEnter:()=>We(!0),onMouseLeave:()=>We(!1),children:[e.jsx(tr,{searchInput:Vs,setSearchInput:Qs,committedSearch:Ce,setCommittedSearch:vt,hasGenerated:he.length>0}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Question Types"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("label",{className:`chip cursor-pointer ${xe?"ring-1 ring-tint bg-tint/10":""}`,children:[e.jsx("input",{type:"checkbox",className:"mr-1",checked:xe,onChange:t=>ws(t.target.checked)})," Toss-ups"]}),e.jsxs("label",{className:`chip cursor-pointer ${be?"ring-1 ring-tint bg-tint/10":""}`,children:[e.jsx("input",{type:"checkbox",className:"mr-1",checked:be,onChange:t=>js(t.target.checked)})," Bonuses"]}),e.jsxs("label",{className:`chip cursor-pointer ${je?"ring-1 ring-tint bg-tint/10":""}`,title:"Bonuses that have associated visual images",children:[e.jsx("input",{type:"checkbox",className:"mr-1",checked:je,onChange:t=>vs(t.target.checked)})," Visual bonuses"]})]})]}),v.length===0&&e.jsxs("div",{role:"alert","aria-live":"polite",className:"flex items-start gap-2 rounded-lg border-l-4 border-amber-500 bg-amber-50 text-amber-900 dark:border-amber-400 dark:bg-amber-900/20 dark:text-amber-100 px-3 py-2",children:[e.jsx(En,{className:"mt-0.5 h-4 w-4 shrink-0"}),e.jsx("div",{className:"text-sm",children:"No tournaments selected."})]}),e.jsx(fn,{tournaments:A,tournamentGroups:T,selectedTournaments:v,setSelectedTournaments:P,tournamentGroupsOpen:C,setTournamentGroupsOpen:R,handleTournamentToggle:O,tournamentVisibleEntriesMainRef:F,isDark:As,showTournamentModal:m,setShowTournamentModal:g}),f?.user&&e.jsx(qn,{auth:f,roundsIndex:J,setRoundsIndex:se,roundFolders:_e,setRoundFolders:fe,loadingUserRounds:oe,refresh:dt,selectedExcludeRoundIds:H,setSelectedExcludeRoundIds:Ie,foldersOpen:ye,setFoldersOpen:V,handleExcludeRoundToggle:Xe,pushToast:h,setManagerSelection:Be,setShowRoundsManager:kt,setFolderDeleteTarget:st,setDeleteTarget:et,onViewRound:tn}),e.jsx(hn,{categories:K,selectedCategories:z,setSelectedCategories:u}),e.jsx(xn,{selectedTournaments:v,tournaments:A,roundRanges:te,setRoundRanges:c,roundsByTournament:a,globalNumericRoundMax:w}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"text-black dark:text-white",children:"Count"}),e.jsx("input",{type:"number",min:1,max:50,className:"w-24 rounded-lg border border-black/10 bg-white dark:bg-darkcard text-black dark:text-white px-2 py-1",value:de,onChange:t=>xs(Number(t.target.value))})]}),e.jsxs("div",{className:"pt-2 flex flex-wrap justify-center gap-4 w-full",children:[e.jsx("button",{className:"btn btn-fancy flex items-center gap-2 hover-lift disabled:opacity-50 disabled:cursor-not-allowed",onClick:Nt,disabled:Ft,style:{minWidth:140},children:Ft?e.jsxs("span",{className:"inline-flex items-center",children:[e.jsx("span",{className:"h-4 w-4 mr-2 inline-block animate-spin rounded-full border-2 border-current border-t-transparent","aria-hidden":"true"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 4V2m0 20v-2m7-7h-2M4 12H2m16.24-6.24l-1.42 1.42M6.34 17.66l-1.42 1.42M17.66 17.66l-1.42-1.42M6.34 6.34l-1.42-1.42M12 8a4 4 0 100 8 4 4 0 000-8z"})}),"Generate"]})}),f?.user?e.jsxs("button",{className:"btn btn-fancy flex items-center gap-2 hover-lift disabled:opacity-50 disabled:cursor-not-allowed",onClick:ts,disabled:Ye||he.length===0,style:{minWidth:140},children:[e.jsx(ls,{className:"h-5 w-5"}),Ye?"Saving…":"Save Round"]}):e.jsxs("button",{className:"btn btn-fancy flex items-center gap-2 hover-lift disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>window.alert?.("Log in to save rounds."),disabled:he.length===0,style:{minWidth:140},children:[e.jsx(ls,{className:"h-5 w-5"}),"Save Round"]}),e.jsx("button",{className:"btn btn-fancy hover-lift disabled:opacity-50 disabled:cursor-not-allowed",disabled:Dt,onClick:en,title:"Generate and export as PDF",children:Dt?e.jsxs("span",{className:"inline-flex items-center",children:[e.jsx("span",{className:"h-4 w-4 mr-2 inline-block animate-spin rounded-full border-2 border-current border-t-transparent","aria-hidden":"true"}),"Generating..."]}):e.jsxs("span",{className:"inline-flex items-center",children:[e.jsx(Pn,{className:"h-4 w-4 mr-1"})," Generate PDF"]})}),e.jsxs("button",{className:`btn flex items-center gap-2 hover-lift disabled:opacity-50 disabled:cursor-not-allowed ${ae?"btn-orange":"btn-fancy"}`,onClick:()=>{ae||Ze(),qt(t=>!t)},style:{minWidth:140},title:ae?"Close Scorekeeper":"Open Scorekeeper",disabled:he.length===0,children:[e.jsx($n,{className:"h-5 w-5"})," ",ae?"Close":"Scorekeeper"]})]}),Array.isArray(Z)&&Z.length>0&&e.jsxs("div",{className:"mt-3 flex items-center justify-center gap-3 text-sm",children:[e.jsx("button",{className:"chip px-2 py-1 disabled:opacity-50",onClick:()=>Mt((Ue??Z.length-1)-1),disabled:(Ue??Z.length-1)<=0,"aria-label":"Previous generated round",children:"◀ Prev"}),e.jsxs("div",{className:"opacity-80",children:["Round ",(Ue??Z.length-1)+1," of ",Z.length," (this session)"]}),e.jsx("button",{className:"chip px-2 py-1 disabled:opacity-50",onClick:()=>Mt((Ue??Z.length-1)+1),disabled:(Ue??Z.length-1)>=Z.length-1,"aria-label":"Next generated round",children:"Next ▶"})]})]}),!Le&&e.jsx("div",{role:"separator","aria-orientation":"vertical",title:"Drag to resize",onMouseDown:t=>{Le||(Ve.current=!0,Ct.current=t.clientX,At.current=He,document.body.style.cursor="col-resize",document.body.style.userSelect="none")},onTouchStart:t=>{if(Le)return;const s=t.touches?.[0];s&&(Ve.current=!0,Ct.current=s.clientX,At.current=He,document.body.style.cursor="col-resize",document.body.style.userSelect="none")},className:"hidden md:block absolute top-0 -right-5 h-full w-2 cursor-col-resize z-30 transition-colors",children:e.jsx("div",{className:"absolute inset-y-0 left-[-1px] right-[-1px] w-[1px] bg-gray-400 dark:bg-gray-500"})})]}),"  ",e.jsxs("div",{className:`${ae?"md:col-span-2":""} md:self-start space-y-4 min-w-0 overflow-x-hidden`,children:[null,ne.length===0&&e.jsx("div",{className:"glass p-6 bg-white/80 dark:bg-darkcard/70 backdrop-blur",role:"status","aria-live":"polite",children:Ce.trim()?"No matches found.":fs?"No questions match the criteria provided.":"No questions generated yet."}),ne.map((t,s)=>{const i=(!ae||s===W)&&(!ae||!t.tossup||le[s]?.result==="correct"||s<W),o=`${t.tossup?.id??"tu"}-${t.bonus?.id??"bo"}-${s}`;return e.jsx(Jn,{pair:t,index:s,scorekeeping:ae,currentIndex:W,tossupResults:le,showBonusContent:i,questionRef:n=>{Yt.current[s]=n}},o)})]}),ae&&e.jsx(sr,{headerOffset:jt,close:()=>qt(!1),currentIndex:W,displayPairs:ne,awaitingPlayer:ie,interruptArmed:Bs,setAwaitingPlayer:Ne,setInterruptArmed:Me,typedAnswerActive:ft,setTypedAnswerActive:ht,typedAnswerText:Ot,setTypedAnswerText:xt,typedAnswerPlayerId:bt,typedAnswerLoading:Ls,typedAnswerReason:Ts,checkTypedAnswer:Fs,isTossupFinal:qs,recordNoAnswer:_s,throwOutAndReplace:Gs,tossupResults:le,bonusResults:ke,saveFixedBonus:Os,players:Y,handleSeatClick:Ds,allowedTeams:wt,totalPoints:Ps,teamPoints:$s,saveBonusPoints:Us,subMode:Is,setSubMode:()=>{Qt(!0)},resetScorekeeping:Ze,exportCoachesScoresheetPdf:Hs,coachesSheetLoading:Ws,tryoutsMode:Se,setTryoutsMode:Ht,questionType:re}),e.jsx(er,{displayPairs:ne,QUESTIONS_PER_PAGE:ks,pdfRef:$t}),Ns&&e.jsxs("button",{type:"button",onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),"aria-label":"Back to top",className:"fixed bottom-6 right-6 z-40 inline-flex items-center gap-2 rounded-full bg-tint text-white shadow-lg px-4 py-2 hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-tint",children:[e.jsx(Dn,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Top"})]}),Ys&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>Ge(!1)}),e.jsxs("div",{className:"relative bg-white dark:bg-darkcard rounded-lg shadow-xl max-w-sm w-full p-6 space-y-4 border border-black/10 dark:border-white/10",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Unsaved round"}),e.jsx("p",{className:"text-sm leading-relaxed text-black/70 dark:text-white/70",children:"You already have a generated round that hasn't been saved. What would you like to do?"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{disabled:Ye,onClick:async()=>{await ts(),Ge(!1),Nt({force:!0})},className:"btn btn-primary w-full justify-center disabled:opacity-60",children:Ye?"Saving…":"Save & Generate New"}),e.jsx("button",{onClick:()=>{Ge(!1),console.log("Discarding unsaved round and generating new"),Nt({force:!0})},className:"btn btn-orange w-full justify-center",children:"Generate Without Saving"}),e.jsx("button",{onClick:()=>Ge(!1),className:"btn btn-ghost w-full justify-center",children:"Cancel"})]})]})]}),Ae&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>!tt&&et(null)}),e.jsxs("div",{className:"relative bg-white dark:bg-darkcard rounded-lg shadow-xl max-w-sm w-full p-6 space-y-5 border border-black/10 dark:border-white/10",children:[e.jsx("h2",{className:"text-lg font-semibold flex items-center gap-2 text-red-600 dark:text-red-300",children:"Delete Round"}),e.jsxs("div",{className:"text-sm leading-relaxed text-black/70 dark:text-white/70",children:["Are you sure you want to delete",e.jsxs("span",{className:"font-medium text-black dark:text-white",children:[" ",Ae.title||"this round"]}),"? This action cannot be undone."]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{disabled:tt,onClick:async()=>{if(!(!f?.user||!Ae)){Zt(!0);try{await ct(f.user.uid,Ae.id),se(t=>t.filter(s=>s.id!==Ae.id)),Ie(t=>t.filter(s=>s!==Ae.id)),ve.current.delete(Ae.id),et(null),h("Round deleted.","error")}catch(t){console.error(t),h(t?.message||"Failed to delete round.","error",6e3)}finally{Zt(!1)}}},className:"btn btn-orange w-full justify-center disabled:opacity-60",children:tt?"Deleting…":"Delete Permanently"}),e.jsx("button",{disabled:tt,onClick:()=>et(null),className:"btn btn-ghost w-full justify-center",children:"Cancel"})]})]})]}),$e&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>!nt&&st(null)}),e.jsxs("div",{className:"relative bg-white dark:bg-darkcard rounded-lg shadow-xl max-w-sm w-full p-6 space-y-5 border border-black/10 dark:border-white/10",children:[e.jsx("h2",{className:"text-lg font-semibold flex items-center gap-2 text-red-600 dark:text-red-300",children:"Delete Folder"}),e.jsxs("div",{className:"text-sm leading-relaxed text-black/70 dark:text-white/70",children:["Delete folder ",e.jsx("span",{className:"font-semibold text-black dark:text-white",children:$e.name})," and its ",$e.count," round(s)? This cannot be undone."]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{disabled:nt,onClick:async()=>{if(f?.user){es(!0);try{await ps($e.name,$e.roundIds),fe(t=>t.filter(s=>s!==$e.name)),Be(new Set),st(null)}finally{es(!1)}}},className:"btn btn-orange w-full justify-center disabled:opacity-60",children:nt?"Deleting…":"Delete Permanently"}),e.jsx("button",{disabled:nt,onClick:()=>st(null),className:"btn btn-ghost w-full justify-center",children:"Cancel"})]})]})]}),e.jsx(nr,{open:Ms,onClose:()=>{Qt(!1),Vt(!1)},players:Y,onSubmit:({team:t,playerId:s,newName:l})=>{qe(i=>{if(i.filter($=>$.team===t).length>=5)return i;const n=i.map($=>$.id===s?{...$,status:"replaced"}:$),d=n.filter($=>$.team===t).map($=>$.seat).filter(Boolean),b=Math.max(0,...d,4)+(d.includes(5)?0:1),k={id:Rs.current++,team:t,seat:b>5?b:5,name:l,status:"active",stats:{correct:0,incorrect:0,correctInterrupt:0,incorrectInterrupt:0}};return[...n,k]}),h(`Substitution: ${l} entered for Team ${t}.`,"success")}}),Ks&&e.jsxs("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>kt(!1)}),e.jsxs("div",{className:"relative bg-white dark:bg-darkcard rounded-lg shadow-xl max-w-3xl w-full p-6 space-y-4 border border-black/10 dark:border-white/10 flex flex-col max-h-[85vh]",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Manage Saved Rounds"}),e.jsx("button",{className:"btn btn-ghost btn-sm",onClick:()=>kt(!1),children:"Close"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{className:"chip px-3 py-1",onClick:()=>Be(new Set(J.map(t=>t.id))),children:"Select All"}),e.jsx("button",{className:"chip px-3 py-1",onClick:()=>Be(new Set),children:"Clear"}),e.jsx("button",{className:"chip px-3 py-1",onClick:()=>Be(t=>new Set(J.filter(s=>!t.has(s.id)).map(s=>s.id))),children:"Invert"}),e.jsx("button",{className:"chip px-3 py-1",onClick:()=>{Ie(Array.from(Re)),h("Excluded rounds updated.","success")},children:"Apply Exclusions"}),e.jsx("button",{className:"chip px-3 py-1 text-red-600 border-red-200 hover:bg-red-50 dark:text-red-300 dark:border-red-700 dark:hover:bg-red-900/30",onClick:async()=>{if(!f?.user)return;if(Re.size===0){h("No rounds selected.","error");return}if(!window.confirm(`Delete ${Re.size} selected round(s)? This cannot be undone.`))return;const t=Array.from(Re);let s=0;for(const l of t)try{await ct(f.user.uid,l),s++}catch{}se(l=>l.filter(i=>!Re.has(i.id))),Ie(l=>l.filter(i=>!Re.has(i))),Be(new Set),h(`Deleted ${s} round(s).`,"error")},children:"Delete Selected"})]}),e.jsx("div",{className:"flex-1 overflow-auto rounded border border-black/10 dark:border-white/10",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-black/5 dark:bg-white/10 backdrop-blur",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-3 py-2 w-10",children:"Sel"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Title"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Folder"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Count"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Created"})]})}),e.jsx("tbody",{children:J.map(t=>{const s=t.createdAt?.seconds?new Date(t.createdAt.seconds*1e3):null;return e.jsxs("tr",{className:"odd:bg-black/0 even:bg-black/5 dark:even:bg-white/5 hover:bg-tint/10",children:[e.jsx("td",{className:"px-3 py-1.5",children:e.jsx("input",{type:"checkbox",checked:Re.has(t.id),onChange:()=>Be(l=>{const i=new Set(l);return i.has(t.id)?i.delete(t.id):i.add(t.id),i})})}),e.jsx("td",{className:"px-3 py-1.5 truncate max-w-[280px]",title:t.title,children:t.title||"Untitled"}),e.jsx("td",{className:"px-3 py-1.5",children:t.folder||""}),e.jsx("td",{className:"px-3 py-1.5",children:t.count??""}),e.jsx("td",{className:"px-3 py-1.5 whitespace-nowrap",children:s?s.toLocaleDateString():""})]},t.id)})})]})})]})]}),e.jsx("div",{className:"fixed top-4 right-4 z-[60] flex flex-col gap-3 w-[min(92vw,360px)] pointer-events-none",children:M.map(t=>e.jsxs("div",{className:"group pointer-events-auto relative overflow-hidden rounded-md px-4 py-3 pr-10 text-sm shadow-lg flex items-start gap-3 animate-toast-enter "+(t.type==="success"?"bg-emerald-600 text-white":t.type==="error"?"bg-red-600 text-white":"bg-neutral-800 text-white"),role:"status","aria-live":"polite",children:[e.jsx("div",{className:"flex-1 break-words leading-relaxed",children:t.message}),e.jsx("button",{className:"absolute top-1.5 right-1.5 rounded p-1 text-white/70 hover:text-white hover:bg-white/10 transition-colors","aria-label":"Dismiss notification",onClick:()=>U(s=>s.filter(l=>l.id!==t.id)),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"h-4 w-4",children:e.jsx("path",{fillRule:"evenodd",d:"M4.22 4.22a.75.75 0 011.06 0L10 8.94l4.72-4.72a.75.75 0 111.06 1.06L11.06 10l4.72 4.72a.75.75 0 11-1.06 1.06L10 11.06l-4.72 4.72a.75.75 0 01-1.06-1.06L8.94 10 4.22 5.28a.75.75 0 010-1.06z",clipRule:"evenodd"})})}),e.jsx("span",{className:"absolute bottom-0 left-0 h-0.5 bg-white/70 group-hover:bg-white",style:{width:"100%",transformOrigin:"left",animation:`toast-bar-${t.id} ${t.ttl}ms linear forwards`}}),e.jsx("style",{children:`@keyframes toast-disappear { to { opacity:0; transform: translateY(-4px); } }
                @keyframes toast-enter { from { opacity:0; transform: translateY(-4px) scale(.98); } to { opacity:1; transform: translateY(0) scale(1); } }
                .animate-toast-enter { animation: toast-enter 160ms cubic-bezier(.4,0,.2,1); }
              `}),e.jsx("style",{children:`@keyframes toast-bar-${t.id} { from { transform: scaleX(1); } to { transform: scaleX(0); } }`})]},t.id))})]})})}export{Vo as default};
