import{b as i,j as s}from"./vendor-react-DpsG3A-O.js";import{g as I}from"./index-DLnuwQ1T.js";import{a as E,d as y,c as Q,b as U,u as B}from"./vendor-firebase-firestore-C-aRomGP.js";import{i as H}from"./visualBonuses-P43A_idX.js";import"./vendor-abs-svg-path-DCUpb6Nw.js";import"./vendor-react-dom-D1u-fJLi.js";import"./vendor-scheduler-CoSDG3-6.js";import"./vendor-firebase-BxSqqaym.js";import"./vendor-firebase-app-CZHFuJSY.js";import"./vendor-firebase-component-BsAoxdSC.js";import"./vendor-firebase-util-DLzrvjrQ.js";import"./vendor-firebase-logger-CNz1B4Yj.js";import"./vendor-idb-BXWtuYvb.js";import"./vendor-firebase-app-check-D4a6coeq.js";import"./vendor-firebase-storage-BvGgD_BW.js";import"./vendor-mui-material-DksXbHt-.js";import"./vendor-mui-utils-B23qfrSe.js";import"./vendor-clsx-B-dksMZM.js";import"./vendor-mui-system-BndTH9qf.js";import"./vendor-mui-styled-engine-CPmDJbkS.js";import"./vendor-emotion-styled-5vLscvJp.js";import"./vendor-babel-runtime-WXw8LxeR.js";import"./vendor-emotion-serialize-B6qc6euy.js";import"./vendor-emotion-hash-WldOFDRm.js";import"./vendor-emotion-unitless-x5IvBceT.js";import"./vendor-emotion-memoize-3S_6p140.js";import"./vendor-emotion-use-insertion-effect-with-fallbacks-B--OEmuQ.js";import"./vendor-emotion-utils-BijCJQMc.js";import"./vendor-emotion-is-prop-valid-DOnQZHJ6.js";import"./vendor-emotion-react-DrbGOuDy.js";import"./vendor-hoist-non-react-statics-mDtaWys7.js";import"./vendor-react-is-CnyDuYXe.js";import"./vendor-emotion-cache-DvsOMRO7.js";import"./vendor-emotion-sheet-6IwnyhEX.js";import"./vendor-stylis-DDa9OTMq.js";import"./vendor-react-transition-group-Q1VPUTjR.js";import"./vendor-react-router-dom-D-i9eXTo.js";import"./vendor-react-router-D4SgS1v_.js";import"./vendor-remix-run-router-9r-WWGj9.js";import"./vendor-react-helmet-async-bvMvt1Ax.js";import"./vendor-react-fast-compare-BCtOC5yC.js";import"./vendor-invariant-DW3JcdOx.js";import"./vendor-shallowequal-Df9Q-7bk.js";import"./vendor-lucide-react-Lx6fY6Gz.js";import"./vendor-firebase-webchannel-wrapper-QS5lB7L3.js";import"./vendor-katex-DP_4UPSs.js";const J="fkLJJ2R6HbdwqoXSxrLUybZ0IdH2";function Ls({auth:r}){const l=i.useMemo(()=>I(),[]),[m,j]=i.useState([]),[t,c]=i.useState(""),[a,d]=i.useState([]),[o,b]=i.useState(""),[_,g]=i.useState(!1),[N,p]=i.useState(null),[u,v]=i.useState(null),[L,S]=i.useState(!1),A=!!r?.user&&r.user.uid===J;i.useEffect(()=>{(async()=>{try{g(!0),p(null);const e=await E(y(l,"meta","tournaments")),n=e.exists()?e.data()?.list||[]:[];j(n)}catch(e){p(e)}finally{g(!1)}})()},[l]),i.useEffect(()=>{(async()=>{if(!t){d([]),b("");return}try{g(!0),p(null);const e=Q(l,"tournaments",t,"rounds"),n=await U(e),x=[];n.forEach(h=>x.push(h.id)),x.sort((h,w)=>String(h).localeCompare(String(w))),d(x),x.length&&!o&&b(x[0])}catch(e){p(e)}finally{g(!1)}})()},[l,t]),i.useEffect(()=>{(async()=>{if(!t||!o){v(null);return}try{g(!0),p(null);const e=y(l,"tournaments",t,"rounds",o),n=await E(e);v(n.exists()?n.data():{tossups:[],bonuses:[]})}catch(e){p(e),v(null)}finally{g(!1)}})()},[l,t,o]);async function T(){if(!(!A||!t||!o||!u))try{S(!0),p(null);const e=y(l,"tournaments",t,"rounds",o),n={};Array.isArray(u.tossups)&&(n.tossups=u.tossups),Array.isArray(u.bonuses)&&(n.bonuses=u.bonuses),await B(e,n),alert("Saved.")}catch(e){console.error(e),p(e),alert("Save failed: "+(e.message||String(e)))}finally{S(!1)}}function C(e,n,x,h){v(w=>{const f={...w||{}},k=Array.isArray(f[e])?[...f[e]]:[],D={...k[n]||{}};return D[x]=h,k[n]=D,f[e]=k,f})}return r?.user?A?s.jsxs("div",{className:"grid gap-4",children:[s.jsxs("div",{className:"glass p-4 flex flex-wrap gap-3 items-center",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-semibold mb-1",children:"Tournament"}),s.jsxs("select",{className:"select",value:t,onChange:e=>c(e.target.value),children:[s.jsx("option",{value:"",children:"Select tournament…"}),m.map(e=>s.jsx("option",{value:e,children:e},e))]})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-semibold mb-1",children:"Round"}),s.jsxs("select",{className:"select",value:o,onChange:e=>b(e.target.value),disabled:!t,children:[s.jsx("option",{value:"",children:"Select round…"}),a.map(e=>s.jsx("option",{value:e,children:e},e))]})]}),s.jsx("button",{className:"btn btn-primary",onClick:T,disabled:!u||L,children:"Save"}),_&&s.jsx("span",{className:"text-sm opacity-70",children:"Loading…"}),N&&s.jsx("span",{className:"text-sm text-red-600",children:String(N.message||N)})]}),u?s.jsxs("div",{className:"grid gap-4",children:[s.jsx(R,{type:"tossups",data:u.tossups||[],onChange:C}),s.jsx(R,{type:"bonuses",data:u.bonuses||[],onChange:C})]}):s.jsx("div",{className:"glass p-6",children:"Select a tournament and round."})]}):s.jsx("div",{className:"glass p-6 text-red-600",children:"Access denied. Admins only."}):s.jsx("div",{className:"glass p-6",children:"Please sign in."})}function R({type:r,data:l,onChange:m}){const j=r==="tossups"?"Toss-ups":"Bonuses";return s.jsxs("div",{className:"glass p-4",children:[s.jsxs("h2",{className:"font-semibold mb-3",children:[j," (",l.length,")"]}),s.jsx("div",{className:"grid gap-4",children:l.map((t,c)=>s.jsxs("div",{className:"rounded border border-black/10 dark:border-white/10 p-3",children:[s.jsxs("div",{className:"text-sm opacity-70 mb-2",children:["#",t?.question_number??c+1," • ",t?.category??"—"]}),s.jsxs("label",{className:"block mb-2",children:[s.jsx("div",{className:"text-xs uppercase tracking-wide mb-1",children:"Question"}),s.jsx("textarea",{className:"w-full min-h-[120px] rounded border p-2 bg-white dark:bg-darkcard",value:t?.question||"",onChange:a=>m(r,c,"question",a.target.value)})]}),s.jsxs("label",{className:"block mb-2",children:[s.jsx("div",{className:"text-xs uppercase tracking-wide mb-1",children:"Answer"}),s.jsx("textarea",{className:"w-full min-h-[60px] rounded border p-2 bg-white dark:bg-darkcard",value:t?.answer||"",onChange:a=>m(r,c,"answer",a.target.value)})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("label",{className:"block",children:[s.jsx("div",{className:"text-xs uppercase tracking-wide mb-1",children:"Category"}),s.jsx("input",{className:"w-full rounded border p-2 bg-white dark:bg-darkcard",value:t?.category||"",onChange:a=>m(r,c,"category",a.target.value)})]}),s.jsxs("label",{className:"block",children:[s.jsx("div",{className:"text-xs uppercase tracking-wide mb-1",children:"Question Number"}),s.jsx("input",{className:"w-full rounded border p-2 bg-white dark:bg-darkcard",value:t?.question_number??"",onChange:a=>m(r,c,"question_number",a.target.value)})]})]}),r==="bonuses"&&s.jsx("div",{className:"grid grid-cols-4 gap-2 mt-2",children:["w","x","y","z"].map(a=>s.jsxs("label",{className:"block",children:[s.jsx("div",{className:"text-xs uppercase tracking-wide mb-1",children:a.toUpperCase()}),s.jsx("input",{className:"w-full rounded border p-2 bg-white dark:bg-darkcard",value:t?.choices?.[a]??t?.[a]??"",onChange:d=>{const o=d.target.value,b={...t?.choices||{}};b[a]=o,m(r,c,"choices",b)}})]},a))}),r==="bonuses"&&s.jsx("div",{className:"mt-3",children:s.jsxs("label",{className:"inline-flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",className:"accent-tint",checked:(()=>{if(t&&(t.visual!=null||t.is_visual_bonus!=null)){const a=t.visual??t.is_visual_bonus;if(a===!0)return!0;const d=String(a??"").trim().toLowerCase();return d==="true"||d==="1"||d==="yes"||d==="y"}return H(t)})(),onChange:a=>{const o=a.target.checked?"true":"";m(r,c,"visual",o)}}),s.jsx("span",{className:"text-sm",children:"Visual bonus"})]})})]},c))})]})}export{Ls as default};
