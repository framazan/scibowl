import{r as O}from"./vendor-inherits-BICa84dG.js";import{r as q}from"./vendor-events-DQ172AOg.js";var f={exports:{}},g;function I(){if(g)return f.exports;g=1;var v=O(),p=q().EventEmitter;f.exports=i,f.exports.default=i;function i(t){if(!(this instanceof i))return new i(t);p.call(this),t=t||{},this.concurrency=t.concurrency||1/0,this.timeout=t.timeout||0,this.autostart=t.autostart||!1,this.results=t.results||null,this.pending=0,this.session=0,this.running=!1,this.jobs=[],this.timers={}}v(i,p);var y=["pop","shift","indexOf","lastIndexOf"];y.forEach(function(t){i.prototype[t]=function(){return Array.prototype[t].apply(this.jobs,arguments)}}),i.prototype.slice=function(t,e){return this.jobs=this.jobs.slice(t,e),this},i.prototype.reverse=function(){return this.jobs.reverse(),this};var b=["push","unshift","splice"];b.forEach(function(t){i.prototype[t]=function(){var e=Array.prototype[t].apply(this.jobs,arguments);return this.autostart&&this.start(),e}}),Object.defineProperty(i.prototype,"length",{get:function(){return this.pending+this.jobs.length}}),i.prototype.start=function(t){if(t&&x.call(this,t),this.running=!0,this.pending>=this.concurrency)return;if(this.jobs.length===0){this.pending===0&&c.call(this);return}var e=this,r=this.jobs.shift(),u=!0,s=this.session,n=null,m=!1,l=null,d=r.hasOwnProperty("timeout")?r.timeout:this.timeout;function h(o,E){u&&e.session===s&&(u=!1,e.pending--,n!==null&&(delete e.timers[n],clearTimeout(n)),o?e.emit("error",o,r):m===!1&&(l!==null&&(e.results[l]=Array.prototype.slice.call(arguments,1)),e.emit("success",E,r)),e.session===s&&(e.pending===0&&e.jobs.length===0?c.call(e):e.running&&e.start()))}d&&(n=setTimeout(function(){m=!0,e.listeners("timeout").length>0?e.emit("timeout",h,r):h()},d),this.timers[n]=n),this.results&&(l=this.results.length,this.results[l]=null),this.pending++,e.emit("start",r);var a=r(h);a&&a.then&&typeof a.then=="function"&&a.then(function(o){return h(null,o)}).catch(function(o){return h(o||!0)}),this.running&&this.jobs.length>0&&this.start()},i.prototype.stop=function(){this.running=!1},i.prototype.end=function(t){j.call(this),this.jobs.length=0,this.pending=0,c.call(this,t)};function j(){for(var t in this.timers){var e=this.timers[t];delete this.timers[t],clearTimeout(e)}}function x(t){var e=this;this.on("error",r),this.on("end",u);function r(s){e.end(s)}function u(s){e.removeListener("error",r),e.removeListener("end",u),t(s,this.results)}}function c(t){this.session++,this.running=!1,this.emit("end",t)}return f.exports}I();
