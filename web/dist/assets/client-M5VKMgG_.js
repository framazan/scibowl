import{r as g,j as e}from"./vendor-react-DpsG3A-O.js";import{k as X,l as _,b as J,L as Y}from"./vendor-lucide-react-Lx6fY6Gz.js";import{m as G}from"./index-DLnuwQ1T.js";function D(t){return Array.from(new Set(t))}function re(t,i){return t?i.find(o=>o.question_type?.toLowerCase()==="bonus"&&o.round===t.round&&o.tournament===t.tournament&&o.question_number===t.question_number):null}function le(t){if(!t)return[];const i=["w","x","y","z"],o=c=>{if(c==null)return null;const h=String(c).replace(/[.)\s]/g,"").toLowerCase()[0];return i.includes(h)?h:null},r=c=>c==null?null:typeof c=="string"||typeof c=="number"?String(c):typeof c=="object"?c.text??c.value??c.choice??c.content??c.answer??c.option??c.label??c.name??null:null;let j=t.choices??null;if(!j){const c={w:t.w??t.W,x:t.x??t.X,y:t.y??t.Y,z:t.z??t.Z};if(Object.values(c).some(S=>S!=null&&String(S).trim()!==""))j=c;else return[]}if(Array.isArray(j)){const c=j.slice(0,4).map((h,B)=>{const A=r(h);return A?[i[B],A]:null}).filter(Boolean),S=new Map(c);return i.map(h=>[h,S.get(h)]).filter(([,h])=>h!=null)}if(j&&typeof j=="object"){const c=Object.entries(j).map(([h,B])=>{const A=r(B),W=o(h);return!A||!W?null:[W,A]}).filter(Boolean),S=new Map(c);return i.map(h=>[h,S.get(h)]).filter(([,h])=>h!=null)}return[]}function ae(t){if(!t)return"";const i=String(t).toUpperCase();return i.startsWith("PHYS")?"P":i.startsWith("CHEM")?"C":i.startsWith("BIO")?"B":i.startsWith("MATH")?"M":i.startsWith("EARTH")?"E":i.startsWith("ASTRO")?"A":i.startsWith("ENERG")?"EN":i.startsWith("GEN")?"G":i[0]}async function ie(){return typeof window<"u"&&window.html2pdf||await new Promise((t,i)=>{const o=document.querySelector("script[data-html2pdf]");if(o){o.addEventListener("load",()=>t()),o.addEventListener("error",()=>i(new Error("Failed to load html2pdf.js")));return}const r=document.createElement("script");r.src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js",r.async=!0,r.defer=!0,r.setAttribute("data-html2pdf","true"),r.onload=()=>t(),r.onerror=()=>i(new Error("Failed to load html2pdf.js")),document.head.appendChild(r)}),window.html2pdf}function ce({questions:t=[],lazy:i=null}){const o=!!i,[r,j]=g.useState([]),[c,S]=g.useState([]),[h,B]=g.useState(()=>new Set),A=g.useMemo(()=>[...o?i.tournaments||[]:D(t.map(a=>a.tournament))].filter(Boolean).sort((a,d)=>String(a).localeCompare(String(d))),[o,i,t]),W=g.useRef([]),p=g.useRef([]),U=g.useRef(null),n=g.useRef(null);function v(l,a,d="main"){const b=l?.nativeEvent?.shiftKey||l?.shiftKey,m=(d==="modal"?p.current:W.current)||[],y=m.findIndex(C=>C?.type==="key"&&C.key===a),k=r.includes(a),F=!k,O=d==="modal"?n:U;if(b&&O.current!=null&&y!==-1&&O.current!==y){const[C,K]=[O.current,y].sort((x,z)=>x-z),$=m.slice(C,K+1),P=[],I=new Set($.filter(x=>x&&x.type==="key"&&x.base).map(x=>x.base));$.forEach(x=>{x&&(x.type==="key"&&x.key?P.push(x.key):x.type==="group"&&Array.isArray(x.keys)&&(I.has(x.base)||x.keys.forEach(z=>P.push(z))))}),j(x=>{const z=new Set(x);return F?P.forEach(H=>z.add(H)):P.forEach(H=>z.delete(H)),Array.from(z)}),O.current=y}else j(C=>{const K=new Set(C);return k?K.delete(a):K.add(a),Array.from(K)}),O.current=y}const M=g.useMemo(()=>{const l=new Map;for(const a of A){if(!a)continue;const[d,b]=String(a).split("-"),m=d||a,y=b&&/\d{4}/.test(b)?b:null;l.has(m)||l.set(m,{base:m,years:[],all:[]});const k=l.get(m);k.all.push(a),y?k.years.push({label:a,year:Number(y)||y,key:a}):k.years.push({label:a,year:null,key:a})}for(const a of l.values())a.years.sort((d,b)=>String(d.label).localeCompare(String(b.label)));return Array.from(l.values()).sort((a,d)=>a.base.localeCompare(d.base))},[A]);g.useEffect(()=>{o&&r.length!==0&&i.ensureLoaded(r)},[o,i,r]);const N=g.useMemo(()=>(o?i.getLoadedQuestions(r):t).map(l=>{let a=l.category;if(typeof a=="string"){const d=a.trim();a=d?d.toUpperCase():null}return{...l,category:a}}),[o,i,r,t]),L=g.useMemo(()=>N.filter(l=>l.category!=null&&String(l.category).trim()!==""),[N]),u=g.useMemo(()=>D(L.map(l=>l.category)),[L]),[s,f]=g.useState([]),w=g.useMemo(()=>{const l=new Map,a=N;for(const b of a){const m=b.tournament,y=b.round;if(m==null||y==null)continue;const k=l.get(m)??[],F=String(y);k.includes(F)||k.push(F),l.set(m,k)}const d={};for(const[b,m]of l.entries())d[b]=[...m].sort((y,k)=>String(y).localeCompare(String(k)));return d},[N]),E=g.useMemo(()=>{let l=0;for(const a of N){const d=a.round;if(d!=null&&/^\d+$/.test(String(d))){const b=Number(d);b>l&&(l=b)}}return l||30},[N]);g.useEffect(()=>{if(r.length===1){const l=r[0];f(a=>{let d=!1;const b=a.map(m=>m.tournament!==l?(d=!0,{...m,tournament:l}):m);return d?b:a})}},[r]);function R(l){return!s.length||l?.round==null?!0:s.some(({from:a,to:d,tournament:b,dFrom:m,dTo:y})=>{const k=r.length===1?r[0]:b||null;if(!(!k||l.tournament===k))return!1;if(k){const C=w[k]??[];if(C.length>0&&C.every($=>/^\d+$/.test($))){const $=Number(l.round);return $>=Number(a)&&$<=Number(d)}else{if(!C.length)return!0;const $=C.indexOf(String(l.round));if($===-1)return!1;const P=m?C.indexOf(m):0,I=y?C.indexOf(y):C.length-1,[x,z]=[P,I].sort((H,V)=>H-V);return $>=x&&$<=z}}const O=Number(l.round);return Number.isNaN(O)?!1:O>=Number(a)&&O<=Number(d)})}return{isLazy:o,tournaments:A,tournamentGroups:M,selectedTournaments:r,setSelectedTournaments:j,selectedCategories:c,setSelectedCategories:S,tournamentGroupsOpen:h,setTournamentGroupsOpen:B,tournamentVisibleEntriesMainRef:W,tournamentVisibleEntriesModalRef:p,lastTournamentClickIndexMainRef:U,lastTournamentClickIndexModalRef:n,handleTournamentToggle:v,loadedQuestions:N,validQuestions:L,categories:u,roundRanges:s,setRoundRanges:f,roundsByTournament:w,globalNumericRoundMax:E,inRanges:R}}function Q(t){if(!t)return!1;try{return String(t).split("-")[0].toLowerCase()==="ms"}catch{return!1}}function oe({tournaments:t,tournamentGroups:i,selectedTournaments:o,setSelectedTournaments:r,tournamentGroupsOpen:j,setTournamentGroupsOpen:c,handleTournamentToggle:S,tournamentVisibleEntriesMainRef:h,isDark:B,showTournamentModal:A,setShowTournamentModal:W}){return e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold mb-2 flex items-center flex-wrap gap-2",children:["Tournaments",e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Clear selection",onClick:()=>r([]),children:"Clear"}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Select all",onClick:()=>r((t||[]).filter(p=>!Q(p))),children:"Select All"}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs inline-flex items-center gap-1","aria-label":"Expand tournament list",title:"Expand to modal",onClick:()=>W(!0),children:e.jsx(X,{size:14})})]}),e.jsx("div",{className:"border rounded-lg max-h-56 overflow-y-auto overflow-x-hidden",children:e.jsx("ul",{role:"tree",className:"divide-y divide-black/5 dark:divide-white/10",children:(()=>{const p=[],U=i.map(n=>{const v=n.all.length>1,M=v&&j.has(n.base),N=n.all.every(s=>o.includes(s)),L=!N&&n.all.some(s=>o.includes(s));let u={};if(v){const s=n.all.filter(R=>o.includes(R)).length,f=n.all.length>0?s/n.all.length:0,w=Math.pow(f,.85),E=120*w;if(s>0)if(B){const R=28+w*8;u={backgroundColor:`hsl(${E.toFixed(0)} 60% ${R}%)`,color:"#fff"}}else{const R=92-w*8;u={backgroundColor:`hsl(${E.toFixed(0)} 70% ${R}%)`}}}if(!v){const s=n.all[0],f=o.includes(s);return p.push({type:"key",key:s,base:n.base}),e.jsx("li",{role:"treeitem",className:"select-none",children:e.jsxs("label",{className:"flex items-center gap-2 px-2 py-1.5 rounded cursor-pointer min-w-0 "+(f?"bg-blue-100 dark:bg-blue-900/40":"hover:bg-black/5 dark:hover:bg-white/10"),children:[e.jsx("span",{className:"inline-block w-5 shrink-0","aria-hidden":"true"}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("input",{type:"checkbox",className:"accent-tint",checked:f,onChange:w=>S(w,s,"main")}),e.jsx("span",{className:"font-medium truncate min-w-0",title:s,children:s})]})]})},n.base)}return e.jsxs("li",{role:"treeitem","aria-expanded":M,className:"select-none",children:[e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1.5 rounded min-w-0 "+(v?"transition-colors ":"")+(v&&(L||N)?"":"hover:bg-black/5 dark:hover:bg-white/10"),style:u,children:[v&&e.jsx("button",{type:"button",className:"shrink-0 p-0.5 rounded hover:bg-black/10 dark:hover:bg-white/10",onClick:()=>c(s=>{const f=new Set(s);return f.has(n.base)?f.delete(n.base):f.add(n.base),f}),"aria-label":M?"Collapse":"Expand",children:M?e.jsx(_,{size:16}):e.jsx(J,{size:16})}),e.jsx("input",{type:"checkbox",className:"accent-tint",checked:N,ref:s=>{s&&(s.indeterminate=L)},onChange:s=>{const f=s.target.checked||L;r(w=>{const E=new Set(w);return f?n.all.forEach(R=>E.add(R)):n.all.forEach(R=>E.delete(R)),Array.from(E)})}}),e.jsx("span",{className:"font-medium truncate",title:n.base,children:`${n.base} (${n.all.length})`})]}),(p.push({type:"group",base:n.base,keys:n.all}),null),M&&e.jsx("ul",{role:"group",className:"pl-10 py-1 overflow-x-hidden min-w-0",children:n.years.map(s=>{const f=o.includes(s.key);return p.push({type:"key",key:s.key,base:n.base}),e.jsx("li",{role:"treeitem","aria-selected":f,className:"px-2 min-w-0 text-xs",children:e.jsxs("label",{className:"flex items-center gap-2 px-2 py-1 rounded cursor-pointer min-w-0 "+(f?"bg-blue-100 dark:bg-blue-900/40":"hover:bg-black/5 dark:hover:bg-white/10"),children:[e.jsx("input",{type:"checkbox",className:"accent-tint",checked:f,onChange:w=>S(w,s.key,"main")}),e.jsx("span",{className:"truncate min-w-0",title:s.label,children:s.label})]})},s.key)})})]},n.base)});return h.current=p,U})()})}),A&&e.jsxs("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>W(!1)}),e.jsxs("div",{className:"relative bg-white dark:bg-darkcard rounded-lg shadow-xl max-w-3xl w-full p-6 space-y-4 border border-black/10 dark:border-white/10 flex flex-col max-h-[85vh]",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Select Tournaments"}),e.jsx("button",{className:"btn btn-ghost btn-sm",onClick:()=>W(!1),children:"Close"})]}),e.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Clear selection",onClick:()=>r([]),children:"Clear"}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Select all",onClick:()=>r((t||[]).filter(p=>!Q(p))),children:"Select All"}),e.jsxs("button",{className:"chip px-2 py-0.5 text-xs inline-flex items-center gap-1","aria-label":"Expand all groups",title:"Expand all groups",onClick:()=>c(new Set(i.filter(p=>p.all.length>1).map(p=>p.base))),children:[e.jsx(Y,{size:15}),e.jsx(J,{size:15})]}),e.jsxs("button",{className:"chip px-2 py-0.5 text-xs inline-flex items-center gap-1","aria-label":"Collapse all groups",title:"Collapse all groups",onClick:()=>c(new Set),children:[e.jsx(Y,{size:15}),e.jsx(_,{size:15})]})]}),e.jsx("div",{className:"border rounded-lg max-h-[65vh] overflow-y-auto overflow-x-hidden",children:e.jsx("ul",{role:"tree",className:"divide-y divide-black/5 dark:divide-white/10",children:(()=>{const p=[];return i.map(n=>{const v=n.all.length>1,M=v&&j.has(n.base),N=n.all.every(u=>o.includes(u)),L=!N&&n.all.some(u=>o.includes(u));return e.jsxs("li",{role:"treeitem","aria-expanded":M,className:"select-none",children:[e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1.5 rounded min-w-0 "+(v?"transition-colors ":""),children:[v&&e.jsx("button",{type:"button",className:"shrink-0 p-0.5 rounded hover:bg-black/10 dark:hover:bg-white/10",onClick:()=>c(u=>{const s=new Set(u);return s.has(n.base)?s.delete(n.base):s.add(n.base),s}),"aria-label":M?"Collapse":"Expand",children:M?e.jsx(_,{size:16}):e.jsx(J,{size:16})}),e.jsx("input",{type:"checkbox",className:"accent-tint",checked:N,ref:u=>{u&&(u.indeterminate=L)},onChange:u=>{const s=u.target.checked||L;r(f=>{const w=new Set(f);return s?n.all.forEach(E=>w.add(E)):n.all.forEach(E=>w.delete(E)),Array.from(w)})}}),e.jsx("span",{className:"font-medium truncate",title:n.base,children:`${n.base} (${n.all.length})`})]}),M&&e.jsx("ul",{role:"group",className:"pl-10 py-1 overflow-x-hidden min-w-0",children:n.years.map(u=>{const s=o.includes(u.key);return p.push({type:"key",key:u.key,base:n.base}),e.jsx("li",{role:"treeitem","aria-selected":s,className:"px-2 min-w-0 text-xs",children:e.jsxs("label",{className:`flex items-center gap-2 px-2 py-1 rounded cursor-pointer min-w-0 ${s?"bg-blue-100 dark:bg-blue-900/40":"hover:bg-black/5 dark:hover:bg-white/10"}`,children:[e.jsx("input",{type:"checkbox",className:"accent-tint",checked:s,onChange:f=>S(f,u.key,"modal")}),e.jsx("span",{className:"truncate min-w-0",title:u.label,children:u.label})]})},u.key)})})]},n.base)})})()})})]})]}),e.jsx("div",{className:"mt-2 text-[11px] text-gray-500 dark:text-gray-400",children:" * Select All does not include MS rounds."})]})}const Z="vertex-gateway-7e74h6s4.uc.gateway.dev",q="AIzaSyBxfXewuANeaSgDisu5U4cD1JF70VJuP_U";function ee(t){const i=`https://${Z}`,o=t.startsWith("/")?t:`/${t}`,r=new URL(i+o);return r.searchParams.set("key",q),r.toString()}async function T(t,i){const o=ee(t),r={"Content-Type":"application/json"};try{const c=await G();c&&(r["X-Firebase-AppCheck"]=c)}catch{}return await fetch(o,{method:"POST",headers:r,body:JSON.stringify(i??{})})}async function de(t){return T("/checkAnswerMC",t)}async function ue(t){return T("/checkAnswerBonus",t)}export{oe as T,ue as a,ae as b,de as c,re as f,ie as l,le as p,ce as u};
