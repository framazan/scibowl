import{r as k,j as e}from"./vendor-react-DpsG3A-O.js";import{k as Z,l as U,b as _,L as V}from"./vendor-lucide-react-Lx6fY6Gz.js";function Y(l){return Array.from(new Set(l))}function T(l,a){return l?a.find(o=>o.question_type?.toLowerCase()==="bonus"&&o.round===l.round&&o.tournament===l.tournament&&o.question_number===l.question_number):null}function q(l){if(!l)return[];const a=["w","x","y","z"],o=c=>{if(c==null)return null;const h=String(c).replace(/[.)\s]/g,"").toLowerCase()[0];return a.includes(h)?h:null},i=c=>c==null?null:typeof c=="string"||typeof c=="number"?String(c):typeof c=="object"?c.text??c.value??c.choice??c.content??c.answer??c.option??c.label??c.name??null:null;let j=l.choices??null;if(!j){const c={w:l.w??l.W,x:l.x??l.X,y:l.y??l.Y,z:l.z??l.Z};if(Object.values(c).some(S=>S!=null&&String(S).trim()!==""))j=c;else return[]}if(Array.isArray(j)){const c=j.slice(0,4).map((h,O)=>{const M=i(h);return M?[a[O],M]:null}).filter(Boolean),S=new Map(c);return a.map(h=>[h,S.get(h)]).filter(([,h])=>h!=null)}if(j&&typeof j=="object"){const c=Object.entries(j).map(([h,O])=>{const M=i(O),W=o(h);return!M||!W?null:[W,M]}).filter(Boolean),S=new Map(c);return a.map(h=>[h,S.get(h)]).filter(([,h])=>h!=null)}return[]}function ee(l){if(!l)return"";const a=String(l).toUpperCase();return a.startsWith("PHYS")?"P":a.startsWith("CHEM")?"C":a.startsWith("BIO")?"B":a.startsWith("MATH")?"M":a.startsWith("EARTH")?"E":a.startsWith("ASTRO")?"A":a.startsWith("ENERG")?"EN":a.startsWith("GEN")?"G":a[0]}async function te(){return typeof window<"u"&&window.html2pdf||await new Promise((l,a)=>{const o=document.querySelector("script[data-html2pdf]");if(o){o.addEventListener("load",()=>l()),o.addEventListener("error",()=>a(new Error("Failed to load html2pdf.js")));return}const i=document.createElement("script");i.src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js",i.async=!0,i.defer=!0,i.setAttribute("data-html2pdf","true"),i.onload=()=>l(),i.onerror=()=>a(new Error("Failed to load html2pdf.js")),document.head.appendChild(i)}),window.html2pdf}function ne({questions:l=[],lazy:a=null}){const o=!!a,[i,j]=k.useState([]),[c,S]=k.useState([]),[h,O]=k.useState(()=>new Set),M=k.useMemo(()=>[...o?a.tournaments||[]:Y(l.map(r=>r.tournament))].filter(Boolean).sort((r,d)=>String(r).localeCompare(String(d))),[o,a,l]),W=k.useRef([]),p=k.useRef([]),P=k.useRef(null),t=k.useRef(null);function v(s,r,d="main"){const b=s?.nativeEvent?.shiftKey||s?.shiftKey,m=(d==="modal"?p.current:W.current)||[],y=m.findIndex(C=>C?.type==="key"&&C.key===r),g=i.includes(r),F=!g,z=d==="modal"?t:P;if(b&&z.current!=null&&y!==-1&&z.current!==y){const[C,B]=[z.current,y].sort((x,K)=>x-K),$=m.slice(C,B+1),H=[],Q=new Set($.filter(x=>x&&x.type==="key"&&x.base).map(x=>x.base));$.forEach(x=>{x&&(x.type==="key"&&x.key?H.push(x.key):x.type==="group"&&Array.isArray(x.keys)&&(Q.has(x.base)||x.keys.forEach(K=>H.push(K))))}),j(x=>{const K=new Set(x);return F?H.forEach(I=>K.add(I)):H.forEach(I=>K.delete(I)),Array.from(K)}),z.current=y}else j(C=>{const B=new Set(C);return g?B.delete(r):B.add(r),Array.from(B)}),z.current=y}const A=k.useMemo(()=>{const s=new Map;for(const r of M){if(!r)continue;const[d,b]=String(r).split("-"),m=d||r,y=b&&/\d{4}/.test(b)?b:null;s.has(m)||s.set(m,{base:m,years:[],all:[]});const g=s.get(m);g.all.push(r),y?g.years.push({label:r,year:Number(y)||y,key:r}):g.years.push({label:r,year:null,key:r})}for(const r of s.values())r.years.sort((d,b)=>String(d.label).localeCompare(String(b.label)));return Array.from(s.values()).sort((r,d)=>r.base.localeCompare(d.base))},[M]);k.useEffect(()=>{o&&i.length!==0&&a.ensureLoaded(i)},[o,a,i]);const N=k.useMemo(()=>(o?a.getLoadedQuestions(i):l).map(s=>{let r=s.category;if(typeof r=="string"){const d=r.trim();r=d?d.toUpperCase():null}return{...s,category:r}}),[o,a,i,l]),L=k.useMemo(()=>N.filter(s=>s.category!=null&&String(s.category).trim()!==""),[N]),u=k.useMemo(()=>Y(L.map(s=>s.category)),[L]),[n,f]=k.useState([]),w=k.useMemo(()=>{const s=new Map,r=N;for(const b of r){const m=b.tournament,y=b.round;if(m==null||y==null)continue;const g=s.get(m)??[],F=String(y);g.includes(F)||g.push(F),s.set(m,g)}const d={};for(const[b,m]of s.entries())d[b]=[...m].sort((y,g)=>String(y).localeCompare(String(g)));return d},[N]),E=k.useMemo(()=>{let s=0;for(const r of N){const d=r.round;if(d!=null&&/^\d+$/.test(String(d))){const b=Number(d);b>s&&(s=b)}}return s||30},[N]);k.useEffect(()=>{if(i.length===1){const s=i[0];f(r=>{let d=!1;const b=r.map(m=>m.tournament!==s?(d=!0,{...m,tournament:s}):m);return d?b:r})}},[i]);function R(s){return!n.length||s?.round==null?!0:n.some(({from:r,to:d,tournament:b,dFrom:m,dTo:y})=>{const g=i.length===1?i[0]:b||null;if(!(!g||s.tournament===g))return!1;if(g){const C=w[g]??[];if(C.length>0&&C.every($=>/^\d+$/.test($))){const $=Number(s.round);return $>=Number(r)&&$<=Number(d)}else{if(!C.length)return!0;const $=C.indexOf(String(s.round));if($===-1)return!1;const H=m?C.indexOf(m):0,Q=y?C.indexOf(y):C.length-1,[x,K]=[H,Q].sort((I,X)=>I-X);return $>=x&&$<=K}}const z=Number(s.round);return Number.isNaN(z)?!1:z>=Number(r)&&z<=Number(d)})}return{isLazy:o,tournaments:M,tournamentGroups:A,selectedTournaments:i,setSelectedTournaments:j,selectedCategories:c,setSelectedCategories:S,tournamentGroupsOpen:h,setTournamentGroupsOpen:O,tournamentVisibleEntriesMainRef:W,tournamentVisibleEntriesModalRef:p,lastTournamentClickIndexMainRef:P,lastTournamentClickIndexModalRef:t,handleTournamentToggle:v,loadedQuestions:N,validQuestions:L,categories:u,roundRanges:n,setRoundRanges:f,roundsByTournament:w,globalNumericRoundMax:E,inRanges:R}}function D(l){if(!l)return!1;try{return String(l).split("-")[0].toLowerCase()==="ms"}catch{return!1}}function se({tournaments:l,tournamentGroups:a,selectedTournaments:o,setSelectedTournaments:i,tournamentGroupsOpen:j,setTournamentGroupsOpen:c,handleTournamentToggle:S,tournamentVisibleEntriesMainRef:h,isDark:O,showTournamentModal:M,setShowTournamentModal:W}){return e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold mb-2 flex items-center flex-wrap gap-2",children:["Tournaments",e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Clear selection",onClick:()=>i([]),children:"Clear"}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Select all",onClick:()=>i((l||[]).filter(p=>!D(p))),children:"Select All"}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs inline-flex items-center gap-1","aria-label":"Expand tournament list",title:"Expand to modal",onClick:()=>W(!0),children:e.jsx(Z,{size:14})})]}),e.jsx("div",{className:"border rounded-lg max-h-56 overflow-y-auto overflow-x-hidden",children:e.jsx("ul",{role:"tree",className:"divide-y divide-black/5 dark:divide-white/10",children:(()=>{const p=[],P=a.map(t=>{const v=t.all.length>1,A=v&&j.has(t.base),N=t.all.every(n=>o.includes(n)),L=!N&&t.all.some(n=>o.includes(n));let u={};if(v){const n=t.all.filter(R=>o.includes(R)).length,f=t.all.length>0?n/t.all.length:0,w=Math.pow(f,.85),E=120*w;if(n>0)if(O){const R=28+w*8;u={backgroundColor:`hsl(${E.toFixed(0)} 60% ${R}%)`,color:"#fff"}}else{const R=92-w*8;u={backgroundColor:`hsl(${E.toFixed(0)} 70% ${R}%)`}}}if(!v){const n=t.all[0],f=o.includes(n);return p.push({type:"key",key:n,base:t.base}),e.jsx("li",{role:"treeitem",className:"select-none",children:e.jsxs("label",{className:"flex items-center gap-2 px-2 py-1.5 rounded cursor-pointer min-w-0 "+(f?"bg-blue-100 dark:bg-blue-900/40":"hover:bg-black/5 dark:hover:bg-white/10"),children:[e.jsx("span",{className:"inline-block w-5 shrink-0","aria-hidden":"true"}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("input",{type:"checkbox",className:"accent-tint",checked:f,onChange:w=>S(w,n,"main")}),e.jsx("span",{className:"font-medium truncate min-w-0",title:n,children:n})]})]})},t.base)}return e.jsxs("li",{role:"treeitem","aria-expanded":A,className:"select-none",children:[e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1.5 rounded min-w-0 "+(v?"transition-colors ":"")+(v&&(L||N)?"":"hover:bg-black/5 dark:hover:bg-white/10"),style:u,children:[v&&e.jsx("button",{type:"button",className:"shrink-0 p-0.5 rounded hover:bg-black/10 dark:hover:bg-white/10",onClick:()=>c(n=>{const f=new Set(n);return f.has(t.base)?f.delete(t.base):f.add(t.base),f}),"aria-label":A?"Collapse":"Expand",children:A?e.jsx(U,{size:16}):e.jsx(_,{size:16})}),e.jsx("input",{type:"checkbox",className:"accent-tint",checked:N,ref:n=>{n&&(n.indeterminate=L)},onChange:n=>{const f=n.target.checked||L;i(w=>{const E=new Set(w);return f?t.all.forEach(R=>E.add(R)):t.all.forEach(R=>E.delete(R)),Array.from(E)})}}),e.jsx("span",{className:"font-medium truncate",title:t.base,children:`${t.base} (${t.all.length})`})]}),(p.push({type:"group",base:t.base,keys:t.all}),null),A&&e.jsx("ul",{role:"group",className:"pl-10 py-1 overflow-x-hidden min-w-0",children:t.years.map(n=>{const f=o.includes(n.key);return p.push({type:"key",key:n.key,base:t.base}),e.jsx("li",{role:"treeitem","aria-selected":f,className:"px-2 min-w-0 text-xs",children:e.jsxs("label",{className:"flex items-center gap-2 px-2 py-1 rounded cursor-pointer min-w-0 "+(f?"bg-blue-100 dark:bg-blue-900/40":"hover:bg-black/5 dark:hover:bg-white/10"),children:[e.jsx("input",{type:"checkbox",className:"accent-tint",checked:f,onChange:w=>S(w,n.key,"main")}),e.jsx("span",{className:"truncate min-w-0",title:n.label,children:n.label})]})},n.key)})})]},t.base)});return h.current=p,P})()})}),M&&e.jsxs("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>W(!1)}),e.jsxs("div",{className:"relative bg-white dark:bg-darkcard rounded-lg shadow-xl max-w-3xl w-full p-6 space-y-4 border border-black/10 dark:border-white/10 flex flex-col max-h-[85vh]",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Select Tournaments"}),e.jsx("button",{className:"btn btn-ghost btn-sm",onClick:()=>W(!1),children:"Close"})]}),e.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Clear selection",onClick:()=>i([]),children:"Clear"}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Select all",onClick:()=>i((l||[]).filter(p=>!D(p))),children:"Select All"}),e.jsxs("button",{className:"chip px-2 py-0.5 text-xs inline-flex items-center gap-1","aria-label":"Expand all groups",title:"Expand all groups",onClick:()=>c(new Set(a.filter(p=>p.all.length>1).map(p=>p.base))),children:[e.jsx(V,{size:15}),e.jsx(_,{size:15})]}),e.jsxs("button",{className:"chip px-2 py-0.5 text-xs inline-flex items-center gap-1","aria-label":"Collapse all groups",title:"Collapse all groups",onClick:()=>c(new Set),children:[e.jsx(V,{size:15}),e.jsx(U,{size:15})]})]}),e.jsx("div",{className:"border rounded-lg max-h-[65vh] overflow-y-auto overflow-x-hidden",children:e.jsx("ul",{role:"tree",className:"divide-y divide-black/5 dark:divide-white/10",children:(()=>{const p=[];return a.map(t=>{const v=t.all.length>1,A=v&&j.has(t.base),N=t.all.every(u=>o.includes(u)),L=!N&&t.all.some(u=>o.includes(u));return e.jsxs("li",{role:"treeitem","aria-expanded":A,className:"select-none",children:[e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1.5 rounded min-w-0 "+(v?"transition-colors ":""),children:[v&&e.jsx("button",{type:"button",className:"shrink-0 p-0.5 rounded hover:bg-black/10 dark:hover:bg-white/10",onClick:()=>c(u=>{const n=new Set(u);return n.has(t.base)?n.delete(t.base):n.add(t.base),n}),"aria-label":A?"Collapse":"Expand",children:A?e.jsx(U,{size:16}):e.jsx(_,{size:16})}),e.jsx("input",{type:"checkbox",className:"accent-tint",checked:N,ref:u=>{u&&(u.indeterminate=L)},onChange:u=>{const n=u.target.checked||L;i(f=>{const w=new Set(f);return n?t.all.forEach(E=>w.add(E)):t.all.forEach(E=>w.delete(E)),Array.from(w)})}}),e.jsx("span",{className:"font-medium truncate",title:t.base,children:`${t.base} (${t.all.length})`})]}),A&&e.jsx("ul",{role:"group",className:"pl-10 py-1 overflow-x-hidden min-w-0",children:t.years.map(u=>{const n=o.includes(u.key);return p.push({type:"key",key:u.key,base:t.base}),e.jsx("li",{role:"treeitem","aria-selected":n,className:"px-2 min-w-0 text-xs",children:e.jsxs("label",{className:`flex items-center gap-2 px-2 py-1 rounded cursor-pointer min-w-0 ${n?"bg-blue-100 dark:bg-blue-900/40":"hover:bg-black/5 dark:hover:bg-white/10"}`,children:[e.jsx("input",{type:"checkbox",className:"accent-tint",checked:n,onChange:f=>S(f,u.key,"modal")}),e.jsx("span",{className:"truncate min-w-0",title:u.label,children:u.label})]})},u.key)})})]},t.base)})})()})})]})]}),e.jsx("div",{className:"mt-2 text-[11px] text-gray-500 dark:text-gray-400",children:" * Select All does not include MS rounds."})]})}export{se as T,ee as c,T as f,te as l,q as p,ne as u};
