const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PracticeMode-CT2TKXw5.js","assets/vendor-react-DpsG3A-O.js","assets/vendor-abs-svg-path-DCUpb6Nw.js","assets/visualBonuses-DUgqxwx-.js","assets/vendor-firebase-storage-D1N4MLec.js","assets/vendor-firebase-app-DqcDUDC6.js","assets/vendor-firebase-component-B9jxOSis.js","assets/vendor-firebase-util-CIVODmCg.js","assets/vendor-firebase-logger-CNz1B4Yj.js","assets/vendor-idb-BXWtuYvb.js","assets/vendor-lucide-react-DoOgXp02.js","assets/vendor-react-dom-D1u-fJLi.js","assets/vendor-scheduler-CoSDG3-6.js","assets/vendor-firebase-B4IeM3Lq.js","assets/vendor-firebase-app-check-Co35-rT3.js","assets/vendor-firebase-firestore-BRp-7IKb.js","assets/vendor-firebase-webchannel-wrapper-QS5lB7L3.js","assets/vendor-firebase-database-DJucM1bQ.js","assets/vendor-react-helmet-async-bvMvt1Ax.js","assets/vendor-react-fast-compare-BCtOC5yC.js","assets/vendor-invariant-DW3JcdOx.js","assets/vendor-shallowequal-Df9Q-7bk.js","assets/vendor-react-router-dom-D6uELkfw.js","assets/vendor-react-router-B_FrsTVh.js","assets/vendor-remix-run-router-9r-WWGj9.js","assets/vendor-mui-material-DksXbHt-.js","assets/vendor-mui-utils-B23qfrSe.js","assets/vendor-clsx-B-dksMZM.js","assets/vendor-mui-system-BndTH9qf.js","assets/vendor-mui-styled-engine-CPmDJbkS.js","assets/vendor-emotion-styled-5vLscvJp.js","assets/vendor-babel-runtime-WXw8LxeR.js","assets/vendor-emotion-serialize-B6qc6euy.js","assets/vendor-emotion-hash-WldOFDRm.js","assets/vendor-emotion-unitless-x5IvBceT.js","assets/vendor-emotion-memoize-3S_6p140.js","assets/vendor-emotion-use-insertion-effect-with-fallbacks-B--OEmuQ.js","assets/vendor-emotion-utils-BijCJQMc.js","assets/vendor-emotion-is-prop-valid-DOnQZHJ6.js","assets/vendor-emotion-react-DrbGOuDy.js","assets/vendor-hoist-non-react-statics-mDtaWys7.js","assets/vendor-react-is-CnyDuYXe.js","assets/vendor-emotion-cache-DvsOMRO7.js","assets/vendor-emotion-sheet-6IwnyhEX.js","assets/vendor-stylis-DDa9OTMq.js","assets/vendor-react-transition-group-Q1VPUTjR.js","assets/vendor-three-CGYwrSEf.js","assets/vendor-katex-DP_4UPSs.js","assets/vendor-katex-CIur2ABi.css","assets/Admin-BCt9CKhW.js","assets/RoundGenerator-CXutUWPu.js","assets/vendor-react-pdf-renderer-DfOTdHag.js","assets/vendor-queue-IZnSDwnG.js","assets/vendor-inherits-BICa84dG.js","assets/vendor-events-DQ172AOg.js","assets/vendor-react-pdf-font-ByacAZ2x.js","assets/vendor-cross-fetch-DvOI2u39.js","assets/vendor-fontkit-5mDwoQ7O.js","assets/vendor-restructure-DwIbRzqP.js","assets/vendor-swc-helpers-DIxjOVuh.js","assets/vendor-fast-deep-equal-DtIvihjZ.js","assets/vendor-unicode-properties-BbL32wKl.js","assets/vendor-base64-js-BJmSPyJr.js","assets/vendor-unicode-trie-rSh8NucD.js","assets/vendor-tiny-inflate-BmeP50H3.js","assets/vendor-dfa-DFRa2UL2.js","assets/vendor-clone-DniFCc4t.js","assets/vendor-brotli-CUuIRSoC.js","assets/vendor-tslib-kHcLnhpD.js","assets/vendor-react-pdf-render-DYs5yDRr.js","assets/vendor-react-pdf-primitives-B6ApagcG.js","assets/vendor-react-pdf-fns-DIcDsgsD.js","assets/vendor-parse-svg-path-Bi0KIs1g.js","assets/vendor-normalize-svg-path-CFWHe3yZ.js","assets/vendor-svg-arc-to-cubic-bezier-DEq50KMd.js","assets/vendor-color-string-BKSasjlw.js","assets/vendor-color-name-Dju3oUBS.js","assets/vendor-simple-swizzle-3gX0Onlb.js","assets/vendor-is-arrayish-DyGeW-O8.js","assets/vendor-react-pdf-pdfkit-CgWEQEi-.js","assets/vendor-pako-CNe1bWpJ.js","assets/vendor-crypto-js-C9XMI5TL.js","assets/vendor-jay-peg-DnV82Tak.js","assets/vendor-react-pdf-png-js-D_OjzuBh.js","assets/vendor-react-pdf-layout-CVT9JNgr.js","assets/vendor-react-pdf-stylesheet-B2kC1IpU.js","assets/vendor-postcss-value-parser-DOXmp8r9.js","assets/vendor-hsl-to-hex-CDkcI7Vq.js","assets/vendor-hsl-to-rgb-for-reals-jL61FXS_.js","assets/vendor-media-engine-BWjc9dwl.js","assets/vendor-react-pdf-textkit-R3VqYnwu.js","assets/vendor-bidi-js-DLACMwmw.js","assets/vendor-hyphen-B2aENclZ.js","assets/vendor-yoga-layout-nAHjiEuJ.js","assets/vendor-react-pdf-image-BJ1YGwqv.js","assets/vendor-object-assign-Dm9xdUEz.js","assets/vendor-react-katex-CCCXQq7R.js","assets/vendor-prop-types-Chjiymov.js"])))=>i.map(i=>d[i]);
import{r as h,j as e,b as W}from"./vendor-react-DpsG3A-O.js";import{c as wr}from"./vendor-react-dom-D1u-fJLi.js";import{g as vr,o as jr,G as Nr,s as kr,a as Sr,c as Ar,b as zr,d as Cr}from"./vendor-firebase-B4IeM3Lq.js";import{i as Mr,a as Er,g as Rr}from"./vendor-firebase-app-check-Co35-rT3.js";import{g as ks,a as we,d as se,c as nt,b as mn,s as _e,u as ne,e as Ke,f as Cs,r as Ms,h as _r,i as Tr,j as yt,o as Gt,q as Vs,w as Ys}from"./vendor-firebase-firestore-BRp-7IKb.js";import{c as Xs,i as Dr}from"./vendor-firebase-app-DqcDUDC6.js";import"./vendor-firebase-logger-CNz1B4Yj.js";import{g as Lr}from"./vendor-firebase-storage-D1N4MLec.js";import{H as Ye,a as Or}from"./vendor-react-helmet-async-bvMvt1Ax.js";import{L as Kt,c as Pr,R as Br}from"./vendor-react-router-dom-D6uELkfw.js";import{s as Fr,S as Ir}from"./vendor-mui-material-DksXbHt-.js";import{c as We,d as Es,f as Vt,g as Ur}from"./vendor-react-router-B_FrsTVh.js";import{C as us,D as Wr,R as $r,L as Ot,a as Pt,V as Bt,b as fe,W as Gr,c as Hr,S as Qs,d as Zs,M as ms,P as hs,e as Ft,H as qr,F as Jr,f as Kr,B as Vr,g as Yr,h as Xr,A as Qr}from"./vendor-three-CGYwrSEf.js";import"./vendor-katex-DP_4UPSs.js";import{g as Yt,r as ue,o as Ne,a as xe,q as Rs,l as hn,b as _s,s as rt,c as Zr,d as ea,e as ze,u as ae,f as Oe,h as Ve,p as Ts,i as ta,j as sa,k as na}from"./vendor-firebase-database-DJucM1bQ.js";import{L as Ss,S as As,M as ra,C as fs,a as ps,b as en,A as aa,P as ia,c as oa,H as ca}from"./vendor-lucide-react-DoOgXp02.js";import"./vendor-abs-svg-path-DCUpb6Nw.js";import"./vendor-scheduler-CoSDG3-6.js";import"./vendor-firebase-util-CIVODmCg.js";import"./vendor-firebase-component-B9jxOSis.js";import"./vendor-firebase-webchannel-wrapper-QS5lB7L3.js";import"./vendor-idb-BXWtuYvb.js";import"./vendor-react-fast-compare-BCtOC5yC.js";import"./vendor-invariant-DW3JcdOx.js";import"./vendor-shallowequal-Df9Q-7bk.js";import"./vendor-remix-run-router-9r-WWGj9.js";import"./vendor-mui-utils-B23qfrSe.js";import"./vendor-clsx-B-dksMZM.js";import"./vendor-mui-system-BndTH9qf.js";import"./vendor-mui-styled-engine-CPmDJbkS.js";import"./vendor-emotion-styled-5vLscvJp.js";import"./vendor-babel-runtime-WXw8LxeR.js";import"./vendor-emotion-serialize-B6qc6euy.js";import"./vendor-emotion-hash-WldOFDRm.js";import"./vendor-emotion-unitless-x5IvBceT.js";import"./vendor-emotion-memoize-3S_6p140.js";import"./vendor-emotion-use-insertion-effect-with-fallbacks-B--OEmuQ.js";import"./vendor-emotion-utils-BijCJQMc.js";import"./vendor-emotion-is-prop-valid-DOnQZHJ6.js";import"./vendor-emotion-react-DrbGOuDy.js";import"./vendor-hoist-non-react-statics-mDtaWys7.js";import"./vendor-react-is-CnyDuYXe.js";import"./vendor-emotion-cache-DvsOMRO7.js";import"./vendor-emotion-sheet-6IwnyhEX.js";import"./vendor-stylis-DDa9OTMq.js";import"./vendor-react-transition-group-Q1VPUTjR.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();const la="modulepreload",da=function(t){return"/"+t},tn={},at=function(s,n,a){let o=Promise.resolve();if(n&&n.length>0){let c=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),l=i?.nonce||i?.getAttribute("nonce");o=c(n.map(u=>{if(u=da(u),u in tn)return;tn[u]=!0;const d=u.endsWith(".css"),m=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${m}`))return;const v=document.createElement("link");if(v.rel=d?"stylesheet":la,d||(v.as="script"),v.crossOrigin="",v.href=u,l&&v.setAttribute("nonce",l),document.head.appendChild(v),d)return new Promise((f,A)=>{v.addEventListener("load",f),v.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${u}`)))})}))}function r(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return o.then(i=>{for(const l of i||[])l.status==="rejected"&&r(l.reason);return s().catch(r)})},ua={apiKey:"AIzaSyC-4y146WLvcjfTg1IrnRgpLJGLir3Kv6E",authDomain:"sciencebowl.org",projectId:"scibowl-analytics",storageBucket:"scibowl-analytics.firebasestorage.app",messagingSenderId:"579454885012",appId:"1:579454885012:web:2015104d8f5e3a6a302881"};let xs;function it(){return Xs().length?xs=Xs()[0]:xs=Dr(ua),xs}function ee(){return ot(),ks(it())}function Ae(){return ot(),vr(it())}function Ho(){return ot(),Lr(it())}let gs=null;function ot(){try{window.FIREBASE_APPCHECK_DEBUG_TOKEN==="true"&&(self.FIREBASE_APPCHECK_DEBUG_TOKEN=!0);const t=it();if(!gs){const n="6LdP4s8rAAAAAH5skwAWa08TPDuqwlRul6Ild4xl";n&&(gs=Mr(t,{provider:new Er(n),isTokenAutoRefreshEnabled:!0}))}return gs}catch{return null}}async function ma(t=!1){try{const s=ot();return s&&(await Rr(s,t))?.token||null}catch{return null}}function Xt(t={}){const s=t.roundSubcollection||"rounds",[n,a]=h.useState([]),[o,r]=h.useState(!0),[i,l]=h.useState(null),[c,u]=h.useState(!1),[d,m]=h.useState(null),v=h.useRef(new Map),f=7200*60*1e3,A=h.useRef(null);function b(){return new Promise((g,S)=>{if(A.current)return g(A.current);const w=indexedDB.open("scibowl-rounds-cache",1);w.onupgradeneeded=()=>{const E=w.result;E.objectStoreNames.contains("rounds")||E.createObjectStore("rounds")},w.onsuccess=()=>{A.current=w.result,g(w.result)},w.onerror=()=>S(w.error)})}async function C(g){try{const S=await b();return await new Promise((w,E)=>{const R=S.transaction("rounds","readonly").objectStore("rounds").get(g);R.onsuccess=()=>w(R.result||null),R.onerror=()=>E(R.error)})}catch{return null}}async function p(g,S){try{const w=await b();await new Promise((E,k)=>{const T=w.transaction("rounds","readwrite").objectStore("rounds").put(S,g);T.onsuccess=()=>E(),T.onerror=()=>k(T.error)})}catch{}}h.useEffect(()=>{let g=!1;return(async()=>{try{r(!0);const S=await C("meta:tournaments");S&&!g&&a(S.list||[]);const w=ee(),E=await we(se(w,"meta","tournaments"));if(!E.exists())throw new Error("meta/tournaments document not found");const k=E.data().list||[];g||a(k),p("meta:tournaments",{list:k,updatedAt:Date.now()})}catch(S){g||l(S)}finally{g||r(!1)}})(),()=>{g=!0}},[]);async function N(g,{force:S=!1}={}){const w=(g||[]).filter(Boolean);if(w.length===0)return;u(!0),m(null);const E=ee();try{for(const k of w){if(v.current.get(k)&&!S)continue;const R=await C(`t:${k}`),T=R&&typeof R.updatedAt=="number"&&Date.now()-R.updatedAt<=f;if(R&&T&&!S){v.current.set(k,R.payload);continue}const F=nt(E,"tournaments",k,s),I=await mn(F),G={},L=[];I.forEach(q=>{const P=q.data(),K=q.id;G[K]={id:K,...P};const te=Array.isArray(P.tossups)?P.tossups:[],Me=Array.isArray(P.bonuses)?P.bonuses:[];for(const J of te){const ie=J._origId||J.origId||J.id;L.push({...J,id:ie||`${k}__${K}__tu__${J.question_number}`,tournament:k,round:K})}for(const J of Me){const ie=J._origId||J.origId||J.id;L.push({...J,id:ie||`${k}__${K}__bo__${J.question_number}`,tournament:k,round:K})}}),v.current.set(k,{rounds:G,flatQuestions:L}),p(`t:${k}`,{payload:{rounds:G,flatQuestions:L},updatedAt:Date.now()})}}catch(k){m(k)}finally{u(!1)}}function j(g){const S=[];for(const w of g||[]){const E=v.current.get(w);E?.flatQuestions&&S.push(...E.flatQuestions)}return S}function z(g){const S=v.current.get(g);return S?Object.values(S.rounds).sort((w,E)=>w.round?.localeCompare?.(E.round||"")||0):[]}return{tournaments:n,loadingTournaments:o,errorTournaments:i,loading:c,error:d,ensureLoaded:N,getLoadedQuestions:j,getRounds:z}}const ha="scibowl-user-cache",fa=1;let It=null;const fn=7200*60*1e3;function ct(){return It||(It=new Promise((t,s)=>{const n=indexedDB.open(ha,fa);n.onupgradeneeded=()=>{const a=n.result;a.objectStoreNames.contains("roundsIndex")||a.createObjectStore("roundsIndex"),a.objectStoreNames.contains("roundDetails")||a.createObjectStore("roundDetails")},n.onsuccess=()=>t(n.result),n.onerror=()=>s(n.error)}),It)}async function Te(t){try{const s=await ct();return await new Promise((n,a)=>{const i=s.transaction("roundsIndex","readonly").objectStore("roundsIndex").get(t);i.onsuccess=()=>n(i.result||null),i.onerror=()=>a(i.error)})}catch{return null}}async function De(t,s){try{const n=await ct();await new Promise((a,o)=>{const l=n.transaction("roundsIndex","readwrite").objectStore("roundsIndex").put(s,t);l.onsuccess=()=>a(),l.onerror=()=>o(l.error)})}catch{}}async function Ds(t,s){try{const n=await ct();return await new Promise((a,o)=>{const l=n.transaction("roundDetails","readonly").objectStore("roundDetails").get(`${t}::${s}`);l.onsuccess=()=>a(l.result||null),l.onerror=()=>o(l.error)})}catch{return null}}async function Qt(t,s,n){try{const a=await ct();await new Promise((o,r)=>{const c=a.transaction("roundDetails","readwrite").objectStore("roundDetails").put(n,`${t}::${s}`);c.onsuccess=()=>o(),c.onerror=()=>r(c.error)})}catch{}}async function pa(t,s){try{const n=await ct();await new Promise(a=>{const i=n.transaction("roundDetails","readwrite").objectStore("roundDetails").delete(`${t}::${s}`);i.onsuccess=()=>a(),i.onerror=()=>a()})}catch{}}async function xa(t){try{const s=await ct();await new Promise((n,a)=>{const o=s.transaction(["roundsIndex","roundDetails"],"readwrite"),r=o.objectStore("roundsIndex"),i=o.objectStore("roundDetails"),l=r.delete(t);l.onerror=()=>a(l.error),l.onsuccess=()=>{const c=i.getAllKeys();c.onsuccess=()=>{const u=(c.result||[]).filter(m=>typeof m=="string"&&m.startsWith(`${t}::`));let d=u.length;if(d===0){n();return}u.forEach(m=>{const v=i.delete(m);v.onsuccess=()=>{--d===0&&n()},v.onerror=()=>{--d===0&&n()}})},c.onerror=()=>n()}})}catch{}}async function qo(t,s){if(!t)throw new Error("Not authenticated");const n=ee(),a=nt(n,"users",t,"rounds"),o=await Tr(a,{...s,createdAt:yt()}),r=se(n,"users",t,"meta","roundsIndex"),i={title:s.title,count:s.count,createdAt:yt()};await _e(r,{entries:{[o.id]:i}},{merge:!0});try{const l=Math.floor(Date.now()/1e3),c=await Te(t),u=c?.entries?{...c.entries}:{};u[o.id]={title:s.title,count:s.count,createdAt:{seconds:l}},await De(t,{entries:u,updatedAt:Date.now()}),await Qt(t,o.id,{data:{id:o.id,...s,createdAt:{seconds:l}},updatedAt:Date.now()})}catch{}return o.id}async function Jo(t,{force:s=!1}={}){if(!t)return[];if(!s){const u=await Te(t);if(u&&u.entries&&!(typeof u.updatedAt=="number"?Date.now()-u.updatedAt>fn:!0)){const m=Object.entries(u.entries).map(([v,f])=>({id:v,...f}));return m.sort((v,f)=>(f.createdAt?.seconds||0)-(v.createdAt?.seconds||0)),m}}const n=ee(),a=se(n,"users",t,"meta","roundsIndex"),o=await we(a);if(!o.exists())return await De(t,{entries:{},updatedAt:Date.now()}),[];const r=o.data()||{};let i=r.entries||{};const l=r.folders||{};if(!i||Object.keys(i).length===0){const u={};for(const[d,m]of Object.entries(r))if(d.startsWith("entries.")){const v=d.slice(8);v&&(u[v]=m)}Object.keys(u).length>0&&(i=u)}await De(t,{entries:i,folders:l,updatedAt:Date.now()});const c=Object.entries(i).map(([u,d])=>({id:u,...d}));return c.sort((u,d)=>{const m=u.createdAt?.seconds||0;return(d.createdAt?.seconds||0)-m}),c}async function Ko(t,s,{force:n=!1}={}){if(!t||!s)return null;const a=await Ds(t,s);if(a&&!n&&a&&typeof a=="object"&&"data"in a&&"updatedAt"in a&&!(typeof a.updatedAt=="number"?Date.now()-a.updatedAt>fn:!0))return a.data;const o=ee(),r=se(o,"users",t,"rounds",s),i=await we(r);if(!i.exists())return null;const l={id:i.id,...i.data()};return await Qt(t,s,{data:l,updatedAt:Date.now()}),l}async function Vo(t,{force:s=!1}={}){if(!t)return[];if(!s){const c=await Te(t),u=c?.folders?Object.keys(c.folders):null;if(u)return u}const n=ee(),a=se(n,"users",t,"meta","roundsIndex"),o=await we(a),i=(o.exists()?o.data()||{}:{}).folders||{},l=await Te(t);return await De(t,{entries:l?.entries||{},folders:i,updatedAt:Date.now()}),Object.keys(i)}async function Yo(t,s){if(!t)throw new Error("Not authenticated");const n=(s??"").toString().trim();if(!n)throw new Error("Folder name required");const a=ee(),o=se(a,"users",t,"meta","roundsIndex");await _e(o,{folders:{[n]:!0}},{merge:!0});const r=await Te(t),i={...r?.folders||{},[n]:!0};return await De(t,{entries:r?.entries||{},folders:i,updatedAt:Date.now()}),!0}async function Xo(t,s,n){if(!t)throw new Error("Not authenticated");const a=(s??"").toString().trim(),o=(n??"").toString().trim();if(!a)throw new Error("Source folder name required");if(!o)throw new Error("Destination folder name required");if(a===o)return!0;const r=ee(),i=se(r,"users",t,"meta","roundsIndex"),l=await we(i);if(!l.exists())throw new Error("No folders meta found");const c=l.data()||{},u={...c.entries||{}},d={...c.folders||{}};if(!d[a])throw new Error("Folder does not exist");if(d[o])throw new Error("A folder with that name already exists");const m={};for(const[f,A]of Object.entries(u))A&&A.folder===a&&(m[`entries.${f}.folder`]=o,u[f]={...A,folder:o});await ne(i,{[`folders.${a}`]:Ke(),[`folders.${o}`]:!0}).catch(async()=>{const f={folders:{[o]:!0}};await _e(i,f,{merge:!0})}),Object.keys(m).length>0&&await ne(i,m).catch(async()=>{await _e(i,{entries:u},{merge:!0})});const v=Object.entries(u).filter(([,f])=>f.folder===o).map(([f])=>f);for(const f of v)try{const A=se(r,"users",t,"rounds",f);await ne(A,{folder:o})}catch{}try{const f=await Te(t);if(f){const A={...f.folders||{}};delete A[a],A[o]=!0;const b={...f.entries||{}};for(const[C,p]of Object.entries(b))p&&p.folder===a&&(b[C]={...p,folder:o});await De(t,{entries:b,folders:A,updatedAt:Date.now()})}}catch{}return!0}async function Qo(t,s){if(!t)throw new Error("Not authenticated");const n=(s??"").toString().trim();if(!n)throw new Error("Folder name required");const a=ee(),o=se(a,"users",t,"meta","roundsIndex"),r=await we(o);if(!r.exists())return!0;const i=r.data()||{};if(!{...i.folders||{}}[n])return!0;const c={...i.entries||{}},u={};for(const[d,m]of Object.entries(c))m&&m.folder===n&&(u[`entries.${d}.folder`]=Ke(),delete c[d].folder);try{await ne(o,{[`folders.${n}`]:Ke()})}catch{}if(Object.keys(u).length>0)try{await ne(o,u)}catch{await _e(o,{entries:c},{merge:!0})}for(const[d,m]of Object.entries(c))if(!m.folder)try{const v=se(a,"users",t,"rounds",d);await ne(v,{folder:Ke()})}catch{}try{const d=await Te(t);if(d){const m={...d.folders||{}};delete m[n];const v={...d.entries||{}};for(const[f,A]of Object.entries(v))if(A&&A.folder===n){const{folder:b,...C}=A;v[f]=C}await De(t,{entries:v,folders:m,updatedAt:Date.now()})}}catch{}return!0}async function Zo(t,s){if(!t||!s)throw new Error("Missing uid/roundId");const n=ee(),a=se(n,"users",t,"rounds",s);try{await Cs(a)}catch{}const o=se(n,"users",t,"meta","roundsIndex");try{await ne(o,{[`entries.${s}`]:Ke()})}catch{try{const i=await we(o),c={...(i.exists()?i.data()||{}:{}).entries||{}};s in c&&delete c[s],await _e(o,{entries:c},{merge:!0})}catch{}}try{const r=await Te(t);if(r?.entries&&s in r.entries){const{[s]:i,...l}=r.entries;await De(t,{entries:l,updatedAt:Date.now()})}await pa(t,s)}catch{}return!0}async function ec(t,s,n){if(!t||!s)throw new Error("Missing uid/roundId");const a=ee(),o=se(a,"users",t,"rounds",s),r=se(a,"users",t,"meta","roundsIndex");try{n&&n.trim().length>0?await ne(o,{folder:n.trim()}):await ne(o,{folder:Ke()})}catch{}try{n&&n.trim().length>0?await ne(r,{[`entries.${s}.folder`]:n.trim()}):await ne(r,{[`entries.${s}.folder`]:Ke()})}catch{n&&n.trim().length>0&&await _e(r,{entries:{[s]:{folder:n.trim()}}},{merge:!0})}try{const i=await Te(t);if(i?.entries){const c={...i.entries};if(c[s]||(c[s]={}),n&&n.trim().length>0)c[s]={...c[s],folder:n.trim()};else{const{folder:u,...d}=c[s];c[s]=d}await De(t,{entries:c,updatedAt:Date.now()})}const l=await Ds(t,s);if(l&&l.data){const c={...l.data};n&&n.trim().length>0?c.folder=n.trim():delete c.folder,await Qt(t,s,{data:c,updatedAt:Date.now()})}}catch{}return!0}function tc(t){const s=new Set,n=t?.pairs||[];for(const a of n)a.tossupId&&s.add(a.tossupId),a.bonusId&&s.add(a.bonusId);return s}async function sc(t,s,n){if(!t)throw new Error("Not authenticated");if(!s)throw new Error("Missing roundId");const a=(n??"").toString().trim();if(a.length===0)throw new Error("Title cannot be empty");const o=ee(),r=se(o,"users",t,"rounds",s);await ne(r,{title:a});const i=se(o,"users",t,"meta","roundsIndex");try{await ne(i,{[`entries.${s}.title`]:a})}catch{await _e(i,{entries:{[s]:{title:a}}},{merge:!0})}try{const l=await Te(t);l&&l.entries&&l.entries[s]&&(l.entries[s]={...l.entries[s],title:a},await De(t,{...l,updatedAt:Date.now()}));const c=await Ds(t,s);if(c&&c.data){const u={...c,data:{...c.data,title:a},updatedAt:Date.now()};await Qt(t,s,u)}}catch{}return!0}async function nc({questionType:t="both",categories:s=[],count:n=1,adminUid:a="fkLJJ2R6HbdwqoXSxrLUybZ0IdH2"}={}){const o=ee(),r=se(o,"users",a,"meta","presets");let i=[];try{const b=await we(r),C=b.exists()?b.data()||{}:{};i=Array.isArray(C?.set)?[...C.set]:[]}catch{return{roundId:null}}if(!i||i.length===0)return{roundId:null};const l=Math.max(1,Number(n)||1),c=Array.isArray(s)&&s.length?new Set(s.map(b=>String(b).toUpperCase())):null,u=(t||"both").toLowerCase();function d(b){if(!Array.isArray(b))return 0;let C=[];return u==="tossup"?C=b.filter(p=>!!p?.tossupMeta&&(!c||c.has(String(p.tossupMeta.category||"").toUpperCase()))):u==="bonus"?C=b.filter(p=>!!p?.bonusMeta&&(!c||c.has(String(p.bonusMeta.category||"").toUpperCase()))):C=b.filter(p=>!!p?.tossupMeta&&(!c||c.has(String(p.tossupMeta.category||"").toUpperCase()))),C.length}const m=[];let v=null;for(let b=0;b<i.length;b++){const C=i[b];try{const p=await we(se(o,"users",a,"rounds",C));if(!p.exists())continue;const N=p.data()?.pairs||[];d(N)>=l&&m.push({index:b,rid:C,pairs:N})}catch{}}if(m.length===0)return{roundId:null};const f=m[Math.floor(Math.random()*m.length)],A=f.rid;v=f.pairs;try{await Ms(o,async b=>{const C=await b.get(r),p=C.exists()?C.data()||{}:{},N=Array.isArray(p.set)?[...p.set]:[],j=N.indexOf(A);j!==-1&&(N.splice(j,1),b.set(r,{set:N},{merge:!0}))})}catch{try{await ne(r,{set:_r(A)})}catch{}}return{roundId:A,pairs:v}}function Ce(){const[t,s]=h.useState(null),[n,a]=h.useState(!0),[o,r]=h.useState(null);h.useEffect(()=>{const d=Ae(),m=jr(d,v=>{s(v),a(!1)},v=>{r(v),a(!1)});return()=>m()},[]);const i=h.useCallback(async()=>{const d=Ae(),m=new Nr;await kr(d,m)},[]),l=h.useCallback(async(d,m)=>{const v=Ae();await Sr(v,d,m)},[]),c=h.useCallback(async(d,m)=>{const v=Ae();await Ar(v,d,m)},[]),u=h.useCallback(async()=>{const d=Ae(),m=d.currentUser?.uid;await zr(d),m&&await xa(m)},[]);return{user:t,loading:n,error:o,loginWithGoogle:i,loginWithEmail:l,signupWithEmail:c,logout:u}}const ga={};function V(t=""){const s=ga?.VITE_SITE_URL,n=s&&typeof s=="string"&&s.trim()||(typeof window<"u"?window.location.origin:"");if(!n)return t||"/";try{return new URL(t||"/",n).toString()}catch{return n+(t||"/")}}function ba(){return e.jsxs(Ye,{children:[e.jsx("title",{children:"atombowl — Science Bowl practice, multiplayer buzzer, and round generator"}),e.jsx("meta",{name:"description",content:"atombowl brings Science Bowl prep together: practice mode, multiplayer rooms, real-time buzzer system, and a fast round generator with visual bonuses."}),e.jsx("link",{rel:"canonical",href:V("/")}),e.jsx("meta",{name:"robots",content:"index,follow"}),e.jsx("meta",{property:"og:type",content:"website"}),e.jsx("meta",{property:"og:site_name",content:"atombowl"}),e.jsx("meta",{property:"og:title",content:"atombowl — Science Bowl practice, multiplayer, buzzer"}),e.jsx("meta",{property:"og:description",content:"Practice questions, generate rounds, and buzz together online — all in one place."}),e.jsx("meta",{property:"og:url",content:V("/")}),e.jsx("meta",{property:"og:image",content:V("/logo.png")}),e.jsx("meta",{property:"og:image:alt",content:"atombowl Logo"}),e.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),e.jsx("meta",{name:"twitter:title",content:"atombowl — Science Bowl practice, multiplayer, buzzer"}),e.jsx("meta",{name:"twitter:description",content:"Practice mode, multiplayer rooms, and a fast round generator."}),e.jsx("meta",{name:"twitter:image",content:V("/logo.png")})]})}function ya(){const t={"@context":"https://schema.org","@type":"BreadcrumbList",itemListElement:[{"@type":"ListItem",position:1,name:"Home",item:V("/")},{"@type":"ListItem",position:2,name:"Round Generator",item:V("/round-generator")}]};return e.jsxs(Ye,{children:[e.jsx("title",{children:"Round Generator & Practice | atombowl"}),e.jsx("meta",{name:"description",content:"Generate custom Science Bowl practice rounds instantly. Filter by tournament and category, include toss-ups and bonuses, and export to PDF."}),e.jsx("link",{rel:"canonical",href:V("/round-generator")}),e.jsx("meta",{property:"og:title",content:"Round Generator & Practice | atombowl"}),e.jsx("meta",{property:"og:description",content:"Build practice rounds from curated tournaments in seconds."}),e.jsx("meta",{property:"og:url",content:V("/round-generator")}),e.jsx("meta",{property:"og:image",content:V("/logo.png")}),e.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),e.jsx("meta",{name:"twitter:title",content:"Round Generator & Practice | atombowl"}),e.jsx("meta",{name:"twitter:description",content:"Generate custom Science Bowl rounds instantly."}),e.jsx("meta",{name:"twitter:image",content:V("/logo.png")}),e.jsx("script",{type:"application/ld+json",children:JSON.stringify(t)})]})}function wa(){const t={"@context":"https://schema.org","@type":"BreadcrumbList",itemListElement:[{"@type":"ListItem",position:1,name:"Home",item:V("/")},{"@type":"ListItem",position:2,name:"Practice",item:V("/practice")}]};return e.jsxs(Ye,{children:[e.jsx("title",{children:"Practice Mode | atombowl"}),e.jsx("meta",{name:"description",content:"Drill Science Bowl toss-ups and bonuses with keyboard shortcuts, instant feedback, and adjustable reading speed."}),e.jsx("link",{rel:"canonical",href:V("/practice")}),e.jsx("meta",{property:"og:title",content:"Practice Mode | atombowl"}),e.jsx("meta",{property:"og:description",content:"Practice Science Bowl questions with instant feedback."}),e.jsx("meta",{property:"og:url",content:V("/practice")}),e.jsx("meta",{property:"og:image",content:V("/logo.png")}),e.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),e.jsx("meta",{name:"twitter:title",content:"Practice Mode | atombowl"}),e.jsx("meta",{name:"twitter:description",content:"Drill toss-ups and bonuses with smart helpers."}),e.jsx("meta",{name:"twitter:image",content:V("/logo.png")}),e.jsx("script",{type:"application/ld+json",children:JSON.stringify(t)}),e.jsx("meta",{name:"robots",content:"follow"})]})}function va(){return e.jsxs(Ye,{children:[e.jsx("title",{children:"Sign In | atombowl"}),e.jsx("meta",{name:"robots",content:"noindex,nofollow"}),e.jsx("meta",{name:"description",content:"Sign in to access atombowl features including practice mode, round generator, multiplayer rooms, and buzzer."}),e.jsx("link",{rel:"canonical",href:V("/signin")})]})}function ja(){const t={"@context":"https://schema.org","@type":"BreadcrumbList",itemListElement:[{"@type":"ListItem",position:1,name:"Home",item:V("/")},{"@type":"ListItem",position:2,name:"Multiplayer",item:V("/multiplayer")}]};return e.jsxs(Ye,{children:[e.jsx("title",{children:"Multiplayer Rooms | atombowl"}),e.jsx("meta",{name:"description",content:"Create or join public and private rooms to practice Science Bowl live with a real-time buzzer and chat."}),e.jsx("link",{rel:"canonical",href:V("/multiplayer")}),e.jsx("meta",{property:"og:title",content:"Multiplayer Rooms | atombowl"}),e.jsx("meta",{property:"og:description",content:"Practice together online with live buzzing and chat."}),e.jsx("meta",{property:"og:url",content:V("/multiplayer")}),e.jsx("meta",{property:"og:image",content:V("/logo.png")}),e.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),e.jsx("meta",{name:"twitter:title",content:"Multiplayer Rooms | atombowl"}),e.jsx("meta",{name:"twitter:description",content:"Host or join rooms for live buzzing practice."}),e.jsx("meta",{name:"twitter:image",content:V("/logo.png")}),e.jsx("script",{type:"application/ld+json",children:JSON.stringify(t)})]})}function Na(){return e.jsxs(Ye,{children:[e.jsx("title",{children:"Multiplayer Room | atombowl"}),e.jsx("meta",{name:"robots",content:"noindex,follow"}),e.jsx("link",{rel:"canonical",href:V("/multiplayer")}),e.jsx("meta",{name:"description",content:"Join a Science Bowl multiplayer room to practice live buzzing with friends and teammates."}),e.jsx("meta",{property:"og:title",content:"Multiplayer Room | atombowl"}),e.jsx("meta",{property:"og:description",content:"Practice together online with live buzzing and chat."}),e.jsx("meta",{property:"og:url",content:V("/multiplayer")}),e.jsx("meta",{property:"og:image",content:V("/logo.png")}),e.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),e.jsx("meta",{name:"twitter:title",content:"Multiplayer Room | atombowl"}),e.jsx("meta",{name:"twitter:description",content:"Host or join rooms for live buzzing practice."}),e.jsx("meta",{name:"twitter:image",content:V("/logo.png")})]})}function ka(){const t={"@context":"https://schema.org","@type":"BreadcrumbList",itemListElement:[{"@type":"ListItem",position:1,name:"Home",item:V("/")},{"@type":"ListItem",position:2,name:"Buzzer",item:V("/buzzer")}]};return e.jsxs(Ye,{children:[e.jsx("title",{children:"Buzzer | atombowl"}),e.jsx("meta",{name:"description",content:"Simple, real-time Science Bowl buzzer. Host a room, share the code, and start buzzing instantly."}),e.jsx("link",{rel:"canonical",href:V("/buzzer")}),e.jsx("meta",{property:"og:title",content:"Buzzer | atombowl"}),e.jsx("meta",{property:"og:description",content:"Real-time online buzzer for scrims and practices."}),e.jsx("meta",{property:"og:url",content:V("/buzzer")}),e.jsx("meta",{property:"og:image",content:V("/logo.png")}),e.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),e.jsx("meta",{name:"twitter:title",content:"Buzzer | atombowl"}),e.jsx("meta",{name:"twitter:description",content:"Share a code and buzz from any device."}),e.jsx("meta",{name:"twitter:image",content:V("/logo.png")}),e.jsx("script",{type:"application/ld+json",children:JSON.stringify(t)})]})}const Sa="scibowl_current_cache",Aa=1,Ht="kv";function za(){return new Promise((t,s)=>{const n=indexedDB.open(Sa,Aa);n.onerror=()=>s(n.error),n.onupgradeneeded=()=>{const a=n.result;a.objectStoreNames.contains(Ht)||a.createObjectStore(Ht)},n.onsuccess=()=>t(n.result)})}async function pn(t,s){const n=await za();return new Promise((a,o)=>{const r=n.transaction(Ht,t),i=r.objectStore(Ht);let l=!1;r.oncomplete=()=>{l||a()},r.onerror=()=>{l||o(r.error)};const c=s(i);Promise.resolve(c).then(u=>{l=!0,a(u)},u=>{l=!0,o(u)})})}async function xn(t){return pn("readonly",s=>new Promise((n,a)=>{const o=s.get(t);o.onsuccess=()=>n(o.result??null),o.onerror=()=>a(o.error)}))}async function qt(t,s){return pn("readwrite",n=>new Promise((a,o)=>{const r=n.put(s,t);r.onsuccess=()=>a(!0),r.onerror=()=>o(r.error)}))}const sn="sb_session_id";function Ca(){try{let t=sessionStorage.getItem(sn);return t||(t=Math.random().toString(36).slice(2)+Date.now().toString(36),sessionStorage.setItem(sn,t)),t}catch{return"fallback"}}function gn(){return`s:${Ca()}:rounds`}async function Zt(){const t=gn(),s=await xn(t);if(!s||typeof s!="object")return{current:null,old:[]};const n=Array.isArray(s.current)?s.current:null,a=Array.isArray(s.old)?s.old.filter(Array.isArray):[];return{current:n,old:a}}async function bn(t){const s=gn(),n={current:Array.isArray(t?.current)?t.current:null,old:Array.isArray(t?.old)?t.old.filter(Array.isArray):[],updatedAt:Date.now()};return await qt(s,n),n}async function Ma(t){const s=await Zt(),n={current:Array.isArray(t)?t:null,old:s.current?[s.current,...s.old||[]]:s.old||[]};return await bn(n),n}async function rc(t){const s=await Zt(),n=s.current,a=Array.isArray(s.old)?[...s.old]:[];if(!Number.isFinite(t)||t<=0||t>=1+a.length)return s;const o=a[t-1],r=a.filter((l,c)=>c!==t-1),i={current:o||null,old:n?[n,...r]:r};return await bn(i),i}async function ac(){const{current:t,old:s}=await Zt(),n=[];Array.isArray(t)&&n.push(t);for(const a of s||[])Array.isArray(a)&&n.push(a);return n}const yn=h.createContext(null);function Ea({children:t}){const[s,n]=h.useState([]),[a,o]=h.useState([]),r=u=>{try{return Array.isArray(u)?u.map(d=>({t:d?.tossup?.id||null,b:d?.bonus?.id||null})):[]}catch{return[]}},i=u=>{try{return Array.isArray(u)?u.map(d=>({tu:d?.tossup?{id:d.tossup.id,tournament:d.tossup.tournament}:null,bo:d?.bonus?{id:d.bonus.id,tournament:d.bonus.tournament}:null})):[]}catch{return[]}},l=u=>{n(d=>{const m=typeof u=="function"?u(d):u;try{window.__sbGeneratedPairs=m,qt("sb_current_round",r(m)),qt("sb_current_round_meta",i(m))}catch{}return m})},c=u=>{o(d=>[...d,u]),l(u);try{Ma(i(u))}catch{}};return h.useEffect(()=>{let u=!0;return(async()=>{if(u)try{await Zt()}catch{}})(),()=>{u=!1}},[]),e.jsx(yn.Provider,{value:{generatedPairs:s,setGeneratedPairs:l,history:a,setHistory:o,pushGeneratedRound:c},children:t})}function wn(){const t=h.useContext(yn);if(!t)throw new Error("useRoundSession must be used within a RoundSessionProvider");return t}const Ra=Fr(Ir)(({theme:t})=>({width:62,height:34,padding:7,"& .MuiSwitch-switchBase":{margin:1,padding:0,transform:"translateX(6px)","&.Mui-checked":{color:"#fff",transform:"translateX(22px)","& .MuiSwitch-thumb:before":{backgroundImage:`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 20 20"><path fill="%23fff" d="M4.2 2.5l-.7 1.8-1.8.7 1.8.7.7 1.8.6-1.8L6.7 5l-1.9-.7-.6-1.8zm15 8.3a6.7 6.7 0 11-6.6-6.6 5.8 5.8 0 006.6 6.6z"/></svg>')`},"& + .MuiSwitch-track":{opacity:1,backgroundColor:t.palette.mode==="dark"?"#8796A5":"#aab4be"}}},"& .MuiSwitch-thumb":{backgroundColor:t.palette.mode==="dark"?"#003892":"#001e3c",width:32,height:32,"&::before":{content:"''",position:"absolute",width:"100%",height:"100%",left:0,top:0,backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundImage:`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 20 20"><path fill="%23fff" d="M9.305 1.667V3.75h1.389V1.667h-1.39zm-4.707 1.95l-.982.982L5.09 6.072l.982-.982-1.473-1.473zm10.802 0L13.927 5.09l.982.982 1.473-1.473-.982-.982zM10 5.139a4.872 4.872 0 00-4.862 4.86A4.872 4.872 0 0010 14.862 4.872 4.872 0 0014.86 10 4.872 4.872 0 0010 5.139zm0 1.389A3.462 3.462 0 0113.471 10a3.462 3.462 0 01-3.473 3.472A3.462 3.462 0 016.527 10 3.462 3.462 0 0110 6.528zM1.665 9.305v1.39h2.083v-1.39H1.666zm14.583 0v1.39h2.084v-1.39h-2.084zM5.09 13.928L3.616 15.4l.982.982 1.473-1.473-.982-.982zm9.82 0l-.982.982 1.473 1.473.982-.982-1.473-1.473zM9.305 16.25v2.083h1.389V16.25h-1.39z"/></svg>')`}},"& .MuiSwitch-track":{opacity:1,backgroundColor:t.palette.mode==="dark"?"#8796A5":"#aab4be",borderRadius:20/2}}));function vn({checked:t,onChange:s,label:n}){const a=h.useCallback(()=>{s(!t)},[t,s]);return e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:12},children:[e.jsx(Ra,{checked:t,onChange:o=>s(o.target.checked),inputProps:{"aria-label":"Toggle dark mode"}}),n?e.jsx("button",{type:"button",onClick:a,style:{border:"none",background:"transparent",padding:0,margin:0,color:"inherit",font:"inherit",cursor:"pointer",display:"inline-flex",alignItems:"center"},children:n}):null]})}const Jt="themePreference";function _a(){try{return!!(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches)}catch{return!1}}function Ue(t){return t==="dark"?!0:t==="light"?!1:_a()}async function jn(){try{const t=localStorage.getItem(Jt);if(t==="light"||t==="dark"||t==="system")return t}catch{}try{const t=await xn(Jt);if(t==="light"||t==="dark"||t==="system")return t}catch{}return"system"}async function Nn(t){try{await qt(Jt,t)}catch{}try{localStorage.setItem(Jt,t)}catch{}}function kn(t){let s;try{s=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)")}catch{}if(!s)return()=>{};const n=a=>{t(!!a.matches)};return s.addEventListener?s.addEventListener("change",n):s.addListener&&s.addListener(n),()=>{s.removeEventListener?s.removeEventListener("change",n):s.removeListener&&s.removeListener(n)}}function Sn(){const[t,s]=W.useState("system"),[n,a]=W.useState(()=>{try{return document.documentElement.classList.contains("dark")}catch{return Ue("system")}});W.useEffect(()=>{const r=i=>{const l=i&&i.detail||{};(l.pref==="light"||l.pref==="dark"||l.pref==="system")&&l.pref!==t&&s(l.pref),typeof l.dark=="boolean"&&l.dark!==n&&a(l.dark)};return window.addEventListener("theme:change",r),()=>window.removeEventListener("theme:change",r)},[t,n]),W.useEffect(()=>{let r=!0;return jn().then(i=>{r&&(s(i),a(Ue(i)))}),()=>{r=!1}},[]),W.useEffect(()=>{document.documentElement.classList.toggle("dark",n),n?document.body.classList.add("dark-bg"):document.body.classList.remove("dark-bg");let r=document.querySelector('meta[name="theme-color"]');r||(r=document.createElement("meta"),r.setAttribute("name","theme-color"),document.head.appendChild(r)),r.setAttribute("content",n?"#000000":"#ffffff")},[n]),W.useEffect(()=>{try{Nn(t)}catch{}try{window.dispatchEvent(new CustomEvent("theme:change",{detail:{pref:t,dark:Ue(t)}}))}catch{}},[t]),W.useEffect(()=>{if(t!=="system")return;a(Ue("system"));const r=kn(i=>a(!!i));return()=>r&&r()},[t]);const o=W.useCallback(r=>{s(r?"dark":"light"),a(!!r);try{window.dispatchEvent(new CustomEvent("theme:change",{detail:{pref:r?"dark":"light",dark:!!r}}))}catch{}},[]);return{themePref:t,setThemePref:s,dark:n,setDark:o}}function lt({className:t="glass p-6",text:s="Loading…"}){return e.jsx("div",{className:t,children:s})}function Ls({auth:t}){const{themePref:s,setThemePref:n,dark:a,setDark:o}=Sn(),r=We(),i=Es(),l=i.pathname==="/",[c,u]=W.useState(!1);W.useEffect(()=>{if(!l){u(!0);return}const p=()=>{try{const N=document.getElementById("home-logo");let j=0;if(C.current&&(j=Math.ceil(C.current.getBoundingClientRect().height||0)),!j){const g=getComputedStyle(document.documentElement).getPropertyValue("--header-h");j=parseInt(g||"72",10)||72}if(!N){u(window.scrollY>j);return}const z=N.getBoundingClientRect();u(z.bottom<=j)}catch{}};return p(),window.addEventListener("scroll",p,{passive:!0}),window.addEventListener("resize",p),()=>{window.removeEventListener("scroll",p),window.removeEventListener("resize",p)}},[l]);const d=i.pathname==="/"?"home":i.pathname.startsWith("/practice")?"practice":i.pathname.startsWith("/admin")?"admin":i.pathname.startsWith("/multiplayer")?"multiplayer":i.pathname.startsWith("/buzzer")?"buzzer":"generate",m=t?.user?.uid==="fkLJJ2R6HbdwqoXSxrLUybZ0IdH2",v=W.useMemo(()=>{const p=[{key:"home",label:"Home",path:"/"},{key:"practice",label:"Practice",path:"/practice"},{key:"generate",label:"Round Generator",path:"/round-generator"},{key:"multiplayer",label:"Multiplayer",path:"/multiplayer"},{key:"buzzer",label:"Buzzer",path:"/buzzer"}];return m&&p.push({key:"admin",label:"Admin",path:"/admin"}),p},[m]),[f,A]=W.useState({width:"0px",transform:"translateX(0px)"}),b=W.useRef([]),C=W.useRef(null);return W.useEffect(()=>{const N=v.map(z=>z.key).indexOf(d),j=N!==-1?b.current[N]?.current:null;if(j&&j.parentElement){const z=j.getBoundingClientRect(),g=j.parentElement.getBoundingClientRect();A(S=>{const w={width:`${z.width}px`,transform:`translateX(${z.left-g.left}px)`};return S.width===w.width&&S.transform===w.transform?S:w})}},[d,i.pathname,v]),W.useEffect(()=>{const p=()=>{try{if(!C.current)return;const j=C.current.getBoundingClientRect();if(j&&j.height){const z=Math.ceil(j.height);document.documentElement.style.setProperty("--header-h",`${z}px`)}}catch{}};p();const N="ResizeObserver"in window?new ResizeObserver(p):null;return N&&C.current&&N.observe(C.current),window.addEventListener("resize",p),()=>{window.removeEventListener("resize",p),N&&N.disconnect()}},[d,a]),e.jsx("header",{ref:C,className:"header-bar",style:{overflow:"visible"},children:e.jsxs("div",{className:"w-full px-3 sm:px-4 py-2 sm:py-3 flex items-center justify-between",style:{position:"relative",zIndex:10},children:[e.jsxs("div",{className:"brand-cluster flex items-center gap-2",style:{transition:"opacity .35s ease, transform .35s ease",opacity:c?1:0,transform:c?"translateY(0) scale(1)":"translateY(8px) scale(0.98)",pointerEvents:c?"auto":"none"},"aria-hidden":l&&!c,children:[e.jsx("img",{src:"/logo.png",alt:"atombowl Logo",className:"w-8 h-8 sm:w-9 sm:h-9"}),e.jsx("div",{className:"font-semibold tracking-tight hidden lg:block text-[#121930] dark:text-white",children:"atombowl"}),e.jsx("div",{className:"font-semibold tracking-tight hidden sm:block lg:hidden text-[#121930] dark:text-white",children:"DSB"})]}),e.jsxs("nav",{className:"tabs flex items-center gap-2 relative overflow-x-auto whitespace-nowrap",style:{position:"relative"},children:[v.map((p,N)=>e.jsx("div",{ref:j=>{b.current[N]||(b.current[N]={current:null}),b.current[N].current=j},className:`tab ${d===p.key?"active":""}`,style:{padding:"16px 24px",cursor:"pointer",textAlign:"center",position:"relative",zIndex:11,textTransform:"lowercase",color:d===p.key?"#ffffff":a?"rgba(229, 231, 235, 0.9)":"#1f2a44",fontWeight:d===p.key?"600":"500",background:d===p.key?a?"rgba(60, 80, 255, 0.35)":"linear-gradient(135deg, rgba(59,130,246,0.92), rgba(99,102,241,0.9))":a?"rgba(255,255,255,0.08)":"rgba(17, 25, 40, 0.06)",borderRadius:"16px",transition:"background 0.3s, color 0.3s, box-shadow 0.3s",boxShadow:d===p.key?a?"0 2px 12px -2px rgba(60,80,255,0.18)":"0 6px 18px -6px rgba(37, 99, 235, 0.45)":a?"none":"inset 0 0 0 1px rgba(17, 25, 40, 0.08)"},onClick:()=>{try{p.key==="admin"?(document.body.classList.add("admin-border-on"),document.documentElement.classList.add("admin-border-on")):(document.body.classList.remove("admin-border-on"),document.documentElement.classList.remove("admin-border-on"))}catch{}r(p.path)},children:p.label},p.path)),e.jsx("div",{className:"slider",style:{position:"absolute",bottom:0,left:0,height:a?"4px":"6px",background:a?"linear-gradient(90deg,rgba(60,80,255,0.7),rgba(120,80,255,0.7))":"linear-gradient(90deg, #3b82f6, #a78bfa)",borderRadius:a?"2px":"3px",boxShadow:a?"0 2px 8px rgba(60,80,255,0.18)":"0 6px 18px -6px rgba(37, 99, 235, 0.5)",transition:"transform 0.3s cubic-bezier(.4,0,.2,1), width 0.3s cubic-bezier(.4,0,.2,1)",zIndex:10,...f}}),e.jsx("div",{className:"ml-2 sm:ml-4",children:e.jsxs("div",{className:"relative inline-flex items-center group",children:[s!=="system"&&e.jsx("button",{type:"button",onClick:()=>{n("system")},className:"mr-2 hidden group-hover:inline-flex items-center px-2 py-1 rounded text-xs border border-black/10 dark:border-white/20 bg-white/70 dark:bg-black/40 backdrop-blur-sm text-black dark:text-white hover:bg-white/90 dark:hover:bg-black/60 transition","aria-label":"Follow system theme",title:"Follow system",children:"Follow system"}),e.jsx(vn,{checked:a,onChange:p=>o(p)})]})}),e.jsx("div",{className:"ml-2 sm:ml-3",children:t?.loading?e.jsx(lt,{className:"text-sm opacity-70"}):t?.user?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm opacity-80 max-w-[12rem] truncate hidden md:inline",children:t.user.email||t.user.displayName}),e.jsx("button",{className:"btn btn-top-maroon",onClick:t.logout,children:"Logout"})]}):e.jsx(Kt,{to:"/signin",className:"btn btn-primary hidden xs:inline-flex",children:"Sign in"})})]})]})})}function st({children:t,auth:s}){return e.jsxs(e.Fragment,{children:[e.jsx(Ls,{auth:s}),e.jsx("main",{className:"w-full px-4 pb-8 app-main text-black dark:text-white",children:t}),e.jsx("footer",{className:"w-full px-4 pb-8 text-center text-black/60 dark:text-white/60",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:"Built with Firebase • Vite • Tailwind"}),e.jsxs("div",{className:"text-xs flex flex-wrap gap-2 justify-center","aria-label":"Legal and policy links",children:[e.jsx("a",{href:"/terms-of-service",className:"hover:underline focus:outline-none focus:ring-1 focus:ring-current",rel:"nofollow",children:"Terms of Service"}),e.jsx("span",{"aria-hidden":"true",children:"•"}),e.jsx("a",{href:"/privacy-policy",className:"hover:underline focus:outline-none focus:ring-1 focus:ring-current",rel:"nofollow",children:"Privacy Policy"})]})]})})]})}const Ta=h.lazy(()=>at(()=>import("./PracticeMode-CT2TKXw5.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48]))),Da=h.lazy(()=>at(()=>import("./Admin-BCt9CKhW.js"),__vite__mapDeps([49,1,2,15,5,6,7,8,9,16,3,4,10,11,12,13,14,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48]))),La=h.lazy(()=>at(()=>import("./RoundGenerator-CXutUWPu.js"),__vite__mapDeps([50,1,2,3,4,5,6,7,8,9,10,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,31,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48])));function bs(){const t=Xt(),s=Ce(),n=Es();We();const{generatedPairs:a,setGeneratedPairs:o,pushGeneratedRound:r}=wn(),i=n.pathname.startsWith("/practice")?"practice":n.pathname.startsWith("/admin")?"admin":n.pathname.startsWith("/buzzer")?"buzzer":"generate";return e.jsxs("div",{className:"min-h-screen app-radial-bg dark:app-radial-bg transition-colors glass-backdrop",children:[i==="practice"?e.jsx(wa,{}):e.jsx(ya,{}),e.jsxs(st,{auth:s,children:[i!=="admin"&&e.jsxs("div",{className:"glass p-6 mb-4",children:[e.jsx("h1",{className:"text-xl font-semibold",children:i==="practice"?"Practice Mode":"Round Generator"}),e.jsx("p",{className:"text-sm opacity-80",children:i==="practice"?"Drill Science Bowl toss-ups and bonuses with keyboard shortcuts, adjustable readout, and instant feedback.":"Generate custom Science Bowl rounds from curated tournaments. Filter by category, pick rounds, include toss-ups and bonuses, and export to PDF."})]}),t.loadingTournaments&&e.jsx("div",{className:"glass p-6",children:"Loading tournaments…"}),t.errorTournaments&&e.jsxs("div",{className:"glass p-6 text-red-600",children:["Failed to load tournaments: ",String(t.errorTournaments)]}),!t.loadingTournaments&&!t.errorTournaments&&e.jsx("div",{className:"space-y-6",children:e.jsx(h.Suspense,{fallback:e.jsx("div",{className:"glass p-6",children:"Loading…"}),children:i==="practice"?e.jsx(Ta,{lazy:t}):i==="admin"?e.jsx(Da,{auth:s}):e.jsx(La,{lazy:t,auth:s,persistedGenerated:a,setPersistedGenerated:o,onNewRound:r})})})]})]})}function Oa(t){const s=Math.max(0,t),n=Math.floor(s/1e3),a=Math.floor(n/86400),o=Math.floor(n%86400/3600),r=Math.floor(n%3600/60),i=n%60;return{days:a,hours:o,minutes:r,seconds:i}}function Pa(t){return String(t).padStart(2,"0")}function Ut({value:t,label:s}){return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"rounded-2xl px-5 sm:px-6 py-4 sm:py-5 text-center bg-white/25 dark:bg-black/25 backdrop-blur-sm border border-white/30 dark:border-white/20 shadow-lg",children:[e.jsx("div",{className:"text-4xl sm:text-5xl md:text-6xl font-extrabold tracking-tight text-[#121930] dark:text-white tabular-nums",children:Pa(t)}),e.jsx("div",{className:"mt-1 text-xs sm:text-sm uppercase tracking-wider text-black/60 dark:text-white/60",children:s})]}),e.jsx("div",{className:"absolute -inset-0.5 -z-10 rounded-3xl bg-gradient-to-tr from-fuchsia-500/30 via-sky-500/30 to-emerald-500/30 blur-xl"})]})}function Ba(){const[t,s]=h.useState(null),[n,a]=h.useState(""),[o,r]=h.useState(()=>Date.now()),[i,l]=h.useState(!0);h.useEffect(()=>{let f=!1;async function A(){try{const b=ee(),C=await mn(nt(b,"countdowns")),p=[];C.forEach(j=>{const z=j.data();let g=z?.time;if(g&&typeof g.toMillis=="function"&&(g=g.toMillis()),typeof g=="string"){const S=Date.parse(g);Number.isNaN(S)||(g=S)}typeof g=="number"&&(g<1e12&&(g=g*1e3),p.push({timeMs:g,name:typeof z?.name=="string"&&z.name.trim()?z.name.trim():j.id}))});const N=p.filter(j=>j.timeMs>Date.now()).sort((j,z)=>j.timeMs-z.timeMs)[0]||null;f||(s(N?new Date(N.timeMs):null),a(N?N.name:""))}catch(b){console.error("Failed to load countdowns:",b),f||(s(null),a(""))}finally{f||l(!1)}}return A(),()=>{f=!0}},[]),h.useEffect(()=>{const f=setInterval(()=>r(Date.now()),1e3);return()=>clearInterval(f)},[]);const c=h.useMemo(()=>t?Math.max(0,t.getTime()-o):0,[t,o]),{days:u,hours:d,minutes:m,seconds:v}=h.useMemo(()=>Oa(c),[c]);return i||!t?null:e.jsx("section",{id:"countdown",className:"relative mx-auto max-w-6xl px-3 sm:px-4 pt-4 sm:pt-6 md:pt-10 pb-8 sm:pb-10",children:e.jsxs("div",{className:"relative grid place-items-center text-center",children:[e.jsxs("div",{className:"mb-4 inline-flex items-center gap-2 rounded-full border border-black/10 dark:border-white/10 bg-white/70 dark:bg-black/30 px-3 py-1 backdrop-blur",children:[e.jsx("span",{className:"h-2 w-2 rounded-full bg-emerald-500 animate-pulse"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium text-[#121930] dark:text-white",children:"next tournament starts in"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5 sm:gap-6",children:[e.jsxs("div",{className:"flex flex-wrap items-stretch justify-center gap-3 sm:gap-4 md:gap-6",children:[e.jsx(Ut,{value:u,label:u===1?"day":"days"}),e.jsx(Ut,{value:d,label:d===1?"hour":"hours"}),e.jsx(Ut,{value:m,label:m===1?"minute":"minutes"}),e.jsx(Ut,{value:v,label:v===1?"second":"seconds"})]}),e.jsxs("div",{className:"text-xs sm:text-sm text-black/70 dark:text-white/70",children:["until ",e.jsx("span",{className:"font-semibold text-[#121930] dark:text-white",children:n})," — ",t.toLocaleString()]})]})]})})}function Fa({mouseForce:t=20,cursorSize:s=100,isViscous:n=!1,viscous:a=30,iterationsViscous:o=32,iterationsPoisson:r=32,dt:i=.014,BFECC:l=!0,resolution:c=.5,isBounce:u=!1,colors:d=["#5227FF","#FF9FFC","#B19EEF"],backgroundColor:m="transparent",style:v={},className:f="",autoDemo:A=!0,autoSpeed:b=.5,autoIntensity:C=2.2,takeoverDuration:p=.25,autoResumeDelay:N=1e3,autoRampDuration:j=.6}){const z=h.useRef(null),g=h.useRef(null),S=h.useRef(null),w=h.useRef(null),E=h.useRef(null),k=h.useRef(!0),_=h.useRef(null);return h.useEffect(()=>{if(!z.current)return;function R(H){let x;Array.isArray(H)&&H.length>0?H.length===1?x=[H[0],H[0]]:x=H:x=["#ffffff","#ffffff"];const O=x.length,B=new Uint8Array(O*4);for(let Q=0;Q<O;Q++){const he=new us(x[Q]);B[Q*4+0]=Math.round(he.r*255),B[Q*4+1]=Math.round(he.g*255),B[Q*4+2]=Math.round(he.b*255),B[Q*4+3]=255}const Y=new Wr(B,O,1,$r);return Y.magFilter=Ot,Y.minFilter=Ot,Y.wrapS=Pt,Y.wrapT=Pt,Y.generateMipmaps=!1,Y.needsUpdate=!0,Y}const T=R(d);function F(H){if(H==="transparent"||H==null)return new Bt(0,0,0,0);if(Array.isArray(H)&&H.length===4){const[x,O,B,Y]=H;return new Bt(x??0,O??0,B??0,Y??1)}try{const x=new us(H);return new Bt(x.r,x.g,x.b,1)}catch{return new Bt(0,0,0,0)}}const I=F(m);class G{constructor(){this.width=0,this.height=0,this.aspect=1,this.pixelRatio=1,this.isMobile=!1,this.breakpoint=768,this.fboWidth=null,this.fboHeight=null,this.time=0,this.delta=0,this.container=null,this.renderer=null,this.clock=null}init(x){this.container=x,this.pixelRatio=Math.min(window.devicePixelRatio||1,2),this.resize(),this.renderer=new Gr({antialias:!0,alpha:!0}),this.renderer.autoClear=!1,this.renderer.setClearColor(new us(0),0),this.renderer.setPixelRatio(this.pixelRatio),this.renderer.setSize(this.width,this.height),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.renderer.domElement.style.display="block",this.clock=new Hr,this.clock.start()}resize(){if(!this.container)return;const x=this.container.getBoundingClientRect();this.width=Math.max(1,Math.floor(x.width)),this.height=Math.max(1,Math.floor(x.height)),this.aspect=this.width/this.height,this.renderer&&this.renderer.setSize(this.width,this.height,!1)}update(){this.delta=this.clock.getDelta(),this.time+=this.delta}}const L=new G;class q{constructor(){this.mouseMoved=!1,this.coords=new fe,this.coords_old=new fe,this.diff=new fe,this.timer=null,this.container=null,this._onMouseMove=this.onDocumentMouseMove.bind(this),this._onTouchStart=this.onDocumentTouchStart.bind(this),this._onTouchMove=this.onDocumentTouchMove.bind(this),this._onTouchEnd=this.onTouchEnd.bind(this),this.isHoverInside=!1,this.hasUserControl=!1,this.isAutoActive=!1,this.autoIntensity=2,this.takeoverActive=!1,this.takeoverStartTime=0,this.takeoverDuration=.25,this.takeoverFrom=new fe,this.takeoverTo=new fe,this.onInteract=null}init(x){this.container=x,document.addEventListener("mousemove",this._onMouseMove,!1),document.addEventListener("touchstart",this._onTouchStart,!1),document.addEventListener("touchmove",this._onTouchMove,!1),document.addEventListener("touchend",this._onTouchEnd,!1)}dispose(){document.removeEventListener("mousemove",this._onMouseMove,!1),document.removeEventListener("touchstart",this._onTouchStart,!1),document.removeEventListener("touchmove",this._onTouchMove,!1),document.removeEventListener("touchend",this._onTouchEnd,!1)}setCoords(x,O){if(!this.container)return;this.timer&&clearTimeout(this.timer);const B=this.container.getBoundingClientRect(),Y=(x-B.left)/B.width,Q=(O-B.top)/B.height;this.coords.set(Y*2-1,-(Q*2-1)),this.mouseMoved=!0,this.timer=setTimeout(()=>{this.mouseMoved=!1},100)}setNormalized(x,O){this.coords.set(x,O),this.mouseMoved=!0}onDocumentMouseMove(x){this.onInteract&&this.onInteract();const O=this.container?.getBoundingClientRect(),B=!!O&&x.clientX>=O.left&&x.clientX<=O.right&&x.clientY>=O.top&&x.clientY<=O.bottom;if(this.isHoverInside=B,this.isAutoActive&&!this.hasUserControl&&!this.takeoverActive){const Y=(x.clientX-O.left)/O.width,Q=(x.clientY-O.top)/O.height;this.takeoverFrom.copy(this.coords),this.takeoverTo.set(Y*2-1,-(Q*2-1)),this.takeoverStartTime=performance.now(),this.takeoverActive=!0,this.hasUserControl=!0,this.isAutoActive=!1;return}this.setCoords(x.clientX,x.clientY),this.hasUserControl=!0}onDocumentTouchStart(x){if(x.touches.length===1){const O=x.touches[0];this.onInteract&&this.onInteract(),this.setCoords(O.pageX,O.pageY),this.hasUserControl=!0}}onDocumentTouchMove(x){if(x.touches.length===1){const O=x.touches[0];this.onInteract&&this.onInteract(),this.setCoords(O.pageX,O.pageY)}}onTouchEnd(){this.isHoverInside=!1}update(){if(this.takeoverActive){const x=(performance.now()-this.takeoverStartTime)/(this.takeoverDuration*1e3);if(x>=1)this.takeoverActive=!1,this.coords.copy(this.takeoverTo),this.coords_old.copy(this.coords),this.diff.set(0,0);else{const O=x*x*(3-2*x);this.coords.copy(this.takeoverFrom).lerp(this.takeoverTo,O)}}this.diff.subVectors(this.coords,this.coords_old),this.coords_old.copy(this.coords),this.coords_old.x===0&&this.coords_old.y===0&&this.diff.set(0,0),this.isAutoActive&&!this.takeoverActive&&this.diff.multiplyScalar(this.autoIntensity)}}const P=new q;class K{constructor(x,O,B){this.mouse=x,this.manager=O,this.enabled=B.enabled,this.speed=B.speed,this.resumeDelay=B.resumeDelay||3e3,this.rampDurationMs=(B.rampDuration||0)*1e3,this.active=!1,this.current=new fe(0,0),this.target=new fe,this.lastTime=performance.now(),this.activationTime=0,this.margin=.2,this._tmpDir=new fe,this.pickNewTarget()}pickNewTarget(){const x=Math.random;this.target.set((x()*2-1)*(1-this.margin),(x()*2-1)*(1-this.margin))}forceStop(){this.active=!1,this.mouse.isAutoActive=!1}update(){if(!this.enabled)return;const x=performance.now();if(x-this.manager.lastUserInteraction<this.resumeDelay){this.active&&this.forceStop();return}if(this.mouse.isHoverInside){this.active&&this.forceStop();return}if(this.active||(this.active=!0,this.current.copy(this.mouse.coords),this.lastTime=x,this.activationTime=x),!this.active)return;this.mouse.isAutoActive=!0;let B=(x-this.lastTime)/1e3;this.lastTime=x,B>.2&&(B=.016);const Y=this._tmpDir.subVectors(this.target,this.current),Q=Y.length();if(Q<.01){this.pickNewTarget();return}Y.normalize();let he=1;if(this.rampDurationMs>0){const Ze=Math.min(1,(x-this.activationTime)/this.rampDurationMs);he=Ze*Ze*(3-2*Ze)}const He=this.speed*B*he,pe=Math.min(He,Q);this.current.addScaledVector(Y,pe),this.mouse.setNormalized(this.current.x,this.current.y)}}const te=`
  attribute vec3 position;
  uniform vec2 px;
  uniform vec2 boundarySpace;
  varying vec2 uv;
  precision highp float;
  void main(){
  vec3 pos = position;
  vec2 scale = 1.0 - boundarySpace * 2.0;
  pos.xy = pos.xy * scale;
  uv = vec2(0.5)+(pos.xy)*0.5;
  gl_Position = vec4(pos, 1.0);
}
`,Me=`
  attribute vec3 position;
  uniform vec2 px;
  precision highp float;
  varying vec2 uv;
  void main(){
  vec3 pos = position;
  uv = 0.5 + pos.xy * 0.5;
  vec2 n = sign(pos.xy);
  pos.xy = abs(pos.xy) - px * 1.0;
  pos.xy *= n;
  gl_Position = vec4(pos, 1.0);
}
`,J=`
    precision highp float;
    attribute vec3 position;
    attribute vec2 uv;
    uniform vec2 center;
    uniform vec2 scale;
    uniform vec2 px;
    varying vec2 vUv;
    void main(){
    vec2 pos = position.xy * scale * 2.0 * px + center;
    vUv = uv;
    gl_Position = vec4(pos, 0.0, 1.0);
}
`,ie=`
    precision highp float;
    uniform sampler2D velocity;
    uniform float dt;
    uniform bool isBFECC;
    uniform vec2 fboSize;
    uniform vec2 px;
    varying vec2 uv;
    void main(){
    vec2 ratio = max(fboSize.x, fboSize.y) / fboSize;
    if(isBFECC == false){
        vec2 vel = texture2D(velocity, uv).xy;
        vec2 uv2 = uv - vel * dt * ratio;
        vec2 newVel = texture2D(velocity, uv2).xy;
        gl_FragColor = vec4(newVel, 0.0, 0.0);
    } else {
        vec2 spot_new = uv;
        vec2 vel_old = texture2D(velocity, uv).xy;
        vec2 spot_old = spot_new - vel_old * dt * ratio;
        vec2 vel_new1 = texture2D(velocity, spot_old).xy;
        vec2 spot_new2 = spot_old + vel_new1 * dt * ratio;
        vec2 error = spot_new2 - spot_new;
        vec2 spot_new3 = spot_new - error / 2.0;
        vec2 vel_2 = texture2D(velocity, spot_new3).xy;
        vec2 spot_old2 = spot_new3 - vel_2 * dt * ratio;
        vec2 newVel2 = texture2D(velocity, spot_old2).xy; 
        gl_FragColor = vec4(newVel2, 0.0, 0.0);
    }
}
`,je=`
    precision highp float;
    uniform sampler2D velocity;
    uniform sampler2D palette;
    uniform vec4 bgColor;
    varying vec2 uv;
    void main(){
    vec2 vel = texture2D(velocity, uv).xy;
    float lenv = clamp(length(vel), 0.0, 1.0);
    vec3 c = texture2D(palette, vec2(lenv, 0.5)).rgb;
    vec3 outRGB = mix(bgColor.rgb, c, lenv);
    float outA = mix(bgColor.a, 1.0, lenv);
    gl_FragColor = vec4(outRGB, outA);
}
`,Xe=`
    precision highp float;
    uniform sampler2D velocity;
    uniform float dt;
    uniform vec2 px;
    varying vec2 uv;
    void main(){
    float x0 = texture2D(velocity, uv-vec2(px.x, 0.0)).x;
    float x1 = texture2D(velocity, uv+vec2(px.x, 0.0)).x;
    float y0 = texture2D(velocity, uv-vec2(0.0, px.y)).y;
    float y1 = texture2D(velocity, uv+vec2(0.0, px.y)).y;
    float divergence = (x1 - x0 + y1 - y0) / 2.0;
    gl_FragColor = vec4(divergence / dt);
}
`,St=`
    precision highp float;
    uniform vec2 force;
    uniform vec2 center;
    uniform vec2 scale;
    uniform vec2 px;
    varying vec2 vUv;
    void main(){
    vec2 circle = (vUv - 0.5) * 2.0;
    float d = 1.0 - min(length(circle), 1.0);
    d *= d;
    gl_FragColor = vec4(force * d, 0.0, 1.0);
}
`,ts=`
    precision highp float;
    uniform sampler2D pressure;
    uniform sampler2D divergence;
    uniform vec2 px;
    varying vec2 uv;
    void main(){
    float p0 = texture2D(pressure, uv + vec2(px.x * 2.0, 0.0)).r;
    float p1 = texture2D(pressure, uv - vec2(px.x * 2.0, 0.0)).r;
    float p2 = texture2D(pressure, uv + vec2(0.0, px.y * 2.0)).r;
    float p3 = texture2D(pressure, uv - vec2(0.0, px.y * 2.0)).r;
    float div = texture2D(divergence, uv).r;
    float newP = (p0 + p1 + p2 + p3) / 4.0 - div;
    gl_FragColor = vec4(newP);
}
`,Ge=`
    precision highp float;
    uniform sampler2D pressure;
    uniform sampler2D velocity;
    uniform vec2 px;
    uniform float dt;
    varying vec2 uv;
    void main(){
    float step = 1.0;
    float p0 = texture2D(pressure, uv + vec2(px.x * step, 0.0)).r;
    float p1 = texture2D(pressure, uv - vec2(px.x * step, 0.0)).r;
    float p2 = texture2D(pressure, uv + vec2(0.0, px.y * step)).r;
    float p3 = texture2D(pressure, uv - vec2(0.0, px.y * step)).r;
    vec2 v = texture2D(velocity, uv).xy;
    vec2 gradP = vec2(p0 - p1, p2 - p3) * 0.5;
    v = v - gradP * dt;
    gl_FragColor = vec4(v, 0.0, 1.0);
}
`,At=`
    precision highp float;
    uniform sampler2D velocity;
    uniform sampler2D velocity_new;
    uniform float v;
    uniform vec2 px;
    uniform float dt;
    varying vec2 uv;
    void main(){
    vec2 old = texture2D(velocity, uv).xy;
    vec2 new0 = texture2D(velocity_new, uv + vec2(px.x * 2.0, 0.0)).xy;
    vec2 new1 = texture2D(velocity_new, uv - vec2(px.x * 2.0, 0.0)).xy;
    vec2 new2 = texture2D(velocity_new, uv + vec2(0.0, px.y * 2.0)).xy;
    vec2 new3 = texture2D(velocity_new, uv - vec2(0.0, px.y * 2.0)).xy;
    vec2 newv = 4.0 * old + v * dt * (new0 + new1 + new2 + new3);
    newv /= 4.0 * (1.0 + v * dt);
    gl_FragColor = vec4(newv, 0.0, 0.0);
}
`;class Be{constructor(x){this.props=x||{},this.uniforms=this.props.material?.uniforms,this.scene=null,this.camera=null,this.material=null,this.geometry=null,this.plane=null}init(){this.scene=new Qs,this.camera=new Zs,this.uniforms&&(this.material=new Ft(this.props.material),this.geometry=new hs(2,2),this.plane=new ms(this.geometry,this.material),this.scene.add(this.plane))}update(){L.renderer.setRenderTarget(this.props.output||null),L.renderer.render(this.scene,this.camera),L.renderer.setRenderTarget(null)}}class ss extends Be{constructor(x){super({material:{vertexShader:te,fragmentShader:ie,uniforms:{boundarySpace:{value:x.cellScale},px:{value:x.cellScale},fboSize:{value:x.fboSize},velocity:{value:x.src.texture},dt:{value:x.dt},isBFECC:{value:!0}}},output:x.dst}),this.uniforms=this.props.material.uniforms,this.init()}init(){super.init(),this.createBoundary()}createBoundary(){const x=new Vr,O=new Float32Array([-1,-1,0,-1,1,0,-1,1,0,1,1,0,1,1,0,1,-1,0,1,-1,0,-1,-1,0]);x.setAttribute("position",new Yr(O,3));const B=new Ft({vertexShader:Me,fragmentShader:ie,uniforms:this.uniforms});this.line=new Xr(x,B),this.scene.add(this.line)}update({dt:x,isBounce:O,BFECC:B}){this.uniforms.dt.value=x,this.line.visible=O,this.uniforms.isBFECC.value=B,super.update()}}class ns extends Be{constructor(x){super({output:x.dst}),this.init(x)}init(x){super.init();const O=new hs(1,1),B=new Ft({vertexShader:J,fragmentShader:St,blending:Qr,depthWrite:!1,uniforms:{px:{value:x.cellScale},force:{value:new fe(0,0)},center:{value:new fe(0,0)},scale:{value:new fe(x.cursor_size,x.cursor_size)}}});this.mouse=new ms(O,B),this.scene.add(this.mouse)}update(x){const O=P.diff.x/2*x.mouse_force,B=P.diff.y/2*x.mouse_force,Y=x.cursor_size*x.cellScale.x,Q=x.cursor_size*x.cellScale.y,he=Math.min(Math.max(P.coords.x,-1+Y+x.cellScale.x*2),1-Y-x.cellScale.x*2),He=Math.min(Math.max(P.coords.y,-1+Q+x.cellScale.y*2),1-Q-x.cellScale.y*2),pe=this.mouse.material.uniforms;pe.force.value.set(O,B),pe.center.value.set(he,He),pe.scale.value.set(x.cursor_size,x.cursor_size),super.update()}}class zt extends Be{constructor(x){super({material:{vertexShader:te,fragmentShader:At,uniforms:{boundarySpace:{value:x.boundarySpace},velocity:{value:x.src.texture},velocity_new:{value:x.dst_.texture},v:{value:x.viscous},px:{value:x.cellScale},dt:{value:x.dt}}},output:x.dst,output0:x.dst_,output1:x.dst}),this.init()}update({viscous:x,iterations:O,dt:B}){let Y,Q;this.uniforms.v.value=x;for(let he=0;he<O;he++)he%2===0?(Y=this.props.output0,Q=this.props.output1):(Y=this.props.output1,Q=this.props.output0),this.uniforms.velocity_new.value=Y.texture,this.props.output=Q,this.uniforms.dt.value=B,super.update();return Q}}class Qe extends Be{constructor(x){super({material:{vertexShader:te,fragmentShader:Xe,uniforms:{boundarySpace:{value:x.boundarySpace},velocity:{value:x.src.texture},px:{value:x.cellScale},dt:{value:x.dt}}},output:x.dst}),this.init()}update({vel:x}){this.uniforms.velocity.value=x.texture,super.update()}}class rs extends Be{constructor(x){super({material:{vertexShader:te,fragmentShader:ts,uniforms:{boundarySpace:{value:x.boundarySpace},pressure:{value:x.dst_.texture},divergence:{value:x.src.texture},px:{value:x.cellScale}}},output:x.dst,output0:x.dst_,output1:x.dst}),this.init()}update({iterations:x}){let O,B;for(let Y=0;Y<x;Y++)Y%2===0?(O=this.props.output0,B=this.props.output1):(O=this.props.output1,B=this.props.output0),this.uniforms.pressure.value=O.texture,this.props.output=B,super.update();return B}}class Ct extends Be{constructor(x){super({material:{vertexShader:te,fragmentShader:Ge,uniforms:{boundarySpace:{value:x.boundarySpace},pressure:{value:x.src_p.texture},velocity:{value:x.src_v.texture},px:{value:x.cellScale},dt:{value:x.dt}}},output:x.dst}),this.init()}update({vel:x,pressure:O}){this.uniforms.velocity.value=x.texture,this.uniforms.pressure.value=O.texture,super.update()}}class as{constructor(x){this.options={iterations_poisson:32,iterations_viscous:32,mouse_force:20,resolution:.5,cursor_size:100,viscous:30,isBounce:!1,dt:.014,isViscous:!1,BFECC:!0,...x},this.fbos={vel_0:null,vel_1:null,vel_viscous0:null,vel_viscous1:null,div:null,pressure_0:null,pressure_1:null},this.fboSize=new fe,this.cellScale=new fe,this.boundarySpace=new fe,this.init()}init(){this.calcSize(),this.createAllFBO(),this.createShaderPass()}getFloatType(){return/(iPad|iPhone|iPod)/i.test(navigator.userAgent)?qr:Jr}createAllFBO(){const O={type:this.getFloatType(),depthBuffer:!1,stencilBuffer:!1,minFilter:Ot,magFilter:Ot,wrapS:Pt,wrapT:Pt};for(let B in this.fbos)this.fbos[B]=new Kr(this.fboSize.x,this.fboSize.y,O)}createShaderPass(){this.advection=new ss({cellScale:this.cellScale,fboSize:this.fboSize,dt:this.options.dt,src:this.fbos.vel_0,dst:this.fbos.vel_1}),this.externalForce=new ns({cellScale:this.cellScale,cursor_size:this.options.cursor_size,dst:this.fbos.vel_1}),this.viscous=new zt({cellScale:this.cellScale,boundarySpace:this.boundarySpace,viscous:this.options.viscous,src:this.fbos.vel_1,dst:this.fbos.vel_viscous1,dst_:this.fbos.vel_viscous0,dt:this.options.dt}),this.divergence=new Qe({cellScale:this.cellScale,boundarySpace:this.boundarySpace,src:this.fbos.vel_viscous0,dst:this.fbos.div,dt:this.options.dt}),this.poisson=new rs({cellScale:this.cellScale,boundarySpace:this.boundarySpace,src:this.fbos.div,dst:this.fbos.pressure_1,dst_:this.fbos.pressure_0}),this.pressure=new Ct({cellScale:this.cellScale,boundarySpace:this.boundarySpace,src_p:this.fbos.pressure_0,src_v:this.fbos.vel_viscous0,dst:this.fbos.vel_0,dt:this.options.dt})}calcSize(){const x=Math.max(1,Math.round(this.options.resolution*L.width)),O=Math.max(1,Math.round(this.options.resolution*L.height)),B=1/x,Y=1/O;this.cellScale.set(B,Y),this.fboSize.set(x,O)}resize(){this.calcSize();for(let x in this.fbos)this.fbos[x].setSize(this.fboSize.x,this.fboSize.y)}update(){this.options.isBounce?this.boundarySpace.set(0,0):this.boundarySpace.copy(this.cellScale),this.advection.update({dt:this.options.dt,isBounce:this.options.isBounce,BFECC:this.options.BFECC}),this.externalForce.update({cursor_size:this.options.cursor_size,mouse_force:this.options.mouse_force,cellScale:this.cellScale});let x=this.fbos.vel_1;this.options.isViscous&&(x=this.viscous.update({viscous:this.options.viscous,iterations:this.options.iterations_viscous,dt:this.options.dt})),this.divergence.update({vel:x});const O=this.poisson.update({iterations:this.options.iterations_poisson});this.pressure.update({vel:x,pressure:O})}}class Mt{constructor(){this.init()}init(){this.simulation=new as,this.scene=new Qs,this.camera=new Zs,this.output=new ms(new hs(2,2),new Ft({vertexShader:te,fragmentShader:je,transparent:!0,depthWrite:!1,uniforms:{velocity:{value:this.simulation.fbos.vel_0.texture},boundarySpace:{value:new fe},palette:{value:T},bgColor:{value:I}}})),this.scene.add(this.output)}addScene(x){this.scene.add(x)}resize(){this.simulation.resize()}render(){L.renderer.setRenderTarget(null),L.renderer.render(this.scene,this.camera)}update(){this.simulation.update(),this.render()}}class is{constructor(x){this.props=x,L.init(x.$wrapper),P.init(x.$wrapper),P.autoIntensity=x.autoIntensity,P.takeoverDuration=x.takeoverDuration,this.lastUserInteraction=performance.now(),P.onInteract=()=>{this.lastUserInteraction=performance.now(),this.autoDriver&&this.autoDriver.forceStop()},this.autoDriver=new K(P,this,{enabled:x.autoDemo,speed:x.autoSpeed,resumeDelay:x.autoResumeDelay,rampDuration:x.autoRampDuration}),this.init(),this._loop=this.loop.bind(this),this._resize=this.resize.bind(this),window.addEventListener("resize",this._resize),this._onVisibility=()=>{document.hidden?this.pause():k.current&&this.start()},document.addEventListener("visibilitychange",this._onVisibility),this.running=!1}init(){this.props.$wrapper.prepend(L.renderer.domElement),this.output=new Mt}resize(){L.resize(),this.output.resize()}render(){this.autoDriver&&this.autoDriver.update(),P.update(),L.update(),this.output.update()}loop(){this.running&&(this.render(),w.current=requestAnimationFrame(this._loop))}start(){this.running||(this.running=!0,this._loop())}pause(){this.running=!1,w.current&&(cancelAnimationFrame(w.current),w.current=null)}dispose(){try{if(window.removeEventListener("resize",this._resize),document.removeEventListener("visibilitychange",this._onVisibility),P.dispose(),L.renderer){const x=L.renderer.domElement;x&&x.parentNode&&x.parentNode.removeChild(x),L.renderer.dispose()}}catch{}}}const me=z.current;me.style.position=me.style.position||"relative",me.style.overflow=me.style.overflow||"hidden";const Et=new is({$wrapper:me,autoDemo:A,autoSpeed:b,autoIntensity:C,takeoverDuration:p,autoResumeDelay:N,autoRampDuration:j});g.current=Et,(()=>{if(!g.current)return;const H=g.current.output?.simulation;if(!H)return;const x=H.options.resolution;Object.assign(H.options,{mouse_force:t,cursor_size:s,isViscous:n,viscous:a,iterations_viscous:o,iterations_poisson:r,dt:i,BFECC:l,resolution:c,isBounce:u}),c!==x&&H.resize()})(),Et.start();const Rt=new IntersectionObserver(H=>{const x=H[0],O=x.isIntersecting&&x.intersectionRatio>0;k.current=O,g.current&&(O&&!document.hidden?g.current.start():g.current.pause())},{threshold:[0,.01,.1]});Rt.observe(me),E.current=Rt;const ge=new ResizeObserver(()=>{g.current&&(_.current&&cancelAnimationFrame(_.current),_.current=requestAnimationFrame(()=>{g.current&&g.current.resize()}))});return ge.observe(me),S.current=ge,()=>{if(w.current&&cancelAnimationFrame(w.current),S.current)try{S.current.disconnect()}catch{}if(E.current)try{E.current.disconnect()}catch{}g.current&&g.current.dispose(),g.current=null}},[l,s,i,u,n,r,o,t,c,a,d,m,A,b,C,p,N,j]),h.useEffect(()=>{const R=g.current;if(!R)return;const T=R.output?.simulation;if(!T)return;const F=T.options.resolution;Object.assign(T.options,{mouse_force:t,cursor_size:s,isViscous:n,viscous:a,iterations_viscous:o,iterations_poisson:r,dt:i,BFECC:l,resolution:c,isBounce:u}),R.autoDriver&&(R.autoDriver.enabled=A,R.autoDriver.speed=b,R.autoDriver.resumeDelay=N,R.autoDriver.rampDurationMs=j*1e3,R.autoDriver.mouse&&(R.autoDriver.mouse.autoIntensity=C,R.autoDriver.mouse.takeoverDuration=p)),c!==F&&T.resize()},[t,s,n,a,o,r,i,l,c,u,A,b,C,p,N,j]),e.jsx("div",{ref:z,className:`w-full h-full relative overflow-hidden touch-none ${f||""}`,style:v})}function Ia(){const t=Ce(),{dark:s}=Sn(),n=!s;return e.jsxs("div",{className:"min-h-screen app-radial-bg dark:app-radial-bg transition-colors glass-backdrop relative",children:[e.jsx(ba,{}),e.jsx("div",{className:"fixed inset-0 z-0",children:e.jsx(Fa,{colors:n?["#2240c5ff","#3b82f6","#06b6d4"]:["#5227FF","#FF9FFC","#B19EEF"],backgroundColor:n?"#ffffff":"transparent",mouseForce:n?8:28,cursorSize:100,isViscous:!1,viscous:30,iterationsViscous:32,iterationsPoisson:32,resolution:.6,isBounce:!0,autoDemo:!0,autoSpeed:n?.3:.5,autoIntensity:2,takeoverDuration:.25,autoResumeDelay:3e3,autoRampDuration:.6})}),e.jsx("div",{className:"relative z-10",children:e.jsxs(st,{auth:t,children:[e.jsx("section",{id:"home-hero",className:"flex flex-col items-center justify-start text-center pt-12 sm:pt-16 md:pt-20 pb-8 sm:pb-10 md:pb-12",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"font-extrabold tracking-tight text-[#121930] dark:text-white",children:e.jsxs("span",{className:"inline-flex items-center justify-center gap-0 text-[2.6rem] sm:text-6xl md:text-7xl",children:[e.jsx("span",{children:"at"}),e.jsx("img",{id:"home-logo",src:"/logo.png",alt:"atom",className:"inline-block align-baseline",style:{height:"1.7em",width:"auto",margin:"0 -14px",transform:"translateY(2px)"}}),e.jsx("span",{children:"mbowl"})]})}),e.jsx("p",{className:"text-lg sm:text-xl md:text-2xl text-black/70 dark:text-white/70",children:"the premier science bowl experience"}),e.jsx("div",{className:"pt-2",children:e.jsx(Kt,{to:"/round-generator",className:"btn btn-fancy text-lg",children:"Get started"})}),e.jsx("div",{className:"mt-6",children:e.jsx(Ba,{})})]})}),e.jsxs("section",{id:"features",className:"max-w-6xl mx-auto px-3 sm:px-4 pt-6 sm:pt-8 md:pt-10 pb-16",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-center text-[#121930] dark:text-white mb-6 sm:mb-10",children:"what you can do"}),e.jsxs("div",{className:"grid gap-4 sm:gap-6 md:gap-8 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsx(tt,{title:"round generator",desc:"Build custom practice rounds from curated tournaments and categories in seconds.",to:"/round-generator",cta:"Generate rounds"}),e.jsx(tt,{title:"practice mode",desc:"Drill toss-ups and bonuses with keyboard-friendly controls and instant feedback.",to:"/practice",cta:"Start practicing"}),e.jsx(tt,{title:"multiplayer rooms",desc:"Create or join live rooms to buzz, chat, and practice together online.",to:"/multiplayer",cta:"Host or join"}),e.jsx(tt,{title:"buzzer",desc:"Simple real-time buzzer for scrims — share a code and you’re in.",to:"/buzzer",cta:"Open buzzer"}),e.jsx(tt,{title:"save & review",desc:"Save generated rounds to your account and review them any time.",to:"/round-generator",cta:"Save rounds"}),e.jsx(tt,{title:"visual bonuses",desc:"View supported visual bonus questions with images when available.",to:"/round-generator",cta:"See visuals"})]})]})]})})]})}function tt({title:t,desc:s,to:n,cta:a}){return e.jsxs("div",{className:"glass p-6 rounded-2xl h-full flex flex-col justify-between hover-lift",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xl font-semibold text-[#121930] dark:text-white",children:t}),e.jsx("p",{className:"text-black/70 dark:text-white/70 text-sm leading-relaxed",children:s})]}),e.jsx("div",{className:"pt-4",children:e.jsx(Kt,{to:n,className:"btn btn-outline-fancy",children:a})})]})}function $e(t,s){return se(t,"games",String(s).toUpperCase())}function Os(t,s,n){return se(t,"games",String(s).toUpperCase(),"players",n)}function Ua(t=6){const s="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";let n="";for(let a=0;a<t;a++)n+=s[Math.floor(Math.random()*s.length)];return n}async function Wa({hostUid:t,hostName:s}){if(!t)throw new Error("Not authenticated");const n=ee();for(let a=0;a<5;a++){const o=Ua(),r=$e(n,o);if(!(await we(r)).exists())return await _e(r,{code:o,hostUid:t,createdAt:yt(),phase:"lobby",state:{buzzerOpen:!1,cycle:0,winnerUid:null,winnerName:null,winnerAt:null}}),o}throw new Error("Failed to create game code")}async function An({code:t,uid:s,displayName:n}){if(!s)throw new Error("Not authenticated");const a=ee(),o=$e(a,t);if(!(await we(o)).exists())throw new Error("Game not found");return await _e(Os(a,t,s),{uid:s,displayName:n||"Player",joinedAt:yt(),score:0,stats:{correct:0,incorrect:0,interruptsCorrect:0,interruptsIncorrect:0}},{merge:!0}),!0}function zn({code:t,onGame:s,onPlayers:n}){const a=ee(),o=Gt($e(a,t),i=>{s?.(i.exists()?{id:i.id,...i.data()}:null)}),r=Gt(nt(a,"games",String(t).toUpperCase(),"players"),i=>{const l=[];i.forEach(c=>l.push({id:c.id,...c.data()})),l.sort((c,u)=>(c.displayName||"").localeCompare(u.displayName||"")),n?.(l)});return()=>{try{o()}catch{}try{r()}catch{}}}async function Cn({code:t,open:s,actorUid:n}){const a=ee(),o=$e(a,t);s?await ne(o,{"state.buzzerOpen":!0,"state.cycle":(await we(o)).data()?.state?.cycle+1||1,"state.winnerUid":null,"state.winnerName":null,"state.winnerAt":null}).catch(async()=>{await Ms(a,async r=>{const i=await r.get(o);if(!i.exists())throw new Error("Game missing");const c=(i.data()||{}).state||{},u=(typeof c.cycle=="number"?c.cycle:0)+1;r.update(o,{"state.buzzerOpen":!0,"state.cycle":u,"state.winnerUid":null,"state.winnerName":null,"state.winnerAt":null})})}):await ne(o,{"state.buzzerOpen":!1})}async function $a({code:t,uid:s,displayName:n}){const a=ee(),o=$e(a,t);try{return await Ms(a,async i=>{const l=await i.get(o);if(!l.exists())throw new Error("Game missing");const u=(l.data()||{}).state||{};return u.buzzerOpen?u.winnerUid?{ok:!1,reason:"already",winnerUid:u.winnerUid}:(i.update(o,{"state.winnerUid":s,"state.winnerName":n||null,"state.winnerAt":yt(),"state.buzzerOpen":!1}),{ok:!0,winnerUid:s}):{ok:!1,reason:"closed",winnerUid:u.winnerUid||null}})}catch(r){return{ok:!1,error:r?.message||String(r)}}}async function gt({code:t}){const s=ee(),n=$e(s,t);await ne(n,{"state.winnerUid":null,"state.winnerName":null,"state.winnerAt":null})}async function Ga({code:t,newHostUid:s}){const n=ee();await ne($e(n,t),{hostUid:s});const a=Os(n,t,s);try{await Cs(a)}catch{}}async function Ha({code:t,pairs:s,meta:n={}}){const a=ee(),o=$e(a,t),r=(Array.isArray(s)?s:[]).map(i=>({tossupId:i?.tossup?.id||i?.tossupId||null,bonusId:i?.bonus?.id||i?.bonusId||null}));await ne(o,{roundPairs:r,phase:"round",roundMeta:{questionType:n.questionType||null,count:r.length,categories:n.categories||[],tournaments:n.tournaments||[]}})}async function nn({code:t,uid:s,delta:n={}}){const a=ee(),o=Os(a,t,s),r=await we(o),i=r.exists()?r.data()||{}:{},l=i.stats||{},c={stats:{correct:(l.correct||0)+(n.correct||0),incorrect:(l.incorrect||0)+(n.incorrect||0),interruptsCorrect:(l.interruptsCorrect||0)+(n.interruptsCorrect||0),interruptsIncorrect:(l.interruptsIncorrect||0)+(n.interruptsIncorrect||0)},score:(i.score||0)+(n.points||0)};await ne(o,c)}function Pe({children:t}){const s=Ce();return e.jsxs("div",{className:"min-h-screen app-radial-bg dark:app-radial-bg transition-colors glass-backdrop",children:[e.jsx(Ls,{auth:s}),e.jsx("main",{className:"w-full px-4 py-8 app-main text-black dark:text-white",children:t}),e.jsx("footer",{className:"w-full px-4 pb-8 text-center text-black/60 dark:text-white/60",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:"Built with Firebase • Vite • Tailwind"}),e.jsxs("div",{className:"text-xs flex flex-wrap gap-2 justify-center","aria-label":"Legal and policy links",children:[e.jsx("a",{href:"/terms-of-service",className:"hover:underline focus:outline-none focus:ring-1 focus:ring-current",rel:"nofollow",children:"Terms of Service"}),e.jsx("span",{"aria-hidden":"true",children:"•"}),e.jsx("a",{href:"/privacy-policy",className:"hover:underline focus:outline-none focus:ring-1 focus:ring-current",rel:"nofollow",children:"Privacy Policy"})]})]})})]})}function qa(){const t=Ce(),s=We(),[n,a]=h.useState(""),[o,r]=h.useState(!1),[i,l]=h.useState(""),[c,u]=h.useState([]),[d,m]=h.useState([]);if(h.useEffect(()=>{if(!t.user)return;const b=ks(),C=Vs(nt(b,"games"),Ys("hostUid","==",t.user.uid)),p=Gt(C,z=>{const g=z.docs.map(S=>({id:S.id,...S.data()}));u(g)}),N=Vs(nt(b,"games"),Ys("players","array-contains",t.user.uid)),j=Gt(N,z=>{const g=z.docs.map(S=>({id:S.id,...S.data()}));m(g)});return()=>{p(),j()}},[t.user]),t.loading)return e.jsx(Pe,{children:e.jsx(lt,{})});if(!t.user)return e.jsx(Pe,{children:e.jsxs("div",{className:"glass p-6 max-w-lg mx-auto text-center space-y-4",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Buzzer"}),e.jsx("p",{children:"Please sign in to host or join a game."}),e.jsx("button",{className:"btn btn-primary",onClick:()=>s("/signin"),children:"Sign in"})]})});async function v(){r(!0),l("");try{const b=await Wa({hostUid:t.user.uid,hostName:t.user.displayName||t.user.email});s(`/buzzer/${b}`)}catch(b){l(b?.message||String(b))}finally{r(!1)}}async function f(b){b?.preventDefault();const C=(n||"").trim().toUpperCase();if(C){r(!0),l("");try{await An({code:C,uid:t.user.uid,displayName:t.user.displayName||t.user.email}),s(`/buzzer/${C}`)}catch(p){l(p?.message||String(p))}finally{r(!1)}}}async function A(b){if(confirm("Are you sure you want to end this game? This action cannot be undone."))try{const C=ks();await Cs(se(C,"games",b))}catch(C){l(C?.message||String(C))}}return e.jsxs(Pe,{children:[e.jsx(ka,{}),e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsxs("div",{className:"glass p-6 space-y-3",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Host a Game"}),e.jsx("p",{className:"text-sm opacity-80",children:"Create a room and share the code with players."}),e.jsx("button",{className:"btn btn-fancy",onClick:v,disabled:o,children:"Create Game"})]}),e.jsxs("div",{className:"glass p-6 space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Join a Game"}),e.jsxs("form",{onSubmit:f,className:"flex gap-2",children:[e.jsx("input",{type:"text",inputMode:"text",pattern:"[A-Za-z0-9]{4,8}",maxLength:8,placeholder:"Enter code",value:n,onChange:b=>a(b.target.value.toUpperCase()),className:"rounded-lg border border-black/10 dark:border-white/10 px-3 py-2 bg-white dark:bg-darkcard flex-1"}),e.jsx("button",{type:"submit",className:"btn btn-fancy",disabled:o||!n,children:"Join"})]}),i&&e.jsx("div",{className:"text-red-600 text-sm",children:i})]}),(c.length>0||d.length>0)&&e.jsxs("div",{className:"glass p-6 space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Active Games"}),c.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-medium",children:"Hosting"}),e.jsx("ul",{className:"space-y-1",children:c.map(b=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsxs("span",{children:["Room ",b.id," (",b.players?b.players.length:0," players)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-rejoin",onClick:()=>s(`/buzzer/${b.id}`),children:"Rejoin"}),e.jsx("button",{className:"btn btn-sm btn-red",onClick:()=>A(b.id),children:"End Game"})]})]},b.id))})]}),d.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-medium",children:"Playing"}),e.jsx("ul",{className:"space-y-1",children:d.map(b=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsxs("span",{children:["Room ",b.id," (",b.players?b.players.length:0," players)"]}),e.jsx("button",{className:"btn btn-sm btn-rejoin",onClick:()=>s(`/buzzer/${b.id}`),children:"Rejoin"})]},b.id))})]})]})]})]})}function Ja(){const{code:t}=Vt(),s=We(),n=Ce(),[a,o]=h.useState(null),[r,i]=h.useState([]),[l,c]=h.useState(!1),u=n?.user?.uid;h.useEffect(()=>{if(!t)return;const f=zn({code:t,onGame:o,onPlayers:i});return()=>f&&f()},[t]),h.useEffect(()=>{!n?.user||!t||!a||n.user.uid!==a.hostUid&&An({code:t,uid:n.user.uid,displayName:n.user.displayName||n.user.email}).catch(()=>{})},[n?.user,t,a]);const d=!!(a&&u&&a.hostUid===u),m=a?.state?.winnerUid?r.find(f=>f.uid===a.state.winnerUid)||{displayName:a.state.winnerName}:null;if(n.loading||!a)return e.jsx(Pe,{children:e.jsx(lt,{})});if(!n.user)return e.jsx(Pe,{children:e.jsx("div",{className:"glass p-6",children:"Please sign in to access this room."})});async function v(){if(a?.state?.buzzerOpen){c(!0);try{const f=await $a({code:t,uid:u,displayName:n.user.displayName||n.user.email})}finally{c(!1)}}}return e.jsx(Pe,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"glass p-6 flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm opacity-75",children:"Room"}),e.jsx("div",{className:"text-2xl font-semibold tracking-tight",children:t}),e.jsxs("div",{className:"text-sm opacity-75",children:["Host: ",a?.hostUid===u?"You":r.find(f=>f.uid===a?.hostUid)?.displayName||"Unknown"]})]}),d&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:`btn ${a?.state?.buzzerOpen?"btn-orange":"btn-fancy"}`,onClick:()=>Cn({code:t,open:!a?.state?.buzzerOpen,actorUid:u}),children:a?.state?.buzzerOpen?"Close Buzzer":"Open Buzzer"}),e.jsx("button",{className:"btn btn-ghost",onClick:()=>gt({code:t}),children:"Clear"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>s(`/buzzer/${t}/generate`),children:"Start Game"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4 items-start",children:[e.jsx("div",{className:"glass p-6 md:col-span-2 space-y-4 text-center",children:m?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm opacity-75",children:"Buzz winner"}),e.jsx("div",{className:"text-3xl font-bold",children:m.displayName||"Unknown"})]}):d?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm opacity-75",children:"Buzzer status"}),e.jsx("div",{className:"text-2xl font-semibold",children:a?.state?.buzzerOpen?"Open":"Closed"}),e.jsx("div",{className:"opacity-70 text-sm",children:"Hosts don't buzz. Use the controls to open/close."})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm opacity-75",children:"Press to buzz"}),e.jsx("button",{disabled:l||!a?.state?.buzzerOpen,onClick:v,className:`inline-flex items-center justify-center w-56 h-56 rounded-full text-2xl font-bold shadow-lg transition ${a?.state?.buzzerOpen?"bg-emerald-600 hover:bg-emerald-700 text-white":"bg-gray-300 dark:bg-gray-700 text-gray-600 dark:text-gray-400"} ${l?"opacity-70":""}`,"aria-live":"polite",children:"Buzz"}),!a?.state?.buzzerOpen&&e.jsx("div",{className:"text-sm opacity-75",children:"Waiting for host to open buzzer…"})]})}),e.jsxs("div",{className:"glass p-6 space-y-3",children:[e.jsx("div",{className:"font-semibold",children:"Players"}),e.jsx("ul",{className:"space-y-1",children:r.map(f=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"truncate pr-2",children:f.displayName||f.uid}),d&&f.uid!==a.hostUid&&e.jsx("button",{className:"chip",onClick:()=>Ga({code:t,newHostUid:f.uid}),children:"Make host"})]},f.uid))})]})]})]})})}const Ka=h.lazy(()=>at(()=>import("./RoundGenerator-CXutUWPu.js"),__vite__mapDeps([50,1,2,3,4,5,6,7,8,9,10,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,31,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48])));function Va({children:t}){const s=Ce();return e.jsxs("div",{className:"min-h-screen app-radial-bg dark:app-radial-bg transition-colors glass-backdrop",children:[e.jsx(Ls,{auth:s}),e.jsx("main",{className:"w-full px-4 py-8 app-main text-black dark:text-white",children:t}),e.jsx("footer",{className:"w-full px-4 pb-8 text-center text-black/60 dark:text-white/60",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:"Built with Firebase • Vite • Tailwind"}),e.jsxs("div",{className:"text-xs flex flex-wrap gap-2 justify-center","aria-label":"Legal and policy links",children:[e.jsx("a",{href:"/terms-of-service",className:"hover:underline focus:outline-none focus:ring-1 focus:ring-current",rel:"nofollow",children:"Terms of Service"}),e.jsx("span",{"aria-hidden":"true",children:"•"}),e.jsx("a",{href:"/privacy-policy",className:"hover:underline focus:outline-none focus:ring-1 focus:ring-current",rel:"nofollow",children:"Privacy Policy"})]})]})})]})}function Ya(){const{code:t}=Vt(),s=We(),{generatedPairs:n,setGeneratedPairs:a,pushGeneratedRound:o}=wn(),r=Ce(),i=Xt();async function l(){if(!n||n.length===0){window.alert?.("Generate a round first.");return}const c=new Set,u=new Set;n.forEach(d=>{d?.tossup&&(d.tossup.tournament&&c.add(d.tossup.tournament),d.tossup.category&&u.add(d.tossup.category)),d?.bonus&&(d.bonus.tournament&&c.add(d.bonus.tournament),d.bonus.category&&u.add(d.bonus.category))}),await Ha({code:t,pairs:n,meta:{tournaments:Array.from(c),categories:Array.from(u)}}),s(`/buzzer/${t}/round`)}return e.jsx(Va,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"glass p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm opacity-70",children:"Room"}),e.jsx("div",{className:"text-xl font-semibold",children:t})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-ghost",onClick:()=>s(`/buzzer/${t}`),children:"Back to Lobby"}),e.jsx("button",{className:"btn btn-primary",onClick:l,children:"Use This Round"})]})]}),e.jsx(h.Suspense,{fallback:e.jsx("div",{className:"glass p-6",children:"Loading…"}),children:e.jsx(Ka,{lazy:i,auth:r,persistedGenerated:n,setPersistedGenerated:a,onNewRound:o})})]})})}const Xa=W.lazy(()=>at(()=>import("./vendor-react-katex-CCCXQq7R.js").then(t=>t.r),__vite__mapDeps([96,2,1,97,47,48])).then(t=>({default:t.BlockMath}))),Qa=W.lazy(()=>at(()=>import("./vendor-react-katex-CCCXQq7R.js").then(t=>t.r),__vite__mapDeps([96,2,1,97,47,48])).then(t=>({default:t.InlineMath})));function Re({children:t}){if(typeof t!="string")return e.jsx(e.Fragment,{children:t});const s=/(\$\$[\s\S]+?\$\$|\$[^\$\n]+?\$)/g,n=[];let a=0,o,r=0;for(;(o=s.exec(t))!==null;){o.index>a&&n.push(t.slice(a,o.index));const i=o[0];i.startsWith("$$")?n.push(e.jsx(h.Suspense,{fallback:e.jsx("span",{children:"[math]"},r++),children:e.jsx(Xa,{children:i.slice(2,-2)},r++)})):i.startsWith("$")&&n.push(e.jsx(h.Suspense,{fallback:e.jsx("span",{children:"[math]"},r++),children:e.jsx(Qa,{children:i.slice(1,-1)},r++)})),a=s.lastIndex}return a<t.length&&n.push(t.slice(a)),e.jsx(e.Fragment,{children:n})}function Za(){const{code:t}=Vt(),s=Ce(),n=We(),[a,o]=h.useState(null),[r,i]=h.useState([]),l=Xt(),c=!!(s?.user&&a?.hostUid===s.user.uid);h.useEffect(()=>{if(!t)return;const S=zn({code:t,onGame:o,onPlayers:i});return()=>S&&S()},[t]);const u=Array.from(new Set(a?.roundMeta?.tournaments||[]));h.useEffect(()=>{u.length!==0&&(async()=>{try{await l.ensureLoaded(u)}catch{}})()},[JSON.stringify(u)]);const d=h.useMemo(()=>l.getLoadedQuestions(u),[l,JSON.stringify(u)]),m=h.useMemo(()=>{const S=new Map;for(const w of d)S.set(w.id,w);return S},[d]),v=h.useMemo(()=>(Array.isArray(a?.roundPairs)?a.roundPairs:[]).map(w=>({tossup:w.tossupId&&m.get(w.tossupId)||null,bonus:w.bonusId&&m.get(w.bonusId)||null})),[a?.roundPairs,m]),[f,A]=h.useState(0);h.useEffect(()=>{A(0)},[a?.id]);const b=a?.state?.winnerUid||null,C=b&&r.find(S=>S.uid===b)||null;if(!s.user)return e.jsx(Pe,{children:e.jsx("div",{className:"glass p-6",children:"Please sign in."})});if(!a)return e.jsx(Pe,{children:e.jsx(lt,{})});const p=u.length>0&&d.length===0,N=v[f]||null;async function j(){!c||!b||(await nn({code:t,uid:b,delta:{correct:1,points:4}}),await gt({code:t}),A(S=>Math.min(S+1,v.length-1)))}async function z(){!c||!b||(await nn({code:t,uid:b,delta:{incorrect:1,points:0}}),await gt({code:t}))}async function g(){c&&(await gt({code:t}),A(S=>Math.min(S+1,v.length-1)))}return e.jsx(Pe,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"glass p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm opacity-70",children:"Room"}),e.jsx("div",{className:"text-xl font-semibold",children:t})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-ghost",onClick:()=>n(`/buzzer/${t}`),children:"Back"}),c&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`btn ${a?.state?.buzzerOpen?"btn-orange":"btn-fancy"}`,onClick:()=>Cn({code:t,open:!a?.state?.buzzerOpen}),children:a?.state?.buzzerOpen?"Close Buzzer":"Open Buzzer"}),e.jsx("button",{className:"btn btn-ghost",onClick:()=>gt({code:t}),children:"Clear"})]})]})]}),e.jsxs("div",{className:"glass p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm opacity-75",children:["Question ",f+1," / ",v.length||0]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"chip",onClick:()=>A(S=>Math.max(0,S-1)),children:"Prev"}),e.jsx("button",{className:"chip",onClick:()=>A(S=>Math.min(v.length-1,S+1)),children:"Next"})]})]}),p?e.jsx("div",{className:"opacity-70",children:"Loading questions…"}):N?e.jsxs("div",{className:"space-y-4",children:[N.tossup&&e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs uppercase tracking-wide opacity-70",children:["Toss-up • ",N.tossup.category]}),e.jsx("div",{className:"prose dark:prose-invert max-w-none whitespace-pre-wrap",children:e.jsx(Re,{children:N.tossup.question})})]}),N.bonus&&e.jsxs("div",{className:"mt-4 p-3 rounded-lg bg-black/5 dark:bg-white/10",children:[e.jsxs("div",{className:"text-xs uppercase tracking-wide opacity-70",children:["Bonus • ",N.bonus.category]}),e.jsx("div",{className:"prose dark:prose-invert max-w-none whitespace-pre-wrap",children:e.jsx(Re,{children:N.bonus.question})})]})]}):e.jsx("div",{className:"opacity-70",children:"No question loaded."}),e.jsxs("div",{className:"pt-2 flex items-center gap-3 flex-wrap",children:[e.jsxs("div",{className:"text-sm opacity-75",children:["Winner: ",C?C.displayName||C.uid:"—"]}),c&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-fancy",onClick:j,disabled:!C,children:"Correct"}),e.jsx("button",{className:"btn btn-orange",onClick:z,disabled:!C,children:"Incorrect"}),e.jsx("button",{className:"btn btn-ghost",onClick:g,children:"Stale"})]})]})]}),e.jsxs("div",{className:"glass p-6",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Scores"}),e.jsx("ul",{className:"grid sm:grid-cols-2 md:grid-cols-3 gap-2",children:r.map(S=>e.jsxs("li",{className:"flex items-center justify-between rounded-lg bg-black/5 dark:bg-white/10 px-3 py-2",children:[e.jsx("span",{className:"truncate pr-2",children:S.displayName||S.uid}),e.jsx("span",{className:"font-semibold",children:S.score||0})]},S.uid))})]})]})})}const wt="mpGuestUid",vt="mpGuestName";function ei(t=12){const s="abcdefghjkmnpqrstuvwxyzABCDEFGHJKMNPQRSTUVWXYZ23456789";let n="";for(let a=0;a<t;a++)n+=s[Math.floor(Math.random()*s.length)];return n}function Se(){const s=Ae?.()?.currentUser||null;if(s)return{uid:s.uid,displayName:s.displayName||s.email||"Player",isGuest:!1};const n=localStorage.getItem(wt),a=localStorage.getItem(vt);return n&&a?{uid:n,displayName:a,isGuest:!0}:null}function ti(t){let s=localStorage.getItem(wt);s||(s=`guest_${ei(16)}`,localStorage.setItem(wt,s)),t&&localStorage.setItem(vt,t);const n=localStorage.getItem(vt)||t||"Guest";return{uid:s,displayName:n,isGuest:!0}}function si(){try{localStorage.removeItem(wt)}catch{}try{localStorage.removeItem(vt)}catch{}}function ni(){const t=localStorage.getItem(wt),s=localStorage.getItem(vt);return t&&s?{uid:t,displayName:s,isGuest:!0}:null}let Mn=0,Wt=!1,$t=[];function ri(){if(!Wt)try{ot();const t=Yt(it()),s=ue(t,".info/serverTimeOffset"),n=Ne(s,a=>{const o=Number(a.val()||0);Mn=Number.isFinite(o)?o:0,Wt||(Wt=!0,$t.forEach(r=>{try{r()}catch{}}),$t=[])});return()=>xe(s,"value",n)}catch{Wt=!0,$t.forEach(t=>{try{t()}catch{}}),$t=[]}}function ye(){return ri(),Date.now()+(Mn||0)}function ve(){return ot(),Yt(it())}function Z(t){return ue(ve(),`mp/rooms/${t}`)}function es(t){return ue(ve(),`mp/roomMembers/${t}`)}function jt(t,s){return ue(ve(),`mp/roomMembers/${t}/${s}`)}function En(t){return ue(ve(),`mp/roomMessages/${t}`)}function Rn(t){return ue(ve(),`mp/roomSettings/${t}`)}function ai(t){return ue(ve(),`mp/roomAnswers/${t}`)}function ii(t,s,n){return ue(ve(),`mp/roomAnswers/${t}/${s}/${n}`)}function oi(t){return ue(ve(),`mp/roomBuzzes/${t}`)}function _n(t,s){return ue(ve(),`mp/roomBuzzes/${t}/${s}`)}function Tn(t){return ue(ve(),`mp/roomHistory/${t}`)}function Nt(t){return ue(ve(),`mp/userRooms/${t}`)}async function kt(t){try{await ae(Z(t),{lastActiveAt:Date.now()})}catch{}}function ci(t=6){const s="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";let n="";for(let a=0;a<t;a++)n+=s[Math.floor(Math.random()*s.length)];return n}async function Dn(t){try{const n=new TextEncoder().encode(String(t||"")),a=await(self.crypto||window.crypto).subtle.digest("SHA-256",n),o=new Uint8Array(a);return Array.from(o).map(r=>r.toString(16).padStart(2,"0")).join("")}catch{return String(t||"")}}async function li({name:t="Room",isPrivate:s=!1,passcode:n=""}){const a=String(t||"Room").trim()||"Room",o=String(n||"").trim();if(s&&!o)throw new Error("Passcode is required for private rooms");for(let r=0;r<5;r++){const i=ci(),l=Z(i);if((await Oe(l)).exists())continue;let u=null;if(s&&o)try{u=await Dn(o)}catch{u=o}return await rt(l,{name:a,isPrivate:!!s,status:"open",createdAt:Date.now(),state:{buzzerOpen:!1,winnerUid:null,winnerName:null,winnerAt:null,awaitNext:!1,perWordMs:200,perChoiceMs:400,streamedWordsBase:0,streamStartAt:null,stemFinishedAt:null,choicesBase:0,choicesStartAt:null},game:{currentId:null,tournaments:[],used:null},passHash:u||null,lastActiveAt:Date.now()}),i}throw new Error("Failed to create room")}async function bt({roomId:t,uid:s,displayName:n,passcode:a,passHashOverride:o}){const i=Ae()?.currentUser,l=i?{uid:i.uid,displayName:i.displayName||i.email||"Player"}:Se()||{},c=s||l.uid,u=n||l.displayName||"Player";if(!c)throw new Error("No identity available");let d=null;try{d=await Oe(Z(t))}catch{}const m=d?.exists()?d.val():null,v=!!m?.isPrivate,f=m?.passHash||null;let A=null;if(v&&f){if(o)A=String(o);else if(a)A=await Dn(a);else try{A=window.localStorage.getItem(`mp_pass_hash_${t}`)}catch{}if(!A||A!==f)throw new Error("Incorrect or missing passcode")}await ae(jt(t,c),{uid:c,displayName:u,typing:!1,draft:"",lastTypedAt:Date.now(),...A?{passHash:A}:{}});try{i?.uid&&await ae(Ve(Nt(c),t),{roomId:t,joinedAt:Date.now(),lastActiveAt:Date.now()})}catch{}kt(t);const b=Ve(jt(t,c),"score");return await ze(b,C=>typeof C=="number"?C:0),!0}function di({roomId:t,onRoom:s,onMembers:n,onMessages:a,onSettings:o,onAnswers:r}){const i=[],l=Z(t),c=es(t),u=Rs(En(t),_s("createdAt"),hn(200)),d=Rn(t),m=ai(t),v=Ne(l,p=>{const N=p.exists()?{id:t,...p.val()}:null;s?.(N)});i.push(()=>xe(l,"value",v));const f=Ne(d,p=>{const N=p.val()||{};o?.(N)});i.push(()=>xe(d,"value",f));const A=Ne(c,p=>{const N=p.val()||{},j=Object.values(N);j.sort((z,g)=>{const S=z.score||0,w=g.score||0;if(w!==S)return w-S;const E=(z.displayName||"").toLowerCase(),k=(g.displayName||"").toLowerCase(),_=E.localeCompare(k);if(_!==0)return _;const R=String(z.uid||""),T=String(g.uid||"");return R.localeCompare(T)}),n?.(j)});i.push(()=>xe(c,"value",A));const b=Ne(u,p=>{const N=p.val()||{},j=Object.entries(N).map(([z,g])=>({id:z,...g})).sort((z,g)=>(z.createdAt||0)-(g.createdAt||0));a?.(j)});i.push(()=>xe(u,"value",b));const C=Ne(m,p=>{const N=p.val()||{};r?.(N)});return i.push(()=>xe(m,"value",C)),()=>{i.forEach(p=>{try{p()}catch{}})}}function ui({roomId:t,onBuzzes:s}){const n=oi(t),a=Ne(n,o=>{const r=o.val()||{},i={};Object.entries(r).forEach(([l,c])=>{const u=Object.entries(c||{}).map(([d,m])=>({id:d,...m}));u.sort((d,m)=>(d.at||0)-(m.at||0)),i[l]=u}),s?.(i)});return()=>xe(n,"value",a)}function mi({roomId:t,onTyping:s}){const n=es(t),a=i=>{const l=i.val()||{},c=l.uid||i.key;s?.({uid:c,displayName:l.displayName||c,typing:!!l.typing,draft:String(l.draft||""),lastTypedAt:Number(l.lastTypedAt||0)})},o=Zr(n,a),r=ea(n,a);return()=>{try{xe(n,"child_added",o)}catch{}try{xe(n,"child_changed",r)}catch{}}}async function hi({roomId:t,text:s}){const a=Ae()?.currentUser,o=a?{uid:a.uid,displayName:a.displayName||a.email||"Player"}:Se()||{},r=o?.uid;if(!r)return!1;const i=o.displayName||"Player",l=Ts(En(t));await rt(l,{uid:r,displayName:i,text:s,createdAt:Date.now()}),await kt(t);try{a?.uid&&await ae(Ve(Nt(r),t),{lastActiveAt:Date.now()})}catch{}return!0}async function rn({roomId:t,uid:s,delta:n}){const a=Ve(jt(t,s),"score");await ze(a,o=>(o||0)+(Number(n)||0)),await kt(t);try{Ae()?.currentUser?.uid&&await ae(Ve(Nt(s),t),{lastActiveAt:Date.now()})}catch{}return!0}async function fi({roomId:t,patch:s,requireHost:n=!1}){if(Ae()?.currentUser?.uid,!t||!s||typeof s!="object")return!1;try{const o={...s};if(Object.prototype.hasOwnProperty.call(s,"selectedTournaments")){const r=Array.isArray(s.selectedTournaments)?s.selectedTournaments.slice(0,20):[];await ae(Z(t),{"game/tournaments":r})}return Object.keys(o).length>0&&await ae(Rn(t),o),!0}catch{return!1}}async function ys({roomId:t,questionId:s,uid:n,displayName:a,data:o}){if(!t||!s||!n)return!1;const r={uid:n,displayName:a||null,status:o?.status||"typing",text:o?.text||"",choice:o?.choice||"",correct:typeof o?.correct=="boolean"?o.correct:null,points:Number.isFinite(o?.points)?Number(o.points):null,updatedAt:Date.now()};await rt(ii(t,s,n),r),await kt(t);try{await ae(Ve(Nt(n),t),{lastActiveAt:Date.now()})}catch{}await ae(jt(t,n),{lastQuestionId:s,lastAnswerStatus:r.status,lastAnswerCorrect:r.correct,lastAnswerAt:r.updatedAt});try{const c=((await Oe(Z(t))).val()?.state||{}).currentBuzzKey;if(c){const u=Ve(_n(t,s),c),m=(await Oe(u)).val();m&&(!m.uid||m.uid===n)&&await ae(u,{status:r.status,text:r.text,correct:r.correct,points:r.points,checkedAt:Date.now()})}}catch{}return!0}async function pi({roomId:t,uid:s}){if(!t||!s)return!1;const n=jt(t,s);return await rt(n,null),!0}async function pt({roomId:t,open:s}){const n=ye();await ze(Z(t),a=>{const o=a||{},r=o.state||{},i=Number(r.perWordMs||200),l=Number(r.perChoiceMs||400);if(!s){const u=r.streamStartAt?Math.max(0,n-Number(r.streamStartAt)):0,d=i>0?Math.floor(u/i):0,m=Math.max(0,Number(r.streamedWordsBase||0))+Math.max(0,d),v=r.choicesStartAt?Math.max(0,n-Number(r.choicesStartAt)):0,f=l>0?Math.floor(v/l):0,A=Math.min(4,Math.max(0,Number(r.choicesBase||0))+Math.max(0,f));return{...o,state:{...r,buzzerOpen:!1,streamStartAt:null,streamedWordsBase:m,choicesStartAt:null,choicesBase:A}}}const c={...o,state:{...r,buzzerOpen:!0}};return r.streamStartAt||(c.state.streamStartAt=n),r.stemFinishedAt&&!r.choicesStartAt&&Number(r.choicesBase||0)<4&&(c.state.choicesStartAt=n),!r.choicesFinishedAt&&r.buzzWindowStartAt&&(c.state.buzzWindowStartAt=null),c})}async function ws({roomId:t,grading:s}){if(!t)return!1;try{return await ae(Z(t),{"state/grading":!!s}),!0}catch{return!1}}async function xi({roomId:t}){if(!t)return!1;try{return await ae(Z(t),{"state/answerWindowResolved":!0,"state/answerWindowDeadlineAt":null,"state/answerWindowStartAt":null}),!0}catch{return!1}}async function gi({roomId:t,wordsPerSecond:s}){if(!t)return!1;const n=Math.min(12,Math.max(1,Math.round(Number(s)||1))),a=Math.max(60,Math.round(1e3/n)),o=Math.max(40,Math.round(a*2)),r=ye();return await ze(Z(t),i=>{if(!i)return i;const l=i||{},c=l.state||{},u={...l,state:{...c}},d=Number(c.perWordMs||0)||0,m=Math.max(0,Number(c.streamedWordsBase||0));let v=m,f=c.streamStartAt||null;if(c.buzzerOpen&&c.streamStartAt&&d>0){const N=Math.max(0,r-Number(c.streamStartAt)),j=Math.max(0,Math.floor(N/d));j>0&&(v=m+j),f=r}const A=Number(c.perChoiceMs||0)||0,b=Math.max(0,Number(c.choicesBase||0));let C=b;if(c.choicesStartAt&&A>0){const N=Math.max(0,r-Number(c.choicesStartAt)),j=Math.max(0,Math.floor(N/A));j>0&&(C=Math.min(4,b+j))}let p=c.choicesStartAt||null;return c.choicesStartAt?!c.buzzerOpen||C>=4?p=null:p=r:c.buzzerOpen&&c.stemFinishedAt&&C<4?p=r:p=null,u.state.perWordMs=a,u.state.perChoiceMs=o,u.state.streamedWordsBase=v,u.state.streamStartAt=f,u.state.choicesBase=C,u.state.choicesStartAt=p,u}),!0}async function bi({roomId:t,uid:s,displayName:n,answerWindowMs:a}){const o=Z(t);try{let r={ok:!1};if(await ze(o,i=>{const l=i||{},c=l.state||{},u=c.lockedOut&&typeof c.lockedOut=="object"?c.lockedOut:{};if(u&&s&&u[s])return r={ok:!1,reason:"locked"},i;if(!c.buzzerOpen)return r={ok:!1,reason:"closed",winnerUid:c.winnerUid||null},i;if(c.winnerUid)return r={ok:!1,reason:"already",winnerUid:c.winnerUid},i;const d=ye(),m=Number(c.perWordMs||200),v=c.streamStartAt?Math.max(0,d-Number(c.streamStartAt)):0,f=m>0?Math.floor(v/m):0,A=Math.max(0,Number(c.streamedWordsBase||0))+Math.max(0,f),b=Number(c.perChoiceMs||400),C=c.choicesStartAt?Math.max(0,d-Number(c.choicesStartAt)):0,p=b>0?Math.floor(C/b):0,N=Math.min(4,Math.max(0,Number(c.choicesBase||0))+Math.max(0,p)),j=!c.stemFinishedAt,z=Number.isFinite(a)&&a>0?Math.floor(a):8e3,g={...l,state:{...l.state||{},buzzerOpen:!1,winnerUid:s,winnerName:n||null,winnerAt:Date.now(),streamStartAt:null,streamedWordsBase:A,choicesStartAt:null,choicesBase:N,currentBuzzKey:null,answerWindowUid:s,answerWindowStartAt:d,answerWindowDeadlineAt:d+z,answerWindowResolved:!1,currentBuzzInterrupt:!!j}};return r={ok:!0,winnerUid:s},g}),r.ok){const l=(await Oe(Z(t))).val()||{},c=l?.game?.currentId||null;if(c){const u=Ts(_n(t,c)),d=u.key,m=!l?.state?.stemFinishedAt;await rt(u,{uid:s,displayName:n,at:Date.now(),interrupt:m}),await ae(Z(t),{"state/currentBuzzKey":d})}}return r}catch(r){return{ok:!1,error:r?.message||String(r)}}}async function vs({roomId:t}){await ae(Z(t),{"state/winnerUid":null,"state/winnerName":null,"state/winnerAt":null,"state/answerWindowUid":null,"state/answerWindowStartAt":null,"state/answerWindowDeadlineAt":null,"state/answerWindowResolved":null,"state/currentBuzzInterrupt":null})}async function yi({roomId:t,questionId:s,tournaments:n=[]}){let a=null;await ze(Z(t),o=>{const r=o||{},i=r.game||{},l=r.state||{},c=i.currentId||null;a=c;const u=i.used&&typeof i.used=="object"?i.used:{},d={...r};d.game={...d.game||{},currentId:s||null,tournaments:Array.isArray(n)?n.slice(0,20):[],used:{...u}},c&&(d.game.used[c]=!0);const v=/__bo__\d+$/i.test(String(s||""))?2e4:4e3,f=Number(l.perWordMs),A=Number(l.perChoiceMs),b=Number.isFinite(f)&&f>=60?Math.floor(f):200,C=Number.isFinite(A)&&A>=40?Math.floor(A):400;return d.state={...d.state||{},buzzerOpen:!1,winnerUid:null,winnerName:null,winnerAt:null,awaitNext:!1,currentBuzzKey:null,lockedOut:null,perWordMs:b,perChoiceMs:C,streamedWordsBase:0,streamStartAt:null,stemFinishedAt:null,choicesFinishedAt:null,choicesBase:0,choicesStartAt:null,timerExpiredAt:null,buzzWindowMs:v,buzzWindowStartAt:null,answerWindowUid:null,answerWindowStartAt:null,answerWindowDeadlineAt:null,answerWindowResolved:null,currentBuzzInterrupt:null},d});try{if(a){const o=Ts(Tn(t));await rt(o,{questionId:a,at:Date.now()})}}catch{}}async function wi({roomId:t,questionId:s,at:n}){const a=Number(n||ye());await ze(Z(t),o=>{const r=o||{},i=r.state||{},l=r?.game?.currentId||null;if(s&&s!==l||i.timerExpiredAt)return o;const c={...r,state:{...i,timerExpiredAt:a}};return c.state.buzzerOpen=!1,c})}async function vi({roomId:t,uid:s}){let n=!1;return await ze(Z(t),a=>{const o=a||{},r=o.state||{},i=ye();if(!r.answerWindowUid||r.answerWindowUid!==s||!r.answerWindowDeadlineAt||r.answerWindowResolved||i<Number(r.answerWindowDeadlineAt))return a;const l={...o,state:{...r,answerWindowResolved:!0}};return n=!0,l}),n}async function ji({roomId:t,questionId:s,at:n}){const a=Number(n||ye());await ze(Z(t),o=>{const r=o||{},i=r.state||{},l=r?.game?.currentId||null;return s&&s!==l||i.stemFinishedAt?o:{...r,state:{...i,stemFinishedAt:a}}})}async function Ni({roomId:t,questionId:s,at:n}){const a=Number(n||ye());await ze(Z(t),o=>{const r=o||{},i=r.state||{},l=r?.game?.currentId||null;if(s&&s!==l||i.choicesFinishedAt)return o;const c={...r,state:{...i,choicesFinishedAt:a}};if(!i.buzzWindowStartAt&&(c.state.buzzWindowStartAt=a,!Number.isFinite(c.state.buzzWindowMs)||c.state.buzzWindowMs<=0)){const u=r.game&&r.game.currentId||"",d=/__bo__\d+$/i.test(String(u));c.state.buzzWindowMs=d?2e4:4e3}return c})}async function an({roomId:t,uid:s}){return!t||!s?!1:(await ze(Z(t),n=>{const a=n||{},o=a.state||{},i={...o.lockedOut&&typeof o.lockedOut=="object"?o.lockedOut:{},[s]:!0};return{...a,state:{...o,lockedOut:i}}}),!0)}async function on({roomId:t}){await ae(Z(t),{"state/lockedOut":null})}async function cn({roomId:t,value:s}){await ae(Z(t),{"state/awaitNext":!!s}),await kt(t)}function ki({onRooms:t}){const s=Rs(ue(ve(),"mp/rooms"),_s("createdAt"),hn(50)),n=new Map;let a=[],o={};const r=()=>{const u=a.map(d=>({...d,memberCount:typeof d.memberCount=="number"?d.memberCount:o[d.id]||0}));t?.(u)},i=u=>{if(n.has(u))return;const d=es(u),m=Ne(d,v=>{const f=v.val()||{};o[u]=Object.keys(f).length,r()});n.set(u,()=>xe(d,"value",m))},l=u=>{for(const[d,m]of n.entries())if(!u.includes(d)){try{m()}catch{}n.delete(d),delete o[d]}},c=Ne(s,u=>{const d=u.val()||{},m=Object.entries(d).map(([f,A])=>({id:f,...A})).filter(f=>f.status==="open"&&f.isPrivate===!1).sort((f,A)=>(A.createdAt||0)-(f.createdAt||0));a=m;const v=m.map(f=>f.id);v.forEach(i),l(v),r()});return()=>{xe(s,"value",c);for(const u of n.values())try{u()}catch{}n.clear()}}function Si({uid:t,onRooms:s}){if(!t)return()=>{};const n=Nt(t),a=new Map;let o=[],r={};const i=()=>{const d=o.map(m=>({...m,memberCount:r[m.id]||0}));d.sort((m,v)=>(v.lastActiveAt||0)-(m.lastActiveAt||0)),s?.(d)},l=d=>{if(a.has(d))return;const m=es(d),v=Ne(m,f=>{const A=f.val()||{};r[d]=Object.keys(A).length,i()});a.set(d,()=>xe(m,"value",v))},c=d=>{for(const[m,v]of a.entries())if(!d.includes(m)){try{v()}catch{}a.delete(m),delete r[m]}},u=Ne(n,async d=>{const m=d.val()||{},v=Object.keys(m),f=[];for(const A of v)try{const b=await Oe(Z(A));b.exists()&&f.push({id:A,...b.val()})}catch{}o=f,v.forEach(l),c(v),i()});return()=>{xe(n,"value",u);for(const d of a.values())try{d()}catch{}a.clear()}}function Ai({roomId:t,onHistory:s}){const n=Tn(t),a=Ne(n,o=>{const r=o.val()||{},i=Object.entries(r).map(([l,c])=>({id:l,...c||{}})).sort((l,c)=>(c.at||0)-(l.at||0));s?.(i)});return()=>xe(n,"value",a)}async function zi({queryText:t}){const s=String(t||"").trim();if(!s)return null;try{const a=await Oe(Z(s));if(a.exists())return{id:s,...a.val()}}catch{}const n=s.toUpperCase();if(n!==s)try{const a=await Oe(Z(n));if(a.exists())return{id:n,...a.val()}}catch{}try{const a=Rs(ue(ve(),"mp/rooms"),_s("name"),ta(s)),r=(await Oe(a)).val()||{},i=Object.entries(r)[0];if(i){const[l,c]=i;return{id:l,...c||{}}}}catch{}return null}function Ci(){const t=Ce(),s=We(),[n,a]=h.useState([]),[o,r]=h.useState([]),i=W.useCallback(k=>{a(_=>JSON.stringify(_)===JSON.stringify(k)?_:k)},[]),[l,c]=h.useState(!1),[u,d]=h.useState(""),[m,v]=h.useState(""),[f,A]=h.useState(!1),[b,C]=h.useState(""),[p,N]=h.useState(""),[j,z]=h.useState(""),[g,S]=h.useState(!1);h.useEffect(()=>{const k=ki({onRooms:i});return()=>k()},[i]),h.useEffect(()=>{if(!t?.user?.uid)return;const k=Si({uid:t.user.uid,onRooms:r});return()=>k()},[t?.user?.uid]);async function w(k){if(k?.preventDefault(),!t?.user){s("/signin");return}c(!0),d("");try{const _=(m||"").trim(),R=(b||"").trim();if(f&&!R)throw new Error("Passcode is required for private rooms");const T=await li({name:_||"Room",isPrivate:f,passcode:f?R:""});await bt({roomId:T,passcode:f?R:void 0}),s(`/multiplayer/${T}`)}catch(_){d(_?.message||String(_))}finally{c(!1)}}async function E(k){k?.preventDefault(),S(!0),d("");try{const _=(p||"").trim();if(!_)throw new Error("Enter a room name or code");const R=await zi({queryText:_});if(!R)throw new Error("Room not found");s(`/multiplayer/${R.id}`,{state:{passcode:(j||"").trim()}})}catch(_){d(_?.message||String(_))}finally{S(!1)}}return e.jsx("div",{className:"min-h-screen app-radial-bg dark:app-radial-bg transition-colors glass-backdrop",children:e.jsxs(st,{auth:t,children:[e.jsx(ja,{}),t.loading?e.jsx(lt,{}):e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"glass p-6 space-y-3",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Multiplayer"}),e.jsx("p",{className:"text-sm opacity-80",children:"Join a public room or create your own. Private rooms require a passcode."}),e.jsxs("form",{onSubmit:E,className:"grid sm:grid-cols-4 gap-2 items-end",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-sm opacity-75 mb-1",children:"Room name or code"}),e.jsx("input",{className:"rounded-lg border border-black/10 dark:border-white/10 px-3 py-2 bg-white dark:bg-darkcard w-full",value:p,onChange:k=>N(k.target.value),placeholder:"e.g., Friday Practice or ABC123"})]}),e.jsx("div",{className:"hidden sm:block"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm opacity-75 mb-1",children:"Passcode (if required)"}),e.jsx("input",{className:"rounded-lg border border-black/10 dark:border-white/10 px-3 py-2 bg-white dark:bg-darkcard w-full",value:j,onChange:k=>z(k.target.value),placeholder:"Room passcode"})]}),e.jsx("div",{className:"sm:col-span-4 flex gap-2",children:e.jsx("button",{className:"btn btn-primary",type:"submit",disabled:g||!p,children:g?"Joining…":"Join room"})})]}),e.jsx("div",{className:"text-sm opacity-80",children:"Create a new room to practice live buzzing. Share the code to invite others, or keep it public for everyone to see. Set a passcode to keep it private."}),(()=>{const k=!t?.user,_=k?"opacity-60 pointer-events-none":"",R=k?"Sign in to create rooms":"";return e.jsxs("form",{onSubmit:w,className:"grid sm:grid-cols-4 gap-2 items-end","aria-disabled":k,title:R,children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-sm opacity-75 mb-1",children:"Room name"}),e.jsx("input",{className:`rounded-lg border border-black/10 dark:border-white/10 px-3 py-2 bg-white dark:bg-darkcard w-full ${_}`,value:m,onChange:T=>v(T.target.value),placeholder:"e.g., Friday Practice",disabled:k})]}),e.jsx("div",{className:`flex items-center gap-2 ${_}`,children:e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:T=>A(T.target.checked),disabled:k})," Private"]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm opacity-75 mb-1",children:["Passcode ",f?"":"(optional)"]}),e.jsx("input",{className:`rounded-lg border border-black/10 dark:border-white/10 px-3 py-2 bg-white dark:bg-darkcard w-full ${_}`,value:b,onChange:T=>C(T.target.value),disabled:k||!f,placeholder:"Set a passcode"})]}),e.jsxs("div",{className:"sm:col-span-4 flex gap-2 items-center",children:[e.jsx("button",{className:`btn btn-fancy ${k?"opacity-60 cursor-not-allowed":""}`,type:"submit",disabled:k||l||f&&!b,children:l?"Creating…":"Create room"}),k&&e.jsx("span",{className:"text-xs opacity-80",children:"Sign in to create a room"}),u&&e.jsx("div",{className:"text-sm text-red-600",children:u})]})]})})()]}),t?.user&&e.jsxs("div",{className:"glass p-6 space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Active sessions"}),o.length===0?e.jsx("div",{className:"opacity-70 text-sm",children:"No active rooms yet."}):e.jsx("ul",{className:"divide-y divide-black/5 dark:divide-white/10",children:o.map(k=>e.jsxs("li",{className:"py-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:k.name||k.id}),e.jsxs("div",{className:"text-sm opacity-70",children:[k.memberCount||0," online • Active ",new Date(k.lastActiveAt||k.createdAt||0).toLocaleString()]})]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>s(`/multiplayer/${k.id}`),children:"Rejoin"})]},k.id))})]}),e.jsxs("div",{className:"glass p-6 space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Public rooms"}),n.length===0?e.jsx("div",{className:"opacity-70 text-sm",children:"No public rooms right now."}):e.jsx("ul",{className:"divide-y divide-black/5 dark:divide-white/10",children:n.map(k=>e.jsxs("li",{className:"py-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:k.name||k.id}),e.jsxs("div",{className:"text-sm opacity-70",children:[k.memberCount||0," online"]})]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>s(`/multiplayer/${k.id}`),children:"Join"})]},k.id))})]})]})]})})}const Mi="vertex-gateway-7e74h6s4.uc.gateway.dev",Ei="AIzaSyBxfXewuANeaSgDisu5U4cD1JF70VJuP_U";function Ri(t){const s=`https://${Mi}`,n=t.startsWith("/")?t:`/${t}`,a=new URL(s+n);return a.searchParams.set("key",Ei),a.toString()}async function Ln(t,s){const n=Ri(t),a={"Content-Type":"application/json"};try{const r=await ma();r&&(a["X-Firebase-AppCheck"]=r)}catch{}return await fetch(n,{method:"POST",headers:a,body:JSON.stringify(s??{})})}async function _i(t){return Ln("/checkAnswerMC",t)}async function ln(t){return Ln("/checkAnswerBonus",t)}function dn(t){if(!t)return!1;try{return String(t).split("-")[0].toLowerCase()==="ms"}catch{return!1}}function Ti({tournaments:t,tournamentGroups:s,selectedTournaments:n,setSelectedTournaments:a,tournamentGroupsOpen:o,setTournamentGroupsOpen:r,handleTournamentToggle:i,tournamentVisibleEntriesMainRef:l,isDark:c,showTournamentModal:u,setShowTournamentModal:d}){return e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold mb-2 flex items-center flex-wrap gap-2",children:["Tournaments",e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Clear selection",onClick:()=>a([]),children:e.jsx(Ss,{size:16})}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Select all",onClick:()=>a((t||[]).filter(m=>!dn(m))),children:e.jsx(As,{size:16})}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs inline-flex items-center gap-1","aria-label":"Expand tournament list",title:"Expand to modal",onClick:()=>d(!0),children:e.jsx(ra,{size:14})})]}),e.jsx("div",{className:"border rounded-lg max-h-56 overflow-y-auto overflow-x-hidden",children:e.jsx("ul",{role:"tree",className:"divide-y divide-black/5 dark:divide-white/10",children:(()=>{const m=[],v=s.map(f=>{const A=f.all.length>1,b=A&&o.has(f.base),C=f.all.every(j=>n.includes(j)),p=!C&&f.all.some(j=>n.includes(j));let N={};if(A){const j=f.all.filter(w=>n.includes(w)).length,z=f.all.length>0?j/f.all.length:0,g=Math.pow(z,.85),S=120*g;if(j>0)if(c){const w=28+g*8;N={backgroundColor:`hsl(${S.toFixed(0)} 60% ${w}%)`,color:"#fff"}}else{const w=92-g*8;N={backgroundColor:`hsl(${S.toFixed(0)} 70% ${w}%)`}}}if(!A){const j=f.all[0],z=n.includes(j);return m.push({type:"key",key:j,base:f.base}),e.jsx("li",{role:"treeitem",className:"select-none",children:e.jsxs("label",{className:"flex items-center gap-2 px-2 py-1.5 rounded cursor-pointer min-w-0 "+(z?"bg-blue-100 dark:bg-blue-900/40":"hover:bg-black/5 dark:hover:bg-white/10"),children:[e.jsx("span",{className:"inline-block w-5 shrink-0","aria-hidden":"true"}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("input",{type:"checkbox",className:"accent-tint",checked:z,onChange:g=>i(g,j,"main")}),e.jsx("span",{className:"font-medium truncate min-w-0",title:j,children:j})]})]})},f.base)}return e.jsxs("li",{role:"treeitem","aria-expanded":b,className:"select-none",children:[e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1.5 rounded min-w-0 "+(A?"transition-colors ":"")+(A&&(p||C)?"":"hover:bg-black/5 dark:hover:bg-white/10"),style:N,children:[A&&e.jsx("button",{type:"button",className:"shrink-0 p-0.5 rounded hover:bg-black/10 dark:hover:bg-white/10",onClick:()=>r(j=>{const z=new Set(j);return z.has(f.base)?z.delete(f.base):z.add(f.base),z}),"aria-label":b?"Collapse":"Expand",children:b?e.jsx(fs,{size:16}):e.jsx(ps,{size:16})}),e.jsx("input",{type:"checkbox",className:"accent-tint",checked:C,ref:j=>{j&&(j.indeterminate=p)},onChange:j=>{const z=j.target.checked||p;a(g=>{const S=new Set(g);return z?f.all.forEach(w=>S.add(w)):f.all.forEach(w=>S.delete(w)),Array.from(S)})}}),e.jsx("span",{className:"font-medium truncate",title:f.base,children:`${f.base} (${f.all.length})`})]}),(m.push({type:"group",base:f.base,keys:f.all}),null),b&&e.jsx("ul",{role:"group",className:"pl-10 py-1 overflow-x-hidden min-w-0",children:f.years.map(j=>{const z=n.includes(j.key);return m.push({type:"key",key:j.key,base:f.base}),e.jsx("li",{role:"treeitem","aria-selected":z,className:"px-2 min-w-0 text-xs",children:e.jsxs("label",{className:"flex items-center gap-2 px-2 py-1 rounded cursor-pointer min-w-0 "+(z?"bg-blue-100 dark:bg-blue-900/40":"hover:bg-black/5 dark:hover:bg-white/10"),children:[e.jsx("input",{type:"checkbox",className:"accent-tint",checked:z,onChange:g=>i(g,j.key,"main")}),e.jsx("span",{className:"truncate min-w-0",title:j.label,children:j.label})]})},j.key)})})]},f.base)});return l.current=m,v})()})}),u&&e.jsxs("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>d(!1)}),e.jsxs("div",{className:"relative bg-white dark:bg-darkcard rounded-lg shadow-xl max-w-3xl w-full p-6 space-y-4 border border-black/10 dark:border-white/10 flex flex-col max-h-[85vh]",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Select Tournaments"}),e.jsx("button",{className:"btn btn-ghost btn-sm",onClick:()=>d(!1),children:"Close"})]}),e.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Clear selection",onClick:()=>a([]),children:e.jsx(Ss,{size:16})}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Select all",onClick:()=>a((t||[]).filter(m=>!dn(m))),children:e.jsx(As,{size:16})}),e.jsxs("button",{className:"chip px-2 py-0.5 text-xs inline-flex items-center gap-1","aria-label":"Expand all groups",title:"Expand all groups",onClick:()=>r(new Set(s.filter(m=>m.all.length>1).map(m=>m.base))),children:[e.jsx(en,{size:15}),e.jsx(ps,{size:15})]}),e.jsxs("button",{className:"chip px-2 py-0.5 text-xs inline-flex items-center gap-1","aria-label":"Collapse all groups",title:"Collapse all groups",onClick:()=>r(new Set),children:[e.jsx(en,{size:15}),e.jsx(fs,{size:15})]})]}),e.jsx("div",{className:"border rounded-lg max-h-[65vh] overflow-y-auto overflow-x-hidden",children:e.jsx("ul",{role:"tree",className:"divide-y divide-black/5 dark:divide-white/10",children:(()=>{const m=[];return s.map(f=>{const A=f.all.length>1,b=A&&o.has(f.base),C=f.all.every(N=>n.includes(N)),p=!C&&f.all.some(N=>n.includes(N));return e.jsxs("li",{role:"treeitem","aria-expanded":b,className:"select-none",children:[e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1.5 rounded min-w-0 "+(A?"transition-colors ":""),children:[A&&e.jsx("button",{type:"button",className:"shrink-0 p-0.5 rounded hover:bg-black/10 dark:hover:bg-white/10",onClick:()=>r(N=>{const j=new Set(N);return j.has(f.base)?j.delete(f.base):j.add(f.base),j}),"aria-label":b?"Collapse":"Expand",children:b?e.jsx(fs,{size:16}):e.jsx(ps,{size:16})}),e.jsx("input",{type:"checkbox",className:"accent-tint",checked:C,ref:N=>{N&&(N.indeterminate=p)},onChange:N=>{const j=N.target.checked||p;a(z=>{const g=new Set(z);return j?f.all.forEach(S=>g.add(S)):f.all.forEach(S=>g.delete(S)),Array.from(g)})}}),e.jsx("span",{className:"font-medium truncate",title:f.base,children:`${f.base} (${f.all.length})`})]}),b&&e.jsx("ul",{role:"group",className:"pl-10 py-1 overflow-x-hidden min-w-0",children:f.years.map(N=>{const j=n.includes(N.key);return m.push({type:"key",key:N.key,base:f.base}),e.jsx("li",{role:"treeitem","aria-selected":j,className:"px-2 min-w-0 text-xs",children:e.jsxs("label",{className:`flex items-center gap-2 px-2 py-1 rounded cursor-pointer min-w-0 ${j?"bg-blue-100 dark:bg-blue-900/40":"hover:bg-black/5 dark:hover:bg-white/10"}`,children:[e.jsx("input",{type:"checkbox",className:"accent-tint",checked:j,onChange:z=>i(z,N.key,"modal")}),e.jsx("span",{className:"truncate min-w-0",title:N.label,children:N.label})]})},N.key)})})]},f.base)})})()})})]})]}),e.jsx("div",{className:"mt-2 text-[11px] text-gray-500 dark:text-gray-400",children:" * Select All does not include MS rounds."})]})}function Di({categories:t,selectedCategories:s,setSelectedCategories:n}){return e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold mb-2 flex items-center gap-2",children:["Categories",e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Clear selection",onClick:()=>n([]),children:e.jsx(Ss,{size:16})}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Select all",onClick:()=>n(t),children:e.jsx(As,{size:16})}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Invert selection",onClick:()=>n(a=>t.filter(o=>!a.includes(o))),children:e.jsx(aa,{size:16})})]}),e.jsx("div",{className:"rounded-lg max-h-56 overflow-y-auto overflow-x-hidden",children:e.jsx("div",{className:"flex flex-wrap gap-2 min-w-0 p-2",children:t.map(a=>{const o=s.includes(a);return e.jsxs("label",{className:`chip cursor-pointer ${o?"ring-1 ring-tint bg-tint/10":""}`,title:a,children:[e.jsx("input",{type:"checkbox",className:"mr-1",checked:o,onChange:()=>n(r=>r.includes(a)?r.filter(i=>i!==a):[...r,a])}),e.jsx("span",{className:"truncate max-w-[12rem] inline-block align-middle",children:a})]},a)})})})]})}function Li({selectedTournaments:t,tournaments:s,roundRanges:n,setRoundRanges:a,roundsByTournament:o,globalNumericRoundMax:r}){return e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold mb-2 flex items-center justify-between gap-2",children:[e.jsx("span",{children:"Round ranges"}),e.jsx("button",{type:"button",className:`chip px-2 py-1 ${t.length===0?"opacity-50 cursor-not-allowed":""}`,"aria-label":"Add round range",title:"Add range",disabled:t.length===0,onClick:()=>{if(t.length===0)return;const l=t.length===1?t[0]:"";a([...n,{from:1,to:3,tournament:l}])},children:e.jsx(ia,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[n.length===0&&e.jsx("div",{className:"text-xs italic text-black/70 dark:text-white/60 px-1",children:"All rounds included (no range filters). Add a range to limit rounds."}),n.map((i,l)=>{const c=t.length>0?t:s,u=t.length===1,d=t.length===0&&s.length===1,m=u||d||c.length===1,v=m&&(t[0]||c[0])||"",f=m?v:i.tournament||"",A=m?v:i.tournament||null,b=A?o[A]??[]:[],C=b.length>0&&b.every(p=>/^\d+$/.test(p));return e.jsxs("div",{className:"round-range-row w-full overflow-hidden",children:[e.jsx("div",{className:"select-wrapper flex-1 min-w-0",children:e.jsx("select",{className:"sb-select-range rounded-lg border px-3 py-1.5 shadow-none focus:outline-none "+(m?"bg-gray-100 dark:bg-white/10 text-gray-500 dark:text-gray-400 border-gray-300 dark:border-white/20 cursor-not-allowed pointer-events-none":"bg-white text-black border-black/10 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20"),value:f,disabled:m,onChange:p=>{if(m)return;const N=[...n];N[l]={...N[l],tournament:p.target.value},a(N)},title:f||"All Tournaments",children:m?e.jsx("option",{value:v,children:v}):t.length===0?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"",children:"All Tournaments"}),c.map(p=>e.jsx("option",{value:p,children:p},p))]}):c.map(p=>e.jsx("option",{value:p,children:p},p))})}),A?C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"select-wrapper sb-select-round",children:e.jsx("select",{className:"rounded-lg border border-black/10 bg-white text-black px-2 py-1 shadow-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20 shrink-0 sb-select-round",value:i.from!=null&&b.includes(String(i.from))?String(i.from):b[0]??"",onChange:p=>{const N=[...n];let j=Number(p.target.value),z=Number(N[l].to);(!Number.isFinite(z)||z<j)&&(z=j),N[l]={...N[l],from:j,to:z,dFrom:void 0,dTo:void 0},a(N)},children:b.map(p=>e.jsx("option",{value:p,children:p},p))})}),e.jsx("span",{className:"text-black dark:text-white",children:"to"}),e.jsx("div",{className:"select-wrapper sb-select-round",children:e.jsx("select",{className:"rounded-lg border border-black/10 bg-white text-black px-2 py-1 shadow-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20 shrink-0 sb-select-round",value:i.to!=null&&b.includes(String(i.to))?String(i.to):b[b.length-1]??"",onChange:p=>{const N=[...n];let j=Number(p.target.value),z=Number(N[l].from);(!Number.isFinite(z)||z>j)&&(z=j),N[l]={...N[l],from:z,to:j,dFrom:void 0,dTo:void 0},a(N)},children:b.map(p=>e.jsx("option",{value:p,children:p},p))})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"select-wrapper sb-select-round",children:e.jsx("select",{className:"rounded-lg border border-black/10 bg-white text-black px-2 py-1 shadow-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20 shrink-0 sb-select-round",value:i.dFrom??b[0]??"",onChange:p=>{const N=[...n],j=p.target.value;let z=N[l].dTo;if(z){const g=b.indexOf(j),S=b.indexOf(z);g!==-1&&S!==-1&&g>S&&(z=j)}N[l]={...N[l],dFrom:j,dTo:z},a(N)},children:b.map(p=>e.jsx("option",{value:p,children:p},p))})}),e.jsx("span",{className:"text-black dark:text-white",children:"to"}),e.jsx("div",{className:"select-wrapper sb-select-round",children:e.jsx("select",{className:"rounded-lg border border-black/10 bg-white text-black px-2 py-1 shadow-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20 shrink-0 sb-select-round",value:i.dTo??b[b.length-1]??"",onChange:p=>{const N=[...n],j=p.target.value;let z=N[l].dFrom;if(z){const g=b.indexOf(z),S=b.indexOf(j);g!==-1&&S!==-1&&g>S&&(z=j)}N[l]={...N[l],dFrom:z??j,dTo:j},a(N)},children:b.map(p=>e.jsx("option",{value:p,children:p},p))})})]}):(()=>{const p=Array.from({length:r},(z,g)=>g+1),N=i.from!=null&&i.from>=1?i.from:p[0],j=i.to!=null&&i.to>=N||i.to!=null?i.to:p[p.length-1];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"select-wrapper sb-select-round",children:e.jsx("select",{className:"rounded-lg border border-black/10 bg-white text-black px-2 py-1 shadow-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20 shrink-0 sb-select-round",value:String(N),onChange:z=>{const g=[...n];let S=Number(z.target.value),w=Number(g[l].to);(!Number.isFinite(w)||w<S)&&(w=S),g[l]={...g[l],from:S,to:w,dFrom:void 0,dTo:void 0},a(g)},children:p.map(z=>e.jsx("option",{value:z,children:z},z))})}),e.jsx("span",{className:"text-black dark:text-white",children:"to"}),e.jsx("div",{className:"select-wrapper sb-select-round",children:e.jsx("select",{className:"rounded-lg border border-black/10 bg-white text-black px-2 py-1 shadow-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20 shrink-0 sb-select-round",value:String(j),onChange:z=>{const g=[...n];let S=Number(z.target.value),w=Number(g[l].from);(!Number.isFinite(w)||w>S)&&(w=S),g[l]={...g[l],from:w,to:S,dFrom:void 0,dTo:void 0},a(g)},children:p.map(z=>e.jsx("option",{value:z,children:z},z))})})]})})(),e.jsx("button",{className:"chip shrink-0","aria-label":"Remove round range",title:"Remove range",onClick:()=>a(n.filter((p,N)=>N!==l)),children:e.jsx(oa,{className:"h-4 w-4"})})]},l)})]})]})}function un(t){return Array.from(new Set(t))}function ic(t,s){return t?s.find(n=>n.question_type?.toLowerCase()==="bonus"&&n.round===t.round&&n.tournament===t.tournament&&n.question_number===t.question_number):null}function zs(t){if(!t)return[];const s=["w","x","y","z"],n=r=>{if(r==null)return null;const l=String(r).replace(/[.)\s]/g,"").toLowerCase()[0];return s.includes(l)?l:null},a=r=>r==null?null:typeof r=="string"||typeof r=="number"?String(r):typeof r=="object"?r.text??r.value??r.choice??r.content??r.answer??r.option??r.label??r.name??null:null;let o=t.choices??null;if(!o){const r={w:t.w??t.W,x:t.x??t.X,y:t.y??t.Y,z:t.z??t.Z};if(Object.values(r).some(i=>i!=null&&String(i).trim()!==""))o=r;else return[]}if(Array.isArray(o)){const r=o.slice(0,4).map((l,c)=>{const u=a(l);return u?[s[c],u]:null}).filter(Boolean),i=new Map(r);return s.map(l=>[l,i.get(l)]).filter(([,l])=>l!=null)}if(o&&typeof o=="object"){const r=Object.entries(o).map(([l,c])=>{const u=a(c),d=n(l);return!u||!d?null:[d,u]}).filter(Boolean),i=new Map(r);return s.map(l=>[l,i.get(l)]).filter(([,l])=>l!=null)}return[]}function oc(t){if(!t)return"";const s=String(t).toUpperCase();return s.startsWith("PHYS")?"P":s.startsWith("CHEM")?"C":s.startsWith("BIO")?"B":s.startsWith("MATH")?"M":s.startsWith("EARTH")?"E":s.startsWith("ASTRO")?"A":s.startsWith("ENERG")?"EN":s.startsWith("GEN")?"G":s[0]}async function cc(){return typeof window<"u"&&window.html2pdf||await new Promise((t,s)=>{const n=document.querySelector("script[data-html2pdf]");if(n){n.addEventListener("load",()=>t()),n.addEventListener("error",()=>s(new Error("Failed to load html2pdf.js")));return}const a=document.createElement("script");a.src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js",a.async=!0,a.defer=!0,a.setAttribute("data-html2pdf","true"),a.onload=()=>t(),a.onerror=()=>s(new Error("Failed to load html2pdf.js")),document.head.appendChild(a)}),window.html2pdf}function Oi({questions:t=[],lazy:s=null}){const n=!!s,[a,o]=h.useState([]),[r,i]=h.useState([]),[l,c]=h.useState(()=>new Set),u=h.useMemo(()=>[...n?s.tournaments||[]:un(t.map(k=>k.tournament))].filter(Boolean).sort((k,_)=>String(k).localeCompare(String(_))),[n,s,t]),d=h.useRef([]),m=h.useRef([]),v=h.useRef(null),f=h.useRef(null);function A(E,k,_="main"){const R=E?.nativeEvent?.shiftKey||E?.shiftKey,T=(_==="modal"?m.current:d.current)||[],F=T.findIndex(q=>q?.type==="key"&&q.key===k),I=a.includes(k),G=!I,L=_==="modal"?f:v;if(R&&L.current!=null&&F!==-1&&L.current!==F){const[q,P]=[L.current,F].sort((J,ie)=>J-ie),K=T.slice(q,P+1),te=[],Me=new Set(K.filter(J=>J&&J.type==="key"&&J.base).map(J=>J.base));K.forEach(J=>{J&&(J.type==="key"&&J.key?te.push(J.key):J.type==="group"&&Array.isArray(J.keys)&&(Me.has(J.base)||J.keys.forEach(ie=>te.push(ie))))}),o(J=>{const ie=new Set(J);return G?te.forEach(je=>ie.add(je)):te.forEach(je=>ie.delete(je)),Array.from(ie)}),L.current=F}else o(q=>{const P=new Set(q);return I?P.delete(k):P.add(k),Array.from(P)}),L.current=F}const b=h.useMemo(()=>{const E=new Map;for(const k of u){if(!k)continue;const[_,R]=String(k).split("-"),T=_||k,F=R&&/\d{4}/.test(R)?R:null;E.has(T)||E.set(T,{base:T,years:[],all:[]});const I=E.get(T);I.all.push(k),F?I.years.push({label:k,year:Number(F)||F,key:k}):I.years.push({label:k,year:null,key:k})}for(const k of E.values())k.years.sort((_,R)=>String(_.label).localeCompare(String(R.label)));return Array.from(E.values()).sort((k,_)=>k.base.localeCompare(_.base))},[u]);h.useEffect(()=>{n&&a.length!==0&&s.ensureLoaded(a)},[n,s,a]);const C=h.useMemo(()=>(n?s.getLoadedQuestions(a):t).map(E=>{let k=E.category;if(typeof k=="string"){const _=k.trim();k=_?_.toUpperCase():null}return{...E,category:k}}),[n,s,a,t]),p=h.useMemo(()=>C.filter(E=>E.category!=null&&String(E.category).trim()!==""),[C]),N=h.useMemo(()=>un(p.map(E=>E.category)),[p]),[j,z]=h.useState([]),g=h.useMemo(()=>{const E=new Map,k=C;for(const R of k){const T=R.tournament,F=R.round;if(T==null||F==null)continue;const I=E.get(T)??[],G=String(F);I.includes(G)||I.push(G),E.set(T,I)}const _={};for(const[R,T]of E.entries())_[R]=[...T].sort((F,I)=>String(F).localeCompare(String(I)));return _},[C]),S=h.useMemo(()=>{let E=0;for(const k of C){const _=k.round;if(_!=null&&/^\d+$/.test(String(_))){const R=Number(_);R>E&&(E=R)}}return E||30},[C]);h.useEffect(()=>{if(a.length===1){const E=a[0];z(k=>{let _=!1;const R=k.map(T=>T.tournament!==E?(_=!0,{...T,tournament:E}):T);return _?R:k})}},[a]);function w(E){return!j.length||E?.round==null?!0:j.some(({from:k,to:_,tournament:R,dFrom:T,dTo:F})=>{const I=a.length===1?a[0]:R||null;if(!(!I||E.tournament===I))return!1;if(I){const q=g[I]??[];if(q.length>0&&q.every(K=>/^\d+$/.test(K))){const K=Number(E.round);return K>=Number(k)&&K<=Number(_)}else{if(!q.length)return!0;const K=q.indexOf(String(E.round));if(K===-1)return!1;const te=T?q.indexOf(T):0,Me=F?q.indexOf(F):q.length-1,[J,ie]=[te,Me].sort((je,Xe)=>je-Xe);return K>=J&&K<=ie}}const L=Number(E.round);return Number.isNaN(L)?!1:L>=Number(k)&&L<=Number(_)})}return{isLazy:n,tournaments:u,tournamentGroups:b,selectedTournaments:a,setSelectedTournaments:o,selectedCategories:r,setSelectedCategories:i,tournamentGroupsOpen:l,setTournamentGroupsOpen:c,tournamentVisibleEntriesMainRef:d,tournamentVisibleEntriesModalRef:m,lastTournamentClickIndexMainRef:v,lastTournamentClickIndexModalRef:f,handleTournamentToggle:A,loadedQuestions:C,validQuestions:p,categories:N,roundRanges:j,setRoundRanges:z,roundsByTournament:g,globalNumericRoundMax:S,inRanges:w}}function Pi({room:t,roomId:s,membersCount:n,onBack:a,members:o,currentQ:r,answersMap:i}){const[l,c]=h.useState(!1),u=o.filter(m=>m.online!==!1),d=o.filter(m=>m.online===!1);return e.jsxs("div",{className:"glass p-4 flex items-start justify-between",children:[e.jsxs("div",{className:"flex gap-6 flex-1 min-w-0",children:[e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("div",{className:"text-sm opacity-70",children:"Room"}),e.jsx("div",{className:"text-xl font-semibold",children:t?.name||s}),e.jsxs("div",{className:"text-sm opacity-70",children:["Participants: ",n]})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Players"}),e.jsx("div",{className:"grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))] gap-x-4 gap-y-1 max-h-32 overflow-y-auto",children:u.map(m=>e.jsxs("div",{className:"flex items-center justify-between gap-2 text-sm min-w-0",children:[e.jsxs("span",{className:"truncate pr-2 flex-1 flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"truncate",children:m.displayName||m.uid}),m.lastQuestionId===r?.id&&m.lastAnswerStatus&&e.jsx("span",{className:`ml-2 text-xs rounded px-2 py-0.5 flex-shrink-0 ${m.lastAnswerStatus==="correct"?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200":m.lastAnswerStatus==="incorrect"?"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200":"bg-black/10 dark:bg-white/10 text-black/70 dark:text-white/70"}`,children:m.lastAnswerStatus})]}),e.jsx("span",{className:"font-semibold tabular-nums flex-shrink-0",children:m.score||0})]},m.uid))}),d.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("button",{className:"text-sm font-medium text-black/60 dark:text-white/60 hover:text-black dark:hover:text-white flex items-center gap-1",onClick:()=>c(!l),children:[e.jsxs("span",{children:["Disconnected (",d.length,")"]}),e.jsx("svg",{className:`w-4 h-4 transition-transform ${l?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),l&&e.jsx("div",{className:"mt-1 grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))] gap-x-4 gap-y-1 max-h-24 overflow-y-auto",children:d.map(m=>e.jsxs("div",{className:"flex items-center justify-between gap-2 text-sm min-w-0 opacity-60",children:[e.jsxs("span",{className:"truncate pr-2 flex-1 flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"truncate",children:m.displayName||m.uid}),e.jsx("span",{className:"text-xs rounded px-2 py-0.5 bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200 flex-shrink-0",children:"disconnected"}),m.lastQuestionId===r?.id&&m.lastAnswerStatus&&e.jsx("span",{className:`ml-2 text-xs rounded px-2 py-0.5 flex-shrink-0 ${m.lastAnswerStatus==="correct"?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200":m.lastAnswerStatus==="incorrect"?"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200":"bg-black/10 dark:bg-white/10 text-black/70 dark:text-white/70"}`,children:m.lastAnswerStatus})]}),e.jsx("span",{className:"font-semibold tabular-nums flex-shrink-0",children:m.score||0})]},m.uid))})]})]})]}),e.jsx("div",{className:"flex gap-2 ml-4",children:e.jsx("button",{className:"btn btn-ghost",onClick:a,children:"Back"})})]})}function Bi({onStartNext:t,onTogglePause:s,isPaused:n,winnerActive:a,buzzWindowRemainingMs:o,showBuzzTimer:r,readingSpeed:i,onChangeReadingSpeed:l}){const c=typeof i=="number"&&l;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"font-semibold flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{children:"Play"}),r&&o!==null&&e.jsxs("div",{className:"inline-flex items-center px-3 py-1.5 rounded-xl bg-blue-600 text-white text-lg font-bold shadow-sm",children:[Math.ceil(Math.max(0,o)/1e3),"s"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"chip",onClick:t,children:"Start/Next"}),e.jsx("button",{className:"chip",onClick:s,disabled:!!a,children:n?"Resume (P)":"Pause (P)"})]})]}),c&&e.jsxs("div",{className:"flex items-center gap-3 text-sm text-black/80 dark:text-white/80",children:[e.jsx("label",{htmlFor:"mp-reading-speed",className:"font-medium",children:"Reading speed"}),e.jsx("input",{id:"mp-reading-speed",type:"range",min:1,max:12,step:1,value:i,onChange:u=>l(Number(u.target.value)),className:"w-40"}),e.jsxs("span",{className:"tabular-nums w-12 text-right",children:[i," w/s"]})]})]})}function Fi({passPrompt:t,setPassPrompt:s,onJoin:n,busy:a,error:o}){return e.jsxs("div",{className:"glass p-6 space-y-3 max-w-md",children:[e.jsx("div",{className:"font-medium",children:"This room is private"}),e.jsx("input",{className:"rounded-lg border border-black/10 dark:border-white/10 px-3 py-2 bg-white dark:bg-darkcard w-full",placeholder:"Enter passcode",value:t,onChange:r=>s(r.target.value)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-primary",onClick:n,disabled:a||!t,children:"Join"}),o&&e.jsx("div",{className:"text-sm text-red-600",children:o})]})]})}function Ii(){return e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("svg",{width:"40",height:"40",viewBox:"0 0 40 40",className:"animate-spin",children:[e.jsx("path",{d:"M20 5 Q25 10 20 15 Q15 20 20 25 Q25 30 20 35",stroke:"#3b82f6",strokeWidth:"2",fill:"none",className:"animate-pulse"}),e.jsx("path",{d:"M20 5 Q15 10 20 15 Q25 20 20 25 Q15 30 20 35",stroke:"#3b82f6",strokeWidth:"2",fill:"none",className:"animate-pulse",style:{animationDelay:"0.5s"}})]})})}function Ui({grading:t,currentQ:s,words:n,displayedWordCount:a,plainQuestionText:o,showBuzzHint:r,fullMcChoices:i,choiceStreamCount:l,choiceWordProgress:c,choiceWordArrays:u,resultBanner:d,timesUp:m,correctAnswer:v}){return e.jsx("div",{className:"rounded-lg bg-black/5 dark:bg-white/10 p-4 min-h-32 text-black dark:text-white",children:t?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ii,{}),e.jsx("span",{className:"ml-4 text-lg font-semibold",children:"Checking answer..."})]})}):s?e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-black/60 dark:text-white/80 mb-2 flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-semibold",children:String(s.tournament).toUpperCase()})," • ","ROUND ",s.round??"—"," • ",s.category," • ",e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold ${String(s?.question_type||"").toLowerCase()==="bonus"?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-100":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-100"}`,children:String(s?.question_type||"").toLowerCase()==="bonus"?"BONUS":"TOSS-UP"})," • ",e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold ${(i||[]).length>0?"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-100":"bg-pink-100 text-pink-800 dark:bg-pink-900/30 dark:text-pink-100"}`,children:(i||[]).length>0?"MULTIPLE CHOICE":"SHORT ANSWER"})]}),a>=n.length?e.jsx("div",{className:"text-base whitespace-pre-line text-black dark:text-white",children:e.jsx(Re,{children:o})}):e.jsxs("div",{className:"text-base whitespace-pre-line text-black dark:text-white",children:[e.jsx(Re,{children:n.slice(0,Math.min(a,n.length)).join(" ")}),r&&e.jsx("div",{className:"mt-2 text-xs opacity-70 text-black dark:text-white",children:"Press Space to buzz"})]}),(i||[]).length>0&&e.jsx("div",{className:"mt-4 space-y-2 text-base text-black dark:text-white",children:i.map(([f,A],b)=>e.jsxs("div",{className:"practice-katex text-black dark:text-white",children:[e.jsxs("span",{className:"font-semibold mr-1 text-black dark:text-white",children:[f.toUpperCase(),")"]}),(()=>{const C=String(A||"");if(!C)return e.jsx("span",{className:"opacity-50",children:"…"});const p=Array.isArray(u?.[b])?u[b]:[],N=p.length,j=Math.min(N,c?.[b]||0),z=l>b,g=l===b&&j>0&&j<N;if(z||l>=(u?.length||0)&&N>0&&j>=N)return e.jsx(Re,{children:C});if(g){const w=p.slice(0,j).join(" "),E=j>=N?"":" …";return w?e.jsx("span",{className:"opacity-80",children:`${w}${E}`}):e.jsx("span",{className:"opacity-50",children:"…"})}return l===b&&j>=N&&N>0?e.jsx(Re,{children:C}):e.jsx("span",{className:"opacity-50",children:"…"})})()]},f))}),d&&e.jsxs("div",{className:`mt-3 rounded-lg px-3 py-2 ${d.correct?"bg-green-100 text-green-900 dark:bg-green-900/20 dark:text-green-100":"bg-red-100 text-red-900 dark:bg-red-900/20 dark:text-red-100"}`,children:[d.correct?"Correct":"Incorrect",d.reason?` — ${d.reason}`:""]}),m&&e.jsxs("div",{className:"mt-3 flex flex-col gap-2 sm:flex-row sm:items-start sm:gap-3",children:[e.jsx("div",{className:"inline-flex items-center px-2 py-1 rounded bg-red-600/90 text-white text-xs font-semibold",children:"Time’s up"}),v&&e.jsxs("div",{className:"rounded-lg px-3 py-2 bg-black/5 dark:bg-white/10 text-black dark:text-white sm:flex-1",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide opacity-70 mb-1",children:"Correct answer"}),e.jsx("div",{className:"practice-katex text-base text-black dark:text-white",children:e.jsx(Re,{children:String(v)})})]})]})]}):e.jsx("div",{className:"opacity-70 text-sm",children:"No question selected yet."})})}function Wi({currentQId:t,buzzes:s,answersForQ:n,selfUid:a,members:o,typingMap:r,winnerUid:i,awaitNext:l,mcTypedAnswer:c,setMcTypedAnswer:u,onSubmit:d,onUpdateTyping:m,mcInputRef:v,answerWindowUid:f,answerWindowRemainingMs:A,answerSubmissionPending:b,answerWindowResolved:C}){return!t||!Array.isArray(s)||s.length===0?null:e.jsx("div",{className:"mt-2 space-y-2",children:s.slice().reverse().map((p,N,j)=>{const z=i===p.uid&&N===0,g=n?.[p.uid]||null,S=z&&!!b,w=g?.status||null,k=!!(S||w&&w!=="typing"),_=w==="correct"||w==="incorrect",R=g?.correct===!0,T=a===p.uid,F=r?.[p.uid]?.draft||o.find(P=>P.uid===p.uid)?.draft||"",I=p.displayName||o.find(P=>P.uid===p.uid)?.displayName||p.uid,G=z&&!k&&f===p.uid&&!C,L=G&&Number.isFinite(A)?Math.ceil(Math.max(0,A)/1e3):null,q=g?.text||(S?T?c:F:"")||"";return e.jsx("div",{className:"rounded-lg bg-black/5 dark:bg-white/10 p-3",children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-semibold text-black dark:text-white",children:I}),e.jsx("span",{className:"chip text-xs bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200",children:"buzzed"}),e.jsxs("span",{className:"text-[10px] opacity-60",children:["#",j.length-N]}),k?q?e.jsx("span",{className:"ml-2 px-2 py-1 rounded bg-black/10 dark:bg-white/10 text-sm whitespace-pre-wrap break-words",children:q}):null:z?T?e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-[240px]",children:[e.jsx("form",{onSubmit:d,className:"flex-1",children:e.jsx("input",{className:"rounded-lg border border-black/10 dark:border-white/10 px-3 py-1.5 bg-white dark:bg-darkcard w-full",placeholder:"Type your answer and press Enter",value:c,onChange:P=>{u(P.target.value),m(!!P.target.value,String(P.target.value).slice(0,200))},ref:v,autoFocus:!0})}),G&&L!==null&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded bg-black/10 dark:bg-white/10 text-[11px] font-semibold",children:[L,"s"]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"ml-2 text-sm text-black/80 dark:text-white/80 whitespace-pre-wrap break-words",children:F}),G&&L!==null&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded bg-black/10 dark:bg-white/10 text-[11px] font-semibold",children:[L,"s"]})]}):null,_&&e.jsx("span",{className:`chip text-xs ${R?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200"}`,children:R?"correct":"incorrect"}),l&&R&&z&&e.jsx("span",{className:"ml-2 text-xs opacity-70",children:"Press ‘n’ for next"})]})},p.id||`${p.uid}-${N}`)})})}function $i({history:t,page:s,setPage:n,pageSize:a,byId:o,buzzesMap:r,answersMap:i,members:l}){return!Array.isArray(t)||t.length===0?null:e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold text-black/60 dark:text-white/60",children:"Previous Questions"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("button",{className:"chip",disabled:s<=0,onClick:()=>n(c=>Math.max(0,c-1)),children:"Prev"}),e.jsxs("span",{className:"opacity-70",children:["Page ",s+1]}),e.jsx("button",{className:"chip",disabled:(s+1)*a>=t.length,onClick:()=>n(c=>c+1),children:"Next"})]})]}),t.slice(s*a,s*a+a).map((c,u)=>{const d=o.get(c.questionId)||{id:c.questionId};return e.jsxs("details",{className:"rounded-lg bg-black/5 dark:bg-white/10",children:[e.jsx("summary",{className:"cursor-pointer px-3 py-2 text-sm",children:d.tournament?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold",children:String(d.tournament).toUpperCase()})," • Round ",d.round," • ",d.category,d.question_number&&e.jsxs(e.Fragment,{children:[" • Q",d.question_number]})," • ",e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold ${String(d?.question_type||"").toLowerCase()==="bonus"?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-100":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-100"}`,children:String(d?.question_type||"").toLowerCase()==="bonus"?"BONUS":"TOSS-UP"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"font-semibold",children:["Question ",d.id]}),e.jsx("span",{className:"ml-2 opacity-70",children:"(Load tournaments to view details)"})]})}),d.question&&e.jsx("div",{className:"px-3 pb-3 whitespace-pre-wrap",children:e.jsx(Re,{children:d.question})}),(()=>{const m=zs(d);return m.length>0&&e.jsx("div",{className:"px-3 pb-3 space-y-1",children:m.map(([v,f])=>e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"font-semibold mr-2",children:[v.toUpperCase(),")"]}),e.jsx(Re,{children:f})]},v))})})(),e.jsx("div",{className:"px-3 pb-1 flex items-center gap-2",children:e.jsx("span",{className:"text-xs uppercase tracking-wide text-black/60 dark:text-white/60",children:"ANSWER"})}),d.answer&&e.jsx("div",{className:"px-3 pb-3",children:e.jsx(Re,{children:String(d.answer).toUpperCase()})}),d.id&&Array.isArray(r[d.id])&&r[d.id].length>0&&e.jsxs("div",{className:"px-3 pb-3 space-y-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-black/60 dark:text-white/60",children:"Buzz History"}),r[d.id].slice().reverse().map((m,v,f)=>{const A=i?.[d.id]?.[m.uid]||null,b=!!A?.correct,C=m.displayName||l.find(p=>p.uid===m.uid)?.displayName||m.uid;return e.jsxs("div",{className:"text-sm flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium",children:C}),e.jsx("span",{className:"chip text-xs bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200",children:"buzzed"}),e.jsxs("span",{className:"text-[10px] opacity-60",children:["#",f.length-v]}),A?.text&&e.jsx("span",{className:"ml-2 px-2 py-0.5 rounded bg-black/10 dark:bg-white/10 whitespace-pre-wrap break-words",children:A.text}),A&&e.jsx("span",{className:`chip text-xs ${b?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200"}`,children:b?"correct":"incorrect"})]},m.id||`${m.uid}-${v}`)})]})]},c.id||c.questionId||u)})]})}function Gi({roomId:t,messages:s,typingMap:n,selfUid:a,onSendMessage:o,onUpdateTyping:r,disabled:i,inputRef:l}){const[c,u]=h.useState(""),d=h.useRef(null),[m,v]=h.useState(!0),f=h.useRef(null),A=h.useRef(null),b=(g=!0,S=180)=>{try{const w=d.current;if(!w)return;const E=w.scrollHeight;if(!g){w.scrollTop=E,v(!0);return}if(A.current){try{cancelAnimationFrame(A.current)}catch{}A.current=null}const k=w.scrollTop,_=E-k;if(Math.abs(_)<1){v(!0);return}const R=performance.now(),T=Math.max(60,Math.min(400,S)),F=G=>1-Math.pow(1-G,3),I=G=>{const L=G-R,q=Math.min(1,L/T),P=F(q);w.scrollTop=k+_*P,q<1?A.current=requestAnimationFrame(I):(A.current=null,v(!0))};A.current=requestAnimationFrame(I),v(!0)}catch{}};h.useEffect(()=>{try{const g=d.current;if(!g)return;(g.scrollHeight-g.scrollTop-g.clientHeight<=48||m)&&b(!0,140)}catch{}},[s?.length,m]),h.useEffect(()=>{const g=setTimeout(()=>b(!0,160),0);return()=>clearTimeout(g)},[]);const C=h.useMemo(()=>{const g=[];return Object.values(n||{}).forEach(S=>{!S||!S.typing||S.draft&&S.uid!==a&&g.push({uid:S.uid,name:S.displayName||S.uid,draft:String(S.draft||"")})}),g},[JSON.stringify(n),a]),p=h.useMemo(()=>Array.isArray(s)?s:[],[s]),N=()=>{try{const g=d.current;if(!g)return;const w=g.scrollHeight-g.scrollTop-g.clientHeight<=48;v(w),w?f.current&&(clearTimeout(f.current),f.current=null):(f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{b(!0,220)},2e3))}catch{}},j=g=>{const S=g.target.value;u(S),r?.(!!S,String(S).slice(0,200))},z=async g=>{g?.preventDefault?.();const S=String(c||"").trim();if(S)try{try{r?.(!1,"")}catch{}await o?.(S)}finally{u("")}};return e.jsxs("div",{className:"flex flex-col h-[520px] max-h-[60vh]",children:[e.jsxs("div",{ref:d,onScroll:N,className:"relative flex-1 overflow-y-auto pr-1 pb-10 space-y-2",children:[p.map((g,S)=>{const w=g.uid===a,E=String(g.text||""),k=g.displayName||g.uid;return e.jsx("div",{className:`flex ${w?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[75%] px-3 py-2 rounded-2xl text-sm whitespace-pre-wrap break-words ${w?"bg-blue-600 text-white rounded-br-md":"bg-black/5 dark:bg-white/10 text-black dark:text-white rounded-bl-md"}`,children:[!w&&e.jsx("div",{className:"text-[10px] opacity-70 mb-0.5",children:k}),e.jsx("div",{children:E})]})},g.id||`${g.uid}-${S}`)}),C.length>0&&e.jsx("div",{className:"pointer-events-none absolute bottom-2 left-0 right-0 px-1 space-y-1 z-20",children:C.map(g=>e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"pointer-events-none max-w-[75%] px-3 py-2 rounded-2xl text-sm whitespace-pre-wrap break-words bg-black/70 dark:bg-white/20 text-white rounded-bl-md border border-dashed border-white/20 shadow",children:[e.jsxs("div",{className:"text-[10px] opacity-80 mb-0.5",children:[g.name," (typing…)"]}),e.jsx("div",{children:g.draft})]})},`live-${g.uid}`))})]}),e.jsx("form",{onSubmit:z,className:"pt-2",children:e.jsx("textarea",{ref:l,disabled:i,rows:2,className:"w-full rounded-lg border border-black/10 dark:border-white/10 px-3 py-2 bg-white dark:bg-darkcard disabled:opacity-60 resize-y min-h-[44px]",placeholder:i?"Chat disabled while you are answering":"Type a message… (Enter to send, Shift+Enter for newline)",value:c,onChange:j,onBlur:()=>{try{r?.(!1,"")}catch{}},onKeyDown:g=>{if(g.key==="Enter"&&g.shiftKey){g.stopPropagation();return}g.key==="Enter"&&!g.shiftKey&&(g.preventDefault(),z())}})})]})}function Hi({room:t,roomId:s,currentQ:n,parseMCChoicesRG:a,setStemFinishedAt:o,setChoicesFinishedAt:r,resultBanner:i}){const[l,c]=h.useState(0),[u,d]=h.useState(0),[m,v]=h.useState([0,0,0,0]),[f,A]=h.useState(!1),[b,C]=h.useState(""),p=h.useRef(!1),N=h.useMemo(()=>String(n?.question||n?.text||""),[n?.id]),j=h.useMemo(()=>N.split(/\s+/).filter(Boolean),[N]),z=l>=j.length,g=h.useMemo(()=>a(n),[n?.id]),S=h.useMemo(()=>{if(!Array.isArray(g)||g.length===0)return[];const k=new Map(g);return["w","x","y","z"].map(_=>[_,k.get(_)])},[g]),w=h.useMemo(()=>(S.length?S:[]).map(([,k=""])=>String(k||"").split(/\s+/).filter(Boolean)),[S]),E=h.useMemo(()=>w.length?w.reduce((k,_)=>k+(_.length>0?1:0),0):0,[w]);return h.useEffect(()=>{p.current=!0;const k=window.requestAnimationFrame(()=>{p.current=!1});return()=>window.cancelAnimationFrame(k)},[n?.id]),h.useEffect(()=>{c(0),d(0),v(Array.from({length:4},()=>0)),A(!1),C("")},[n?.id]),h.useEffect(()=>{if(!n)return;const k=Number(t?.state?.perWordMs||200),_=Number(t?.state?.streamedWordsBase||0),R=Number(t?.state?.streamStartAt||0)||null;let T=null;const F=()=>{const I=ye(),G=R?Math.max(0,Math.floor((I-R)/Math.max(1,k))):0,L=Math.min(j.length,_+G);t?.state?.awaitNext?c(j.length):c(L)};return!t?.state?.awaitNext&&t?.state?.buzzerOpen&&!t?.state?.winnerUid&&(T=setInterval(F,80)),F(),()=>{T&&clearInterval(T)}},[n?.id,j.length,t?.state?.buzzerOpen,t?.state?.winnerUid,t?.state?.perWordMs,t?.state?.streamedWordsBase,t?.state?.streamStartAt,t?.state?.awaitNext]),h.useEffect(()=>{!n||!z||t?.state?.stemFinishedAt||p.current||j.length>0&&l===0||t?.state?.streamStartAt&&(async()=>{try{await o({roomId:s,questionId:n?.id,at:ye()})}catch{}})()},[z,n?.id,!!t?.state?.stemFinishedAt,l,j.length,t?.state?.streamStartAt]),h.useEffect(()=>{if(!n)return;if(!w.length){u!==0&&d(0);return}const _=w.map(R=>R.length).reduce((R,T,F)=>{const I=m[F]||0;return T===0?R:R+(I>=T?1:0)},0);_>u&&d(Math.min(w.length,_))},[w,m,u,n]),h.useEffect(()=>{if(!n||!t?.state?.awaitNext)return;const k=w.map(R=>R.length);k.every((R,T)=>R===0||(m[T]||0)>=R)||(v(k.map(R=>R)),d(Math.min(w.length,k.filter(R=>R>0).length)))},[n,t?.state?.awaitNext,w,m]),h.useEffect(()=>{if(!n||!w.length||!z)return;const k=Number(t?.state?.perChoiceMs||400);if(!Number(t?.state?.stemFinishedAt||0)||t?.state?.awaitNext||t?.state?.winnerUid||!t?.state?.buzzerOpen)return;const R=Math.min(u,w.length-1);if(R<0)return;const T=w[R]?.length||0;if(T===0){u<w.length&&d(G=>Math.min(w.length,G+1));return}if((m[R]||0)>=T)return;const I=setInterval(()=>{v(G=>{const L=G.slice(0,Math.max(w.length,4)),q=Math.min(u,w.length-1);if(q<0)return G;const P=w[q]?.length||0;if(P===0)return G;const K=L[q]||0;if(K>=P)return G;const te=L.slice();return te[q]=Math.min(P,K+1),te.length?te:G})},Math.max(40,k));return()=>clearInterval(I)},[n?.id,z,t?.state?.winnerUid,t?.state?.buzzerOpen,t?.state?.perChoiceMs,t?.state?.stemFinishedAt,t?.state?.awaitNext,u,m,w.length]),h.useEffect(()=>{if(!n||!w.length||!i||!i.correct||w.map(T=>T.length).every((T,F)=>T===0||(m[F]||0)>=T))return;f||A(!0);const R=setInterval(()=>{v(T=>{const F=T.slice(0,Math.max(w.length,4));let I=!1;for(let G=0;G<w.length;G+=1){const L=w[G]?.length||0;if(L===0)continue;const q=F[G]||0;if(q<L){const P=F.slice();return P[G]=Math.min(L,q+2),I=!0,P}}return I?F:T})},120);return()=>clearInterval(R)},[i,n?.id,w,m,f]),h.useEffect(()=>{!n||!z||t?.state?.choicesFinishedAt||p.current||!t?.state?.stemFinishedAt||j.length>0&&l===0||!(!(E>0)||u>=E)||(async()=>{try{await r({roomId:s,questionId:n?.id,at:ye()})}catch{}})()},[n?.id,z,u,!!t?.state?.choicesFinishedAt,!!t?.state?.stemFinishedAt,l,j.length,E]),{displayedWordCount:l,setDisplayedWordCount:c,choiceStreamCount:u,setChoiceStreamCount:d,choiceWordProgress:m,setChoiceWordProgress:v,choiceWordArrays:w,revealChoicesAfterCheck:f,setRevealChoicesAfterCheck:A,mcTypedAnswer:b,setMcTypedAnswer:C,streamFinished:z,words:j,plainQuestionText:N,choices:g,fullMcChoices:S}}function qi({room:t,roomId:s,currentQ:n}){const[a,o]=h.useState(0);h.useEffect(()=>{const m=setInterval(()=>o(v=>(v+1)%1e6),200);return()=>clearInterval(m)},[]);const r=h.useMemo(()=>{const m=Number(t?.state?.buzzWindowStartAt||0),v=Number(t?.state?.buzzWindowMs||0);if(!m||!v)return null;const f=ye();return Math.max(0,m+v-f)},[t?.state?.buzzWindowStartAt,t?.state?.buzzWindowMs,t?.state?.winnerUid,a]),i=Number(t?.state?.answerWindowDeadlineAt||0)||null,l=t?.state?.answerWindowUid||null,c=!!t?.state?.answerWindowResolved,u=!!t?.state?.grading,d=h.useMemo(()=>{if(!i||c||u)return null;const m=ye();return Math.max(0,i-m)},[i,t?.state?.winnerUid,a,c,u]);return{buzzWindowRemainingMs:r,answerWindowUid:l,answerWindowDeadlineAt:i,answerWindowRemainingMs:d}}function Ji(){async function t(){if(!r?.state?.buzzerOpen)return;const y=Se(),M=y?.uid,D=y?.displayName||"Player";b(!0);try{await bi({roomId:s,uid:M,displayName:D})}finally{b(!1)}}const{roomId:s}=Vt(),n=Es(),a=We(),o=Ce(),[r,i]=h.useState(null),l=W.useCallback(y=>{i(M=>JSON.stringify(M)===JSON.stringify(y)?M:y)},[]),[c,u]=h.useState([]),d=W.useCallback(y=>{u(M=>JSON.stringify(M)===JSON.stringify(y)?M:y)},[]),[m,v]=h.useState([]),f=W.useCallback(y=>{v(M=>JSON.stringify(M)===JSON.stringify(y)?M:y)},[]),[A,b]=h.useState(!1),[C,p]=h.useState(""),[N,j]=h.useState(""),[z,g]=h.useState(""),[S,w]=h.useState(!1),[E,k]=h.useState(!1),[_,R]=h.useState(""),[T,F]=h.useState("");h.useRef(null);const I=Xt(),G=Se(),L=G?.uid||null;G?.displayName;const[q,P]=h.useState(""),[K,te]=h.useState({selectedTournaments:[],selectedCategories:[],roundRanges:[]}),Me=W.useCallback(y=>{te(M=>JSON.stringify(M)===JSON.stringify(y)?M:y)},[]),[J,ie]=h.useState([]),[je,Xe]=h.useState("settings"),[St,ts]=h.useState(()=>Date.now()),[Ge,At]=h.useState(0),[Be,ss]=h.useState(0),ns=10,[zt,Qe]=h.useState(null),rs=!!r?.state?.grading,[Ct,as]=h.useState({}),[Mt,is]=h.useState({}),[me,Et]=h.useState({}),[On,Rt]=h.useState(0),[ge,H]=h.useState({tossup:!0,bonus:!0});h.useRef(null);const x=h.useRef(null),O=h.useRef(null),B=h.useRef(!1),[Y,Q]=h.useState(!1);h.useEffect(()=>{if(s)return di({roomId:s,onRoom:l,onMembers:d,onMessages:f,onSettings:Me,onAnswers:Et})},[s,l,d,f,Me]),h.useEffect(()=>{if(!s||!o?.user)return;const y=ni();!y||!c.some(D=>D.uid===y.uid)||(async()=>{try{await pi({roomId:s,uid:y.uid})}catch{}try{si()}catch{}})()},[s,o?.user?.uid,JSON.stringify(c.map(y=>y.uid))]),h.useEffect(()=>{if(s)return mi({roomId:s,onTyping:y=>{as(M=>({...M,[y.uid]:y}))}})},[s]),h.useEffect(()=>{if(s)return ui({roomId:s,onBuzzes:is})},[s]),h.useEffect(()=>{const y=L;if(!s||!y)return;const M=Yt(),D=ue(M,`mp/roomMembers/${s}/${y}`);try{sa(D).update({online:!1,lastSeenAt:na()})}catch{}return(async()=>{try{await ae(D,{online:!0,lastSeenAt:Date.now()})}catch{}})(),()=>{try{ae(D,{online:!1,lastSeenAt:Date.now()})}catch{}}},[s,L]),h.useEffect(()=>{if(s)return Ai({roomId:s,onHistory:ie})},[s]),h.useEffect(()=>{const y=setInterval(()=>Rt(M=>(M+1)%1e6),200);return()=>clearInterval(y)},[]);const he=String(r?.game?.currentId||"")||"",He=h.useMemo(()=>{const y=he.match(/^([^_]+)__[^_]+__(?:tu|bo)__\d+$/i);return y?y[1]:null},[he]),pe=h.useMemo(()=>{const y=Array.isArray(K?.selectedTournaments)&&K.selectedTournaments.length?K.selectedTournaments:[],M=Array.isArray(r?.game?.tournaments)?r.game.tournaments:[],D=new Set([...y||[],...M||[]]);return He&&D.add(He),Array.from(D)},[JSON.stringify(K?.selectedTournaments||[]),JSON.stringify(r?.game?.tournaments||[]),He]);h.useEffect(()=>{!pe||pe.length===0||(async()=>{try{await I.ensureLoaded(pe)}catch{}})()},[JSON.stringify(pe)]);const Ze=W.useMemo(()=>I.getLoadedQuestions(pe),[I,JSON.stringify(pe)]),Ps=W.useMemo(()=>{const y=new Map;for(const M of Ze)y.set(M.id,M);return y},[Ze]),U=r?.game?.currentId&&Ps.get(r.game.currentId)||null,Pn=Hi({room:r,roomId:s,currentQ:U,parseMCChoicesRG:zs,setStemFinishedAt:ji,setChoicesFinishedAt:Ni,resultBanner:zt}),{displayedWordCount:Bn,choiceStreamCount:Fn,choiceWordProgress:In,choiceWordArrays:Un,mcTypedAnswer:_t,setMcTypedAnswer:Wn,streamFinished:$n,words:Gn,plainQuestionText:Hn,fullMcChoices:qn}=Pn,dt=W.useMemo(()=>{const M=Se()?.uid;return M?c.some(D=>D.uid===M):!1},[c,o?.user?.uid]),os=W.useMemo(()=>{const y=Math.max(60,Number(r?.state?.perWordMs||200)),M=Math.round(1e3/y);return Math.min(12,Math.max(1,M))},[r?.state?.perWordMs]),[Jn,Bs]=h.useState(os);h.useEffect(()=>{Bs(os)},[os]);const Kn=W.useCallback(y=>{const M=Math.min(12,Math.max(1,Math.round(Number(y)||1)));Bs(M),s&&gi({roomId:s,wordsPerSecond:M}).catch(()=>{})},[s]),{tournamentGroups:Vn,selectedTournaments:Le,setSelectedTournaments:Fs,selectedCategories:Fe,setSelectedCategories:Is,tournamentGroupsOpen:Yn,setTournamentGroupsOpen:Xn,tournamentVisibleEntriesMainRef:Qn,handleTournamentToggle:Zn,categories:er,roundRanges:ut,setRoundRanges:Us,roundsByTournament:tr,globalNumericRoundMax:sr,inRanges:nr}=Oi({questions:[],lazy:I}),[rr,ar]=h.useState(!1),[ir,or]=h.useState(()=>{try{return document.documentElement.classList.contains("dark")}catch{return!1}});h.useEffect(()=>{try{const y=document.documentElement,M=()=>or(y.classList.contains("dark"));M();const D=new MutationObserver(M);D.observe(y,{attributes:!0,attributeFilter:["class"]});const $=window.matchMedia("(prefers-color-scheme: dark)");return $.addEventListener("change",M),()=>{D.disconnect(),$.removeEventListener("change",M)}}catch{}},[]);const cs=W.useRef(!1),Tt=()=>{cs.current=!0},cr=y=>{Fs(y),Tt()},lr=y=>{Is(y),Tt()},dr=y=>{Us(y),Tt()},Ws=y=>{const M=typeof y=="function"?y(ge):y;H(M),Tt()},ls=JSON.stringify(K);h.useEffect(()=>{try{const y=JSON.parse(ls||"{}");if(Array.isArray(y.selectedTournaments)&&JSON.stringify(y.selectedTournaments)!==JSON.stringify(Le)&&Fs(y.selectedTournaments),Array.isArray(y.selectedCategories)&&JSON.stringify(y.selectedCategories)!==JSON.stringify(Fe)&&Is(y.selectedCategories),Array.isArray(y.roundRanges)&&JSON.stringify(y.roundRanges)!==JSON.stringify(ut)&&Us(y.roundRanges),y.selectedTypes&&(y.selectedTypes.tossup!==void 0||y.selectedTypes.bonus!==void 0)){const M={tossup:y.selectedTypes.tossup??!0,bonus:y.selectedTypes.bonus??!0};JSON.stringify(M)!==JSON.stringify(ge)&&H(M)}}catch{}},[ls]),h.useEffect(()=>{if(!s)return;const y={selectedTournaments:Array.isArray(Le)?Le:[],selectedCategories:Array.isArray(Fe)?Fe:[],roundRanges:Array.isArray(ut)?ut:[],selectedTypes:ge||{tossup:!0,bonus:!0}};if(!cs.current||(()=>{try{const $=K||{};return JSON.stringify($.selectedTournaments||[])===JSON.stringify(y.selectedTournaments)&&JSON.stringify($.selectedCategories||[])===JSON.stringify(y.selectedCategories)&&JSON.stringify($.roundRanges||[])===JSON.stringify(y.roundRanges)&&JSON.stringify($.selectedTypes||{})===JSON.stringify(y.selectedTypes)}catch{return!1}})())return;const D=setTimeout(()=>{fi({roomId:s,patch:y}),cs.current=!1},200);return()=>clearTimeout(D)},[s,JSON.stringify(Le),JSON.stringify(Fe),JSON.stringify(ut),JSON.stringify(ge),ls]),h.useEffect(()=>{if(!r)return;const y=Se();if(!y&&!o?.user){k(!0);return}(async()=>{try{const M=`mp_pass_ok_${s}`,D=typeof window<"u"?window.localStorage.getItem(M)==="1":!1,$=n?.state?.passcode?String(n.state.passcode).trim():"";if(r.isPrivate&&!dt&&!D)if($){await bt({roomId:s,passcode:$,uid:y?.uid,displayName:y?.displayName});try{window.localStorage.setItem(M,"1"),r?.passHash&&window.localStorage.setItem(`mp_pass_hash_${s}`,String(r.passHash))}catch{}w(!1)}else w(!0);else dt||await bt({roomId:s,uid:y?.uid,displayName:y?.displayName})}catch(M){p(M?.message||String(M))}})()},[!!r,o?.user?.uid,dt]),h.useEffect(()=>{const y=M=>{try{xt(s,!1,"")}catch{}};return window.addEventListener("beforeunload",y),()=>window.removeEventListener("beforeunload",y)},[s]),String(U?.question_type||"").toLowerCase(),h.useEffect(()=>{Qe(null),B.current=!1,Q(!1)},[U?.id]),h.useEffect(()=>{function y(D){return D&&(D.tagName==="INPUT"||D.tagName==="TEXTAREA"||D.isContentEditable)}const M=D=>{const $=D.key;if($===" "||$==="Spacebar"){if(!y(D.target)){const le=Se()?.uid,be=r?.state?.lockedOut&&typeof r.state.lockedOut=="object"?r.state.lockedOut:{};!!U&&!!r?.state?.buzzerOpen&&!r?.state?.winnerUid&&(!le||!be[le])&&(D.preventDefault(),t())}}else String($).toLowerCase()==="p"&&(y(D.target)||(D.preventDefault(),qs()))};return window.addEventListener("keydown",M),()=>window.removeEventListener("keydown",M)},[r?.state?.buzzerOpen,r?.state?.winnerUid,r?.state?.lockedOut,!!U]),h.useEffect(()=>{const y=D=>{if(!D)return!1;const $=(D.tagName||"").toUpperCase();return $==="INPUT"||$==="TEXTAREA"||D.isContentEditable},M=D=>{if(D.altKey||D.ctrlKey||D.metaKey||D.shiftKey||String(D.key)!=="Enter")return;const $=D.target||document.activeElement;y($)||L&&r?.state?.winnerUid===L||(D.preventDefault(),Xe("chat"),setTimeout(()=>{try{O.current?.focus?.()}catch{}},0))};return window.addEventListener("keydown",M),()=>window.removeEventListener("keydown",M)},[L,r?.state?.winnerUid]),h.useEffect(()=>{const y=Array.isArray(m)?m:[];if(je==="chat"){const $=y.reduce((ce,le)=>Math.max(ce,Number(le.createdAt||0)),0);ts($||Date.now()),Ge!==0&&At(0);return}const M=Number(St||0),D=y.reduce(($,ce)=>$+(Number(ce.createdAt||0)>M&&ce.uid!==L?1:0),0);D!==Ge&&At(D)},[je,m,St,L]);const $s=!!(L&&r?.state?.winnerUid===L);h.useEffect(()=>{if(!U||!$s||!!(L&&me?.[U.id]?.[L]))return;const M=x.current;M&&typeof M.focus=="function"&&setTimeout(()=>{try{M.focus(),M.select?.()}catch{}},0)},[$s,U?.id,me,L]),h.useEffect(()=>{const y=D=>{if(!D)return!1;const $=(D.tagName||"").toUpperCase();return $==="INPUT"||$==="TEXTAREA"||D.isContentEditable},M=D=>{if(D.altKey||D.ctrlKey||D.metaKey)return;const $=D.target||document.activeElement;if(y($))return;String(D.key||"").toLowerCase()==="n"&&(D.preventDefault(),gr())};return window.addEventListener("keydown",M),()=>window.removeEventListener("keydown",M)},[U?.id]);const{buzzWindowRemainingMs:mt,answerWindowUid:Dt,answerWindowRemainingMs:Lt}=qi({room:r,roomId:s,currentQ:U}),Gs=!!U&&!!r?.state?.timerExpiredAt,ur=h.useMemo(()=>{if(!U)return"";const y=U.answer||(Array.isArray(U.answers)?U.answers[0]:"")||"";return String(y).trim()},[U?.id]);h.useEffect(()=>{U&&(r?.state?.winnerUid||r?.state?.awaitNext||r?.state?.timerExpiredAt||r?.state?.choicesFinishedAt&&mt!==null&&(mt>0||(async()=>{try{await Promise.allSettled([wi({roomId:s,questionId:U.id,at:ye()}),pt({roomId:s,open:!1})])}catch{}try{await xt(s,!1,"")}catch{}})()))},[mt,!!U,r?.state?.winnerUid,r?.state?.awaitNext,r?.state?.timerExpiredAt,r?.state?.choicesFinishedAt]),h.useEffect(()=>{if(!U)return;const y=r?.state?.winnerUid;if(!y||!Dt||y!==Dt||B.current||r?.state?.grading||r?.state?.answerWindowResolved||Lt===null||Lt>0)return;const M=me?.[U.id]?.[y]||null;if(M)return;const $=Se()?.uid===y;(async()=>{try{if(!await vi({roomId:s,uid:y}))return;if($)await Js({answerText:_t,auto:!0,allowBlank:!0,reasonWhenEmpty:"Time expired"});else{const be=c.find(Ee=>Ee.uid===y)?.displayName||r?.state?.winnerName||M?.displayName||"Player",de=String(U?.question_type||"").toLowerCase()==="tossup",oe=!!r?.state?.currentBuzzInterrupt,X=de&&oe?-4:0;if(await ys({roomId:s,questionId:U.id,uid:y,displayName:be,data:{status:"incorrect",text:"",correct:!1,points:X}}),X!==0)try{await rn({roomId:s,uid:y,delta:X})}catch{}await an({roomId:s,uid:y}),await vs({roomId:s}),await pt({roomId:s,open:!0})}}catch{}})()},[Lt,me,U?.id,r?.state?.winnerUid,Dt,_t,c,r?.state?.currentBuzzInterrupt,r?.state?.grading,r?.state?.answerWindowResolved]);async function mr(){try{b(!0),p(""),await bt({roomId:s,passcode:z});try{window.localStorage.setItem(`mp_pass_ok_${s}`,"1"),r?.passHash&&window.localStorage.setItem(`mp_pass_hash_${s}`,String(r.passHash))}catch{}w(!1)}catch(y){p(y?.message||String(y))}finally{b(!1)}}async function hr(){F("");const y=String(_||"").trim();if(!y||y.length<2){F("Enter a username (min 2 chars)");return}if(c.some($=>($.displayName||"").toLowerCase()===y.toLowerCase())){F("Username is taken in this room");return}const D=ti(y);try{b(!0),await bt({roomId:s,uid:D.uid,displayName:D.displayName}),k(!1)}catch($){F($?.message||String($))}finally{b(!1)}}if(o.loading||!r)return e.jsx("div",{className:"min-h-screen app-radial-bg dark:app-rad-bg transition-colors glass-backdrop",children:e.jsxs(st,{auth:o,children:[e.jsx(Na,{}),e.jsxs("div",{className:"glass p-6 space-y-3 max-w-3xl",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Multiplayer Room"}),e.jsxs("p",{className:"opacity-80 text-sm",children:["Practice Science Bowl together in real time. Rooms support live buzzing, chat, and shared control of question flow. Create a room on the",e.jsx("a",{className:"text-blue-600 hover:underline ml-1",href:"/multiplayer",children:"multiplayer page"})," or join with a code."]}),e.jsxs("ul",{className:"list-disc pl-5 text-sm opacity-80 space-y-1",children:[e.jsx("li",{children:"Host or join private/public rooms"}),e.jsx("li",{children:"Buzz in on toss-ups and type answers"}),e.jsx("li",{children:"Multiple choice and short-answer grading"}),e.jsx("li",{children:"Filters for tournaments, categories, and rounds"})]}),e.jsxs("div",{className:"pt-2",children:[e.jsx("a",{href:"/round-generator",className:"text-blue-600 hover:underline text-sm",children:"Try the Round Generator"}),e.jsx("span",{className:"opacity-60 mx-2",children:"•"}),e.jsx("a",{href:"/buzzer",className:"text-blue-600 hover:underline text-sm",children:"Use the simple buzzer"})]}),e.jsx("div",{className:"pt-3",children:e.jsx(lt,{})})]})]})});const fr=!!Se();if(!o.user&&!fr)return e.jsx("div",{className:"min-h-screen app-radial-bg dark:app-rad-bg transition-colors glass-backdrop",children:e.jsx(st,{auth:o,children:e.jsxs("div",{className:"glass p-6 space-y-3 max-w-md",children:[e.jsx("div",{className:"font-medium",children:"Enter a username to join"}),e.jsx("input",{className:"rounded-lg border border-black/10 dark:border-white/10 px-3 py-2 bg-white dark:bg-darkcard w-full",placeholder:"Username",value:_,onChange:y=>R(y.target.value)}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{className:"btn btn-primary",onClick:hr,disabled:A||!_,children:"Join"}),T&&e.jsx("div",{className:"text-sm text-red-600",children:T})]}),e.jsx("div",{className:"text-xs opacity-70",children:"You can sign in later; your guest slot will be removed automatically."})]})})});async function Hs(){try{P("");const y=oe=>{const X=String(oe||"").trim().toUpperCase();return X&&(X==="PHYSICAL SCIENCE"?"PHYSICS":X==="LIFE SCIENCE"?"BIOLOGY":X==="EARTH AND SPACE SCIENCE"?"EARTH AND SPACE":X==="PHYS"?"PHYSICS":X==="CHEM"?"CHEMISTRY":X)};let M=Le&&Le.length?Le:K.selectedTournaments&&K.selectedTournaments.length?K.selectedTournaments:pe.length?pe:(I.tournaments||[]).slice(0,2);if(!M.length){P("No tournaments loaded yet.");return}await I.ensureLoaded(M);const D=I.getLoadedQuestions(M),$=r?.game?.used&&typeof r.game.used=="object"?r.game.used:{},ce=Fe&&Fe.length?Fe:K.selectedCategories||[],le=new Set(ce||[]),be=D.filter(oe=>{const X=String(oe.category||"").toUpperCase(),Ee=y(X),et=!le.size||X&&(le.has(Ee)||le.has(X)),ke=String(oe.question_type||"").toLowerCase(),qe=ge.tossup&&ke==="tossup"||ge.bonus&&ke==="bonus",re=!$[oe.id];return et&&nr(oe)&&qe&&re});if(!ge.tossup&&!ge.bonus){P("Select at least one type: Toss-up or Bonus");return}if(be.length===0){P("No questions available (all used for current filters).");return}const de=be[Math.floor(Math.random()*be.length)];await yi({roomId:s,questionId:de.id,tournaments:M}),await on({roomId:s}),await pt({roomId:s,open:!0}),Qe(null)}catch(y){P(y?.message||String(y))}}async function qs(){try{if(r?.state?.winnerUid)return;const y=!!r?.state?.buzzerOpen;await pt({roomId:s,open:!y})}catch{}}function pr(y,M=[]){if(!y)return null;const D={a:"w",b:"x",c:"y",d:"z"},ce=String(y.answer??(Array.isArray(y.answers)?y.answers[0]:"")??"").toLowerCase().replace(/^answer[:\-\s]+/i,"").trim(),be=ce.replace(/[()\s.]/g,"").charAt(0);let de=D[be]||be;if(!["w","x","y","z"].includes(de)){const oe=ce.match(/\b([wxyz])\b/);oe&&(de=oe[1])}if(!["w","x","y","z"].includes(de)){const oe=Ee=>String(Ee||"").toLowerCase().replace(/^answer[:\-\s]+/i,"").replace(/^[wxyz][.)\s-]*/,"").replace(/\s+/g," ").trim(),X=oe(ce);for(const[Ee,et]of M){const ke=oe(et);if(!(!ke||!X)&&(X===ke||X.endsWith(ke)||ke.endsWith(X))){de=Ee;break}}}return["w","x","y","z"].includes(de)?de:null}async function Js({answerText:y,auto:M=!1,allowBlank:D=!1,reasonWhenEmpty:$="No answer provided"}){if(!U)return null;const ce=Se(),le=ce?.uid;if(!le||r?.state?.winnerUid!==le)return null;const be=ce?.displayName||"Player",de=zs(U),oe=(de||[]).length>0,X=String(y||"").trim();if(!X&&!D)return Qe({correct:!1,reason:$}),null;try{await xt(s,!1,"")}catch{}B.current=!0,Q(!0);let Ee=null;try{try{await xi({roomId:s})}catch{}try{await ys({roomId:s,questionId:U.id,uid:le,displayName:be,data:{status:"pending",text:X,correct:null}})}catch{}const et=String(U?.question_type||"").toLowerCase()==="tossup",ke=String(U?.question||U?.leadin||U?.text||"").trim();let qe=String(U?.answer??(Array.isArray(U?.answers)?U.answers[0]:"")??"").trim();qe=qe.replace(/^\(?[wxyz]\)?[.)\s-]*/i,"");let re=null,Ks=!1;const br=Array.isArray(de)?de:[],ds=X.toLowerCase().trim();if(oe&&["w","x","y","z"].includes(ds)&&ds.length===1){const Ie=pr(U,br);if(Ie){const ft=ds===Ie;re={correct:ft,...ft?{}:{reason:`Correct: ${Ie.toUpperCase()}`}}}else re={correct:!1,reason:"Correct letter unavailable"}}if(!re&&X){Ks=!0,await ws({roomId:s,grading:!0});try{if(et)oe?re=await(await _i({userAnswer:X,correctAnswer:qe,question:ke,choices:de})).json():re=await(await ln({userAnswer:X,correctAnswer:qe,question:ke})).json();else{const Ie={userAnswer:X,correctAnswer:qe,question:ke,...oe?{choices:de}:{}};re=await(await ln(Ie)).json()}}catch{re={correct:!1,reason:"Grading failed"}}}else X||(re={correct:!1,reason:$||"Time expired"});re||(re={correct:!1,reason:"Grading failed"}),Qe(re),j(""),Ks?await ws({roomId:s,grading:!1}):M&&await ws({roomId:s,grading:!1});const yr=!$n;let ht=0;et?ht=re.correct?4:yr?-4:0:ht=re.correct?10:0,await ys({roomId:s,questionId:U.id,uid:le,displayName:be,data:{status:re.correct?"correct":"incorrect",text:X,correct:!!re.correct,points:ht}}),ht!==0&&await rn({roomId:s,uid:le,delta:ht}),re.correct?await cn({roomId:s,value:!0}):(await an({roomId:s,uid:le}),await vs({roomId:s}),await pt({roomId:s,open:!0})),Ee=re}finally{B.current=!1,Q(!1)}return Ee}async function xr(y){y?.preventDefault(),await Js({answerText:_t,auto:!1,allowBlank:!1,reasonWhenEmpty:"No answer provided"})}async function gr(){try{await cn({roomId:s,value:!1}),await vs({roomId:s}),await on({roomId:s}),await Hs()}catch{}}return e.jsxs("div",{className:"min-h-screen app-radial-bg dark:app-radial-bg transition-colors glass-backdrop",children:[e.jsx(st,{auth:o,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(Pi,{room:r,roomId:s,membersCount:c.length,onBack:()=>a("/multiplayer"),members:c,currentQ:U,answersMap:me}),S&&!dt&&e.jsx(Fi,{passPrompt:z,setPassPrompt:g,onJoin:mr,busy:A,error:C}),(!S||dt)&&e.jsxs("div",{className:"grid lg:grid-cols-3 gap-4 items-start",children:[e.jsxs("div",{className:"glass p-6 lg:col-span-2 space-y-4",children:[e.jsx(Bi,{onStartNext:Hs,onTogglePause:qs,isPaused:!r?.state?.buzzerOpen,winnerActive:r?.state?.winnerUid,buzzWindowRemainingMs:mt,showBuzzTimer:!!U&&!!r?.state?.buzzerOpen&&!!r?.state?.choicesFinishedAt&&!r?.state?.winnerUid&&!r?.state?.awaitNext&&!r?.state?.grading&&mt!==null,readingSpeed:Jn,onChangeReadingSpeed:Kn}),q&&e.jsx("div",{className:"text-sm text-red-600",children:q}),e.jsx(Ui,{grading:rs,currentQ:U,words:Gn,displayedWordCount:Bn,plainQuestionText:Hn,showBuzzHint:!r?.state?.winnerUid&&r?.state?.buzzerOpen,fullMcChoices:qn,choiceStreamCount:Fn,choiceWordProgress:In,choiceWordArrays:Un,resultBanner:zt,timesUp:Gs,correctAnswer:Gs?ur:null}),e.jsx(Wi,{currentQId:U?.id,buzzes:U?Mt[U.id]:[],answersForQ:U?me?.[U.id]:{},selfUid:L,members:c,typingMap:Ct,winnerUid:r?.state?.winnerUid,awaitNext:r?.state?.awaitNext,mcTypedAnswer:_t,setMcTypedAnswer:Wn,onSubmit:xr,onUpdateTyping:(y,M)=>xt(s,y,M),mcInputRef:x,answerWindowUid:Dt,answerWindowRemainingMs:Lt,answerSubmissionPending:Y,answerWindowResolved:!!r?.state?.answerWindowResolved}),e.jsx($i,{history:J,page:Be,setPage:ss,pageSize:ns,byId:Ps,buzzesMap:Mt,answersMap:me,members:c}),C&&e.jsx("div",{className:"text-sm text-red-600",children:C})]}),e.jsxs("div",{className:"glass p-6 space-y-6",children:[e.jsx("div",{className:"flex border-b border-black/10 dark:border-white/10 mb-3",children:["settings","chat"].map(y=>{const M=je===y,D=y==="settings"?"Settings":"Chat";return e.jsxs("button",{className:`relative px-3 py-2 -mb-px border-b-2 text-sm font-medium mr-2 ${M?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent opacity-70 hover:opacity-100"}`,onClick:()=>Xe(y),children:[D,y==="chat"&&!M&&Ge>0&&e.jsx("span",{className:"absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1 rounded-full bg-red-600 text-white text-[10px] leading-[18px] text-center shadow",children:Ge>99?"99+":Ge})]},y)})}),je==="settings"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Selection"}),e.jsx(Ti,{tournaments:I.tournaments||[],tournamentGroups:Vn,selectedTournaments:Le,setSelectedTournaments:cr,tournamentGroupsOpen:Yn,setTournamentGroupsOpen:Xn,handleTournamentToggle:Zn,tournamentVisibleEntriesMainRef:Qn,isDark:ir,showTournamentModal:rr,setShowTournamentModal:ar})]}),e.jsx(Di,{categories:er,selectedCategories:Fe,setSelectedCategories:lr}),e.jsxs("div",{className:"pt-2",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Question Type"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:ge.tossup,onChange:y=>Ws(M=>({...M,tossup:y.target.checked}))}),"Toss-up"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:ge.bonus,onChange:y=>Ws(M=>({...M,bonus:y.target.checked}))}),"Bonus"]})]})]}),e.jsx(Li,{selectedTournaments:Le,tournaments:I.tournaments||[],roundRanges:ut,setRoundRanges:dr,roundsByTournament:tr,globalNumericRoundMax:sr})]}):e.jsx(Gi,{roomId:s,messages:m,typingMap:Ct,selfUid:L,onSendMessage:async y=>{try{await hi({roomId:s,text:y})}catch{}},onUpdateTyping:(y,M)=>xt(s,y,M),disabled:!!(L&&r?.state?.winnerUid===L),inputRef:O})]})]})]})}),(()=>{const y=r?.state?.lockedOut&&typeof r.state.lockedOut=="object"?r.state.lockedOut:{},M=!!U&&!!r?.state?.buzzerOpen&&!r?.state?.winnerUid&&(!L||!y[L]);return e.jsx("div",{className:"md:hidden fixed bottom-0 inset-x-0 z-40 p-3 pb-[calc(env(safe-area-inset-bottom)+12px)] pointer-events-none",children:e.jsx("div",{className:"max-w-3xl mx-auto pointer-events-auto",children:e.jsx("button",{className:`w-full py-4 rounded-2xl text-white text-lg font-bold shadow-xl active:scale-[0.98] transition ${M?"bg-red-600":"bg-red-300 cursor-not-allowed"}`,onClick:()=>{M&&t()},"aria-label":"Buzz",disabled:!M,children:M?"BUZZ":r?.state?.winnerUid?"BUZZ LOCKED":"BUZZ DISABLED"})})})})()]})}let js=null,Je={roomId:null,typing:null,draft:null,at:0};async function xt(t,s,n){const a=Yt(),o=Date.now(),r=n||"",i=!s||r.length===0||o-(Je.at||0)>300||Je.typing!==!!s,l=async()=>{try{const c=Se?.()||null,u=c?.uid,d=c?.displayName||"Player";if(!u)return;const m=Date.now();if(Je.roomId===t&&Je.typing===!!s&&Je.draft===r&&m-(Je.at||0)<120)return;const v=ue(a,`mp/roomMembers/${t}/${u}`);await ae(v,{uid:u,displayName:d,typing:!!s,draft:r,lastTypedAt:Date.now()}),Je={roomId:t,typing:!!s,draft:r,at:m}}catch{}};js&&clearTimeout(js),i?await l():js=setTimeout(l,120)}function Ns({children:t,dark:s,setDark:n,themePref:a,setThemePref:o,userChangedPrefRef:r}){return e.jsxs("div",{className:"min-h-screen app-radial-bg dark:app-radial-bg transition-colors glass-backdrop text-black dark:text-white flex flex-col items-center px-4 py-10",children:[e.jsxs("div",{className:"w-full max-w-md flex items-center justify-between mb-4 gap-2",children:[e.jsxs(Kt,{to:"/round-generator",className:"inline-flex items-center gap-1 text-xs px-3 py-1 rounded-full border border-black/10 dark:border-white/20 hover:bg-black/5 dark:hover:bg-white/10 transition","aria-label":"Back to home",children:[e.jsx("span",{"aria-hidden":"true",className:"-ml-0.5 mr-0.5",children:"←"}),e.jsx(ca,{size:14,"aria-hidden":"true"}),e.jsx("span",{children:"Home"})]}),e.jsxs("div",{className:"relative inline-flex items-center group",children:[a!=="system"&&e.jsx("button",{type:"button",onClick:()=>{r.current=!0,o("system"),n(Ue("system"))},className:"mr-2 hidden group-hover:inline-flex items-center px-2 py-1 rounded text-xs border border-black/10 dark:border-white/20 bg-white/70 dark:bg-black/40 backdrop-blur-sm text-black dark:text-white hover:bg-white/90 dark:hover:bg-black/60 transition","aria-label":"Follow system theme",title:"Follow system",children:"Follow system"}),e.jsx(vn,{checked:s,onChange:i=>{r.current=!0,o(i?"dark":"light"),n(i)}})]})]}),t]})}function Ki(){const t=Ce(),[s,n]=W.useState(""),[a,o]=W.useState(""),[r,i]=W.useState(!1),[l,c]=W.useState(""),[u,d]=W.useState(!1),[m,v]=W.useState(""),[f,A]=W.useState("system"),[b,C]=W.useState(()=>{try{return document.documentElement.classList.contains("dark")}catch{return Ue("system")}}),p=W.useRef(!1);W.useEffect(()=>{let w=!0;return jn().then(E=>{w&&(A(E),C(Ue(E)))}),()=>{w=!1}},[]),W.useEffect(()=>{document.documentElement.classList.toggle("dark",b),b?document.body.classList.add("dark-bg"):document.body.classList.remove("dark-bg");let w=document.querySelector('meta[name="theme-color"]');w||(w=document.createElement("meta"),w.name="theme-color",document.head.appendChild(w)),w.setAttribute("content",b?"#000000":"#ffffff")},[b]),W.useEffect(()=>{p.current&&Nn(f)},[f]),W.useEffect(()=>{if(f!=="system")return;C(Ue("system"));const w=kn(E=>{C(!!E)});return()=>w&&w()},[f]);const N=/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(s),j=a.length>=10,z=async()=>{if(c(""),!N){c("Enter a valid email.");return}if(!j){c("Password must be at least 10 characters.");return}i(!0);try{await t.loginWithEmail(s,a)}catch(w){const E=w?.code||"";c(E==="auth/invalid-credential"||E==="auth/wrong-password"||E==="auth/user-not-found"?"Wrong email or password.":E==="auth/too-many-requests"?"Too many attempts. Try again later.":E==="auth/invalid-email"?"Enter a valid email.":w?.message||"Login failed.")}finally{i(!1)}},g=async()=>{if(c(""),!N){c("Enter a valid email.");return}if(!j){c("Password isn’t safe. Use at least 10 characters.");return}i(!0);try{await t.signupWithEmail(s,a)}catch(w){const E=w?.code||"";c(E==="auth/email-already-in-use"?"That email already exists. Try signing in.":E==="auth/weak-password"?"Password isn’t safe. Use at least 10 characters.":E==="auth/invalid-email"?"Enter a valid email.":w?.message||"Sign up failed.")}finally{i(!1)}},S=async()=>{c(""),i(!0);try{await t.loginWithGoogle()}catch(w){const E=w?.code||"";c(E==="auth/popup-closed-by-user"?"Sign-in was canceled.":E==="auth/cancelled-popup-request"?"Another sign-in is already in progress.":w?.message||"Google sign-in failed.")}finally{i(!1)}};return t.user?e.jsx(Ns,{dark:b,setDark:C,themePref:f,setThemePref:A,userChangedPrefRef:p,children:e.jsxs("div",{className:"mx-auto w-full max-w-md p-6 glass space-y-4",children:[e.jsxs("div",{className:"mb-3",children:["You’re signed in as ",e.jsx("strong",{children:t.user.email||t.user.displayName}),"."]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("a",{href:"/",className:"btn btn-primary",children:"Go to app"}),e.jsx("button",{className:"btn btn-ghost",onClick:t.logout,children:"Logout"})]})]})}):u?e.jsx(Ns,{dark:b,setDark:C,themePref:f,setThemePref:A,userChangedPrefRef:p,children:e.jsxs("div",{className:"mx-auto w-full max-w-md p-6 glass space-y-4 flex flex-col items-center",children:[e.jsx("h1",{className:"text-xl font-semibold gradient-text",children:"Reset password"}),m&&e.jsx("div",{className:"rounded-lg border border-green-300/60 bg-green-50 text-green-800 dark:bg-green-900/20 dark:text-green-200 dark:border-green-400/40 px-3 py-2 text-sm",children:m}),l&&e.jsx("div",{className:"rounded-lg border border-red-300/60 bg-red-50 text-red-800 dark:bg-red-900/20 dark:text-red-200 dark:border-red-400/40 px-3 py-2 text-sm",children:l}),e.jsx("input",{className:"w-full rounded-lg border border-black/10 bg-white dark:bg-darkcard text-black dark:text-white px-2 py-2",placeholder:"Enter your email",type:"email",autoComplete:"email",value:s,onChange:w=>n(w.target.value)}),e.jsxs("div",{className:"flex flex-col items-center gap-2 w-full mt-2",children:[e.jsxs("button",{className:"btn btn-primary flex items-center justify-center gap-2 w-full",disabled:r||!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(s),onClick:async()=>{c(""),v(""),i(!0);try{await Cr(Ae(),s),v("Password reset email sent, if you have an account with us! Check your inbox.")}catch(w){w?.code==="auth/user-not-found"?c("No account found for that email."):w?.code==="auth/invalid-email"?c("Enter a valid email."):c(w?.message||"Failed to send reset email.")}finally{i(!1)}},children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M22 2L11 13"}),e.jsx("path",{d:"M22 2l-7 20-4-9-9-4 20-7z"})]}),"Send reset email"]}),e.jsxs("button",{className:"btn btn-ghost flex items-center justify-center gap-2 w-full",onClick:()=>{d(!1),c(""),v("")},children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back"]})]})]})}):e.jsx(Ns,{dark:b,setDark:C,themePref:f,setThemePref:A,userChangedPrefRef:p,children:e.jsxs("div",{className:"mx-auto w-full max-w-md p-6 glass mt-0 space-y-4 flex flex-col items-center",children:[e.jsx(va,{}),e.jsx("h1",{className:"text-xl font-semibold gradient-text",children:"Sign in"}),l&&e.jsx("div",{className:"rounded-lg border border-red-300/60 bg-red-50 text-red-800 dark:bg-red-900/20 dark:text-red-200 dark:border-red-400/40 px-3 py-2 text-sm",role:"alert","aria-live":"polite",children:l}),e.jsxs("button",{className:"btn btn-google w-full bg-white text-[#1f1f1f] border border-black/10 hover:bg-white/90 dark:bg-white dark:text-[#1f1f1f] dark:hover:bg-white/90 flex items-center justify-center text-base",style:{maxWidth:320,minHeight:48,paddingTop:8,paddingBottom:8},disabled:r,onClick:S,children:[e.jsx("span",{className:"google-icon",style:{width:28,height:28,marginRight:14,display:"flex",alignItems:"center",justifyContent:"center"},"aria-hidden":!0}),e.jsx("span",{style:{lineHeight:"28px"},children:"Sign in with Google"})]}),e.jsx("div",{className:"text-center opacity-60 text-sm",children:"or"}),e.jsx("input",{className:"w-full rounded-lg border border-black/10 bg-white dark:bg-darkcard text-black dark:text-white px-2 py-2",placeholder:"email",type:"email",autoComplete:"email",value:s,onChange:w=>n(w.target.value)}),e.jsx("input",{className:"w-full rounded-lg border border-black/10 bg-white dark:bg-darkcard text-black dark:text-white px-2 py-2",placeholder:"password",type:"password",autoComplete:"current-password",value:a,onChange:w=>o(w.target.value)}),e.jsxs("div",{className:"flex flex-col w-full mt-2 gap-2 items-center",children:[e.jsxs("div",{className:"flex gap-2 w-full justify-center",children:[e.jsxs("button",{className:"btn btn-fancy flex items-center justify-center gap-2 text-sm font-medium",disabled:r,onClick:z,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 12h14M12 5l7 7-7 7"})}),"Login"]}),e.jsxs("button",{className:"btn btn-orange flex items-center justify-center gap-2 text-sm font-medium hover-lift",disabled:r,onClick:g,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Sign up"]})]}),e.jsx("button",{className:"text-xs text-red-500 hover:underline focus:underline font-normal w-full mt-2 flex items-center justify-center gap-1 bg-transparent border-none p-0",type:"button",style:{cursor:"pointer"},onClick:()=>{d(!0),c(""),v("")},children:"Forgot password?"})]})]})})}const Vi=Pr([{path:"/",element:e.jsx(Ia,{})},{path:"/round-generator",element:e.jsx(bs,{})},{path:"/practice",element:e.jsx(bs,{})},{path:"/admin",element:e.jsx(bs,{})},{path:"/signin",element:e.jsx(Ki,{})},{path:"/buzzer",element:e.jsx(qa,{})},{path:"/buzzer/:code",element:e.jsx(Ja,{})},{path:"/buzzer/:code/generate",element:e.jsx(Ya,{})},{path:"/buzzer/:code/round",element:e.jsx(Za,{})},{path:"/multiplayer",element:e.jsx(Ci,{})},{path:"/multiplayer/:roomId",element:e.jsx(Ji,{})},{path:"*",element:e.jsx(Ur,{to:"/",replace:!0})}]);wr.createRoot(document.getElementById("root")).render(e.jsx(W.StrictMode,{children:e.jsx(Or,{children:e.jsx(Ea,{children:e.jsx(Br,{router:Vi})})})}));export{Di as C,Re as L,Li as R,Ti as T,Sn as a,ln as b,_i as c,lt as d,Yo as e,ic as f,ee as g,sc as h,Jo as i,Vo as j,Zo as k,Qo as l,Ko as m,wn as n,oc as o,zs as p,ac as q,Xo as r,ec as s,rc as t,Oi as u,nc as v,qo as w,cc as x,tc as y,Ho as z};
