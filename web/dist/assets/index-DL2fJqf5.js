const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PracticeMode-Bi4LErd5.js","assets/vendor-react-DpsG3A-O.js","assets/vendor-abs-svg-path-DCUpb6Nw.js","assets/visualBonuses-m3ufG0uO.js","assets/vendor-firebase-storage-D1N4MLec.js","assets/vendor-firebase-app-DqcDUDC6.js","assets/vendor-firebase-component-B9jxOSis.js","assets/vendor-firebase-util-CIVODmCg.js","assets/vendor-firebase-logger-CNz1B4Yj.js","assets/vendor-idb-BXWtuYvb.js","assets/vendor-lucide-react-DoOgXp02.js","assets/vendor-react-dom-D1u-fJLi.js","assets/vendor-scheduler-CoSDG3-6.js","assets/vendor-firebase-BZrYkTdu.js","assets/vendor-firebase-app-check-Co35-rT3.js","assets/vendor-firebase-firestore-BRp-7IKb.js","assets/vendor-firebase-webchannel-wrapper-QS5lB7L3.js","assets/vendor-firebase-database-DcYXcGm3.js","assets/vendor-react-helmet-async-bvMvt1Ax.js","assets/vendor-react-fast-compare-BCtOC5yC.js","assets/vendor-invariant-DW3JcdOx.js","assets/vendor-shallowequal-Df9Q-7bk.js","assets/vendor-react-router-dom-D6uELkfw.js","assets/vendor-react-router-B_FrsTVh.js","assets/vendor-remix-run-router-9r-WWGj9.js","assets/vendor-mui-material-DksXbHt-.js","assets/vendor-mui-utils-B23qfrSe.js","assets/vendor-clsx-B-dksMZM.js","assets/vendor-mui-system-BndTH9qf.js","assets/vendor-mui-styled-engine-CPmDJbkS.js","assets/vendor-emotion-styled-5vLscvJp.js","assets/vendor-babel-runtime-WXw8LxeR.js","assets/vendor-emotion-serialize-B6qc6euy.js","assets/vendor-emotion-hash-WldOFDRm.js","assets/vendor-emotion-unitless-x5IvBceT.js","assets/vendor-emotion-memoize-3S_6p140.js","assets/vendor-emotion-use-insertion-effect-with-fallbacks-B--OEmuQ.js","assets/vendor-emotion-utils-BijCJQMc.js","assets/vendor-emotion-is-prop-valid-DOnQZHJ6.js","assets/vendor-emotion-react-DrbGOuDy.js","assets/vendor-hoist-non-react-statics-mDtaWys7.js","assets/vendor-react-is-CnyDuYXe.js","assets/vendor-emotion-cache-DvsOMRO7.js","assets/vendor-emotion-sheet-6IwnyhEX.js","assets/vendor-stylis-DDa9OTMq.js","assets/vendor-react-transition-group-Q1VPUTjR.js","assets/vendor-three-CGYwrSEf.js","assets/vendor-katex-DP_4UPSs.js","assets/vendor-katex-CIur2ABi.css","assets/Admin-BwueU6Tz.js","assets/RoundGenerator-B42ChL-b.js","assets/vendor-react-pdf-renderer-DfOTdHag.js","assets/vendor-queue-IZnSDwnG.js","assets/vendor-inherits-BICa84dG.js","assets/vendor-events-DQ172AOg.js","assets/vendor-react-pdf-font-ByacAZ2x.js","assets/vendor-cross-fetch-DvOI2u39.js","assets/vendor-fontkit-5mDwoQ7O.js","assets/vendor-restructure-DwIbRzqP.js","assets/vendor-swc-helpers-DIxjOVuh.js","assets/vendor-fast-deep-equal-DtIvihjZ.js","assets/vendor-unicode-properties-BbL32wKl.js","assets/vendor-base64-js-BJmSPyJr.js","assets/vendor-unicode-trie-rSh8NucD.js","assets/vendor-tiny-inflate-BmeP50H3.js","assets/vendor-dfa-DFRa2UL2.js","assets/vendor-clone-DniFCc4t.js","assets/vendor-brotli-CUuIRSoC.js","assets/vendor-tslib-kHcLnhpD.js","assets/vendor-react-pdf-render-DYs5yDRr.js","assets/vendor-react-pdf-primitives-B6ApagcG.js","assets/vendor-react-pdf-fns-DIcDsgsD.js","assets/vendor-parse-svg-path-Bi0KIs1g.js","assets/vendor-normalize-svg-path-CFWHe3yZ.js","assets/vendor-svg-arc-to-cubic-bezier-DEq50KMd.js","assets/vendor-color-string-BKSasjlw.js","assets/vendor-color-name-Dju3oUBS.js","assets/vendor-simple-swizzle-3gX0Onlb.js","assets/vendor-is-arrayish-DyGeW-O8.js","assets/vendor-react-pdf-pdfkit-CgWEQEi-.js","assets/vendor-pako-CNe1bWpJ.js","assets/vendor-crypto-js-C9XMI5TL.js","assets/vendor-jay-peg-DnV82Tak.js","assets/vendor-react-pdf-png-js-D_OjzuBh.js","assets/vendor-react-pdf-layout-CVT9JNgr.js","assets/vendor-react-pdf-stylesheet-B2kC1IpU.js","assets/vendor-postcss-value-parser-DOXmp8r9.js","assets/vendor-hsl-to-hex-CDkcI7Vq.js","assets/vendor-hsl-to-rgb-for-reals-jL61FXS_.js","assets/vendor-media-engine-BWjc9dwl.js","assets/vendor-react-pdf-textkit-R3VqYnwu.js","assets/vendor-bidi-js-DLACMwmw.js","assets/vendor-hyphen-B2aENclZ.js","assets/vendor-yoga-layout-nAHjiEuJ.js","assets/vendor-react-pdf-image-BJ1YGwqv.js","assets/vendor-object-assign-Dm9xdUEz.js","assets/vendor-react-katex-CCCXQq7R.js","assets/vendor-prop-types-Chjiymov.js"])))=>i.map(i=>d[i]);
import{r as h,j as e,b as I}from"./vendor-react-DpsG3A-O.js";import{c as lr}from"./vendor-react-dom-D1u-fJLi.js";import{g as dr,o as ur,G as mr,s as hr,a as fr,c as pr,b as xr,d as gr}from"./vendor-firebase-BZrYkTdu.js";import{i as br,a as yr,g as wr}from"./vendor-firebase-app-check-Co35-rT3.js";import{g as zs,a as xe,d as Z,c as it,b as gn,s as ze,u as ee,e as Ke,f as _s,r as Rs,h as vr,i as jr,j as vt,o as Wt,q as Xs,w as Zs}from"./vendor-firebase-firestore-BRp-7IKb.js";import{c as en,i as Nr}from"./vendor-firebase-app-DqcDUDC6.js";import"./vendor-firebase-logger-CNz1B4Yj.js";import{g as kr}from"./vendor-firebase-storage-D1N4MLec.js";import{H as Qe,a as Sr}from"./vendor-react-helmet-async-bvMvt1Ax.js";import{L as Jt,c as Ar,R as zr}from"./vendor-react-router-dom-D6uELkfw.js";import{s as Cr,S as Er}from"./vendor-mui-material-DksXbHt-.js";import{c as $e,d as Ts,f as Kt,g as Mr}from"./vendor-react-router-B_FrsTVh.js";import{C as ps,D as _r,R as Rr,L as Ot,a as Lt,V as Bt,b as de,W as Tr,c as Dr,S as tn,d as sn,M as xs,P as gs,e as Pt,H as Or,F as Lr,f as Br,B as Pr,g as Fr,h as Ir,A as Ur}from"./vendor-three-CGYwrSEf.js";import"./vendor-katex-DP_4UPSs.js";import{g as Vt,r as oe,o as ye,a as fe,q as Ds,l as bn,b as Os,s as ot,c as $r,d as Wr,u as re,e as Re,f as Ve,h as De,p as Ls,i as Gr,j as Hr,k as qr}from"./vendor-firebase-database-DcYXcGm3.js";import{L as Cs,S as Es,M as Jr,C as bs,a as ys,b as nn,A as Kr,P as Vr,c as Qr,H as Yr}from"./vendor-lucide-react-DoOgXp02.js";import"./vendor-abs-svg-path-DCUpb6Nw.js";import"./vendor-scheduler-CoSDG3-6.js";import"./vendor-firebase-util-CIVODmCg.js";import"./vendor-firebase-component-B9jxOSis.js";import"./vendor-firebase-webchannel-wrapper-QS5lB7L3.js";import"./vendor-idb-BXWtuYvb.js";import"./vendor-react-fast-compare-BCtOC5yC.js";import"./vendor-invariant-DW3JcdOx.js";import"./vendor-shallowequal-Df9Q-7bk.js";import"./vendor-remix-run-router-9r-WWGj9.js";import"./vendor-mui-utils-B23qfrSe.js";import"./vendor-clsx-B-dksMZM.js";import"./vendor-mui-system-BndTH9qf.js";import"./vendor-mui-styled-engine-CPmDJbkS.js";import"./vendor-emotion-styled-5vLscvJp.js";import"./vendor-babel-runtime-WXw8LxeR.js";import"./vendor-emotion-serialize-B6qc6euy.js";import"./vendor-emotion-hash-WldOFDRm.js";import"./vendor-emotion-unitless-x5IvBceT.js";import"./vendor-emotion-memoize-3S_6p140.js";import"./vendor-emotion-use-insertion-effect-with-fallbacks-B--OEmuQ.js";import"./vendor-emotion-utils-BijCJQMc.js";import"./vendor-emotion-is-prop-valid-DOnQZHJ6.js";import"./vendor-emotion-react-DrbGOuDy.js";import"./vendor-hoist-non-react-statics-mDtaWys7.js";import"./vendor-react-is-CnyDuYXe.js";import"./vendor-emotion-cache-DvsOMRO7.js";import"./vendor-emotion-sheet-6IwnyhEX.js";import"./vendor-stylis-DDa9OTMq.js";import"./vendor-react-transition-group-Q1VPUTjR.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function r(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(i){if(i.ep)return;i.ep=!0;const n=r(i);fetch(i.href,n)}})();const Xr="modulepreload",Zr=function(t){return"/"+t},rn={},ct=function(s,r,a){let i=Promise.resolve();if(r&&r.length>0){let l=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),c=o?.nonce||o?.getAttribute("nonce");i=l(r.map(u=>{if(u=Zr(u),u in rn)return;rn[u]=!0;const d=u.endsWith(".css"),m=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${m}`))return;const v=document.createElement("link");if(v.rel=d?"stylesheet":Xr,d||(v.as="script"),v.crossOrigin="",v.href=u,c&&v.setAttribute("nonce",c),document.head.appendChild(v),d)return new Promise((p,z)=>{v.addEventListener("load",p),v.addEventListener("error",()=>z(new Error(`Unable to preload CSS for ${u}`)))})}))}function n(o){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=o,window.dispatchEvent(c),!c.defaultPrevented)throw o}return i.then(o=>{for(const c of o||[])c.status==="rejected"&&n(c.reason);return s().catch(n)})},ea={apiKey:"AIzaSyC-4y146WLvcjfTg1IrnRgpLJGLir3Kv6E",authDomain:"sciencebowl.org",projectId:"scibowl-analytics",storageBucket:"scibowl-analytics.firebasestorage.app",messagingSenderId:"579454885012",appId:"1:579454885012:web:2015104d8f5e3a6a302881"};let ws;function lt(){return en().length?ws=en()[0]:ws=Nr(ea),ws}function Y(){return dt(),zs(lt())}function je(){return dt(),dr(lt())}function Co(){return dt(),kr(lt())}let vs=null;function dt(){try{window.FIREBASE_APPCHECK_DEBUG_TOKEN==="true"&&(self.FIREBASE_APPCHECK_DEBUG_TOKEN=!0);const t=lt();if(!vs){const r="6LdP4s8rAAAAAH5skwAWa08TPDuqwlRul6Ild4xl";r&&(vs=br(t,{provider:new yr(r),isTokenAutoRefreshEnabled:!0}))}return vs}catch{return null}}async function ta(t=!1){try{const s=dt();return s&&(await wr(s,t))?.token||null}catch{return null}}function Qt(t={}){const s=t.roundSubcollection||"rounds",[r,a]=h.useState([]),[i,n]=h.useState(!0),[o,c]=h.useState(null),[l,u]=h.useState(!1),[d,m]=h.useState(null),v=h.useRef(new Map),p=7200*60*1e3,z=h.useRef(null);function x(){return new Promise((b,N)=>{if(z.current)return b(z.current);const k=indexedDB.open("scibowl-rounds-cache",1);k.onupgradeneeded=()=>{const M=k.result;M.objectStoreNames.contains("rounds")||M.createObjectStore("rounds")},k.onsuccess=()=>{z.current=k.result,b(k.result)},k.onerror=()=>N(k.error)})}async function C(b){try{const N=await x();return await new Promise((k,M)=>{const R=N.transaction("rounds","readonly").objectStore("rounds").get(b);R.onsuccess=()=>k(R.result||null),R.onerror=()=>M(R.error)})}catch{return null}}async function g(b,N){try{const k=await x();await new Promise((M,S)=>{const B=k.transaction("rounds","readwrite").objectStore("rounds").put(N,b);B.onsuccess=()=>M(),B.onerror=()=>S(B.error)})}catch{}}h.useEffect(()=>{let b=!1;return(async()=>{try{n(!0);const N=await C("meta:tournaments");N&&!b&&a(N.list||[]);const k=Y(),M=await xe(Z(k,"meta","tournaments"));if(!M.exists())throw new Error("meta/tournaments document not found");const S=M.data().list||[];b||a(S),g("meta:tournaments",{list:S,updatedAt:Date.now()})}catch(N){b||c(N)}finally{b||n(!1)}})(),()=>{b=!0}},[]);async function j(b,{force:N=!1}={}){const k=(b||[]).filter(Boolean);if(k.length===0)return;u(!0),m(null);const M=Y();try{for(const S of k){if(v.current.get(S)&&!N)continue;const R=await C(`t:${S}`),B=R&&typeof R.updatedAt=="number"&&Date.now()-R.updatedAt<=p;if(R&&B&&!N){v.current.set(S,R.payload);continue}const K=it(M,"tournaments",S,s),W=await gn(K),te={},L=[];W.forEach(V=>{const q=V.data(),J=V.id;te[J]={id:J,...q};const ae=Array.isArray(q.tossups)?q.tossups:[],ke=Array.isArray(q.bonuses)?q.bonuses:[];for(const $ of ae){const se=$._origId||$.origId||$.id;L.push({...$,id:se||`${S}__${J}__tu__${$.question_number}`,tournament:S,round:J})}for(const $ of ke){const se=$._origId||$.origId||$.id;L.push({...$,id:se||`${S}__${J}__bo__${$.question_number}`,tournament:S,round:J})}}),v.current.set(S,{rounds:te,flatQuestions:L}),g(`t:${S}`,{payload:{rounds:te,flatQuestions:L},updatedAt:Date.now()})}}catch(S){m(S)}finally{u(!1)}}function w(b){const N=[];for(const k of b||[]){const M=v.current.get(k);M?.flatQuestions&&N.push(...M.flatQuestions)}return N}function A(b){const N=v.current.get(b);return N?Object.values(N.rounds).sort((k,M)=>k.round?.localeCompare?.(M.round||"")||0):[]}return{tournaments:r,loadingTournaments:i,errorTournaments:o,loading:l,error:d,ensureLoaded:j,getLoadedQuestions:w,getRounds:A}}const sa="scibowl-user-cache",na=1;let Ft=null;const yn=7200*60*1e3;function ut(){return Ft||(Ft=new Promise((t,s)=>{const r=indexedDB.open(sa,na);r.onupgradeneeded=()=>{const a=r.result;a.objectStoreNames.contains("roundsIndex")||a.createObjectStore("roundsIndex"),a.objectStoreNames.contains("roundDetails")||a.createObjectStore("roundDetails")},r.onsuccess=()=>t(r.result),r.onerror=()=>s(r.error)}),Ft)}async function Ce(t){try{const s=await ut();return await new Promise((r,a)=>{const o=s.transaction("roundsIndex","readonly").objectStore("roundsIndex").get(t);o.onsuccess=()=>r(o.result||null),o.onerror=()=>a(o.error)})}catch{return null}}async function Ee(t,s){try{const r=await ut();await new Promise((a,i)=>{const c=r.transaction("roundsIndex","readwrite").objectStore("roundsIndex").put(s,t);c.onsuccess=()=>a(),c.onerror=()=>i(c.error)})}catch{}}async function Bs(t,s){try{const r=await ut();return await new Promise((a,i)=>{const c=r.transaction("roundDetails","readonly").objectStore("roundDetails").get(`${t}::${s}`);c.onsuccess=()=>a(c.result||null),c.onerror=()=>i(c.error)})}catch{return null}}async function Yt(t,s,r){try{const a=await ut();await new Promise((i,n)=>{const l=a.transaction("roundDetails","readwrite").objectStore("roundDetails").put(r,`${t}::${s}`);l.onsuccess=()=>i(),l.onerror=()=>n(l.error)})}catch{}}async function ra(t,s){try{const r=await ut();await new Promise(a=>{const o=r.transaction("roundDetails","readwrite").objectStore("roundDetails").delete(`${t}::${s}`);o.onsuccess=()=>a(),o.onerror=()=>a()})}catch{}}async function aa(t){try{const s=await ut();await new Promise((r,a)=>{const i=s.transaction(["roundsIndex","roundDetails"],"readwrite"),n=i.objectStore("roundsIndex"),o=i.objectStore("roundDetails"),c=n.delete(t);c.onerror=()=>a(c.error),c.onsuccess=()=>{const l=o.getAllKeys();l.onsuccess=()=>{const u=(l.result||[]).filter(m=>typeof m=="string"&&m.startsWith(`${t}::`));let d=u.length;if(d===0){r();return}u.forEach(m=>{const v=o.delete(m);v.onsuccess=()=>{--d===0&&r()},v.onerror=()=>{--d===0&&r()}})},l.onerror=()=>r()}})}catch{}}async function Eo(t,s){if(!t)throw new Error("Not authenticated");const r=Y(),a=it(r,"users",t,"rounds"),i=await jr(a,{...s,createdAt:vt()}),n=Z(r,"users",t,"meta","roundsIndex"),o={title:s.title,count:s.count,createdAt:vt()};await ze(n,{entries:{[i.id]:o}},{merge:!0});try{const c=Math.floor(Date.now()/1e3),l=await Ce(t),u=l?.entries?{...l.entries}:{};u[i.id]={title:s.title,count:s.count,createdAt:{seconds:c}},await Ee(t,{entries:u,updatedAt:Date.now()}),await Yt(t,i.id,{data:{id:i.id,...s,createdAt:{seconds:c}},updatedAt:Date.now()})}catch{}return i.id}async function Mo(t,{force:s=!1}={}){if(!t)return[];if(!s){const u=await Ce(t);if(u&&u.entries&&!(typeof u.updatedAt=="number"?Date.now()-u.updatedAt>yn:!0)){const m=Object.entries(u.entries).map(([v,p])=>({id:v,...p}));return m.sort((v,p)=>(p.createdAt?.seconds||0)-(v.createdAt?.seconds||0)),m}}const r=Y(),a=Z(r,"users",t,"meta","roundsIndex"),i=await xe(a);if(!i.exists())return await Ee(t,{entries:{},updatedAt:Date.now()}),[];const n=i.data()||{};let o=n.entries||{};const c=n.folders||{};if(!o||Object.keys(o).length===0){const u={};for(const[d,m]of Object.entries(n))if(d.startsWith("entries.")){const v=d.slice(8);v&&(u[v]=m)}Object.keys(u).length>0&&(o=u)}await Ee(t,{entries:o,folders:c,updatedAt:Date.now()});const l=Object.entries(o).map(([u,d])=>({id:u,...d}));return l.sort((u,d)=>{const m=u.createdAt?.seconds||0;return(d.createdAt?.seconds||0)-m}),l}async function _o(t,s,{force:r=!1}={}){if(!t||!s)return null;const a=await Bs(t,s);if(a&&!r&&a&&typeof a=="object"&&"data"in a&&"updatedAt"in a&&!(typeof a.updatedAt=="number"?Date.now()-a.updatedAt>yn:!0))return a.data;const i=Y(),n=Z(i,"users",t,"rounds",s),o=await xe(n);if(!o.exists())return null;const c={id:o.id,...o.data()};return await Yt(t,s,{data:c,updatedAt:Date.now()}),c}async function Ro(t,{force:s=!1}={}){if(!t)return[];if(!s){const l=await Ce(t),u=l?.folders?Object.keys(l.folders):null;if(u)return u}const r=Y(),a=Z(r,"users",t,"meta","roundsIndex"),i=await xe(a),o=(i.exists()?i.data()||{}:{}).folders||{},c=await Ce(t);return await Ee(t,{entries:c?.entries||{},folders:o,updatedAt:Date.now()}),Object.keys(o)}async function To(t,s){if(!t)throw new Error("Not authenticated");const r=(s??"").toString().trim();if(!r)throw new Error("Folder name required");const a=Y(),i=Z(a,"users",t,"meta","roundsIndex");await ze(i,{folders:{[r]:!0}},{merge:!0});const n=await Ce(t),o={...n?.folders||{},[r]:!0};return await Ee(t,{entries:n?.entries||{},folders:o,updatedAt:Date.now()}),!0}async function Do(t,s,r){if(!t)throw new Error("Not authenticated");const a=(s??"").toString().trim(),i=(r??"").toString().trim();if(!a)throw new Error("Source folder name required");if(!i)throw new Error("Destination folder name required");if(a===i)return!0;const n=Y(),o=Z(n,"users",t,"meta","roundsIndex"),c=await xe(o);if(!c.exists())throw new Error("No folders meta found");const l=c.data()||{},u={...l.entries||{}},d={...l.folders||{}};if(!d[a])throw new Error("Folder does not exist");if(d[i])throw new Error("A folder with that name already exists");const m={};for(const[p,z]of Object.entries(u))z&&z.folder===a&&(m[`entries.${p}.folder`]=i,u[p]={...z,folder:i});await ee(o,{[`folders.${a}`]:Ke(),[`folders.${i}`]:!0}).catch(async()=>{const p={folders:{[i]:!0}};await ze(o,p,{merge:!0})}),Object.keys(m).length>0&&await ee(o,m).catch(async()=>{await ze(o,{entries:u},{merge:!0})});const v=Object.entries(u).filter(([,p])=>p.folder===i).map(([p])=>p);for(const p of v)try{const z=Z(n,"users",t,"rounds",p);await ee(z,{folder:i})}catch{}try{const p=await Ce(t);if(p){const z={...p.folders||{}};delete z[a],z[i]=!0;const x={...p.entries||{}};for(const[C,g]of Object.entries(x))g&&g.folder===a&&(x[C]={...g,folder:i});await Ee(t,{entries:x,folders:z,updatedAt:Date.now()})}}catch{}return!0}async function Oo(t,s){if(!t)throw new Error("Not authenticated");const r=(s??"").toString().trim();if(!r)throw new Error("Folder name required");const a=Y(),i=Z(a,"users",t,"meta","roundsIndex"),n=await xe(i);if(!n.exists())return!0;const o=n.data()||{};if(!{...o.folders||{}}[r])return!0;const l={...o.entries||{}},u={};for(const[d,m]of Object.entries(l))m&&m.folder===r&&(u[`entries.${d}.folder`]=Ke(),delete l[d].folder);try{await ee(i,{[`folders.${r}`]:Ke()})}catch{}if(Object.keys(u).length>0)try{await ee(i,u)}catch{await ze(i,{entries:l},{merge:!0})}for(const[d,m]of Object.entries(l))if(!m.folder)try{const v=Z(a,"users",t,"rounds",d);await ee(v,{folder:Ke()})}catch{}try{const d=await Ce(t);if(d){const m={...d.folders||{}};delete m[r];const v={...d.entries||{}};for(const[p,z]of Object.entries(v))if(z&&z.folder===r){const{folder:x,...C}=z;v[p]=C}await Ee(t,{entries:v,folders:m,updatedAt:Date.now()})}}catch{}return!0}async function Lo(t,s){if(!t||!s)throw new Error("Missing uid/roundId");const r=Y(),a=Z(r,"users",t,"rounds",s);try{await _s(a)}catch{}const i=Z(r,"users",t,"meta","roundsIndex");try{await ee(i,{[`entries.${s}`]:Ke()})}catch{try{const o=await xe(i),l={...(o.exists()?o.data()||{}:{}).entries||{}};s in l&&delete l[s],await ze(i,{entries:l},{merge:!0})}catch{}}try{const n=await Ce(t);if(n?.entries&&s in n.entries){const{[s]:o,...c}=n.entries;await Ee(t,{entries:c,updatedAt:Date.now()})}await ra(t,s)}catch{}return!0}async function Bo(t,s,r){if(!t||!s)throw new Error("Missing uid/roundId");const a=Y(),i=Z(a,"users",t,"rounds",s),n=Z(a,"users",t,"meta","roundsIndex");try{r&&r.trim().length>0?await ee(i,{folder:r.trim()}):await ee(i,{folder:Ke()})}catch{}try{r&&r.trim().length>0?await ee(n,{[`entries.${s}.folder`]:r.trim()}):await ee(n,{[`entries.${s}.folder`]:Ke()})}catch{r&&r.trim().length>0&&await ze(n,{entries:{[s]:{folder:r.trim()}}},{merge:!0})}try{const o=await Ce(t);if(o?.entries){const l={...o.entries};if(l[s]||(l[s]={}),r&&r.trim().length>0)l[s]={...l[s],folder:r.trim()};else{const{folder:u,...d}=l[s];l[s]=d}await Ee(t,{entries:l,updatedAt:Date.now()})}const c=await Bs(t,s);if(c&&c.data){const l={...c.data};r&&r.trim().length>0?l.folder=r.trim():delete l.folder,await Yt(t,s,{data:l,updatedAt:Date.now()})}}catch{}return!0}function Po(t){const s=new Set,r=t?.pairs||[];for(const a of r)a.tossupId&&s.add(a.tossupId),a.bonusId&&s.add(a.bonusId);return s}async function Fo(t,s,r){if(!t)throw new Error("Not authenticated");if(!s)throw new Error("Missing roundId");const a=(r??"").toString().trim();if(a.length===0)throw new Error("Title cannot be empty");const i=Y(),n=Z(i,"users",t,"rounds",s);await ee(n,{title:a});const o=Z(i,"users",t,"meta","roundsIndex");try{await ee(o,{[`entries.${s}.title`]:a})}catch{await ze(o,{entries:{[s]:{title:a}}},{merge:!0})}try{const c=await Ce(t);c&&c.entries&&c.entries[s]&&(c.entries[s]={...c.entries[s],title:a},await Ee(t,{...c,updatedAt:Date.now()}));const l=await Bs(t,s);if(l&&l.data){const u={...l,data:{...l.data,title:a},updatedAt:Date.now()};await Yt(t,s,u)}}catch{}return!0}async function Io({questionType:t="both",categories:s=[],count:r=1,adminUid:a="fkLJJ2R6HbdwqoXSxrLUybZ0IdH2"}={}){const i=Y(),n=Z(i,"users",a,"meta","presets");let o=[];try{const x=await xe(n),C=x.exists()?x.data()||{}:{};o=Array.isArray(C?.set)?[...C.set]:[]}catch{return{roundId:null}}if(!o||o.length===0)return{roundId:null};const c=Math.max(1,Number(r)||1),l=Array.isArray(s)&&s.length?new Set(s.map(x=>String(x).toUpperCase())):null,u=(t||"both").toLowerCase();function d(x){if(!Array.isArray(x))return 0;let C=[];return u==="tossup"?C=x.filter(g=>!!g?.tossupMeta&&(!l||l.has(String(g.tossupMeta.category||"").toUpperCase()))):u==="bonus"?C=x.filter(g=>!!g?.bonusMeta&&(!l||l.has(String(g.bonusMeta.category||"").toUpperCase()))):C=x.filter(g=>!!g?.tossupMeta&&(!l||l.has(String(g.tossupMeta.category||"").toUpperCase()))),C.length}const m=[];let v=null;for(let x=0;x<o.length;x++){const C=o[x];try{const g=await xe(Z(i,"users",a,"rounds",C));if(!g.exists())continue;const j=g.data()?.pairs||[];d(j)>=c&&m.push({index:x,rid:C,pairs:j})}catch{}}if(m.length===0)return{roundId:null};const p=m[Math.floor(Math.random()*m.length)],z=p.rid;v=p.pairs;try{await Rs(i,async x=>{const C=await x.get(n),g=C.exists()?C.data()||{}:{},j=Array.isArray(g.set)?[...g.set]:[],w=j.indexOf(z);w!==-1&&(j.splice(w,1),x.set(n,{set:j},{merge:!0}))})}catch{try{await ee(n,{set:vr(z)})}catch{}}return{roundId:z,pairs:v}}function Ne(){const[t,s]=h.useState(null),[r,a]=h.useState(!0),[i,n]=h.useState(null);h.useEffect(()=>{const d=je(),m=ur(d,v=>{s(v),a(!1)},v=>{n(v),a(!1)});return()=>m()},[]);const o=h.useCallback(async()=>{const d=je(),m=new mr;await hr(d,m)},[]),c=h.useCallback(async(d,m)=>{const v=je();await fr(v,d,m)},[]),l=h.useCallback(async(d,m)=>{const v=je();await pr(v,d,m)},[]),u=h.useCallback(async()=>{const d=je(),m=d.currentUser?.uid;await xr(d),m&&await aa(m)},[]);return{user:t,loading:r,error:i,loginWithGoogle:o,loginWithEmail:c,signupWithEmail:l,logout:u}}const ia={};function H(t=""){const s=ia?.VITE_SITE_URL,r=s&&typeof s=="string"&&s.trim()||(typeof window<"u"?window.location.origin:"");if(!r)return t||"/";try{return new URL(t||"/",r).toString()}catch{return r+(t||"/")}}function oa(){return e.jsxs(Qe,{children:[e.jsx("title",{children:"atombowl — Science Bowl practice, multiplayer buzzer, and round generator"}),e.jsx("meta",{name:"description",content:"atombowl brings Science Bowl prep together: practice mode, multiplayer rooms, real-time buzzer system, and a fast round generator with visual bonuses."}),e.jsx("link",{rel:"canonical",href:H("/")}),e.jsx("meta",{name:"robots",content:"index,follow"}),e.jsx("meta",{property:"og:type",content:"website"}),e.jsx("meta",{property:"og:site_name",content:"atombowl"}),e.jsx("meta",{property:"og:title",content:"atombowl — Science Bowl practice, multiplayer, buzzer"}),e.jsx("meta",{property:"og:description",content:"Practice questions, generate rounds, and buzz together online — all in one place."}),e.jsx("meta",{property:"og:url",content:H("/")}),e.jsx("meta",{property:"og:image",content:H("/logo.png")}),e.jsx("meta",{property:"og:image:alt",content:"atombowl Logo"}),e.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),e.jsx("meta",{name:"twitter:title",content:"atombowl — Science Bowl practice, multiplayer, buzzer"}),e.jsx("meta",{name:"twitter:description",content:"Practice mode, multiplayer rooms, and a fast round generator."}),e.jsx("meta",{name:"twitter:image",content:H("/logo.png")})]})}function ca(){const t={"@context":"https://schema.org","@type":"BreadcrumbList",itemListElement:[{"@type":"ListItem",position:1,name:"Home",item:H("/")},{"@type":"ListItem",position:2,name:"Round Generator",item:H("/round-generator")}]};return e.jsxs(Qe,{children:[e.jsx("title",{children:"Round Generator & Practice | atombowl"}),e.jsx("meta",{name:"description",content:"Generate custom Science Bowl practice rounds instantly. Filter by tournament and category, include toss-ups and bonuses, and export to PDF."}),e.jsx("link",{rel:"canonical",href:H("/round-generator")}),e.jsx("meta",{property:"og:title",content:"Round Generator & Practice | atombowl"}),e.jsx("meta",{property:"og:description",content:"Build practice rounds from curated tournaments in seconds."}),e.jsx("meta",{property:"og:url",content:H("/round-generator")}),e.jsx("meta",{property:"og:image",content:H("/logo.png")}),e.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),e.jsx("meta",{name:"twitter:title",content:"Round Generator & Practice | atombowl"}),e.jsx("meta",{name:"twitter:description",content:"Generate custom Science Bowl rounds instantly."}),e.jsx("meta",{name:"twitter:image",content:H("/logo.png")}),e.jsx("script",{type:"application/ld+json",children:JSON.stringify(t)})]})}function la(){const t={"@context":"https://schema.org","@type":"BreadcrumbList",itemListElement:[{"@type":"ListItem",position:1,name:"Home",item:H("/")},{"@type":"ListItem",position:2,name:"Practice",item:H("/practice")}]};return e.jsxs(Qe,{children:[e.jsx("title",{children:"Practice Mode | atombowl"}),e.jsx("meta",{name:"description",content:"Drill Science Bowl toss-ups and bonuses with keyboard shortcuts, instant feedback, and adjustable reading speed."}),e.jsx("link",{rel:"canonical",href:H("/practice")}),e.jsx("meta",{property:"og:title",content:"Practice Mode | atombowl"}),e.jsx("meta",{property:"og:description",content:"Practice Science Bowl questions with instant feedback."}),e.jsx("meta",{property:"og:url",content:H("/practice")}),e.jsx("meta",{property:"og:image",content:H("/logo.png")}),e.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),e.jsx("meta",{name:"twitter:title",content:"Practice Mode | atombowl"}),e.jsx("meta",{name:"twitter:description",content:"Drill toss-ups and bonuses with smart helpers."}),e.jsx("meta",{name:"twitter:image",content:H("/logo.png")}),e.jsx("script",{type:"application/ld+json",children:JSON.stringify(t)}),e.jsx("meta",{name:"robots",content:"follow"})]})}function da(){return e.jsxs(Qe,{children:[e.jsx("title",{children:"Sign In | atombowl"}),e.jsx("meta",{name:"robots",content:"noindex,nofollow"}),e.jsx("meta",{name:"description",content:"Sign in to access atombowl features including practice mode, round generator, multiplayer rooms, and buzzer."}),e.jsx("link",{rel:"canonical",href:H("/signin")})]})}function ua(){const t={"@context":"https://schema.org","@type":"BreadcrumbList",itemListElement:[{"@type":"ListItem",position:1,name:"Home",item:H("/")},{"@type":"ListItem",position:2,name:"Multiplayer",item:H("/multiplayer")}]};return e.jsxs(Qe,{children:[e.jsx("title",{children:"Multiplayer Rooms | atombowl"}),e.jsx("meta",{name:"description",content:"Create or join public and private rooms to practice Science Bowl live with a real-time buzzer and chat."}),e.jsx("link",{rel:"canonical",href:H("/multiplayer")}),e.jsx("meta",{property:"og:title",content:"Multiplayer Rooms | atombowl"}),e.jsx("meta",{property:"og:description",content:"Practice together online with live buzzing and chat."}),e.jsx("meta",{property:"og:url",content:H("/multiplayer")}),e.jsx("meta",{property:"og:image",content:H("/logo.png")}),e.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),e.jsx("meta",{name:"twitter:title",content:"Multiplayer Rooms | atombowl"}),e.jsx("meta",{name:"twitter:description",content:"Host or join rooms for live buzzing practice."}),e.jsx("meta",{name:"twitter:image",content:H("/logo.png")}),e.jsx("script",{type:"application/ld+json",children:JSON.stringify(t)})]})}function ma(){return e.jsxs(Qe,{children:[e.jsx("title",{children:"Multiplayer Room | atombowl"}),e.jsx("meta",{name:"robots",content:"noindex,follow"}),e.jsx("link",{rel:"canonical",href:H("/multiplayer")}),e.jsx("meta",{name:"description",content:"Join a Science Bowl multiplayer room to practice live buzzing with friends and teammates."}),e.jsx("meta",{property:"og:title",content:"Multiplayer Room | atombowl"}),e.jsx("meta",{property:"og:description",content:"Practice together online with live buzzing and chat."}),e.jsx("meta",{property:"og:url",content:H("/multiplayer")}),e.jsx("meta",{property:"og:image",content:H("/logo.png")}),e.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),e.jsx("meta",{name:"twitter:title",content:"Multiplayer Room | atombowl"}),e.jsx("meta",{name:"twitter:description",content:"Host or join rooms for live buzzing practice."}),e.jsx("meta",{name:"twitter:image",content:H("/logo.png")})]})}function ha(){const t={"@context":"https://schema.org","@type":"BreadcrumbList",itemListElement:[{"@type":"ListItem",position:1,name:"Home",item:H("/")},{"@type":"ListItem",position:2,name:"Buzzer",item:H("/buzzer")}]};return e.jsxs(Qe,{children:[e.jsx("title",{children:"Buzzer | atombowl"}),e.jsx("meta",{name:"description",content:"Simple, real-time Science Bowl buzzer. Host a room, share the code, and start buzzing instantly."}),e.jsx("link",{rel:"canonical",href:H("/buzzer")}),e.jsx("meta",{property:"og:title",content:"Buzzer | atombowl"}),e.jsx("meta",{property:"og:description",content:"Real-time online buzzer for scrims and practices."}),e.jsx("meta",{property:"og:url",content:H("/buzzer")}),e.jsx("meta",{property:"og:image",content:H("/logo.png")}),e.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),e.jsx("meta",{name:"twitter:title",content:"Buzzer | atombowl"}),e.jsx("meta",{name:"twitter:description",content:"Share a code and buzz from any device."}),e.jsx("meta",{name:"twitter:image",content:H("/logo.png")}),e.jsx("script",{type:"application/ld+json",children:JSON.stringify(t)})]})}const fa="scibowl_current_cache",pa=1,Gt="kv";function xa(){return new Promise((t,s)=>{const r=indexedDB.open(fa,pa);r.onerror=()=>s(r.error),r.onupgradeneeded=()=>{const a=r.result;a.objectStoreNames.contains(Gt)||a.createObjectStore(Gt)},r.onsuccess=()=>t(r.result)})}async function wn(t,s){const r=await xa();return new Promise((a,i)=>{const n=r.transaction(Gt,t),o=n.objectStore(Gt);let c=!1;n.oncomplete=()=>{c||a()},n.onerror=()=>{c||i(n.error)};const l=s(o);Promise.resolve(l).then(u=>{c=!0,a(u)},u=>{c=!0,i(u)})})}async function vn(t){return wn("readonly",s=>new Promise((r,a)=>{const i=s.get(t);i.onsuccess=()=>r(i.result??null),i.onerror=()=>a(i.error)}))}async function Ht(t,s){return wn("readwrite",r=>new Promise((a,i)=>{const n=r.put(s,t);n.onsuccess=()=>a(!0),n.onerror=()=>i(n.error)}))}const an="sb_session_id";function ga(){try{let t=sessionStorage.getItem(an);return t||(t=Math.random().toString(36).slice(2)+Date.now().toString(36),sessionStorage.setItem(an,t)),t}catch{return"fallback"}}function jn(){return`s:${ga()}:rounds`}async function Xt(){const t=jn(),s=await vn(t);if(!s||typeof s!="object")return{current:null,old:[]};const r=Array.isArray(s.current)?s.current:null,a=Array.isArray(s.old)?s.old.filter(Array.isArray):[];return{current:r,old:a}}async function Nn(t){const s=jn(),r={current:Array.isArray(t?.current)?t.current:null,old:Array.isArray(t?.old)?t.old.filter(Array.isArray):[],updatedAt:Date.now()};return await Ht(s,r),r}async function ba(t){const s=await Xt(),r={current:Array.isArray(t)?t:null,old:s.current?[s.current,...s.old||[]]:s.old||[]};return await Nn(r),r}async function Uo(t){const s=await Xt(),r=s.current,a=Array.isArray(s.old)?[...s.old]:[];if(!Number.isFinite(t)||t<=0||t>=1+a.length)return s;const i=a[t-1],n=a.filter((c,l)=>l!==t-1),o={current:i||null,old:r?[r,...n]:n};return await Nn(o),o}async function $o(){const{current:t,old:s}=await Xt(),r=[];Array.isArray(t)&&r.push(t);for(const a of s||[])Array.isArray(a)&&r.push(a);return r}const kn=h.createContext(null);function ya({children:t}){const[s,r]=h.useState([]),[a,i]=h.useState([]),n=u=>{try{return Array.isArray(u)?u.map(d=>({t:d?.tossup?.id||null,b:d?.bonus?.id||null})):[]}catch{return[]}},o=u=>{try{return Array.isArray(u)?u.map(d=>({tu:d?.tossup?{id:d.tossup.id,tournament:d.tossup.tournament}:null,bo:d?.bonus?{id:d.bonus.id,tournament:d.bonus.tournament}:null})):[]}catch{return[]}},c=u=>{r(d=>{const m=typeof u=="function"?u(d):u;try{window.__sbGeneratedPairs=m,Ht("sb_current_round",n(m)),Ht("sb_current_round_meta",o(m))}catch{}return m})},l=u=>{i(d=>[...d,u]),c(u);try{ba(o(u))}catch{}};return h.useEffect(()=>{let u=!0;return(async()=>{if(u)try{await Xt()}catch{}})(),()=>{u=!1}},[]),e.jsx(kn.Provider,{value:{generatedPairs:s,setGeneratedPairs:c,history:a,setHistory:i,pushGeneratedRound:l},children:t})}function Sn(){const t=h.useContext(kn);if(!t)throw new Error("useRoundSession must be used within a RoundSessionProvider");return t}const wa=Cr(Er)(({theme:t})=>({width:62,height:34,padding:7,"& .MuiSwitch-switchBase":{margin:1,padding:0,transform:"translateX(6px)","&.Mui-checked":{color:"#fff",transform:"translateX(22px)","& .MuiSwitch-thumb:before":{backgroundImage:`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 20 20"><path fill="%23fff" d="M4.2 2.5l-.7 1.8-1.8.7 1.8.7.7 1.8.6-1.8L6.7 5l-1.9-.7-.6-1.8zm15 8.3a6.7 6.7 0 11-6.6-6.6 5.8 5.8 0 006.6 6.6z"/></svg>')`},"& + .MuiSwitch-track":{opacity:1,backgroundColor:t.palette.mode==="dark"?"#8796A5":"#aab4be"}}},"& .MuiSwitch-thumb":{backgroundColor:t.palette.mode==="dark"?"#003892":"#001e3c",width:32,height:32,"&::before":{content:"''",position:"absolute",width:"100%",height:"100%",left:0,top:0,backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundImage:`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 20 20"><path fill="%23fff" d="M9.305 1.667V3.75h1.389V1.667h-1.39zm-4.707 1.95l-.982.982L5.09 6.072l.982-.982-1.473-1.473zm10.802 0L13.927 5.09l.982.982 1.473-1.473-.982-.982zM10 5.139a4.872 4.872 0 00-4.862 4.86A4.872 4.872 0 0010 14.862 4.872 4.872 0 0014.86 10 4.872 4.872 0 0010 5.139zm0 1.389A3.462 3.462 0 0113.471 10a3.462 3.462 0 01-3.473 3.472A3.462 3.462 0 016.527 10 3.462 3.462 0 0110 6.528zM1.665 9.305v1.39h2.083v-1.39H1.666zm14.583 0v1.39h2.084v-1.39h-2.084zM5.09 13.928L3.616 15.4l.982.982 1.473-1.473-.982-.982zm9.82 0l-.982.982 1.473 1.473.982-.982-1.473-1.473zM9.305 16.25v2.083h1.389V16.25h-1.39z"/></svg>')`}},"& .MuiSwitch-track":{opacity:1,backgroundColor:t.palette.mode==="dark"?"#8796A5":"#aab4be",borderRadius:20/2}}));function An({checked:t,onChange:s,label:r}){const a=h.useCallback(()=>{s(!t)},[t,s]);return e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:12},children:[e.jsx(wa,{checked:t,onChange:i=>s(i.target.checked),inputProps:{"aria-label":"Toggle dark mode"}}),r?e.jsx("button",{type:"button",onClick:a,style:{border:"none",background:"transparent",padding:0,margin:0,color:"inherit",font:"inherit",cursor:"pointer",display:"inline-flex",alignItems:"center"},children:r}):null]})}const qt="themePreference";function va(){try{return!!(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches)}catch{return!1}}function Ie(t){return t==="dark"?!0:t==="light"?!1:va()}async function zn(){try{const t=localStorage.getItem(qt);if(t==="light"||t==="dark"||t==="system")return t}catch{}try{const t=await vn(qt);if(t==="light"||t==="dark"||t==="system")return t}catch{}return"system"}async function Cn(t){try{await Ht(qt,t)}catch{}try{localStorage.setItem(qt,t)}catch{}}function En(t){let s;try{s=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)")}catch{}if(!s)return()=>{};const r=a=>{t(!!a.matches)};return s.addEventListener?s.addEventListener("change",r):s.addListener&&s.addListener(r),()=>{s.removeEventListener?s.removeEventListener("change",r):s.removeListener&&s.removeListener(r)}}function Mn(){const[t,s]=I.useState("system"),[r,a]=I.useState(()=>{try{return document.documentElement.classList.contains("dark")}catch{return Ie("system")}});I.useEffect(()=>{const n=o=>{const c=o&&o.detail||{};(c.pref==="light"||c.pref==="dark"||c.pref==="system")&&c.pref!==t&&s(c.pref),typeof c.dark=="boolean"&&c.dark!==r&&a(c.dark)};return window.addEventListener("theme:change",n),()=>window.removeEventListener("theme:change",n)},[t,r]),I.useEffect(()=>{let n=!0;return zn().then(o=>{n&&(s(o),a(Ie(o)))}),()=>{n=!1}},[]),I.useEffect(()=>{document.documentElement.classList.toggle("dark",r),r?document.body.classList.add("dark-bg"):document.body.classList.remove("dark-bg");let n=document.querySelector('meta[name="theme-color"]');n||(n=document.createElement("meta"),n.setAttribute("name","theme-color"),document.head.appendChild(n)),n.setAttribute("content",r?"#000000":"#ffffff")},[r]),I.useEffect(()=>{try{Cn(t)}catch{}try{window.dispatchEvent(new CustomEvent("theme:change",{detail:{pref:t,dark:Ie(t)}}))}catch{}},[t]),I.useEffect(()=>{if(t!=="system")return;a(Ie("system"));const n=En(o=>a(!!o));return()=>n&&n()},[t]);const i=I.useCallback(n=>{s(n?"dark":"light"),a(!!n);try{window.dispatchEvent(new CustomEvent("theme:change",{detail:{pref:n?"dark":"light",dark:!!n}}))}catch{}},[]);return{themePref:t,setThemePref:s,dark:r,setDark:i}}function mt({className:t="glass p-6",text:s="Loading…"}){return e.jsx("div",{className:t,children:s})}function Ps({auth:t}){const{themePref:s,setThemePref:r,dark:a,setDark:i}=Mn(),n=$e(),o=Ts(),c=o.pathname==="/",[l,u]=I.useState(!1);I.useEffect(()=>{if(!c){u(!0);return}const g=()=>{try{const j=document.getElementById("home-logo");let w=0;if(C.current&&(w=Math.ceil(C.current.getBoundingClientRect().height||0)),!w){const b=getComputedStyle(document.documentElement).getPropertyValue("--header-h");w=parseInt(b||"72",10)||72}if(!j){u(window.scrollY>w);return}const A=j.getBoundingClientRect();u(A.bottom<=w)}catch{}};return g(),window.addEventListener("scroll",g,{passive:!0}),window.addEventListener("resize",g),()=>{window.removeEventListener("scroll",g),window.removeEventListener("resize",g)}},[c]);const d=o.pathname==="/"?"home":o.pathname.startsWith("/practice")?"practice":o.pathname.startsWith("/admin")?"admin":o.pathname.startsWith("/multiplayer")?"multiplayer":o.pathname.startsWith("/buzzer")?"buzzer":"generate",m=t?.user?.uid==="fkLJJ2R6HbdwqoXSxrLUybZ0IdH2",v=I.useMemo(()=>{const g=[{key:"home",label:"Home",path:"/"},{key:"practice",label:"Practice",path:"/practice"},{key:"generate",label:"Round Generator",path:"/round-generator"},{key:"multiplayer",label:"Multiplayer",path:"/multiplayer"},{key:"buzzer",label:"Buzzer",path:"/buzzer"}];return m&&g.push({key:"admin",label:"Admin",path:"/admin"}),g},[m]),[p,z]=I.useState({width:"0px",transform:"translateX(0px)"}),x=I.useRef([]),C=I.useRef(null);return I.useEffect(()=>{const j=v.map(A=>A.key).indexOf(d),w=j!==-1?x.current[j]?.current:null;if(w&&w.parentElement){const A=w.getBoundingClientRect(),b=w.parentElement.getBoundingClientRect();z(N=>{const k={width:`${A.width}px`,transform:`translateX(${A.left-b.left}px)`};return N.width===k.width&&N.transform===k.transform?N:k})}},[d,o.pathname,v]),I.useEffect(()=>{const g=()=>{try{if(!C.current)return;const w=C.current.getBoundingClientRect();if(w&&w.height){const A=Math.ceil(w.height);document.documentElement.style.setProperty("--header-h",`${A}px`)}}catch{}};g();const j="ResizeObserver"in window?new ResizeObserver(g):null;return j&&C.current&&j.observe(C.current),window.addEventListener("resize",g),()=>{window.removeEventListener("resize",g),j&&j.disconnect()}},[d,a]),e.jsx("header",{ref:C,className:"header-bar",style:{overflow:"visible"},children:e.jsxs("div",{className:"w-full px-3 sm:px-4 py-2 sm:py-3 flex items-center justify-between",style:{position:"relative",zIndex:10},children:[e.jsxs("div",{className:"brand-cluster flex items-center gap-2",style:{transition:"opacity .35s ease, transform .35s ease",opacity:l?1:0,transform:l?"translateY(0) scale(1)":"translateY(8px) scale(0.98)",pointerEvents:l?"auto":"none"},"aria-hidden":c&&!l,children:[e.jsx("img",{src:"/logo.png",alt:"atombowl Logo",className:"w-8 h-8 sm:w-9 sm:h-9"}),e.jsx("div",{className:"font-semibold tracking-tight hidden lg:block text-[#121930] dark:text-white",children:"atombowl"}),e.jsx("div",{className:"font-semibold tracking-tight hidden sm:block lg:hidden text-[#121930] dark:text-white",children:"DSB"})]}),e.jsxs("nav",{className:"tabs flex items-center gap-2 relative overflow-x-auto whitespace-nowrap",style:{position:"relative"},children:[v.map((g,j)=>e.jsx("div",{ref:w=>{x.current[j]||(x.current[j]={current:null}),x.current[j].current=w},className:`tab ${d===g.key?"active":""}`,style:{padding:"16px 24px",cursor:"pointer",textAlign:"center",position:"relative",zIndex:11,textTransform:"lowercase",color:d===g.key?"#ffffff":a?"rgba(229, 231, 235, 0.9)":"#1f2a44",fontWeight:d===g.key?"600":"500",background:d===g.key?a?"rgba(60, 80, 255, 0.35)":"linear-gradient(135deg, rgba(59,130,246,0.92), rgba(99,102,241,0.9))":a?"rgba(255,255,255,0.08)":"rgba(17, 25, 40, 0.06)",borderRadius:"16px",transition:"background 0.3s, color 0.3s, box-shadow 0.3s",boxShadow:d===g.key?a?"0 2px 12px -2px rgba(60,80,255,0.18)":"0 6px 18px -6px rgba(37, 99, 235, 0.45)":a?"none":"inset 0 0 0 1px rgba(17, 25, 40, 0.08)"},onClick:()=>{try{g.key==="admin"?(document.body.classList.add("admin-border-on"),document.documentElement.classList.add("admin-border-on")):(document.body.classList.remove("admin-border-on"),document.documentElement.classList.remove("admin-border-on"))}catch{}n(g.path)},children:g.label},g.path)),e.jsx("div",{className:"slider",style:{position:"absolute",bottom:0,left:0,height:a?"4px":"6px",background:a?"linear-gradient(90deg,rgba(60,80,255,0.7),rgba(120,80,255,0.7))":"linear-gradient(90deg, #3b82f6, #a78bfa)",borderRadius:a?"2px":"3px",boxShadow:a?"0 2px 8px rgba(60,80,255,0.18)":"0 6px 18px -6px rgba(37, 99, 235, 0.5)",transition:"transform 0.3s cubic-bezier(.4,0,.2,1), width 0.3s cubic-bezier(.4,0,.2,1)",zIndex:10,...p}}),e.jsx("div",{className:"ml-2 sm:ml-4",children:e.jsxs("div",{className:"relative inline-flex items-center group",children:[s!=="system"&&e.jsx("button",{type:"button",onClick:()=>{r("system")},className:"mr-2 hidden group-hover:inline-flex items-center px-2 py-1 rounded text-xs border border-black/10 dark:border-white/20 bg-white/70 dark:bg-black/40 backdrop-blur-sm text-black dark:text-white hover:bg-white/90 dark:hover:bg-black/60 transition","aria-label":"Follow system theme",title:"Follow system",children:"Follow system"}),e.jsx(An,{checked:a,onChange:g=>i(g)})]})}),e.jsx("div",{className:"ml-2 sm:ml-3",children:t?.loading?e.jsx(mt,{className:"text-sm opacity-70"}):t?.user?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm opacity-80 max-w-[12rem] truncate hidden md:inline",children:t.user.email||t.user.displayName}),e.jsx("button",{className:"btn btn-top-maroon",onClick:t.logout,children:"Logout"})]}):e.jsx(Jt,{to:"/signin",className:"btn btn-primary hidden xs:inline-flex",children:"Sign in"})})]})]})})}function at({children:t,auth:s}){return e.jsxs(e.Fragment,{children:[e.jsx(Ps,{auth:s}),e.jsx("main",{className:"w-full px-4 pb-8 app-main text-black dark:text-white",children:t}),e.jsx("footer",{className:"w-full px-4 pb-8 text-center text-black/60 dark:text-white/60",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:"Built with Firebase • Vite • Tailwind"}),e.jsxs("div",{className:"text-xs flex flex-wrap gap-2 justify-center","aria-label":"Legal and policy links",children:[e.jsx("a",{href:"/terms-of-service",className:"hover:underline focus:outline-none focus:ring-1 focus:ring-current",rel:"nofollow",children:"Terms of Service"}),e.jsx("span",{"aria-hidden":"true",children:"•"}),e.jsx("a",{href:"/privacy-policy",className:"hover:underline focus:outline-none focus:ring-1 focus:ring-current",rel:"nofollow",children:"Privacy Policy"})]})]})})]})}const ja=h.lazy(()=>ct(()=>import("./PracticeMode-Bi4LErd5.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48]))),Na=h.lazy(()=>ct(()=>import("./Admin-BwueU6Tz.js"),__vite__mapDeps([49,1,2,15,5,6,7,8,9,16,3,4,10,11,12,13,14,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48]))),ka=h.lazy(()=>ct(()=>import("./RoundGenerator-B42ChL-b.js"),__vite__mapDeps([50,1,2,3,4,5,6,7,8,9,10,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,31,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48])));function js(){const t=Qt(),s=Ne(),r=Ts();$e();const{generatedPairs:a,setGeneratedPairs:i,pushGeneratedRound:n}=Sn(),o=r.pathname.startsWith("/practice")?"practice":r.pathname.startsWith("/admin")?"admin":r.pathname.startsWith("/buzzer")?"buzzer":"generate";return e.jsxs("div",{className:"min-h-screen app-radial-bg dark:app-radial-bg transition-colors glass-backdrop",children:[o==="practice"?e.jsx(la,{}):e.jsx(ca,{}),e.jsxs(at,{auth:s,children:[o!=="admin"&&e.jsxs("div",{className:"glass p-6 mb-4",children:[e.jsx("h1",{className:"text-xl font-semibold",children:o==="practice"?"Practice Mode":"Round Generator"}),e.jsx("p",{className:"text-sm opacity-80",children:o==="practice"?"Drill Science Bowl toss-ups and bonuses with keyboard shortcuts, adjustable readout, and instant feedback.":"Generate custom Science Bowl rounds from curated tournaments. Filter by category, pick rounds, include toss-ups and bonuses, and export to PDF."})]}),t.loadingTournaments&&e.jsx("div",{className:"glass p-6",children:"Loading tournaments…"}),t.errorTournaments&&e.jsxs("div",{className:"glass p-6 text-red-600",children:["Failed to load tournaments: ",String(t.errorTournaments)]}),!t.loadingTournaments&&!t.errorTournaments&&e.jsx("div",{className:"space-y-6",children:e.jsx(h.Suspense,{fallback:e.jsx("div",{className:"glass p-6",children:"Loading…"}),children:o==="practice"?e.jsx(ja,{lazy:t}):o==="admin"?e.jsx(Na,{auth:s}):e.jsx(ka,{lazy:t,auth:s,persistedGenerated:a,setPersistedGenerated:i,onNewRound:n})})})]})]})}function Sa(t){const s=Math.max(0,t),r=Math.floor(s/1e3),a=Math.floor(r/86400),i=Math.floor(r%86400/3600),n=Math.floor(r%3600/60),o=r%60;return{days:a,hours:i,minutes:n,seconds:o}}function Aa(t){return String(t).padStart(2,"0")}function It({value:t,label:s}){return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"rounded-2xl px-5 sm:px-6 py-4 sm:py-5 text-center bg-white/25 dark:bg-black/25 backdrop-blur-sm border border-white/30 dark:border-white/20 shadow-lg",children:[e.jsx("div",{className:"text-4xl sm:text-5xl md:text-6xl font-extrabold tracking-tight text-[#121930] dark:text-white tabular-nums",children:Aa(t)}),e.jsx("div",{className:"mt-1 text-xs sm:text-sm uppercase tracking-wider text-black/60 dark:text-white/60",children:s})]}),e.jsx("div",{className:"absolute -inset-0.5 -z-10 rounded-3xl bg-gradient-to-tr from-fuchsia-500/30 via-sky-500/30 to-emerald-500/30 blur-xl"})]})}function za(){const[t,s]=h.useState(null),[r,a]=h.useState(""),[i,n]=h.useState(()=>Date.now()),[o,c]=h.useState(!0);h.useEffect(()=>{let p=!1;async function z(){try{const x=Y(),C=await gn(it(x,"countdowns")),g=[];C.forEach(w=>{const A=w.data();let b=A?.time;if(b&&typeof b.toMillis=="function"&&(b=b.toMillis()),typeof b=="string"){const N=Date.parse(b);Number.isNaN(N)||(b=N)}typeof b=="number"&&(b<1e12&&(b=b*1e3),g.push({timeMs:b,name:typeof A?.name=="string"&&A.name.trim()?A.name.trim():w.id}))});const j=g.filter(w=>w.timeMs>Date.now()).sort((w,A)=>w.timeMs-A.timeMs)[0]||null;p||(s(j?new Date(j.timeMs):null),a(j?j.name:""))}catch(x){console.error("Failed to load countdowns:",x),p||(s(null),a(""))}finally{p||c(!1)}}return z(),()=>{p=!0}},[]),h.useEffect(()=>{const p=setInterval(()=>n(Date.now()),1e3);return()=>clearInterval(p)},[]);const l=h.useMemo(()=>t?Math.max(0,t.getTime()-i):0,[t,i]),{days:u,hours:d,minutes:m,seconds:v}=h.useMemo(()=>Sa(l),[l]);return o||!t?null:e.jsx("section",{id:"countdown",className:"relative mx-auto max-w-6xl px-3 sm:px-4 pt-4 sm:pt-6 md:pt-10 pb-8 sm:pb-10",children:e.jsxs("div",{className:"relative grid place-items-center text-center",children:[e.jsxs("div",{className:"mb-4 inline-flex items-center gap-2 rounded-full border border-black/10 dark:border-white/10 bg-white/70 dark:bg-black/30 px-3 py-1 backdrop-blur",children:[e.jsx("span",{className:"h-2 w-2 rounded-full bg-emerald-500 animate-pulse"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium text-[#121930] dark:text-white",children:"next tournament starts in"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5 sm:gap-6",children:[e.jsxs("div",{className:"flex flex-wrap items-stretch justify-center gap-3 sm:gap-4 md:gap-6",children:[e.jsx(It,{value:u,label:u===1?"day":"days"}),e.jsx(It,{value:d,label:d===1?"hour":"hours"}),e.jsx(It,{value:m,label:m===1?"minute":"minutes"}),e.jsx(It,{value:v,label:v===1?"second":"seconds"})]}),e.jsxs("div",{className:"text-xs sm:text-sm text-black/70 dark:text-white/70",children:["until ",e.jsx("span",{className:"font-semibold text-[#121930] dark:text-white",children:r})," — ",t.toLocaleString()]})]})]})})}function Ca({mouseForce:t=20,cursorSize:s=100,isViscous:r=!1,viscous:a=30,iterationsViscous:i=32,iterationsPoisson:n=32,dt:o=.014,BFECC:c=!0,resolution:l=.5,isBounce:u=!1,colors:d=["#5227FF","#FF9FFC","#B19EEF"],backgroundColor:m="transparent",style:v={},className:p="",autoDemo:z=!0,autoSpeed:x=.5,autoIntensity:C=2.2,takeoverDuration:g=.25,autoResumeDelay:j=1e3,autoRampDuration:w=.6}){const A=h.useRef(null),b=h.useRef(null),N=h.useRef(null),k=h.useRef(null),M=h.useRef(null),S=h.useRef(!0),T=h.useRef(null);return h.useEffect(()=>{if(!A.current)return;function R(U){let f;Array.isArray(U)&&U.length>0?U.length===1?f=[U[0],U[0]]:f=U:f=["#ffffff","#ffffff"];const D=f.length,F=new Uint8Array(D*4);for(let Q=0;Q<D;Q++){const ue=new ps(f[Q]);F[Q*4+0]=Math.round(ue.r*255),F[Q*4+1]=Math.round(ue.g*255),F[Q*4+2]=Math.round(ue.b*255),F[Q*4+3]=255}const G=new _r(F,D,1,Rr);return G.magFilter=Ot,G.minFilter=Ot,G.wrapS=Lt,G.wrapT=Lt,G.generateMipmaps=!1,G.needsUpdate=!0,G}const B=R(d);function K(U){if(U==="transparent"||U==null)return new Bt(0,0,0,0);if(Array.isArray(U)&&U.length===4){const[f,D,F,G]=U;return new Bt(f??0,D??0,F??0,G??1)}try{const f=new ps(U);return new Bt(f.r,f.g,f.b,1)}catch{return new Bt(0,0,0,0)}}const W=K(m);class te{constructor(){this.width=0,this.height=0,this.aspect=1,this.pixelRatio=1,this.isMobile=!1,this.breakpoint=768,this.fboWidth=null,this.fboHeight=null,this.time=0,this.delta=0,this.container=null,this.renderer=null,this.clock=null}init(f){this.container=f,this.pixelRatio=Math.min(window.devicePixelRatio||1,2),this.resize(),this.renderer=new Tr({antialias:!0,alpha:!0}),this.renderer.autoClear=!1,this.renderer.setClearColor(new ps(0),0),this.renderer.setPixelRatio(this.pixelRatio),this.renderer.setSize(this.width,this.height),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.renderer.domElement.style.display="block",this.clock=new Dr,this.clock.start()}resize(){if(!this.container)return;const f=this.container.getBoundingClientRect();this.width=Math.max(1,Math.floor(f.width)),this.height=Math.max(1,Math.floor(f.height)),this.aspect=this.width/this.height,this.renderer&&this.renderer.setSize(this.width,this.height,!1)}update(){this.delta=this.clock.getDelta(),this.time+=this.delta}}const L=new te;class V{constructor(){this.mouseMoved=!1,this.coords=new de,this.coords_old=new de,this.diff=new de,this.timer=null,this.container=null,this._onMouseMove=this.onDocumentMouseMove.bind(this),this._onTouchStart=this.onDocumentTouchStart.bind(this),this._onTouchMove=this.onDocumentTouchMove.bind(this),this._onTouchEnd=this.onTouchEnd.bind(this),this.isHoverInside=!1,this.hasUserControl=!1,this.isAutoActive=!1,this.autoIntensity=2,this.takeoverActive=!1,this.takeoverStartTime=0,this.takeoverDuration=.25,this.takeoverFrom=new de,this.takeoverTo=new de,this.onInteract=null}init(f){this.container=f,document.addEventListener("mousemove",this._onMouseMove,!1),document.addEventListener("touchstart",this._onTouchStart,!1),document.addEventListener("touchmove",this._onTouchMove,!1),document.addEventListener("touchend",this._onTouchEnd,!1)}dispose(){document.removeEventListener("mousemove",this._onMouseMove,!1),document.removeEventListener("touchstart",this._onTouchStart,!1),document.removeEventListener("touchmove",this._onTouchMove,!1),document.removeEventListener("touchend",this._onTouchEnd,!1)}setCoords(f,D){if(!this.container)return;this.timer&&clearTimeout(this.timer);const F=this.container.getBoundingClientRect(),G=(f-F.left)/F.width,Q=(D-F.top)/F.height;this.coords.set(G*2-1,-(Q*2-1)),this.mouseMoved=!0,this.timer=setTimeout(()=>{this.mouseMoved=!1},100)}setNormalized(f,D){this.coords.set(f,D),this.mouseMoved=!0}onDocumentMouseMove(f){this.onInteract&&this.onInteract();const D=this.container?.getBoundingClientRect(),F=!!D&&f.clientX>=D.left&&f.clientX<=D.right&&f.clientY>=D.top&&f.clientY<=D.bottom;if(this.isHoverInside=F,this.isAutoActive&&!this.hasUserControl&&!this.takeoverActive){const G=(f.clientX-D.left)/D.width,Q=(f.clientY-D.top)/D.height;this.takeoverFrom.copy(this.coords),this.takeoverTo.set(G*2-1,-(Q*2-1)),this.takeoverStartTime=performance.now(),this.takeoverActive=!0,this.hasUserControl=!0,this.isAutoActive=!1;return}this.setCoords(f.clientX,f.clientY),this.hasUserControl=!0}onDocumentTouchStart(f){if(f.touches.length===1){const D=f.touches[0];this.onInteract&&this.onInteract(),this.setCoords(D.pageX,D.pageY),this.hasUserControl=!0}}onDocumentTouchMove(f){if(f.touches.length===1){const D=f.touches[0];this.onInteract&&this.onInteract(),this.setCoords(D.pageX,D.pageY)}}onTouchEnd(){this.isHoverInside=!1}update(){if(this.takeoverActive){const f=(performance.now()-this.takeoverStartTime)/(this.takeoverDuration*1e3);if(f>=1)this.takeoverActive=!1,this.coords.copy(this.takeoverTo),this.coords_old.copy(this.coords),this.diff.set(0,0);else{const D=f*f*(3-2*f);this.coords.copy(this.takeoverFrom).lerp(this.takeoverTo,D)}}this.diff.subVectors(this.coords,this.coords_old),this.coords_old.copy(this.coords),this.coords_old.x===0&&this.coords_old.y===0&&this.diff.set(0,0),this.isAutoActive&&!this.takeoverActive&&this.diff.multiplyScalar(this.autoIntensity)}}const q=new V;class J{constructor(f,D,F){this.mouse=f,this.manager=D,this.enabled=F.enabled,this.speed=F.speed,this.resumeDelay=F.resumeDelay||3e3,this.rampDurationMs=(F.rampDuration||0)*1e3,this.active=!1,this.current=new de(0,0),this.target=new de,this.lastTime=performance.now(),this.activationTime=0,this.margin=.2,this._tmpDir=new de,this.pickNewTarget()}pickNewTarget(){const f=Math.random;this.target.set((f()*2-1)*(1-this.margin),(f()*2-1)*(1-this.margin))}forceStop(){this.active=!1,this.mouse.isAutoActive=!1}update(){if(!this.enabled)return;const f=performance.now();if(f-this.manager.lastUserInteraction<this.resumeDelay){this.active&&this.forceStop();return}if(this.mouse.isHoverInside){this.active&&this.forceStop();return}if(this.active||(this.active=!0,this.current.copy(this.mouse.coords),this.lastTime=f,this.activationTime=f),!this.active)return;this.mouse.isAutoActive=!0;let F=(f-this.lastTime)/1e3;this.lastTime=f,F>.2&&(F=.016);const G=this._tmpDir.subVectors(this.target,this.current),Q=G.length();if(Q<.01){this.pickNewTarget();return}G.normalize();let ue=1;if(this.rampDurationMs>0){const tt=Math.min(1,(f-this.activationTime)/this.rampDurationMs);ue=tt*tt*(3-2*tt)}const me=this.speed*F*ue,Le=Math.min(me,Q);this.current.addScaledVector(G,Le),this.mouse.setNormalized(this.current.x,this.current.y)}}const ae=`
  attribute vec3 position;
  uniform vec2 px;
  uniform vec2 boundarySpace;
  varying vec2 uv;
  precision highp float;
  void main(){
  vec3 pos = position;
  vec2 scale = 1.0 - boundarySpace * 2.0;
  pos.xy = pos.xy * scale;
  uv = vec2(0.5)+(pos.xy)*0.5;
  gl_Position = vec4(pos, 1.0);
}
`,ke=`
  attribute vec3 position;
  uniform vec2 px;
  precision highp float;
  varying vec2 uv;
  void main(){
  vec3 pos = position;
  uv = 0.5 + pos.xy * 0.5;
  vec2 n = sign(pos.xy);
  pos.xy = abs(pos.xy) - px * 1.0;
  pos.xy *= n;
  gl_Position = vec4(pos, 1.0);
}
`,$=`
    precision highp float;
    attribute vec3 position;
    attribute vec2 uv;
    uniform vec2 center;
    uniform vec2 scale;
    uniform vec2 px;
    varying vec2 vUv;
    void main(){
    vec2 pos = position.xy * scale * 2.0 * px + center;
    vUv = uv;
    gl_Position = vec4(pos, 0.0, 1.0);
}
`,se=`
    precision highp float;
    uniform sampler2D velocity;
    uniform float dt;
    uniform bool isBFECC;
    uniform vec2 fboSize;
    uniform vec2 px;
    varying vec2 uv;
    void main(){
    vec2 ratio = max(fboSize.x, fboSize.y) / fboSize;
    if(isBFECC == false){
        vec2 vel = texture2D(velocity, uv).xy;
        vec2 uv2 = uv - vel * dt * ratio;
        vec2 newVel = texture2D(velocity, uv2).xy;
        gl_FragColor = vec4(newVel, 0.0, 0.0);
    } else {
        vec2 spot_new = uv;
        vec2 vel_old = texture2D(velocity, uv).xy;
        vec2 spot_old = spot_new - vel_old * dt * ratio;
        vec2 vel_new1 = texture2D(velocity, spot_old).xy;
        vec2 spot_new2 = spot_old + vel_new1 * dt * ratio;
        vec2 error = spot_new2 - spot_new;
        vec2 spot_new3 = spot_new - error / 2.0;
        vec2 vel_2 = texture2D(velocity, spot_new3).xy;
        vec2 spot_old2 = spot_new3 - vel_2 * dt * ratio;
        vec2 newVel2 = texture2D(velocity, spot_old2).xy; 
        gl_FragColor = vec4(newVel2, 0.0, 0.0);
    }
}
`,be=`
    precision highp float;
    uniform sampler2D velocity;
    uniform sampler2D palette;
    uniform vec4 bgColor;
    varying vec2 uv;
    void main(){
    vec2 vel = texture2D(velocity, uv).xy;
    float lenv = clamp(length(vel), 0.0, 1.0);
    vec3 c = texture2D(palette, vec2(lenv, 0.5)).rgb;
    vec3 outRGB = mix(bgColor.rgb, c, lenv);
    float outA = mix(bgColor.a, 1.0, lenv);
    gl_FragColor = vec4(outRGB, outA);
}
`,Ye=`
    precision highp float;
    uniform sampler2D velocity;
    uniform float dt;
    uniform vec2 px;
    varying vec2 uv;
    void main(){
    float x0 = texture2D(velocity, uv-vec2(px.x, 0.0)).x;
    float x1 = texture2D(velocity, uv+vec2(px.x, 0.0)).x;
    float y0 = texture2D(velocity, uv-vec2(0.0, px.y)).y;
    float y1 = texture2D(velocity, uv+vec2(0.0, px.y)).y;
    float divergence = (x1 - x0 + y1 - y0) / 2.0;
    gl_FragColor = vec4(divergence / dt);
}
`,zt=`
    precision highp float;
    uniform vec2 force;
    uniform vec2 center;
    uniform vec2 scale;
    uniform vec2 px;
    varying vec2 vUv;
    void main(){
    vec2 circle = (vUv - 0.5) * 2.0;
    float d = 1.0 - min(length(circle), 1.0);
    d *= d;
    gl_FragColor = vec4(force * d, 0.0, 1.0);
}
`,es=`
    precision highp float;
    uniform sampler2D pressure;
    uniform sampler2D divergence;
    uniform vec2 px;
    varying vec2 uv;
    void main(){
    float p0 = texture2D(pressure, uv + vec2(px.x * 2.0, 0.0)).r;
    float p1 = texture2D(pressure, uv - vec2(px.x * 2.0, 0.0)).r;
    float p2 = texture2D(pressure, uv + vec2(0.0, px.y * 2.0)).r;
    float p3 = texture2D(pressure, uv - vec2(0.0, px.y * 2.0)).r;
    float div = texture2D(divergence, uv).r;
    float newP = (p0 + p1 + p2 + p3) / 4.0 - div;
    gl_FragColor = vec4(newP);
}
`,Ge=`
    precision highp float;
    uniform sampler2D pressure;
    uniform sampler2D velocity;
    uniform vec2 px;
    uniform float dt;
    varying vec2 uv;
    void main(){
    float step = 1.0;
    float p0 = texture2D(pressure, uv + vec2(px.x * step, 0.0)).r;
    float p1 = texture2D(pressure, uv - vec2(px.x * step, 0.0)).r;
    float p2 = texture2D(pressure, uv + vec2(0.0, px.y * step)).r;
    float p3 = texture2D(pressure, uv - vec2(0.0, px.y * step)).r;
    vec2 v = texture2D(velocity, uv).xy;
    vec2 gradP = vec2(p0 - p1, p2 - p3) * 0.5;
    v = v - gradP * dt;
    gl_FragColor = vec4(v, 0.0, 1.0);
}
`,Ct=`
    precision highp float;
    uniform sampler2D velocity;
    uniform sampler2D velocity_new;
    uniform float v;
    uniform vec2 px;
    uniform float dt;
    varying vec2 uv;
    void main(){
    vec2 old = texture2D(velocity, uv).xy;
    vec2 new0 = texture2D(velocity_new, uv + vec2(px.x * 2.0, 0.0)).xy;
    vec2 new1 = texture2D(velocity_new, uv - vec2(px.x * 2.0, 0.0)).xy;
    vec2 new2 = texture2D(velocity_new, uv + vec2(0.0, px.y * 2.0)).xy;
    vec2 new3 = texture2D(velocity_new, uv - vec2(0.0, px.y * 2.0)).xy;
    vec2 newv = 4.0 * old + v * dt * (new0 + new1 + new2 + new3);
    newv /= 4.0 * (1.0 + v * dt);
    gl_FragColor = vec4(newv, 0.0, 0.0);
}
`;class Oe{constructor(f){this.props=f||{},this.uniforms=this.props.material?.uniforms,this.scene=null,this.camera=null,this.material=null,this.geometry=null,this.plane=null}init(){this.scene=new tn,this.camera=new sn,this.uniforms&&(this.material=new Pt(this.props.material),this.geometry=new gs(2,2),this.plane=new xs(this.geometry,this.material),this.scene.add(this.plane))}update(){L.renderer.setRenderTarget(this.props.output||null),L.renderer.render(this.scene,this.camera),L.renderer.setRenderTarget(null)}}class ts extends Oe{constructor(f){super({material:{vertexShader:ae,fragmentShader:se,uniforms:{boundarySpace:{value:f.cellScale},px:{value:f.cellScale},fboSize:{value:f.fboSize},velocity:{value:f.src.texture},dt:{value:f.dt},isBFECC:{value:!0}}},output:f.dst}),this.uniforms=this.props.material.uniforms,this.init()}init(){super.init(),this.createBoundary()}createBoundary(){const f=new Pr,D=new Float32Array([-1,-1,0,-1,1,0,-1,1,0,1,1,0,1,1,0,1,-1,0,1,-1,0,-1,-1,0]);f.setAttribute("position",new Fr(D,3));const F=new Pt({vertexShader:ke,fragmentShader:se,uniforms:this.uniforms});this.line=new Ir(f,F),this.scene.add(this.line)}update({dt:f,isBounce:D,BFECC:F}){this.uniforms.dt.value=f,this.line.visible=D,this.uniforms.isBFECC.value=F,super.update()}}class ss extends Oe{constructor(f){super({output:f.dst}),this.init(f)}init(f){super.init();const D=new gs(1,1),F=new Pt({vertexShader:$,fragmentShader:zt,blending:Ur,depthWrite:!1,uniforms:{px:{value:f.cellScale},force:{value:new de(0,0)},center:{value:new de(0,0)},scale:{value:new de(f.cursor_size,f.cursor_size)}}});this.mouse=new xs(D,F),this.scene.add(this.mouse)}update(f){const D=q.diff.x/2*f.mouse_force,F=q.diff.y/2*f.mouse_force,G=f.cursor_size*f.cellScale.x,Q=f.cursor_size*f.cellScale.y,ue=Math.min(Math.max(q.coords.x,-1+G+f.cellScale.x*2),1-G-f.cellScale.x*2),me=Math.min(Math.max(q.coords.y,-1+Q+f.cellScale.y*2),1-Q-f.cellScale.y*2),Le=this.mouse.material.uniforms;Le.force.value.set(D,F),Le.center.value.set(ue,me),Le.scale.value.set(f.cursor_size,f.cursor_size),super.update()}}class Xe extends Oe{constructor(f){super({material:{vertexShader:ae,fragmentShader:Ct,uniforms:{boundarySpace:{value:f.boundarySpace},velocity:{value:f.src.texture},velocity_new:{value:f.dst_.texture},v:{value:f.viscous},px:{value:f.cellScale},dt:{value:f.dt}}},output:f.dst,output0:f.dst_,output1:f.dst}),this.init()}update({viscous:f,iterations:D,dt:F}){let G,Q;this.uniforms.v.value=f;for(let ue=0;ue<D;ue++)ue%2===0?(G=this.props.output0,Q=this.props.output1):(G=this.props.output1,Q=this.props.output0),this.uniforms.velocity_new.value=G.texture,this.props.output=Q,this.uniforms.dt.value=F,super.update();return Q}}class Ze extends Oe{constructor(f){super({material:{vertexShader:ae,fragmentShader:Ye,uniforms:{boundarySpace:{value:f.boundarySpace},velocity:{value:f.src.texture},px:{value:f.cellScale},dt:{value:f.dt}}},output:f.dst}),this.init()}update({vel:f}){this.uniforms.velocity.value=f.texture,super.update()}}class ns extends Oe{constructor(f){super({material:{vertexShader:ae,fragmentShader:es,uniforms:{boundarySpace:{value:f.boundarySpace},pressure:{value:f.dst_.texture},divergence:{value:f.src.texture},px:{value:f.cellScale}}},output:f.dst,output0:f.dst_,output1:f.dst}),this.init()}update({iterations:f}){let D,F;for(let G=0;G<f;G++)G%2===0?(D=this.props.output0,F=this.props.output1):(D=this.props.output1,F=this.props.output0),this.uniforms.pressure.value=D.texture,this.props.output=F,super.update();return F}}class Et extends Oe{constructor(f){super({material:{vertexShader:ae,fragmentShader:Ge,uniforms:{boundarySpace:{value:f.boundarySpace},pressure:{value:f.src_p.texture},velocity:{value:f.src_v.texture},px:{value:f.cellScale},dt:{value:f.dt}}},output:f.dst}),this.init()}update({vel:f,pressure:D}){this.uniforms.velocity.value=f.texture,this.uniforms.pressure.value=D.texture,super.update()}}class rs{constructor(f){this.options={iterations_poisson:32,iterations_viscous:32,mouse_force:20,resolution:.5,cursor_size:100,viscous:30,isBounce:!1,dt:.014,isViscous:!1,BFECC:!0,...f},this.fbos={vel_0:null,vel_1:null,vel_viscous0:null,vel_viscous1:null,div:null,pressure_0:null,pressure_1:null},this.fboSize=new de,this.cellScale=new de,this.boundarySpace=new de,this.init()}init(){this.calcSize(),this.createAllFBO(),this.createShaderPass()}getFloatType(){return/(iPad|iPhone|iPod)/i.test(navigator.userAgent)?Or:Lr}createAllFBO(){const D={type:this.getFloatType(),depthBuffer:!1,stencilBuffer:!1,minFilter:Ot,magFilter:Ot,wrapS:Lt,wrapT:Lt};for(let F in this.fbos)this.fbos[F]=new Br(this.fboSize.x,this.fboSize.y,D)}createShaderPass(){this.advection=new ts({cellScale:this.cellScale,fboSize:this.fboSize,dt:this.options.dt,src:this.fbos.vel_0,dst:this.fbos.vel_1}),this.externalForce=new ss({cellScale:this.cellScale,cursor_size:this.options.cursor_size,dst:this.fbos.vel_1}),this.viscous=new Xe({cellScale:this.cellScale,boundarySpace:this.boundarySpace,viscous:this.options.viscous,src:this.fbos.vel_1,dst:this.fbos.vel_viscous1,dst_:this.fbos.vel_viscous0,dt:this.options.dt}),this.divergence=new Ze({cellScale:this.cellScale,boundarySpace:this.boundarySpace,src:this.fbos.vel_viscous0,dst:this.fbos.div,dt:this.options.dt}),this.poisson=new ns({cellScale:this.cellScale,boundarySpace:this.boundarySpace,src:this.fbos.div,dst:this.fbos.pressure_1,dst_:this.fbos.pressure_0}),this.pressure=new Et({cellScale:this.cellScale,boundarySpace:this.boundarySpace,src_p:this.fbos.pressure_0,src_v:this.fbos.vel_viscous0,dst:this.fbos.vel_0,dt:this.options.dt})}calcSize(){const f=Math.max(1,Math.round(this.options.resolution*L.width)),D=Math.max(1,Math.round(this.options.resolution*L.height)),F=1/f,G=1/D;this.cellScale.set(F,G),this.fboSize.set(f,D)}resize(){this.calcSize();for(let f in this.fbos)this.fbos[f].setSize(this.fboSize.x,this.fboSize.y)}update(){this.options.isBounce?this.boundarySpace.set(0,0):this.boundarySpace.copy(this.cellScale),this.advection.update({dt:this.options.dt,isBounce:this.options.isBounce,BFECC:this.options.BFECC}),this.externalForce.update({cursor_size:this.options.cursor_size,mouse_force:this.options.mouse_force,cellScale:this.cellScale});let f=this.fbos.vel_1;this.options.isViscous&&(f=this.viscous.update({viscous:this.options.viscous,iterations:this.options.iterations_viscous,dt:this.options.dt})),this.divergence.update({vel:f});const D=this.poisson.update({iterations:this.options.iterations_poisson});this.pressure.update({vel:f,pressure:D})}}class Mt{constructor(){this.init()}init(){this.simulation=new rs,this.scene=new tn,this.camera=new sn,this.output=new xs(new gs(2,2),new Pt({vertexShader:ae,fragmentShader:be,transparent:!0,depthWrite:!1,uniforms:{velocity:{value:this.simulation.fbos.vel_0.texture},boundarySpace:{value:new de},palette:{value:B},bgColor:{value:W}}})),this.scene.add(this.output)}addScene(f){this.scene.add(f)}resize(){this.simulation.resize()}render(){L.renderer.setRenderTarget(null),L.renderer.render(this.scene,this.camera)}update(){this.simulation.update(),this.render()}}class as{constructor(f){this.props=f,L.init(f.$wrapper),q.init(f.$wrapper),q.autoIntensity=f.autoIntensity,q.takeoverDuration=f.takeoverDuration,this.lastUserInteraction=performance.now(),q.onInteract=()=>{this.lastUserInteraction=performance.now(),this.autoDriver&&this.autoDriver.forceStop()},this.autoDriver=new J(q,this,{enabled:f.autoDemo,speed:f.autoSpeed,resumeDelay:f.autoResumeDelay,rampDuration:f.autoRampDuration}),this.init(),this._loop=this.loop.bind(this),this._resize=this.resize.bind(this),window.addEventListener("resize",this._resize),this._onVisibility=()=>{document.hidden?this.pause():S.current&&this.start()},document.addEventListener("visibilitychange",this._onVisibility),this.running=!1}init(){this.props.$wrapper.prepend(L.renderer.domElement),this.output=new Mt}resize(){L.resize(),this.output.resize()}render(){this.autoDriver&&this.autoDriver.update(),q.update(),L.update(),this.output.update()}loop(){this.running&&(this.render(),k.current=requestAnimationFrame(this._loop))}start(){this.running||(this.running=!0,this._loop())}pause(){this.running=!1,k.current&&(cancelAnimationFrame(k.current),k.current=null)}dispose(){try{if(window.removeEventListener("resize",this._resize),document.removeEventListener("visibilitychange",this._onVisibility),q.dispose(),L.renderer){const f=L.renderer.domElement;f&&f.parentNode&&f.parentNode.removeChild(f),L.renderer.dispose()}}catch{}}}const ce=A.current;ce.style.position=ce.style.position||"relative",ce.style.overflow=ce.style.overflow||"hidden";const _t=new as({$wrapper:ce,autoDemo:z,autoSpeed:x,autoIntensity:C,takeoverDuration:g,autoResumeDelay:j,autoRampDuration:w});b.current=_t,(()=>{if(!b.current)return;const U=b.current.output?.simulation;if(!U)return;const f=U.options.resolution;Object.assign(U.options,{mouse_force:t,cursor_size:s,isViscous:r,viscous:a,iterations_viscous:i,iterations_poisson:n,dt:o,BFECC:c,resolution:l,isBounce:u}),l!==f&&U.resize()})(),_t.start();const et=new IntersectionObserver(U=>{const f=U[0],D=f.isIntersecting&&f.intersectionRatio>0;S.current=D,b.current&&(D&&!document.hidden?b.current.start():b.current.pause())},{threshold:[0,.01,.1]});et.observe(ce),M.current=et;const we=new ResizeObserver(()=>{b.current&&(T.current&&cancelAnimationFrame(T.current),T.current=requestAnimationFrame(()=>{b.current&&b.current.resize()}))});return we.observe(ce),N.current=we,()=>{if(k.current&&cancelAnimationFrame(k.current),N.current)try{N.current.disconnect()}catch{}if(M.current)try{M.current.disconnect()}catch{}b.current&&b.current.dispose(),b.current=null}},[c,s,o,u,r,n,i,t,l,a,d,m,z,x,C,g,j,w]),h.useEffect(()=>{const R=b.current;if(!R)return;const B=R.output?.simulation;if(!B)return;const K=B.options.resolution;Object.assign(B.options,{mouse_force:t,cursor_size:s,isViscous:r,viscous:a,iterations_viscous:i,iterations_poisson:n,dt:o,BFECC:c,resolution:l,isBounce:u}),R.autoDriver&&(R.autoDriver.enabled=z,R.autoDriver.speed=x,R.autoDriver.resumeDelay=j,R.autoDriver.rampDurationMs=w*1e3,R.autoDriver.mouse&&(R.autoDriver.mouse.autoIntensity=C,R.autoDriver.mouse.takeoverDuration=g)),l!==K&&B.resize()},[t,s,r,a,i,n,o,c,l,u,z,x,C,g,j,w]),e.jsx("div",{ref:A,className:`w-full h-full relative overflow-hidden touch-none ${p||""}`,style:v})}function Ea(){const t=Ne(),{dark:s}=Mn(),r=!s;return e.jsxs("div",{className:"min-h-screen app-radial-bg dark:app-radial-bg transition-colors glass-backdrop relative",children:[e.jsx(oa,{}),e.jsx("div",{className:"fixed inset-0 z-0",children:e.jsx(Ca,{colors:r?["#2240c5ff","#3b82f6","#06b6d4"]:["#5227FF","#FF9FFC","#B19EEF"],backgroundColor:r?"#ffffff":"transparent",mouseForce:r?8:28,cursorSize:100,isViscous:!1,viscous:30,iterationsViscous:32,iterationsPoisson:32,resolution:.6,isBounce:!0,autoDemo:!0,autoSpeed:r?.3:.5,autoIntensity:2,takeoverDuration:.25,autoResumeDelay:3e3,autoRampDuration:.6})}),e.jsx("div",{className:"relative z-10",children:e.jsxs(at,{auth:t,children:[e.jsx("section",{id:"home-hero",className:"flex flex-col items-center justify-start text-center pt-12 sm:pt-16 md:pt-20 pb-8 sm:pb-10 md:pb-12",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"font-extrabold tracking-tight text-[#121930] dark:text-white",children:e.jsxs("span",{className:"inline-flex items-center justify-center gap-0 text-[2.6rem] sm:text-6xl md:text-7xl",children:[e.jsx("span",{children:"at"}),e.jsx("img",{id:"home-logo",src:"/logo.png",alt:"atom",className:"inline-block align-baseline",style:{height:"1.7em",width:"auto",margin:"0 -14px",transform:"translateY(2px)"}}),e.jsx("span",{children:"mbowl"})]})}),e.jsx("p",{className:"text-lg sm:text-xl md:text-2xl text-black/70 dark:text-white/70",children:"the premier science bowl experience"}),e.jsx("div",{className:"pt-2",children:e.jsx(Jt,{to:"/round-generator",className:"btn btn-fancy text-lg",children:"Get started"})}),e.jsx("div",{className:"mt-6",children:e.jsx(za,{})})]})}),e.jsxs("section",{id:"features",className:"max-w-6xl mx-auto px-3 sm:px-4 pt-6 sm:pt-8 md:pt-10 pb-16",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-center text-[#121930] dark:text-white mb-6 sm:mb-10",children:"what you can do"}),e.jsxs("div",{className:"grid gap-4 sm:gap-6 md:gap-8 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsx(nt,{title:"round generator",desc:"Build custom practice rounds from curated tournaments and categories in seconds.",to:"/round-generator",cta:"Generate rounds"}),e.jsx(nt,{title:"practice mode",desc:"Drill toss-ups and bonuses with keyboard-friendly controls and instant feedback.",to:"/practice",cta:"Start practicing"}),e.jsx(nt,{title:"multiplayer rooms",desc:"Create or join live rooms to buzz, chat, and practice together online.",to:"/multiplayer",cta:"Host or join"}),e.jsx(nt,{title:"buzzer",desc:"Simple real-time buzzer for scrims — share a code and you’re in.",to:"/buzzer",cta:"Open buzzer"}),e.jsx(nt,{title:"save & review",desc:"Save generated rounds to your account and review them any time.",to:"/round-generator",cta:"Save rounds"}),e.jsx(nt,{title:"visual bonuses",desc:"View supported visual bonus questions with images when available.",to:"/round-generator",cta:"See visuals"})]})]})]})})]})}function nt({title:t,desc:s,to:r,cta:a}){return e.jsxs("div",{className:"glass p-6 rounded-2xl h-full flex flex-col justify-between hover-lift",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xl font-semibold text-[#121930] dark:text-white",children:t}),e.jsx("p",{className:"text-black/70 dark:text-white/70 text-sm leading-relaxed",children:s})]}),e.jsx("div",{className:"pt-4",children:e.jsx(Jt,{to:r,className:"btn btn-outline-fancy",children:a})})]})}function We(t,s){return Z(t,"games",String(s).toUpperCase())}function Fs(t,s,r){return Z(t,"games",String(s).toUpperCase(),"players",r)}function Ma(t=6){const s="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";let r="";for(let a=0;a<t;a++)r+=s[Math.floor(Math.random()*s.length)];return r}async function _a({hostUid:t,hostName:s}){if(!t)throw new Error("Not authenticated");const r=Y();for(let a=0;a<5;a++){const i=Ma(),n=We(r,i);if(!(await xe(n)).exists())return await ze(n,{code:i,hostUid:t,createdAt:vt(),phase:"lobby",state:{buzzerOpen:!1,cycle:0,winnerUid:null,winnerName:null,winnerAt:null}}),i}throw new Error("Failed to create game code")}async function _n({code:t,uid:s,displayName:r}){if(!s)throw new Error("Not authenticated");const a=Y(),i=We(a,t);if(!(await xe(i)).exists())throw new Error("Game not found");return await ze(Fs(a,t,s),{uid:s,displayName:r||"Player",joinedAt:vt(),score:0,stats:{correct:0,incorrect:0,interruptsCorrect:0,interruptsIncorrect:0}},{merge:!0}),!0}function Rn({code:t,onGame:s,onPlayers:r}){const a=Y(),i=Wt(We(a,t),o=>{s?.(o.exists()?{id:o.id,...o.data()}:null)}),n=Wt(it(a,"games",String(t).toUpperCase(),"players"),o=>{const c=[];o.forEach(l=>c.push({id:l.id,...l.data()})),c.sort((l,u)=>(l.displayName||"").localeCompare(u.displayName||"")),r?.(c)});return()=>{try{i()}catch{}try{n()}catch{}}}async function Tn({code:t,open:s,actorUid:r}){const a=Y(),i=We(a,t);s?await ee(i,{"state.buzzerOpen":!0,"state.cycle":(await xe(i)).data()?.state?.cycle+1||1,"state.winnerUid":null,"state.winnerName":null,"state.winnerAt":null}).catch(async()=>{await Rs(a,async n=>{const o=await n.get(i);if(!o.exists())throw new Error("Game missing");const l=(o.data()||{}).state||{},u=(typeof l.cycle=="number"?l.cycle:0)+1;n.update(i,{"state.buzzerOpen":!0,"state.cycle":u,"state.winnerUid":null,"state.winnerName":null,"state.winnerAt":null})})}):await ee(i,{"state.buzzerOpen":!1})}async function Ra({code:t,uid:s,displayName:r}){const a=Y(),i=We(a,t);try{return await Rs(a,async o=>{const c=await o.get(i);if(!c.exists())throw new Error("Game missing");const u=(c.data()||{}).state||{};return u.buzzerOpen?u.winnerUid?{ok:!1,reason:"already",winnerUid:u.winnerUid}:(o.update(i,{"state.winnerUid":s,"state.winnerName":r||null,"state.winnerAt":vt(),"state.buzzerOpen":!1}),{ok:!0,winnerUid:s}):{ok:!1,reason:"closed",winnerUid:u.winnerUid||null}})}catch(n){return{ok:!1,error:n?.message||String(n)}}}async function yt({code:t}){const s=Y(),r=We(s,t);await ee(r,{"state.winnerUid":null,"state.winnerName":null,"state.winnerAt":null})}async function Ta({code:t,newHostUid:s}){const r=Y();await ee(We(r,t),{hostUid:s});const a=Fs(r,t,s);try{await _s(a)}catch{}}async function Da({code:t,pairs:s,meta:r={}}){const a=Y(),i=We(a,t),n=(Array.isArray(s)?s:[]).map(o=>({tossupId:o?.tossup?.id||o?.tossupId||null,bonusId:o?.bonus?.id||o?.bonusId||null}));await ee(i,{roundPairs:n,phase:"round",roundMeta:{questionType:r.questionType||null,count:n.length,categories:r.categories||[],tournaments:r.tournaments||[]}})}async function on({code:t,uid:s,delta:r={}}){const a=Y(),i=Fs(a,t,s),n=await xe(i),o=n.exists()?n.data()||{}:{},c=o.stats||{},l={stats:{correct:(c.correct||0)+(r.correct||0),incorrect:(c.incorrect||0)+(r.incorrect||0),interruptsCorrect:(c.interruptsCorrect||0)+(r.interruptsCorrect||0),interruptsIncorrect:(c.interruptsIncorrect||0)+(r.interruptsIncorrect||0)},score:(o.score||0)+(r.points||0)};await ee(i,l)}function Te({children:t}){const s=Ne();return e.jsxs("div",{className:"min-h-screen app-radial-bg dark:app-radial-bg transition-colors glass-backdrop",children:[e.jsx(Ps,{auth:s}),e.jsx("main",{className:"w-full px-4 py-8 app-main text-black dark:text-white",children:t}),e.jsx("footer",{className:"w-full px-4 pb-8 text-center text-black/60 dark:text-white/60",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:"Built with Firebase • Vite • Tailwind"}),e.jsxs("div",{className:"text-xs flex flex-wrap gap-2 justify-center","aria-label":"Legal and policy links",children:[e.jsx("a",{href:"/terms-of-service",className:"hover:underline focus:outline-none focus:ring-1 focus:ring-current",rel:"nofollow",children:"Terms of Service"}),e.jsx("span",{"aria-hidden":"true",children:"•"}),e.jsx("a",{href:"/privacy-policy",className:"hover:underline focus:outline-none focus:ring-1 focus:ring-current",rel:"nofollow",children:"Privacy Policy"})]})]})})]})}function Oa(){const t=Ne(),s=$e(),[r,a]=h.useState(""),[i,n]=h.useState(!1),[o,c]=h.useState(""),[l,u]=h.useState([]),[d,m]=h.useState([]);if(h.useEffect(()=>{if(!t.user)return;const x=zs(),C=Xs(it(x,"games"),Zs("hostUid","==",t.user.uid)),g=Wt(C,A=>{const b=A.docs.map(N=>({id:N.id,...N.data()}));u(b)}),j=Xs(it(x,"games"),Zs("players","array-contains",t.user.uid)),w=Wt(j,A=>{const b=A.docs.map(N=>({id:N.id,...N.data()}));m(b)});return()=>{g(),w()}},[t.user]),t.loading)return e.jsx(Te,{children:e.jsx(mt,{})});if(!t.user)return e.jsx(Te,{children:e.jsxs("div",{className:"glass p-6 max-w-lg mx-auto text-center space-y-4",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Buzzer"}),e.jsx("p",{children:"Please sign in to host or join a game."}),e.jsx("button",{className:"btn btn-primary",onClick:()=>s("/signin"),children:"Sign in"})]})});async function v(){n(!0),c("");try{const x=await _a({hostUid:t.user.uid,hostName:t.user.displayName||t.user.email});s(`/buzzer/${x}`)}catch(x){c(x?.message||String(x))}finally{n(!1)}}async function p(x){x?.preventDefault();const C=(r||"").trim().toUpperCase();if(C){n(!0),c("");try{await _n({code:C,uid:t.user.uid,displayName:t.user.displayName||t.user.email}),s(`/buzzer/${C}`)}catch(g){c(g?.message||String(g))}finally{n(!1)}}}async function z(x){if(confirm("Are you sure you want to end this game? This action cannot be undone."))try{const C=zs();await _s(Z(C,"games",x))}catch(C){c(C?.message||String(C))}}return e.jsxs(Te,{children:[e.jsx(ha,{}),e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsxs("div",{className:"glass p-6 space-y-3",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Host a Game"}),e.jsx("p",{className:"text-sm opacity-80",children:"Create a room and share the code with players."}),e.jsx("button",{className:"btn btn-fancy",onClick:v,disabled:i,children:"Create Game"})]}),e.jsxs("div",{className:"glass p-6 space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Join a Game"}),e.jsxs("form",{onSubmit:p,className:"flex gap-2",children:[e.jsx("input",{type:"text",inputMode:"text",pattern:"[A-Za-z0-9]{4,8}",maxLength:8,placeholder:"Enter code",value:r,onChange:x=>a(x.target.value.toUpperCase()),className:"rounded-lg border border-black/10 dark:border-white/10 px-3 py-2 bg-white dark:bg-darkcard flex-1"}),e.jsx("button",{type:"submit",className:"btn btn-fancy",disabled:i||!r,children:"Join"})]}),o&&e.jsx("div",{className:"text-red-600 text-sm",children:o})]}),(l.length>0||d.length>0)&&e.jsxs("div",{className:"glass p-6 space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Active Games"}),l.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-medium",children:"Hosting"}),e.jsx("ul",{className:"space-y-1",children:l.map(x=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsxs("span",{children:["Room ",x.id," (",x.players?x.players.length:0," players)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-rejoin",onClick:()=>s(`/buzzer/${x.id}`),children:"Rejoin"}),e.jsx("button",{className:"btn btn-sm btn-red",onClick:()=>z(x.id),children:"End Game"})]})]},x.id))})]}),d.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-medium",children:"Playing"}),e.jsx("ul",{className:"space-y-1",children:d.map(x=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsxs("span",{children:["Room ",x.id," (",x.players?x.players.length:0," players)"]}),e.jsx("button",{className:"btn btn-sm btn-rejoin",onClick:()=>s(`/buzzer/${x.id}`),children:"Rejoin"})]},x.id))})]})]})]})]})}function La(){const{code:t}=Kt(),s=$e(),r=Ne(),[a,i]=h.useState(null),[n,o]=h.useState([]),[c,l]=h.useState(!1),u=r?.user?.uid;h.useEffect(()=>{if(!t)return;const p=Rn({code:t,onGame:i,onPlayers:o});return()=>p&&p()},[t]),h.useEffect(()=>{!r?.user||!t||!a||r.user.uid!==a.hostUid&&_n({code:t,uid:r.user.uid,displayName:r.user.displayName||r.user.email}).catch(()=>{})},[r?.user,t,a]);const d=!!(a&&u&&a.hostUid===u),m=a?.state?.winnerUid?n.find(p=>p.uid===a.state.winnerUid)||{displayName:a.state.winnerName}:null;if(r.loading||!a)return e.jsx(Te,{children:e.jsx(mt,{})});if(!r.user)return e.jsx(Te,{children:e.jsx("div",{className:"glass p-6",children:"Please sign in to access this room."})});async function v(){if(a?.state?.buzzerOpen){l(!0);try{const p=await Ra({code:t,uid:u,displayName:r.user.displayName||r.user.email})}finally{l(!1)}}}return e.jsx(Te,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"glass p-6 flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm opacity-75",children:"Room"}),e.jsx("div",{className:"text-2xl font-semibold tracking-tight",children:t}),e.jsxs("div",{className:"text-sm opacity-75",children:["Host: ",a?.hostUid===u?"You":n.find(p=>p.uid===a?.hostUid)?.displayName||"Unknown"]})]}),d&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:`btn ${a?.state?.buzzerOpen?"btn-orange":"btn-fancy"}`,onClick:()=>Tn({code:t,open:!a?.state?.buzzerOpen,actorUid:u}),children:a?.state?.buzzerOpen?"Close Buzzer":"Open Buzzer"}),e.jsx("button",{className:"btn btn-ghost",onClick:()=>yt({code:t}),children:"Clear"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>s(`/buzzer/${t}/generate`),children:"Start Game"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4 items-start",children:[e.jsx("div",{className:"glass p-6 md:col-span-2 space-y-4 text-center",children:m?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm opacity-75",children:"Buzz winner"}),e.jsx("div",{className:"text-3xl font-bold",children:m.displayName||"Unknown"})]}):d?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm opacity-75",children:"Buzzer status"}),e.jsx("div",{className:"text-2xl font-semibold",children:a?.state?.buzzerOpen?"Open":"Closed"}),e.jsx("div",{className:"opacity-70 text-sm",children:"Hosts don't buzz. Use the controls to open/close."})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm opacity-75",children:"Press to buzz"}),e.jsx("button",{disabled:c||!a?.state?.buzzerOpen,onClick:v,className:`inline-flex items-center justify-center w-56 h-56 rounded-full text-2xl font-bold shadow-lg transition ${a?.state?.buzzerOpen?"bg-emerald-600 hover:bg-emerald-700 text-white":"bg-gray-300 dark:bg-gray-700 text-gray-600 dark:text-gray-400"} ${c?"opacity-70":""}`,"aria-live":"polite",children:"Buzz"}),!a?.state?.buzzerOpen&&e.jsx("div",{className:"text-sm opacity-75",children:"Waiting for host to open buzzer…"})]})}),e.jsxs("div",{className:"glass p-6 space-y-3",children:[e.jsx("div",{className:"font-semibold",children:"Players"}),e.jsx("ul",{className:"space-y-1",children:n.map(p=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"truncate pr-2",children:p.displayName||p.uid}),d&&p.uid!==a.hostUid&&e.jsx("button",{className:"chip",onClick:()=>Ta({code:t,newHostUid:p.uid}),children:"Make host"})]},p.uid))})]})]})]})})}const Ba=h.lazy(()=>ct(()=>import("./RoundGenerator-B42ChL-b.js"),__vite__mapDeps([50,1,2,3,4,5,6,7,8,9,10,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,31,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48])));function Pa({children:t}){const s=Ne();return e.jsxs("div",{className:"min-h-screen app-radial-bg dark:app-radial-bg transition-colors glass-backdrop",children:[e.jsx(Ps,{auth:s}),e.jsx("main",{className:"w-full px-4 py-8 app-main text-black dark:text-white",children:t}),e.jsx("footer",{className:"w-full px-4 pb-8 text-center text-black/60 dark:text-white/60",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:"Built with Firebase • Vite • Tailwind"}),e.jsxs("div",{className:"text-xs flex flex-wrap gap-2 justify-center","aria-label":"Legal and policy links",children:[e.jsx("a",{href:"/terms-of-service",className:"hover:underline focus:outline-none focus:ring-1 focus:ring-current",rel:"nofollow",children:"Terms of Service"}),e.jsx("span",{"aria-hidden":"true",children:"•"}),e.jsx("a",{href:"/privacy-policy",className:"hover:underline focus:outline-none focus:ring-1 focus:ring-current",rel:"nofollow",children:"Privacy Policy"})]})]})})]})}function Fa(){const{code:t}=Kt(),s=$e(),{generatedPairs:r,setGeneratedPairs:a,pushGeneratedRound:i}=Sn(),n=Ne(),o=Qt();async function c(){if(!r||r.length===0){window.alert?.("Generate a round first.");return}const l=new Set,u=new Set;r.forEach(d=>{d?.tossup&&(d.tossup.tournament&&l.add(d.tossup.tournament),d.tossup.category&&u.add(d.tossup.category)),d?.bonus&&(d.bonus.tournament&&l.add(d.bonus.tournament),d.bonus.category&&u.add(d.bonus.category))}),await Da({code:t,pairs:r,meta:{tournaments:Array.from(l),categories:Array.from(u)}}),s(`/buzzer/${t}/round`)}return e.jsx(Pa,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"glass p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm opacity-70",children:"Room"}),e.jsx("div",{className:"text-xl font-semibold",children:t})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-ghost",onClick:()=>s(`/buzzer/${t}`),children:"Back to Lobby"}),e.jsx("button",{className:"btn btn-primary",onClick:c,children:"Use This Round"})]})]}),e.jsx(h.Suspense,{fallback:e.jsx("div",{className:"glass p-6",children:"Loading…"}),children:e.jsx(Ba,{lazy:o,auth:n,persistedGenerated:r,setPersistedGenerated:a,onNewRound:i})})]})})}const Ia=I.lazy(()=>ct(()=>import("./vendor-react-katex-CCCXQq7R.js").then(t=>t.r),__vite__mapDeps([96,2,1,97,47,48])).then(t=>({default:t.BlockMath}))),Ua=I.lazy(()=>ct(()=>import("./vendor-react-katex-CCCXQq7R.js").then(t=>t.r),__vite__mapDeps([96,2,1,97,47,48])).then(t=>({default:t.InlineMath})));function Ue({children:t}){if(typeof t!="string")return e.jsx(e.Fragment,{children:t});const s=/(\$\$[\s\S]+?\$\$|\$[^\$\n]+?\$)/g,r=[];let a=0,i,n=0;for(;(i=s.exec(t))!==null;){i.index>a&&r.push(t.slice(a,i.index));const o=i[0];o.startsWith("$$")?r.push(e.jsx(h.Suspense,{fallback:e.jsx("span",{children:"[math]"},n++),children:e.jsx(Ia,{children:o.slice(2,-2)},n++)})):o.startsWith("$")&&r.push(e.jsx(h.Suspense,{fallback:e.jsx("span",{children:"[math]"},n++),children:e.jsx(Ua,{children:o.slice(1,-1)},n++)})),a=s.lastIndex}return a<t.length&&r.push(t.slice(a)),e.jsx(e.Fragment,{children:r})}function $a(){const{code:t}=Kt(),s=Ne(),r=$e(),[a,i]=h.useState(null),[n,o]=h.useState([]),c=Qt(),l=!!(s?.user&&a?.hostUid===s.user.uid);h.useEffect(()=>{if(!t)return;const N=Rn({code:t,onGame:i,onPlayers:o});return()=>N&&N()},[t]);const u=Array.from(new Set(a?.roundMeta?.tournaments||[]));h.useEffect(()=>{u.length!==0&&(async()=>{try{await c.ensureLoaded(u)}catch{}})()},[JSON.stringify(u)]);const d=h.useMemo(()=>c.getLoadedQuestions(u),[c,JSON.stringify(u)]),m=h.useMemo(()=>{const N=new Map;for(const k of d)N.set(k.id,k);return N},[d]),v=h.useMemo(()=>(Array.isArray(a?.roundPairs)?a.roundPairs:[]).map(k=>({tossup:k.tossupId&&m.get(k.tossupId)||null,bonus:k.bonusId&&m.get(k.bonusId)||null})),[a?.roundPairs,m]),[p,z]=h.useState(0);h.useEffect(()=>{z(0)},[a?.id]);const x=a?.state?.winnerUid||null,C=x&&n.find(N=>N.uid===x)||null;if(!s.user)return e.jsx(Te,{children:e.jsx("div",{className:"glass p-6",children:"Please sign in."})});if(!a)return e.jsx(Te,{children:e.jsx(mt,{})});const g=u.length>0&&d.length===0,j=v[p]||null;async function w(){!l||!x||(await on({code:t,uid:x,delta:{correct:1,points:4}}),await yt({code:t}),z(N=>Math.min(N+1,v.length-1)))}async function A(){!l||!x||(await on({code:t,uid:x,delta:{incorrect:1,points:0}}),await yt({code:t}))}async function b(){l&&(await yt({code:t}),z(N=>Math.min(N+1,v.length-1)))}return e.jsx(Te,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"glass p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm opacity-70",children:"Room"}),e.jsx("div",{className:"text-xl font-semibold",children:t})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-ghost",onClick:()=>r(`/buzzer/${t}`),children:"Back"}),l&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`btn ${a?.state?.buzzerOpen?"btn-orange":"btn-fancy"}`,onClick:()=>Tn({code:t,open:!a?.state?.buzzerOpen}),children:a?.state?.buzzerOpen?"Close Buzzer":"Open Buzzer"}),e.jsx("button",{className:"btn btn-ghost",onClick:()=>yt({code:t}),children:"Clear"})]})]})]}),e.jsxs("div",{className:"glass p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm opacity-75",children:["Question ",p+1," / ",v.length||0]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"chip",onClick:()=>z(N=>Math.max(0,N-1)),children:"Prev"}),e.jsx("button",{className:"chip",onClick:()=>z(N=>Math.min(v.length-1,N+1)),children:"Next"})]})]}),g?e.jsx("div",{className:"opacity-70",children:"Loading questions…"}):j?e.jsxs("div",{className:"space-y-4",children:[j.tossup&&e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs uppercase tracking-wide opacity-70",children:["Toss-up • ",j.tossup.category]}),e.jsx("div",{className:"prose dark:prose-invert max-w-none whitespace-pre-wrap",children:e.jsx(Ue,{children:j.tossup.question})})]}),j.bonus&&e.jsxs("div",{className:"mt-4 p-3 rounded-lg bg-black/5 dark:bg-white/10",children:[e.jsxs("div",{className:"text-xs uppercase tracking-wide opacity-70",children:["Bonus • ",j.bonus.category]}),e.jsx("div",{className:"prose dark:prose-invert max-w-none whitespace-pre-wrap",children:e.jsx(Ue,{children:j.bonus.question})})]})]}):e.jsx("div",{className:"opacity-70",children:"No question loaded."}),e.jsxs("div",{className:"pt-2 flex items-center gap-3 flex-wrap",children:[e.jsxs("div",{className:"text-sm opacity-75",children:["Winner: ",C?C.displayName||C.uid:"—"]}),l&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-fancy",onClick:w,disabled:!C,children:"Correct"}),e.jsx("button",{className:"btn btn-orange",onClick:A,disabled:!C,children:"Incorrect"}),e.jsx("button",{className:"btn btn-ghost",onClick:b,children:"Stale"})]})]})]}),e.jsxs("div",{className:"glass p-6",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Scores"}),e.jsx("ul",{className:"grid sm:grid-cols-2 md:grid-cols-3 gap-2",children:n.map(N=>e.jsxs("li",{className:"flex items-center justify-between rounded-lg bg-black/5 dark:bg-white/10 px-3 py-2",children:[e.jsx("span",{className:"truncate pr-2",children:N.displayName||N.uid}),e.jsx("span",{className:"font-semibold",children:N.score||0})]},N.uid))})]})]})})}const jt="mpGuestUid",Nt="mpGuestName";function Wa(t=12){const s="abcdefghjkmnpqrstuvwxyzABCDEFGHJKMNPQRSTUVWXYZ23456789";let r="";for(let a=0;a<t;a++)r+=s[Math.floor(Math.random()*s.length)];return r}function ve(){const s=je?.()?.currentUser||null;if(s)return{uid:s.uid,displayName:s.displayName||s.email||"Player",isGuest:!1};const r=localStorage.getItem(jt),a=localStorage.getItem(Nt);return r&&a?{uid:r,displayName:a,isGuest:!0}:null}function Ga(t){let s=localStorage.getItem(jt);s||(s=`guest_${Wa(16)}`,localStorage.setItem(jt,s)),t&&localStorage.setItem(Nt,t);const r=localStorage.getItem(Nt)||t||"Guest";return{uid:s,displayName:r,isGuest:!0}}function Ha(){try{localStorage.removeItem(jt)}catch{}try{localStorage.removeItem(Nt)}catch{}}function qa(){const t=localStorage.getItem(jt),s=localStorage.getItem(Nt);return t&&s?{uid:t,displayName:s,isGuest:!0}:null}let Dn=0,Ut=!1,$t=[];function Ja(){if(!Ut)try{dt();const t=Vt(lt()),s=oe(t,".info/serverTimeOffset"),r=ye(s,a=>{const i=Number(a.val()||0);Dn=Number.isFinite(i)?i:0,Ut||(Ut=!0,$t.forEach(n=>{try{n()}catch{}}),$t=[])});return()=>fe(s,"value",r)}catch{Ut=!0,$t.forEach(t=>{try{t()}catch{}}),$t=[]}}function Ae(){return Ja(),Date.now()+(Dn||0)}function ge(){return dt(),Vt(lt())}function X(t){return oe(ge(),`mp/rooms/${t}`)}function Zt(t){return oe(ge(),`mp/roomMembers/${t}`)}function kt(t,s){return oe(ge(),`mp/roomMembers/${t}/${s}`)}function On(t){return oe(ge(),`mp/roomMessages/${t}`)}function Ln(t){return oe(ge(),`mp/roomSettings/${t}`)}function Ka(t){return oe(ge(),`mp/roomAnswers/${t}`)}function Va(t,s,r){return oe(ge(),`mp/roomAnswers/${t}/${s}/${r}`)}function Qa(t){return oe(ge(),`mp/roomBuzzes/${t}`)}function Bn(t,s){return oe(ge(),`mp/roomBuzzes/${t}/${s}`)}function Pn(t){return oe(ge(),`mp/roomHistory/${t}`)}function St(t){return oe(ge(),`mp/userRooms/${t}`)}async function At(t){try{await re(X(t),{lastActiveAt:Date.now()})}catch{}}function Ya(t=6){const s="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";let r="";for(let a=0;a<t;a++)r+=s[Math.floor(Math.random()*s.length)];return r}async function Fn(t){try{const r=new TextEncoder().encode(String(t||"")),a=await(self.crypto||window.crypto).subtle.digest("SHA-256",r),i=new Uint8Array(a);return Array.from(i).map(n=>n.toString(16).padStart(2,"0")).join("")}catch{return String(t||"")}}async function Xa({name:t="Room",isPrivate:s=!1,passcode:r=""}){const a=String(t||"Room").trim()||"Room",i=String(r||"").trim();if(s&&!i)throw new Error("Passcode is required for private rooms");for(let n=0;n<5;n++){const o=Ya(),c=X(o);if((await Re(c)).exists())continue;let u=null;if(s&&i)try{u=await Fn(i)}catch{u=i}return await ot(c,{name:a,isPrivate:!!s,status:"open",createdAt:Date.now(),state:{buzzerOpen:!1,winnerUid:null,winnerName:null,winnerAt:null,awaitNext:!1,perWordMs:200,perChoiceMs:400,streamedWordsBase:0,streamStartAt:null,stemFinishedAt:null,choicesBase:0,choicesStartAt:null},game:{currentId:null,tournaments:[],used:null},passHash:u||null,lastActiveAt:Date.now()}),o}throw new Error("Failed to create room")}async function wt({roomId:t,uid:s,displayName:r,passcode:a,passHashOverride:i}){const o=je()?.currentUser,c=o?{uid:o.uid,displayName:o.displayName||o.email||"Player"}:ve()||{},l=s||c.uid,u=r||c.displayName||"Player";if(!l)throw new Error("No identity available");let d=null;try{d=await Re(X(t))}catch{}const m=d?.exists()?d.val():null,v=!!m?.isPrivate,p=m?.passHash||null;let z=null;if(v&&p){if(i)z=String(i);else if(a)z=await Fn(a);else try{z=window.localStorage.getItem(`mp_pass_hash_${t}`)}catch{}if(!z||z!==p)throw new Error("Incorrect or missing passcode")}await re(kt(t,l),{uid:l,displayName:u,typing:!1,draft:"",lastTypedAt:Date.now(),...z?{passHash:z}:{}});try{o?.uid&&await re(Ve(St(l),t),{roomId:t,joinedAt:Date.now(),lastActiveAt:Date.now()})}catch{}At(t);const x=Ve(kt(t,l),"score");return await De(x,C=>typeof C=="number"?C:0),!0}function Za({roomId:t,onRoom:s,onMembers:r,onMessages:a,onSettings:i,onAnswers:n}){const o=[],c=X(t),l=Zt(t),u=Ds(On(t),Os("createdAt"),bn(200)),d=Ln(t),m=Ka(t),v=ye(c,g=>{const j=g.exists()?{id:t,...g.val()}:null;s?.(j)});o.push(()=>fe(c,"value",v));const p=ye(d,g=>{const j=g.val()||{};i?.(j)});o.push(()=>fe(d,"value",p));const z=ye(l,g=>{const j=g.val()||{},w=Object.values(j);w.sort((A,b)=>{const N=A.score||0,k=b.score||0;if(k!==N)return k-N;const M=(A.displayName||"").toLowerCase(),S=(b.displayName||"").toLowerCase(),T=M.localeCompare(S);if(T!==0)return T;const R=String(A.uid||""),B=String(b.uid||"");return R.localeCompare(B)}),r?.(w)});o.push(()=>fe(l,"value",z));const x=ye(u,g=>{const j=g.val()||{},w=Object.entries(j).map(([A,b])=>({id:A,...b})).sort((A,b)=>(A.createdAt||0)-(b.createdAt||0));a?.(w)});o.push(()=>fe(u,"value",x));const C=ye(m,g=>{const j=g.val()||{};n?.(j)});return o.push(()=>fe(m,"value",C)),()=>{o.forEach(g=>{try{g()}catch{}})}}function ei({roomId:t,onBuzzes:s}){const r=Qa(t),a=ye(r,i=>{const n=i.val()||{},o={};Object.entries(n).forEach(([c,l])=>{const u=Object.entries(l||{}).map(([d,m])=>({id:d,...m}));u.sort((d,m)=>(d.at||0)-(m.at||0)),o[c]=u}),s?.(o)});return()=>fe(r,"value",a)}function ti({roomId:t,onTyping:s}){const r=Zt(t),a=o=>{const c=o.val()||{},l=c.uid||o.key;s?.({uid:l,displayName:c.displayName||l,typing:!!c.typing,draft:String(c.draft||""),lastTypedAt:Number(c.lastTypedAt||0)})},i=$r(r,a),n=Wr(r,a);return()=>{try{fe(r,"child_added",i)}catch{}try{fe(r,"child_changed",n)}catch{}}}async function si({roomId:t,text:s}){const a=je()?.currentUser,i=a?{uid:a.uid,displayName:a.displayName||a.email||"Player"}:ve()||{},n=i?.uid;if(!n)return!1;const o=i.displayName||"Player",c=Ls(On(t));await ot(c,{uid:n,displayName:o,text:s,createdAt:Date.now()}),await At(t);try{a?.uid&&await re(Ve(St(n),t),{lastActiveAt:Date.now()})}catch{}return!0}async function cn({roomId:t,uid:s,delta:r}){const a=Ve(kt(t,s),"score");await De(a,i=>(i||0)+(Number(r)||0)),await At(t);try{je()?.currentUser?.uid&&await re(Ve(St(s),t),{lastActiveAt:Date.now()})}catch{}return!0}async function ni({roomId:t,patch:s,requireHost:r=!1}){if(je()?.currentUser?.uid,!t||!s||typeof s!="object")return!1;try{const i={...s};if(Object.prototype.hasOwnProperty.call(s,"selectedTournaments")){const n=Array.isArray(s.selectedTournaments)?s.selectedTournaments.slice(0,20):[];await re(X(t),{"game/tournaments":n})}return Object.keys(i).length>0&&await re(Ln(t),i),!0}catch{return!1}}async function ln({roomId:t,questionId:s,uid:r,displayName:a,data:i}){if(!t||!s||!r)return!1;const n={uid:r,displayName:a||null,status:i?.status||"typing",text:i?.text||"",choice:i?.choice||"",correct:typeof i?.correct=="boolean"?i.correct:null,points:Number.isFinite(i?.points)?Number(i.points):null,updatedAt:Date.now()};await ot(Va(t,s,r),n),await At(t);try{await re(Ve(St(r),t),{lastActiveAt:Date.now()})}catch{}await re(kt(t,r),{lastQuestionId:s,lastAnswerStatus:n.status,lastAnswerCorrect:n.correct,lastAnswerAt:n.updatedAt});try{const l=((await Re(X(t))).val()?.state||{}).currentBuzzKey;if(l){const u=Ve(Bn(t,s),l),m=(await Re(u)).val();m&&(!m.uid||m.uid===r)&&await re(u,{status:n.status,text:n.text,correct:n.correct,points:n.points,checkedAt:Date.now()})}}catch{}return!0}async function ri({roomId:t,uid:s}){if(!t||!s)return!1;const r=kt(t,s);return await ot(r,null),!0}async function rt({roomId:t,open:s}){const r=Ae();await De(X(t),a=>{const i=a||{},n=i.state||{},o=Number(n.perWordMs||200),c=Number(n.perChoiceMs||400);if(!s){const u=n.streamStartAt?Math.max(0,r-Number(n.streamStartAt)):0,d=o>0?Math.floor(u/o):0,m=Math.max(0,Number(n.streamedWordsBase||0))+Math.max(0,d),v=n.choicesStartAt?Math.max(0,r-Number(n.choicesStartAt)):0,p=c>0?Math.floor(v/c):0,z=Math.min(4,Math.max(0,Number(n.choicesBase||0))+Math.max(0,p));return{...i,state:{...n,buzzerOpen:!1,streamStartAt:null,streamedWordsBase:m,choicesStartAt:null,choicesBase:z}}}const l={...i,state:{...n,buzzerOpen:!0}};if(n.streamStartAt||(l.state.streamStartAt=r),n.stemFinishedAt&&!n.choicesStartAt&&Number(n.choicesBase||0)<4&&(l.state.choicesStartAt=r),n.choicesFinishedAt&&!n.buzzWindowStartAt){const u=i.game&&i.game.currentId||"",m=/__bo__\d+$/i.test(String(u))?1e4:4e3;l.state.buzzWindowMs=Number.isFinite(n.buzzWindowMs)&&n.buzzWindowMs>0?n.buzzWindowMs:m,l.state.buzzWindowStartAt=r}return l})}async function dn({roomId:t,grading:s}){await re(X(t),{"state/grading":!!s})}async function ai({roomId:t,uid:s,displayName:r}){const a=X(t);try{let i={ok:!1};if(await De(a,n=>{const o=n||{},c=o.state||{},l=c.lockedOut&&typeof c.lockedOut=="object"?c.lockedOut:{};if(l&&s&&l[s])return i={ok:!1,reason:"locked"},n;if(!c.buzzerOpen)return i={ok:!1,reason:"closed",winnerUid:c.winnerUid||null},n;if(c.winnerUid)return i={ok:!1,reason:"already",winnerUid:c.winnerUid},n;const u=Ae(),d=Number(c.perWordMs||200),m=c.streamStartAt?Math.max(0,u-Number(c.streamStartAt)):0,v=d>0?Math.floor(m/d):0,p=Math.max(0,Number(c.streamedWordsBase||0))+Math.max(0,v),z=Number(c.perChoiceMs||400),x=c.choicesStartAt?Math.max(0,u-Number(c.choicesStartAt)):0,C=z>0?Math.floor(x/z):0,g=Math.min(4,Math.max(0,Number(c.choicesBase||0))+Math.max(0,C)),j=!c.stemFinishedAt,w={...o,state:{...o.state||{},buzzerOpen:!1,winnerUid:s,winnerName:r||null,winnerAt:Date.now(),streamStartAt:null,streamedWordsBase:p,choicesStartAt:null,choicesBase:g,currentBuzzKey:null,answerWindowUid:s,answerWindowStartAt:u,answerWindowDeadlineAt:u+3e3,answerWindowResolved:!1,currentBuzzInterrupt:!!j}};if(!j&&(w.state.buzzWindowStartAt=u,!Number.isFinite(w.state.buzzWindowMs)||w.state.buzzWindowMs<=0)){const A=o.game&&o.game.currentId||"",b=/__bo__\d+$/i.test(String(A));w.state.buzzWindowMs=b?1e4:4e3}return i={ok:!0,winnerUid:s},w}),i.ok){const o=(await Re(X(t))).val()||{},c=o?.game?.currentId||null;if(c){const l=Ls(Bn(t,c)),u=l.key,d=!o?.state?.stemFinishedAt;await ot(l,{uid:s,displayName:r,at:Date.now(),interrupt:d}),await re(X(t),{"state/currentBuzzKey":u})}}return i}catch(i){return{ok:!1,error:i?.message||String(i)}}}async function Ns({roomId:t}){await re(X(t),{"state/winnerUid":null,"state/winnerName":null,"state/winnerAt":null,"state/answerWindowUid":null,"state/answerWindowStartAt":null,"state/answerWindowDeadlineAt":null,"state/answerWindowResolved":null,"state/currentBuzzInterrupt":null})}async function ii({roomId:t,questionId:s,tournaments:r=[]}){let a=null;await De(X(t),i=>{const n=i||{},o=n.game||{},c=o.currentId||null;a=c;const l=o.used&&typeof o.used=="object"?o.used:{},u={...n};u.game={...u.game||{},currentId:s||null,tournaments:Array.isArray(r)?r.slice(0,20):[],used:{...l}},c&&(u.game.used[c]=!0);const m=/__bo__\d+$/i.test(String(s||""))?1e4:4e3;return u.state={...u.state||{},buzzerOpen:!1,winnerUid:null,winnerName:null,winnerAt:null,awaitNext:!1,currentBuzzKey:null,lockedOut:null,perWordMs:200,perChoiceMs:400,streamedWordsBase:0,streamStartAt:null,stemFinishedAt:null,choicesFinishedAt:null,choicesBase:0,choicesStartAt:null,buzzWindowMs:m,buzzWindowStartAt:null,answerWindowUid:null,answerWindowStartAt:null,answerWindowDeadlineAt:null,answerWindowResolved:null,currentBuzzInterrupt:null},u});try{if(a){const i=Ls(Pn(t));await ot(i,{questionId:a,at:Date.now()})}}catch{}}async function oi({roomId:t,uid:s}){let r=!1;return await De(X(t),a=>{const i=a||{},n=i.state||{},o=Ae();if(!n.answerWindowUid||n.answerWindowUid!==s||!n.answerWindowDeadlineAt||n.answerWindowResolved||o<Number(n.answerWindowDeadlineAt))return a;const c={...i,state:{...n,answerWindowResolved:!0}};return r=!0,c}),r}async function ci({roomId:t,at:s}){const r=Number(s||Ae());await De(X(t),a=>{const i=a||{},n=i.state||{};return n.stemFinishedAt?a:{...i,state:{...n,stemFinishedAt:r}}})}async function li({roomId:t,at:s}){const r=Number(s||Ae());await De(X(t),a=>{const i=a||{},n=i.state||{};return n.choicesFinishedAt?a:{...i,state:{...n,choicesFinishedAt:r}}})}async function un({roomId:t,uid:s}){return!t||!s?!1:(await De(X(t),r=>{const a=r||{},i=a.state||{},o={...i.lockedOut&&typeof i.lockedOut=="object"?i.lockedOut:{},[s]:!0};return{...a,state:{...i,lockedOut:o}}}),!0)}async function mn({roomId:t}){await re(X(t),{"state/lockedOut":null})}async function hn({roomId:t,value:s}){await re(X(t),{"state/awaitNext":!!s}),await At(t)}function di({onRooms:t}){const s=Ds(oe(ge(),"mp/rooms"),Os("createdAt"),bn(50)),r=new Map;let a=[],i={};const n=()=>{const u=a.map(d=>({...d,memberCount:typeof d.memberCount=="number"?d.memberCount:i[d.id]||0}));t?.(u)},o=u=>{if(r.has(u))return;const d=Zt(u),m=ye(d,v=>{const p=v.val()||{};i[u]=Object.keys(p).length,n()});r.set(u,()=>fe(d,"value",m))},c=u=>{for(const[d,m]of r.entries())if(!u.includes(d)){try{m()}catch{}r.delete(d),delete i[d]}},l=ye(s,u=>{const d=u.val()||{},m=Object.entries(d).map(([p,z])=>({id:p,...z})).filter(p=>p.status==="open"&&p.isPrivate===!1).sort((p,z)=>(z.createdAt||0)-(p.createdAt||0));a=m;const v=m.map(p=>p.id);v.forEach(o),c(v),n()});return()=>{fe(s,"value",l);for(const u of r.values())try{u()}catch{}r.clear()}}function ui({uid:t,onRooms:s}){if(!t)return()=>{};const r=St(t),a=new Map;let i=[],n={};const o=()=>{const d=i.map(m=>({...m,memberCount:n[m.id]||0}));d.sort((m,v)=>(v.lastActiveAt||0)-(m.lastActiveAt||0)),s?.(d)},c=d=>{if(a.has(d))return;const m=Zt(d),v=ye(m,p=>{const z=p.val()||{};n[d]=Object.keys(z).length,o()});a.set(d,()=>fe(m,"value",v))},l=d=>{for(const[m,v]of a.entries())if(!d.includes(m)){try{v()}catch{}a.delete(m),delete n[m]}},u=ye(r,async d=>{const m=d.val()||{},v=Object.keys(m),p=[];for(const z of v)try{const x=await Re(X(z));x.exists()&&p.push({id:z,...x.val()})}catch{}i=p,v.forEach(c),l(v),o()});return()=>{fe(r,"value",u);for(const d of a.values())try{d()}catch{}a.clear()}}function mi({roomId:t,onHistory:s}){const r=Pn(t),a=ye(r,i=>{const n=i.val()||{},o=Object.entries(n).map(([c,l])=>({id:c,...l||{}})).sort((c,l)=>(l.at||0)-(c.at||0));s?.(o)});return()=>fe(r,"value",a)}async function hi({queryText:t}){const s=String(t||"").trim();if(!s)return null;try{const a=await Re(X(s));if(a.exists())return{id:s,...a.val()}}catch{}const r=s.toUpperCase();if(r!==s)try{const a=await Re(X(r));if(a.exists())return{id:r,...a.val()}}catch{}try{const a=Ds(oe(ge(),"mp/rooms"),Os("name"),Gr(s)),n=(await Re(a)).val()||{},o=Object.entries(n)[0];if(o){const[c,l]=o;return{id:c,...l||{}}}}catch{}return null}function fi(){const t=Ne(),s=$e(),[r,a]=h.useState([]),[i,n]=h.useState([]),o=I.useCallback(S=>{a(T=>JSON.stringify(T)===JSON.stringify(S)?T:S)},[]),[c,l]=h.useState(!1),[u,d]=h.useState(""),[m,v]=h.useState(""),[p,z]=h.useState(!1),[x,C]=h.useState(""),[g,j]=h.useState(""),[w,A]=h.useState(""),[b,N]=h.useState(!1);h.useEffect(()=>{const S=di({onRooms:o});return()=>S()},[o]),h.useEffect(()=>{if(!t?.user?.uid)return;const S=ui({uid:t.user.uid,onRooms:n});return()=>S()},[t?.user?.uid]);async function k(S){if(S?.preventDefault(),!t?.user){s("/signin");return}l(!0),d("");try{const T=(m||"").trim(),R=(x||"").trim();if(p&&!R)throw new Error("Passcode is required for private rooms");const B=await Xa({name:T||"Room",isPrivate:p,passcode:p?R:""});await wt({roomId:B,passcode:p?R:void 0}),s(`/multiplayer/${B}`)}catch(T){d(T?.message||String(T))}finally{l(!1)}}async function M(S){S?.preventDefault(),N(!0),d("");try{const T=(g||"").trim();if(!T)throw new Error("Enter a room name or code");const R=await hi({queryText:T});if(!R)throw new Error("Room not found");s(`/multiplayer/${R.id}`,{state:{passcode:(w||"").trim()}})}catch(T){d(T?.message||String(T))}finally{N(!1)}}return e.jsx("div",{className:"min-h-screen app-radial-bg dark:app-radial-bg transition-colors glass-backdrop",children:e.jsxs(at,{auth:t,children:[e.jsx(ua,{}),t.loading?e.jsx(mt,{}):e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"glass p-6 space-y-3",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Multiplayer"}),e.jsx("p",{className:"text-sm opacity-80",children:"Join a public room or create your own. Private rooms require a passcode."}),e.jsxs("form",{onSubmit:M,className:"grid sm:grid-cols-4 gap-2 items-end",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-sm opacity-75 mb-1",children:"Room name or code"}),e.jsx("input",{className:"rounded-lg border border-black/10 dark:border-white/10 px-3 py-2 bg-white dark:bg-darkcard w-full",value:g,onChange:S=>j(S.target.value),placeholder:"e.g., Friday Practice or ABC123"})]}),e.jsx("div",{className:"hidden sm:block"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm opacity-75 mb-1",children:"Passcode (if required)"}),e.jsx("input",{className:"rounded-lg border border-black/10 dark:border-white/10 px-3 py-2 bg-white dark:bg-darkcard w-full",value:w,onChange:S=>A(S.target.value),placeholder:"Room passcode"})]}),e.jsx("div",{className:"sm:col-span-4 flex gap-2",children:e.jsx("button",{className:"btn btn-primary",type:"submit",disabled:b||!g,children:b?"Joining…":"Join room"})})]}),e.jsx("div",{className:"text-sm opacity-80",children:"Create a new room to practice live buzzing. Share the code to invite others, or keep it public for everyone to see. Set a passcode to keep it private."}),(()=>{const S=!t?.user,T=S?"opacity-60 pointer-events-none":"",R=S?"Sign in to create rooms":"";return e.jsxs("form",{onSubmit:k,className:"grid sm:grid-cols-4 gap-2 items-end","aria-disabled":S,title:R,children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-sm opacity-75 mb-1",children:"Room name"}),e.jsx("input",{className:`rounded-lg border border-black/10 dark:border-white/10 px-3 py-2 bg-white dark:bg-darkcard w-full ${T}`,value:m,onChange:B=>v(B.target.value),placeholder:"e.g., Friday Practice",disabled:S})]}),e.jsx("div",{className:`flex items-center gap-2 ${T}`,children:e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:B=>z(B.target.checked),disabled:S})," Private"]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm opacity-75 mb-1",children:["Passcode ",p?"":"(optional)"]}),e.jsx("input",{className:`rounded-lg border border-black/10 dark:border-white/10 px-3 py-2 bg-white dark:bg-darkcard w-full ${T}`,value:x,onChange:B=>C(B.target.value),disabled:S||!p,placeholder:"Set a passcode"})]}),e.jsxs("div",{className:"sm:col-span-4 flex gap-2 items-center",children:[e.jsx("button",{className:`btn btn-fancy ${S?"opacity-60 cursor-not-allowed":""}`,type:"submit",disabled:S||c||p&&!x,children:c?"Creating…":"Create room"}),S&&e.jsx("span",{className:"text-xs opacity-80",children:"Sign in to create a room"}),u&&e.jsx("div",{className:"text-sm text-red-600",children:u})]})]})})()]}),t?.user&&e.jsxs("div",{className:"glass p-6 space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Active sessions"}),i.length===0?e.jsx("div",{className:"opacity-70 text-sm",children:"No active rooms yet."}):e.jsx("ul",{className:"divide-y divide-black/5 dark:divide-white/10",children:i.map(S=>e.jsxs("li",{className:"py-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:S.name||S.id}),e.jsxs("div",{className:"text-sm opacity-70",children:[S.memberCount||0," online • Active ",new Date(S.lastActiveAt||S.createdAt||0).toLocaleString()]})]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>s(`/multiplayer/${S.id}`),children:"Rejoin"})]},S.id))})]}),e.jsxs("div",{className:"glass p-6 space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Public rooms"}),r.length===0?e.jsx("div",{className:"opacity-70 text-sm",children:"No public rooms right now."}):e.jsx("ul",{className:"divide-y divide-black/5 dark:divide-white/10",children:r.map(S=>e.jsxs("li",{className:"py-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:S.name||S.id}),e.jsxs("div",{className:"text-sm opacity-70",children:[S.memberCount||0," online"]})]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>s(`/multiplayer/${S.id}`),children:"Join"})]},S.id))})]})]})]})})}const pi="vertex-gateway-7e74h6s4.uc.gateway.dev",xi="AIzaSyBxfXewuANeaSgDisu5U4cD1JF70VJuP_U";function gi(t){const s=`https://${pi}`,r=t.startsWith("/")?t:`/${t}`,a=new URL(s+r);return a.searchParams.set("key",xi),a.toString()}async function In(t,s){const r=gi(t),a={"Content-Type":"application/json"};try{const n=await ta();n&&(a["X-Firebase-AppCheck"]=n)}catch{}return await fetch(r,{method:"POST",headers:a,body:JSON.stringify(s??{})})}async function bi(t){return In("/checkAnswerMC",t)}async function fn(t){return In("/checkAnswerBonus",t)}function pn(t){if(!t)return!1;try{return String(t).split("-")[0].toLowerCase()==="ms"}catch{return!1}}function yi({tournaments:t,tournamentGroups:s,selectedTournaments:r,setSelectedTournaments:a,tournamentGroupsOpen:i,setTournamentGroupsOpen:n,handleTournamentToggle:o,tournamentVisibleEntriesMainRef:c,isDark:l,showTournamentModal:u,setShowTournamentModal:d}){return e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold mb-2 flex items-center flex-wrap gap-2",children:["Tournaments",e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Clear selection",onClick:()=>a([]),children:e.jsx(Cs,{size:16})}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Select all",onClick:()=>a((t||[]).filter(m=>!pn(m))),children:e.jsx(Es,{size:16})}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs inline-flex items-center gap-1","aria-label":"Expand tournament list",title:"Expand to modal",onClick:()=>d(!0),children:e.jsx(Jr,{size:14})})]}),e.jsx("div",{className:"border rounded-lg max-h-56 overflow-y-auto overflow-x-hidden",children:e.jsx("ul",{role:"tree",className:"divide-y divide-black/5 dark:divide-white/10",children:(()=>{const m=[],v=s.map(p=>{const z=p.all.length>1,x=z&&i.has(p.base),C=p.all.every(w=>r.includes(w)),g=!C&&p.all.some(w=>r.includes(w));let j={};if(z){const w=p.all.filter(k=>r.includes(k)).length,A=p.all.length>0?w/p.all.length:0,b=Math.pow(A,.85),N=120*b;if(w>0)if(l){const k=28+b*8;j={backgroundColor:`hsl(${N.toFixed(0)} 60% ${k}%)`,color:"#fff"}}else{const k=92-b*8;j={backgroundColor:`hsl(${N.toFixed(0)} 70% ${k}%)`}}}if(!z){const w=p.all[0],A=r.includes(w);return m.push({type:"key",key:w,base:p.base}),e.jsx("li",{role:"treeitem",className:"select-none",children:e.jsxs("label",{className:"flex items-center gap-2 px-2 py-1.5 rounded cursor-pointer min-w-0 "+(A?"bg-blue-100 dark:bg-blue-900/40":"hover:bg-black/5 dark:hover:bg-white/10"),children:[e.jsx("span",{className:"inline-block w-5 shrink-0","aria-hidden":"true"}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("input",{type:"checkbox",className:"accent-tint",checked:A,onChange:b=>o(b,w,"main")}),e.jsx("span",{className:"font-medium truncate min-w-0",title:w,children:w})]})]})},p.base)}return e.jsxs("li",{role:"treeitem","aria-expanded":x,className:"select-none",children:[e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1.5 rounded min-w-0 "+(z?"transition-colors ":"")+(z&&(g||C)?"":"hover:bg-black/5 dark:hover:bg-white/10"),style:j,children:[z&&e.jsx("button",{type:"button",className:"shrink-0 p-0.5 rounded hover:bg-black/10 dark:hover:bg-white/10",onClick:()=>n(w=>{const A=new Set(w);return A.has(p.base)?A.delete(p.base):A.add(p.base),A}),"aria-label":x?"Collapse":"Expand",children:x?e.jsx(bs,{size:16}):e.jsx(ys,{size:16})}),e.jsx("input",{type:"checkbox",className:"accent-tint",checked:C,ref:w=>{w&&(w.indeterminate=g)},onChange:w=>{const A=w.target.checked||g;a(b=>{const N=new Set(b);return A?p.all.forEach(k=>N.add(k)):p.all.forEach(k=>N.delete(k)),Array.from(N)})}}),e.jsx("span",{className:"font-medium truncate",title:p.base,children:`${p.base} (${p.all.length})`})]}),(m.push({type:"group",base:p.base,keys:p.all}),null),x&&e.jsx("ul",{role:"group",className:"pl-10 py-1 overflow-x-hidden min-w-0",children:p.years.map(w=>{const A=r.includes(w.key);return m.push({type:"key",key:w.key,base:p.base}),e.jsx("li",{role:"treeitem","aria-selected":A,className:"px-2 min-w-0 text-xs",children:e.jsxs("label",{className:"flex items-center gap-2 px-2 py-1 rounded cursor-pointer min-w-0 "+(A?"bg-blue-100 dark:bg-blue-900/40":"hover:bg-black/5 dark:hover:bg-white/10"),children:[e.jsx("input",{type:"checkbox",className:"accent-tint",checked:A,onChange:b=>o(b,w.key,"main")}),e.jsx("span",{className:"truncate min-w-0",title:w.label,children:w.label})]})},w.key)})})]},p.base)});return c.current=m,v})()})}),u&&e.jsxs("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>d(!1)}),e.jsxs("div",{className:"relative bg-white dark:bg-darkcard rounded-lg shadow-xl max-w-3xl w-full p-6 space-y-4 border border-black/10 dark:border-white/10 flex flex-col max-h-[85vh]",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Select Tournaments"}),e.jsx("button",{className:"btn btn-ghost btn-sm",onClick:()=>d(!1),children:"Close"})]}),e.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Clear selection",onClick:()=>a([]),children:e.jsx(Cs,{size:16})}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Select all",onClick:()=>a((t||[]).filter(m=>!pn(m))),children:e.jsx(Es,{size:16})}),e.jsxs("button",{className:"chip px-2 py-0.5 text-xs inline-flex items-center gap-1","aria-label":"Expand all groups",title:"Expand all groups",onClick:()=>n(new Set(s.filter(m=>m.all.length>1).map(m=>m.base))),children:[e.jsx(nn,{size:15}),e.jsx(ys,{size:15})]}),e.jsxs("button",{className:"chip px-2 py-0.5 text-xs inline-flex items-center gap-1","aria-label":"Collapse all groups",title:"Collapse all groups",onClick:()=>n(new Set),children:[e.jsx(nn,{size:15}),e.jsx(bs,{size:15})]})]}),e.jsx("div",{className:"border rounded-lg max-h-[65vh] overflow-y-auto overflow-x-hidden",children:e.jsx("ul",{role:"tree",className:"divide-y divide-black/5 dark:divide-white/10",children:(()=>{const m=[];return s.map(p=>{const z=p.all.length>1,x=z&&i.has(p.base),C=p.all.every(j=>r.includes(j)),g=!C&&p.all.some(j=>r.includes(j));return e.jsxs("li",{role:"treeitem","aria-expanded":x,className:"select-none",children:[e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1.5 rounded min-w-0 "+(z?"transition-colors ":""),children:[z&&e.jsx("button",{type:"button",className:"shrink-0 p-0.5 rounded hover:bg-black/10 dark:hover:bg-white/10",onClick:()=>n(j=>{const w=new Set(j);return w.has(p.base)?w.delete(p.base):w.add(p.base),w}),"aria-label":x?"Collapse":"Expand",children:x?e.jsx(bs,{size:16}):e.jsx(ys,{size:16})}),e.jsx("input",{type:"checkbox",className:"accent-tint",checked:C,ref:j=>{j&&(j.indeterminate=g)},onChange:j=>{const w=j.target.checked||g;a(A=>{const b=new Set(A);return w?p.all.forEach(N=>b.add(N)):p.all.forEach(N=>b.delete(N)),Array.from(b)})}}),e.jsx("span",{className:"font-medium truncate",title:p.base,children:`${p.base} (${p.all.length})`})]}),x&&e.jsx("ul",{role:"group",className:"pl-10 py-1 overflow-x-hidden min-w-0",children:p.years.map(j=>{const w=r.includes(j.key);return m.push({type:"key",key:j.key,base:p.base}),e.jsx("li",{role:"treeitem","aria-selected":w,className:"px-2 min-w-0 text-xs",children:e.jsxs("label",{className:`flex items-center gap-2 px-2 py-1 rounded cursor-pointer min-w-0 ${w?"bg-blue-100 dark:bg-blue-900/40":"hover:bg-black/5 dark:hover:bg-white/10"}`,children:[e.jsx("input",{type:"checkbox",className:"accent-tint",checked:w,onChange:A=>o(A,j.key,"modal")}),e.jsx("span",{className:"truncate min-w-0",title:j.label,children:j.label})]})},j.key)})})]},p.base)})})()})})]})]}),e.jsx("div",{className:"mt-2 text-[11px] text-gray-500 dark:text-gray-400",children:" * Select All does not include MS rounds."})]})}function wi({categories:t,selectedCategories:s,setSelectedCategories:r}){return e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold mb-2 flex items-center gap-2",children:["Categories",e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Clear selection",onClick:()=>r([]),children:e.jsx(Cs,{size:16})}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Select all",onClick:()=>r(t),children:e.jsx(Es,{size:16})}),e.jsx("button",{className:"chip px-2 py-0.5 text-xs",title:"Invert selection",onClick:()=>r(a=>t.filter(i=>!a.includes(i))),children:e.jsx(Kr,{size:16})})]}),e.jsx("div",{className:"rounded-lg max-h-56 overflow-y-auto overflow-x-hidden",children:e.jsx("div",{className:"flex flex-wrap gap-2 min-w-0 p-2",children:t.map(a=>{const i=s.includes(a);return e.jsxs("label",{className:`chip cursor-pointer ${i?"ring-1 ring-tint bg-tint/10":""}`,title:a,children:[e.jsx("input",{type:"checkbox",className:"mr-1",checked:i,onChange:()=>r(n=>n.includes(a)?n.filter(o=>o!==a):[...n,a])}),e.jsx("span",{className:"truncate max-w-[12rem] inline-block align-middle",children:a})]},a)})})})]})}function vi({selectedTournaments:t,tournaments:s,roundRanges:r,setRoundRanges:a,roundsByTournament:i,globalNumericRoundMax:n}){return e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold mb-2 flex items-center justify-between gap-2",children:[e.jsx("span",{children:"Round ranges"}),e.jsx("button",{type:"button",className:`chip px-2 py-1 ${t.length===0?"opacity-50 cursor-not-allowed":""}`,"aria-label":"Add round range",title:"Add range",disabled:t.length===0,onClick:()=>{if(t.length===0)return;const c=t.length===1?t[0]:"";a([...r,{from:1,to:3,tournament:c}])},children:e.jsx(Vr,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[r.length===0&&e.jsx("div",{className:"text-xs italic text-black/70 dark:text-white/60 px-1",children:"All rounds included (no range filters). Add a range to limit rounds."}),r.map((o,c)=>{const l=t.length>0?t:s,u=t.length===1,d=t.length===0&&s.length===1,m=u||d||l.length===1,v=m&&(t[0]||l[0])||"",p=m?v:o.tournament||"",z=m?v:o.tournament||null,x=z?i[z]??[]:[],C=x.length>0&&x.every(g=>/^\d+$/.test(g));return e.jsxs("div",{className:"round-range-row w-full overflow-hidden",children:[e.jsx("div",{className:"select-wrapper flex-1 min-w-0",children:e.jsx("select",{className:"sb-select-range rounded-lg border px-3 py-1.5 shadow-none focus:outline-none "+(m?"bg-gray-100 dark:bg-white/10 text-gray-500 dark:text-gray-400 border-gray-300 dark:border-white/20 cursor-not-allowed pointer-events-none":"bg-white text-black border-black/10 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20"),value:p,disabled:m,onChange:g=>{if(m)return;const j=[...r];j[c]={...j[c],tournament:g.target.value},a(j)},title:p||"All Tournaments",children:m?e.jsx("option",{value:v,children:v}):t.length===0?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"",children:"All Tournaments"}),l.map(g=>e.jsx("option",{value:g,children:g},g))]}):l.map(g=>e.jsx("option",{value:g,children:g},g))})}),z?C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"select-wrapper sb-select-round",children:e.jsx("select",{className:"rounded-lg border border-black/10 bg-white text-black px-2 py-1 shadow-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20 shrink-0 sb-select-round",value:o.from!=null&&x.includes(String(o.from))?String(o.from):x[0]??"",onChange:g=>{const j=[...r];let w=Number(g.target.value),A=Number(j[c].to);(!Number.isFinite(A)||A<w)&&(A=w),j[c]={...j[c],from:w,to:A,dFrom:void 0,dTo:void 0},a(j)},children:x.map(g=>e.jsx("option",{value:g,children:g},g))})}),e.jsx("span",{className:"text-black dark:text-white",children:"to"}),e.jsx("div",{className:"select-wrapper sb-select-round",children:e.jsx("select",{className:"rounded-lg border border-black/10 bg-white text-black px-2 py-1 shadow-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20 shrink-0 sb-select-round",value:o.to!=null&&x.includes(String(o.to))?String(o.to):x[x.length-1]??"",onChange:g=>{const j=[...r];let w=Number(g.target.value),A=Number(j[c].from);(!Number.isFinite(A)||A>w)&&(A=w),j[c]={...j[c],from:A,to:w,dFrom:void 0,dTo:void 0},a(j)},children:x.map(g=>e.jsx("option",{value:g,children:g},g))})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"select-wrapper sb-select-round",children:e.jsx("select",{className:"rounded-lg border border-black/10 bg-white text-black px-2 py-1 shadow-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20 shrink-0 sb-select-round",value:o.dFrom??x[0]??"",onChange:g=>{const j=[...r],w=g.target.value;let A=j[c].dTo;if(A){const b=x.indexOf(w),N=x.indexOf(A);b!==-1&&N!==-1&&b>N&&(A=w)}j[c]={...j[c],dFrom:w,dTo:A},a(j)},children:x.map(g=>e.jsx("option",{value:g,children:g},g))})}),e.jsx("span",{className:"text-black dark:text-white",children:"to"}),e.jsx("div",{className:"select-wrapper sb-select-round",children:e.jsx("select",{className:"rounded-lg border border-black/10 bg-white text-black px-2 py-1 shadow-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20 shrink-0 sb-select-round",value:o.dTo??x[x.length-1]??"",onChange:g=>{const j=[...r],w=g.target.value;let A=j[c].dFrom;if(A){const b=x.indexOf(A),N=x.indexOf(w);b!==-1&&N!==-1&&b>N&&(A=w)}j[c]={...j[c],dFrom:A??w,dTo:w},a(j)},children:x.map(g=>e.jsx("option",{value:g,children:g},g))})})]}):(()=>{const g=Array.from({length:n},(A,b)=>b+1),j=o.from!=null&&o.from>=1?o.from:g[0],w=o.to!=null&&o.to>=j||o.to!=null?o.to:g[g.length-1];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"select-wrapper sb-select-round",children:e.jsx("select",{className:"rounded-lg border border-black/10 bg-white text-black px-2 py-1 shadow-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20 shrink-0 sb-select-round",value:String(j),onChange:A=>{const b=[...r];let N=Number(A.target.value),k=Number(b[c].to);(!Number.isFinite(k)||k<N)&&(k=N),b[c]={...b[c],from:N,to:k,dFrom:void 0,dTo:void 0},a(b)},children:g.map(A=>e.jsx("option",{value:A,children:A},A))})}),e.jsx("span",{className:"text-black dark:text-white",children:"to"}),e.jsx("div",{className:"select-wrapper sb-select-round",children:e.jsx("select",{className:"rounded-lg border border-black/10 bg-white text-black px-2 py-1 shadow-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-darkcard dark:text-white dark:border-white/20 shrink-0 sb-select-round",value:String(w),onChange:A=>{const b=[...r];let N=Number(A.target.value),k=Number(b[c].from);(!Number.isFinite(k)||k>N)&&(k=N),b[c]={...b[c],from:k,to:N,dFrom:void 0,dTo:void 0},a(b)},children:g.map(A=>e.jsx("option",{value:A,children:A},A))})})]})})(),e.jsx("button",{className:"chip shrink-0","aria-label":"Remove round range",title:"Remove range",onClick:()=>a(r.filter((g,j)=>j!==c)),children:e.jsx(Qr,{className:"h-4 w-4"})})]},c)})]})]})}function xn(t){return Array.from(new Set(t))}function Wo(t,s){return t?s.find(r=>r.question_type?.toLowerCase()==="bonus"&&r.round===t.round&&r.tournament===t.tournament&&r.question_number===t.question_number):null}function Ms(t){if(!t)return[];const s=["w","x","y","z"],r=n=>{if(n==null)return null;const c=String(n).replace(/[.)\s]/g,"").toLowerCase()[0];return s.includes(c)?c:null},a=n=>n==null?null:typeof n=="string"||typeof n=="number"?String(n):typeof n=="object"?n.text??n.value??n.choice??n.content??n.answer??n.option??n.label??n.name??null:null;let i=t.choices??null;if(!i){const n={w:t.w??t.W,x:t.x??t.X,y:t.y??t.Y,z:t.z??t.Z};if(Object.values(n).some(o=>o!=null&&String(o).trim()!==""))i=n;else return[]}if(Array.isArray(i)){const n=i.slice(0,4).map((c,l)=>{const u=a(c);return u?[s[l],u]:null}).filter(Boolean),o=new Map(n);return s.map(c=>[c,o.get(c)]).filter(([,c])=>c!=null)}if(i&&typeof i=="object"){const n=Object.entries(i).map(([c,l])=>{const u=a(l),d=r(c);return!u||!d?null:[d,u]}).filter(Boolean),o=new Map(n);return s.map(c=>[c,o.get(c)]).filter(([,c])=>c!=null)}return[]}function Go(t){if(!t)return"";const s=String(t).toUpperCase();return s.startsWith("PHYS")?"P":s.startsWith("CHEM")?"C":s.startsWith("BIO")?"B":s.startsWith("MATH")?"M":s.startsWith("EARTH")?"E":s.startsWith("ASTRO")?"A":s.startsWith("ENERG")?"EN":s.startsWith("GEN")?"G":s[0]}async function Ho(){return typeof window<"u"&&window.html2pdf||await new Promise((t,s)=>{const r=document.querySelector("script[data-html2pdf]");if(r){r.addEventListener("load",()=>t()),r.addEventListener("error",()=>s(new Error("Failed to load html2pdf.js")));return}const a=document.createElement("script");a.src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js",a.async=!0,a.defer=!0,a.setAttribute("data-html2pdf","true"),a.onload=()=>t(),a.onerror=()=>s(new Error("Failed to load html2pdf.js")),document.head.appendChild(a)}),window.html2pdf}function ji({questions:t=[],lazy:s=null}){const r=!!s,[a,i]=h.useState([]),[n,o]=h.useState([]),[c,l]=h.useState(()=>new Set),u=h.useMemo(()=>[...r?s.tournaments||[]:xn(t.map(S=>S.tournament))].filter(Boolean).sort((S,T)=>String(S).localeCompare(String(T))),[r,s,t]),d=h.useRef([]),m=h.useRef([]),v=h.useRef(null),p=h.useRef(null);function z(M,S,T="main"){const R=M?.nativeEvent?.shiftKey||M?.shiftKey,B=(T==="modal"?m.current:d.current)||[],K=B.findIndex(V=>V?.type==="key"&&V.key===S),W=a.includes(S),te=!W,L=T==="modal"?p:v;if(R&&L.current!=null&&K!==-1&&L.current!==K){const[V,q]=[L.current,K].sort(($,se)=>$-se),J=B.slice(V,q+1),ae=[],ke=new Set(J.filter($=>$&&$.type==="key"&&$.base).map($=>$.base));J.forEach($=>{$&&($.type==="key"&&$.key?ae.push($.key):$.type==="group"&&Array.isArray($.keys)&&(ke.has($.base)||$.keys.forEach(se=>ae.push(se))))}),i($=>{const se=new Set($);return te?ae.forEach(be=>se.add(be)):ae.forEach(be=>se.delete(be)),Array.from(se)}),L.current=K}else i(V=>{const q=new Set(V);return W?q.delete(S):q.add(S),Array.from(q)}),L.current=K}const x=h.useMemo(()=>{const M=new Map;for(const S of u){if(!S)continue;const[T,R]=String(S).split("-"),B=T||S,K=R&&/\d{4}/.test(R)?R:null;M.has(B)||M.set(B,{base:B,years:[],all:[]});const W=M.get(B);W.all.push(S),K?W.years.push({label:S,year:Number(K)||K,key:S}):W.years.push({label:S,year:null,key:S})}for(const S of M.values())S.years.sort((T,R)=>String(T.label).localeCompare(String(R.label)));return Array.from(M.values()).sort((S,T)=>S.base.localeCompare(T.base))},[u]);h.useEffect(()=>{r&&a.length!==0&&s.ensureLoaded(a)},[r,s,a]);const C=h.useMemo(()=>(r?s.getLoadedQuestions(a):t).map(M=>{let S=M.category;if(typeof S=="string"){const T=S.trim();S=T?T.toUpperCase():null}return{...M,category:S}}),[r,s,a,t]),g=h.useMemo(()=>C.filter(M=>M.category!=null&&String(M.category).trim()!==""),[C]),j=h.useMemo(()=>xn(g.map(M=>M.category)),[g]),[w,A]=h.useState([]),b=h.useMemo(()=>{const M=new Map,S=C;for(const R of S){const B=R.tournament,K=R.round;if(B==null||K==null)continue;const W=M.get(B)??[],te=String(K);W.includes(te)||W.push(te),M.set(B,W)}const T={};for(const[R,B]of M.entries())T[R]=[...B].sort((K,W)=>String(K).localeCompare(String(W)));return T},[C]),N=h.useMemo(()=>{let M=0;for(const S of C){const T=S.round;if(T!=null&&/^\d+$/.test(String(T))){const R=Number(T);R>M&&(M=R)}}return M||30},[C]);h.useEffect(()=>{if(a.length===1){const M=a[0];A(S=>{let T=!1;const R=S.map(B=>B.tournament!==M?(T=!0,{...B,tournament:M}):B);return T?R:S})}},[a]);function k(M){return!w.length||M?.round==null?!0:w.some(({from:S,to:T,tournament:R,dFrom:B,dTo:K})=>{const W=a.length===1?a[0]:R||null;if(!(!W||M.tournament===W))return!1;if(W){const V=b[W]??[];if(V.length>0&&V.every(J=>/^\d+$/.test(J))){const J=Number(M.round);return J>=Number(S)&&J<=Number(T)}else{if(!V.length)return!0;const J=V.indexOf(String(M.round));if(J===-1)return!1;const ae=B?V.indexOf(B):0,ke=K?V.indexOf(K):V.length-1,[$,se]=[ae,ke].sort((be,Ye)=>be-Ye);return J>=$&&J<=se}}const L=Number(M.round);return Number.isNaN(L)?!1:L>=Number(S)&&L<=Number(T)})}return{isLazy:r,tournaments:u,tournamentGroups:x,selectedTournaments:a,setSelectedTournaments:i,selectedCategories:n,setSelectedCategories:o,tournamentGroupsOpen:c,setTournamentGroupsOpen:l,tournamentVisibleEntriesMainRef:d,tournamentVisibleEntriesModalRef:m,lastTournamentClickIndexMainRef:v,lastTournamentClickIndexModalRef:p,handleTournamentToggle:z,loadedQuestions:C,validQuestions:g,categories:j,roundRanges:w,setRoundRanges:A,roundsByTournament:b,globalNumericRoundMax:N,inRanges:k}}function Ni({room:t,roomId:s,membersCount:r,onBack:a,members:i,currentQ:n,answersMap:o}){const[c,l]=h.useState(!1),u=i.filter(m=>m.online!==!1),d=i.filter(m=>m.online===!1);return e.jsxs("div",{className:"glass p-4 flex items-start justify-between",children:[e.jsxs("div",{className:"flex gap-6 flex-1 min-w-0",children:[e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("div",{className:"text-sm opacity-70",children:"Room"}),e.jsx("div",{className:"text-xl font-semibold",children:t?.name||s}),e.jsxs("div",{className:"text-sm opacity-70",children:["Participants: ",r]})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Players"}),e.jsx("div",{className:"grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))] gap-x-4 gap-y-1 max-h-32 overflow-y-auto",children:u.map(m=>e.jsxs("div",{className:"flex items-center justify-between gap-2 text-sm min-w-0",children:[e.jsxs("span",{className:"truncate pr-2 flex-1 flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"truncate",children:m.displayName||m.uid}),m.lastQuestionId===n?.id&&m.lastAnswerStatus&&e.jsx("span",{className:`ml-2 text-xs rounded px-2 py-0.5 flex-shrink-0 ${m.lastAnswerStatus==="correct"?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200":m.lastAnswerStatus==="incorrect"?"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200":"bg-black/10 dark:bg-white/10 text-black/70 dark:text-white/70"}`,children:m.lastAnswerStatus})]}),e.jsx("span",{className:"font-semibold tabular-nums flex-shrink-0",children:m.score||0})]},m.uid))}),d.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("button",{className:"text-sm font-medium text-black/60 dark:text-white/60 hover:text-black dark:hover:text-white flex items-center gap-1",onClick:()=>l(!c),children:[e.jsxs("span",{children:["Disconnected (",d.length,")"]}),e.jsx("svg",{className:`w-4 h-4 transition-transform ${c?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),c&&e.jsx("div",{className:"mt-1 grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))] gap-x-4 gap-y-1 max-h-24 overflow-y-auto",children:d.map(m=>e.jsxs("div",{className:"flex items-center justify-between gap-2 text-sm min-w-0 opacity-60",children:[e.jsxs("span",{className:"truncate pr-2 flex-1 flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"truncate",children:m.displayName||m.uid}),e.jsx("span",{className:"text-xs rounded px-2 py-0.5 bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200 flex-shrink-0",children:"disconnected"}),m.lastQuestionId===n?.id&&m.lastAnswerStatus&&e.jsx("span",{className:`ml-2 text-xs rounded px-2 py-0.5 flex-shrink-0 ${m.lastAnswerStatus==="correct"?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200":m.lastAnswerStatus==="incorrect"?"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200":"bg-black/10 dark:bg-white/10 text-black/70 dark:text-white/70"}`,children:m.lastAnswerStatus})]}),e.jsx("span",{className:"font-semibold tabular-nums flex-shrink-0",children:m.score||0})]},m.uid))})]})]})]}),e.jsx("div",{className:"flex gap-2 ml-4",children:e.jsx("button",{className:"btn btn-ghost",onClick:a,children:"Back"})})]})}function ki({onStartNext:t,onTogglePause:s,isPaused:r,winnerActive:a,buzzWindowRemainingMs:i,showBuzzTimer:n}){return e.jsxs("div",{className:"font-semibold flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{children:"Play"}),n&&i!==null&&e.jsxs("div",{className:"inline-flex items-center px-3 py-1.5 rounded-xl bg-blue-600 text-white text-lg font-bold shadow-sm",children:[Math.ceil(Math.max(0,i)/1e3),"s"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"chip",onClick:t,children:"Start/Next"}),e.jsx("button",{className:"chip",onClick:s,disabled:!!a,children:r?"Resume (P)":"Pause (P)"})]})]})}function Si({passPrompt:t,setPassPrompt:s,onJoin:r,busy:a,error:i}){return e.jsxs("div",{className:"glass p-6 space-y-3 max-w-md",children:[e.jsx("div",{className:"font-medium",children:"This room is private"}),e.jsx("input",{className:"rounded-lg border border-black/10 dark:border-white/10 px-3 py-2 bg-white dark:bg-darkcard w-full",placeholder:"Enter passcode",value:t,onChange:n=>s(n.target.value)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-primary",onClick:r,disabled:a||!t,children:"Join"}),i&&e.jsx("div",{className:"text-sm text-red-600",children:i})]})]})}function Ai(){return e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("svg",{width:"40",height:"40",viewBox:"0 0 40 40",className:"animate-spin",children:[e.jsx("path",{d:"M20 5 Q25 10 20 15 Q15 20 20 25 Q25 30 20 35",stroke:"#3b82f6",strokeWidth:"2",fill:"none",className:"animate-pulse"}),e.jsx("path",{d:"M20 5 Q15 10 20 15 Q25 20 20 25 Q15 30 20 35",stroke:"#3b82f6",strokeWidth:"2",fill:"none",className:"animate-pulse",style:{animationDelay:"0.5s"}})]})})}function zi({grading:t,currentQ:s,words:r,displayedWordCount:a,plainQuestionText:i,showBuzzHint:n,fullMcChoices:o,choiceStreamCount:c,resultBanner:l}){return e.jsx("div",{className:"rounded-lg bg-black/5 dark:bg-white/10 p-4 min-h-32 text-black dark:text-white",children:t?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ai,{}),e.jsx("span",{className:"ml-4 text-lg font-semibold",children:"Checking answer..."})]})}):s?e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-black/60 dark:text-white/80 mb-2 flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-semibold",children:String(s.tournament).toUpperCase()})," • ","ROUND ",s.round??"—"," • ",s.category," • ",e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold ${String(s?.question_type||"").toLowerCase()==="bonus"?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-100":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-100"}`,children:String(s?.question_type||"").toLowerCase()==="bonus"?"BONUS":"TOSS-UP"})," • ",e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold ${(o||[]).length>0?"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-100":"bg-pink-100 text-pink-800 dark:bg-pink-900/30 dark:text-pink-100"}`,children:(o||[]).length>0?"MULTIPLE CHOICE":"SHORT ANSWER"})]}),a>=r.length?e.jsx("div",{className:"text-base whitespace-pre-line text-black dark:text-white",children:e.jsx(Ue,{children:i})}):e.jsxs("div",{className:"text-base whitespace-pre-line text-black dark:text-white",children:[e.jsx(Ue,{children:r.slice(0,Math.min(a,r.length)).join(" ")}),n&&e.jsx("div",{className:"mt-2 text-xs opacity-70 text-black dark:text-white",children:"Press Space to buzz"})]}),(o||[]).length>0&&e.jsx("div",{className:"mt-4 space-y-2 text-base text-black dark:text-white",children:o.map(([u,d],m)=>e.jsxs("div",{className:"practice-katex text-black dark:text-white",children:[e.jsxs("span",{className:"font-semibold mr-1 text-black dark:text-white",children:[u.toUpperCase(),")"]}),m<c&&d?e.jsx(Ue,{children:d}):e.jsx("span",{className:"opacity-50",children:"…"})]},u))}),l&&e.jsxs("div",{className:`mt-3 rounded-lg px-3 py-2 ${l.correct?"bg-green-100 text-green-900 dark:bg-green-900/20 dark:text-green-100":"bg-red-100 text-red-900 dark:bg-red-900/20 dark:text-red-100"}`,children:[l.correct?"Correct":"Incorrect",l.reason?` — ${l.reason}`:""]})]}):e.jsx("div",{className:"opacity-70 text-sm",children:"No question selected yet."})})}function Ci({currentQId:t,buzzes:s,answersForQ:r,selfUid:a,members:i,typingMap:n,winnerUid:o,awaitNext:c,mcTypedAnswer:l,setMcTypedAnswer:u,onSubmit:d,onUpdateTyping:m,mcInputRef:v,answerWindowUid:p,answerWindowRemainingMs:z}){return!t||!Array.isArray(s)||s.length===0?null:e.jsx("div",{className:"mt-2 space-y-2",children:s.slice().reverse().map((x,C,g)=>{const j=o===x.uid&&C===0,w=r?.[x.uid]||null,A=!!w,b=!!w?.correct,N=a===x.uid,k=n?.[x.uid]?.draft||i.find(R=>R.uid===x.uid)?.draft||"",M=x.displayName||i.find(R=>R.uid===x.uid)?.displayName||x.uid,S=j&&!A&&p===x.uid,T=S&&Number.isFinite(z)?Math.ceil(Math.max(0,z)/1e3):null;return e.jsx("div",{className:"rounded-lg bg-black/5 dark:bg-white/10 p-3",children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-semibold text-black dark:text-white",children:M}),e.jsx("span",{className:"chip text-xs bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200",children:"buzzed"}),e.jsxs("span",{className:"text-[10px] opacity-60",children:["#",g.length-C]}),A?e.jsx("span",{className:"ml-2 px-2 py-1 rounded bg-black/10 dark:bg-white/10 text-sm whitespace-pre-wrap break-words",children:w?.text||""}):j?N?e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-[240px]",children:[e.jsx("form",{onSubmit:d,className:"flex-1",children:e.jsx("input",{className:"rounded-lg border border-black/10 dark:border-white/10 px-3 py-1.5 bg-white dark:bg-darkcard w-full",placeholder:"Type your answer and press Enter",value:l,onChange:R=>{u(R.target.value),m(!!R.target.value,String(R.target.value).slice(0,200))},ref:v,autoFocus:!0})}),S&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded bg-black/10 dark:bg-white/10 text-[11px] font-semibold",children:[T,"s"]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"ml-2 text-sm text-black/80 dark:text-white/80 whitespace-pre-wrap break-words",children:k}),S&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded bg-black/10 dark:bg-white/10 text-[11px] font-semibold",children:[T,"s"]})]}):null,A&&e.jsx("span",{className:`chip text-xs ${b?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200"}`,children:b?"correct":"incorrect"}),c&&b&&j&&e.jsx("span",{className:"ml-2 text-xs opacity-70",children:"Press ‘n’ for next"})]})},x.id||`${x.uid}-${C}`)})})}function Ei({history:t,page:s,setPage:r,pageSize:a,byId:i,buzzesMap:n,answersMap:o,members:c}){return!Array.isArray(t)||t.length===0?null:e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold text-black/60 dark:text-white/60",children:"Previous Questions"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("button",{className:"chip",disabled:s<=0,onClick:()=>r(l=>Math.max(0,l-1)),children:"Prev"}),e.jsxs("span",{className:"opacity-70",children:["Page ",s+1]}),e.jsx("button",{className:"chip",disabled:(s+1)*a>=t.length,onClick:()=>r(l=>l+1),children:"Next"})]})]}),t.slice(s*a,s*a+a).map((l,u)=>{const d=i.get(l.questionId)||{id:l.questionId};return e.jsxs("details",{className:"rounded-lg bg-black/5 dark:bg-white/10",children:[e.jsx("summary",{className:"cursor-pointer px-3 py-2 text-sm",children:d.tournament?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold",children:String(d.tournament).toUpperCase()})," • Round ",d.round," • ",d.category,d.question_number&&e.jsxs(e.Fragment,{children:[" • Q",d.question_number]})," • ",e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold ${String(d?.question_type||"").toLowerCase()==="bonus"?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-100":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-100"}`,children:String(d?.question_type||"").toLowerCase()==="bonus"?"BONUS":"TOSS-UP"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"font-semibold",children:["Question ",d.id]}),e.jsx("span",{className:"ml-2 opacity-70",children:"(Load tournaments to view details)"})]})}),d.question&&e.jsx("div",{className:"px-3 pb-3 whitespace-pre-wrap",children:e.jsx(Ue,{children:d.question})}),(()=>{const m=Ms(d);return m.length>0&&e.jsx("div",{className:"px-3 pb-3 space-y-1",children:m.map(([v,p])=>e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"font-semibold mr-2",children:[v.toUpperCase(),")"]}),e.jsx(Ue,{children:p})]},v))})})(),e.jsx("div",{className:"px-3 pb-1 flex items-center gap-2",children:e.jsx("span",{className:"text-xs uppercase tracking-wide text-black/60 dark:text-white/60",children:"ANSWER"})}),d.answer&&e.jsx("div",{className:"px-3 pb-3",children:e.jsx(Ue,{children:String(d.answer).toUpperCase()})}),d.id&&Array.isArray(n[d.id])&&n[d.id].length>0&&e.jsxs("div",{className:"px-3 pb-3 space-y-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-black/60 dark:text-white/60",children:"Buzz History"}),n[d.id].slice().reverse().map((m,v,p)=>{const z=o?.[d.id]?.[m.uid]||null,x=!!z?.correct,C=m.displayName||c.find(g=>g.uid===m.uid)?.displayName||m.uid;return e.jsxs("div",{className:"text-sm flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium",children:C}),e.jsx("span",{className:"chip text-xs bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200",children:"buzzed"}),e.jsxs("span",{className:"text-[10px] opacity-60",children:["#",p.length-v]}),z?.text&&e.jsx("span",{className:"ml-2 px-2 py-0.5 rounded bg-black/10 dark:bg-white/10 whitespace-pre-wrap break-words",children:z.text}),z&&e.jsx("span",{className:`chip text-xs ${x?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-200"}`,children:x?"correct":"incorrect"})]},m.id||`${m.uid}-${v}`)})]})]},l.id||l.questionId||u)})]})}function Mi({roomId:t,messages:s,typingMap:r,selfUid:a,onSendMessage:i,onUpdateTyping:n,disabled:o,inputRef:c}){const[l,u]=h.useState(""),d=h.useRef(null),[m,v]=h.useState(!0),p=h.useRef(null),z=h.useRef(null),x=(b=!0,N=180)=>{try{const k=d.current;if(!k)return;const M=k.scrollHeight;if(!b){k.scrollTop=M,v(!0);return}if(z.current){try{cancelAnimationFrame(z.current)}catch{}z.current=null}const S=k.scrollTop,T=M-S;if(Math.abs(T)<1){v(!0);return}const R=performance.now(),B=Math.max(60,Math.min(400,N)),K=te=>1-Math.pow(1-te,3),W=te=>{const L=te-R,V=Math.min(1,L/B),q=K(V);k.scrollTop=S+T*q,V<1?z.current=requestAnimationFrame(W):(z.current=null,v(!0))};z.current=requestAnimationFrame(W),v(!0)}catch{}};h.useEffect(()=>{try{const b=d.current;if(!b)return;(b.scrollHeight-b.scrollTop-b.clientHeight<=48||m)&&x(!0,140)}catch{}},[s?.length,m]),h.useEffect(()=>{const b=setTimeout(()=>x(!0,160),0);return()=>clearTimeout(b)},[]);const C=h.useMemo(()=>{const b=[];return Object.values(r||{}).forEach(N=>{!N||!N.typing||N.draft&&N.uid!==a&&b.push({uid:N.uid,name:N.displayName||N.uid,draft:String(N.draft||"")})}),b},[JSON.stringify(r),a]),g=h.useMemo(()=>Array.isArray(s)?s:[],[s]),j=()=>{try{const b=d.current;if(!b)return;const k=b.scrollHeight-b.scrollTop-b.clientHeight<=48;v(k),k?p.current&&(clearTimeout(p.current),p.current=null):(p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{x(!0,220)},2e3))}catch{}},w=b=>{const N=b.target.value;u(N),n?.(!!N,String(N).slice(0,200))},A=async b=>{b?.preventDefault?.();const N=String(l||"").trim();if(N)try{try{n?.(!1,"")}catch{}await i?.(N)}finally{u("")}};return e.jsxs("div",{className:"flex flex-col h-[520px] max-h-[60vh]",children:[e.jsxs("div",{ref:d,onScroll:j,className:"relative flex-1 overflow-y-auto pr-1 pb-10 space-y-2",children:[g.map((b,N)=>{const k=b.uid===a,M=String(b.text||""),S=b.displayName||b.uid;return e.jsx("div",{className:`flex ${k?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[75%] px-3 py-2 rounded-2xl text-sm whitespace-pre-wrap break-words ${k?"bg-blue-600 text-white rounded-br-md":"bg-black/5 dark:bg-white/10 text-black dark:text-white rounded-bl-md"}`,children:[!k&&e.jsx("div",{className:"text-[10px] opacity-70 mb-0.5",children:S}),e.jsx("div",{children:M})]})},b.id||`${b.uid}-${N}`)}),C.length>0&&e.jsx("div",{className:"pointer-events-none absolute bottom-2 left-0 right-0 px-1 space-y-1 z-20",children:C.map(b=>e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"pointer-events-none max-w-[75%] px-3 py-2 rounded-2xl text-sm whitespace-pre-wrap break-words bg-black/70 dark:bg-white/20 text-white rounded-bl-md border border-dashed border-white/20 shadow",children:[e.jsxs("div",{className:"text-[10px] opacity-80 mb-0.5",children:[b.name," (typing…)"]}),e.jsx("div",{children:b.draft})]})},`live-${b.uid}`))})]}),e.jsx("form",{onSubmit:A,className:"pt-2",children:e.jsx("textarea",{ref:c,disabled:o,rows:2,className:"w-full rounded-lg border border-black/10 dark:border-white/10 px-3 py-2 bg-white dark:bg-darkcard disabled:opacity-60 resize-y min-h-[44px]",placeholder:o?"Chat disabled while you are answering":"Type a message… (Enter to send, Shift+Enter for newline)",value:l,onChange:w,onBlur:()=>{try{n?.(!1,"")}catch{}},onKeyDown:b=>{if(b.key==="Enter"&&b.shiftKey){b.stopPropagation();return}b.key==="Enter"&&!b.shiftKey&&(b.preventDefault(),A())}})})]})}function _i(){async function t(){if(!n?.state?.buzzerOpen)return;const y=ve(),E=y?.uid,_=y?.displayName||"Player";x(!0);try{await ai({roomId:s,uid:E,displayName:_})}finally{x(!1)}}const{roomId:s}=Kt(),r=Ts(),a=$e(),i=Ne(),[n,o]=h.useState(null),c=I.useCallback(y=>{o(E=>JSON.stringify(E)===JSON.stringify(y)?E:y)},[]),[l,u]=h.useState([]),d=I.useCallback(y=>{u(E=>JSON.stringify(E)===JSON.stringify(y)?E:y)},[]),[m,v]=h.useState([]),p=I.useCallback(y=>{v(E=>JSON.stringify(E)===JSON.stringify(y)?E:y)},[]),[z,x]=h.useState(!1),[C,g]=h.useState(""),[j,w]=h.useState(""),[A,b]=h.useState(""),[N,k]=h.useState(!1),[M,S]=h.useState(!1),[T,R]=h.useState(""),[B,K]=h.useState("");h.useRef(null);const W=Qt(),te=ve(),L=te?.uid||null;te?.displayName;const[V,q]=h.useState(""),[J,ae]=h.useState({selectedTournaments:[],selectedCategories:[],roundRanges:[]}),ke=I.useCallback(y=>{ae(E=>JSON.stringify(E)===JSON.stringify(y)?E:y)},[]),[$,se]=h.useState([]),[be,Ye]=h.useState("settings"),[zt,es]=h.useState(()=>Date.now()),[Ge,Ct]=h.useState(0),[Oe,ts]=h.useState(0),ss=10,[Xe,Ze]=h.useState(null),ns=!!n?.state?.grading,[Et,rs]=h.useState({}),[Mt,as]=h.useState({}),[ce,_t]=h.useState({}),[is,et]=h.useState(0),[we,U]=h.useState(0),[f,D]=h.useState(!1),[F,G]=h.useState(""),[Q,ue]=h.useState(0),[me,Le]=h.useState({tossup:!0,bonus:!0});h.useRef(null);const tt=h.useRef(null),Is=h.useRef(null);h.useEffect(()=>{if(s)return Za({roomId:s,onRoom:c,onMembers:d,onMessages:p,onSettings:ke,onAnswers:_t})},[s,c,d,p,ke]),h.useEffect(()=>{if(!s||!i?.user)return;const y=qa();!y||!l.some(_=>_.uid===y.uid)||(async()=>{try{await ri({roomId:s,uid:y.uid})}catch{}try{Ha()}catch{}})()},[s,i?.user?.uid,JSON.stringify(l.map(y=>y.uid))]),h.useEffect(()=>{if(s)return ti({roomId:s,onTyping:y=>{rs(E=>({...E,[y.uid]:y}))}})},[s]),h.useEffect(()=>{if(s)return ei({roomId:s,onBuzzes:as})},[s]),h.useEffect(()=>{const y=L;if(!s||!y)return;const E=Vt(),_=oe(E,`mp/roomMembers/${s}/${y}`);try{Hr(_).update({online:!1,lastSeenAt:qr()})}catch{}return(async()=>{try{await re(_,{online:!0,lastSeenAt:Date.now()})}catch{}})(),()=>{try{re(_,{online:!1,lastSeenAt:Date.now()})}catch{}}},[s,L]),h.useEffect(()=>{if(s)return mi({roomId:s,onHistory:se})},[s]),h.useEffect(()=>{const y=setInterval(()=>ue(E=>(E+1)%1e6),200);return()=>clearInterval(y)},[]);const Us=String(n?.game?.currentId||"")||"",os=h.useMemo(()=>{const y=Us.match(/^([^_]+)__[^_]+__(?:tu|bo)__\d+$/i);return y?y[1]:null},[Us]),Be=h.useMemo(()=>{const y=Array.isArray(J?.selectedTournaments)&&J.selectedTournaments.length?J.selectedTournaments:[],E=Array.isArray(n?.game?.tournaments)?n.game.tournaments:[],_=new Set([...y||[],...E||[]]);return os&&_.add(os),Array.from(_)},[JSON.stringify(J?.selectedTournaments||[]),JSON.stringify(n?.game?.tournaments||[]),os]);h.useEffect(()=>{!Be||Be.length===0||(async()=>{try{await W.ensureLoaded(Be)}catch{}})()},[JSON.stringify(Be)]);const $s=I.useMemo(()=>W.getLoadedQuestions(Be),[W,JSON.stringify(Be)]),Ws=I.useMemo(()=>{const y=new Map;for(const E of $s)y.set(E.id,E);return y},[$s]),O=n?.game?.currentId&&Ws.get(n.game.currentId)||null,ht=I.useMemo(()=>{const E=ve()?.uid;return E?l.some(_=>_.uid===E):!1},[l,i?.user?.uid]),{tournamentGroups:Un,selectedTournaments:Me,setSelectedTournaments:Gs,selectedCategories:Pe,setSelectedCategories:Hs,tournamentGroupsOpen:$n,setTournamentGroupsOpen:Wn,tournamentVisibleEntriesMainRef:Gn,handleTournamentToggle:Hn,categories:qn,roundRanges:ft,setRoundRanges:qs,roundsByTournament:Jn,globalNumericRoundMax:Kn,inRanges:Vn}=ji({questions:[],lazy:W}),[Qn,Yn]=h.useState(!1),[Xn,Zn]=h.useState(()=>{try{return document.documentElement.classList.contains("dark")}catch{return!1}});h.useEffect(()=>{try{const y=document.documentElement,E=()=>Zn(y.classList.contains("dark"));E();const _=new MutationObserver(E);_.observe(y,{attributes:!0,attributeFilter:["class"]});const P=window.matchMedia("(prefers-color-scheme: dark)");return P.addEventListener("change",E),()=>{_.disconnect(),P.removeEventListener("change",E)}}catch{}},[]);const cs=I.useRef(!1),Rt=()=>{cs.current=!0},er=y=>{Gs(y),Rt()},tr=y=>{Hs(y),Rt()},sr=y=>{qs(y),Rt()},Js=y=>{const E=typeof y=="function"?y(me):y;Le(E),Rt()},ls=JSON.stringify(J);h.useEffect(()=>{try{const y=JSON.parse(ls||"{}");if(Array.isArray(y.selectedTournaments)&&JSON.stringify(y.selectedTournaments)!==JSON.stringify(Me)&&Gs(y.selectedTournaments),Array.isArray(y.selectedCategories)&&JSON.stringify(y.selectedCategories)!==JSON.stringify(Pe)&&Hs(y.selectedCategories),Array.isArray(y.roundRanges)&&JSON.stringify(y.roundRanges)!==JSON.stringify(ft)&&qs(y.roundRanges),y.selectedTypes&&(y.selectedTypes.tossup!==void 0||y.selectedTypes.bonus!==void 0)){const E={tossup:y.selectedTypes.tossup??!0,bonus:y.selectedTypes.bonus??!0};JSON.stringify(E)!==JSON.stringify(me)&&Le(E)}}catch{}},[ls]),h.useEffect(()=>{if(!s)return;const y={selectedTournaments:Array.isArray(Me)?Me:[],selectedCategories:Array.isArray(Pe)?Pe:[],roundRanges:Array.isArray(ft)?ft:[],selectedTypes:me||{tossup:!0,bonus:!0}};if(!cs.current||(()=>{try{const P=J||{};return JSON.stringify(P.selectedTournaments||[])===JSON.stringify(y.selectedTournaments)&&JSON.stringify(P.selectedCategories||[])===JSON.stringify(y.selectedCategories)&&JSON.stringify(P.roundRanges||[])===JSON.stringify(y.roundRanges)&&JSON.stringify(P.selectedTypes||{})===JSON.stringify(y.selectedTypes)}catch{return!1}})())return;const _=setTimeout(()=>{ni({roomId:s,patch:y}),cs.current=!1},200);return()=>clearTimeout(_)},[s,JSON.stringify(Me),JSON.stringify(Pe),JSON.stringify(ft),JSON.stringify(me),ls]),h.useEffect(()=>{if(!n)return;const y=ve();if(!y&&!i?.user){S(!0);return}(async()=>{try{const E=`mp_pass_ok_${s}`,_=typeof window<"u"?window.localStorage.getItem(E)==="1":!1,P=r?.state?.passcode?String(r.state.passcode).trim():"";if(n.isPrivate&&!ht&&!_)if(P){await wt({roomId:s,passcode:P,uid:y?.uid,displayName:y?.displayName});try{window.localStorage.setItem(E,"1"),n?.passHash&&window.localStorage.setItem(`mp_pass_hash_${s}`,String(n.passHash))}catch{}k(!1)}else k(!0);else ht||await wt({roomId:s,uid:y?.uid,displayName:y?.displayName})}catch(E){g(E?.message||String(E))}})()},[!!n,i?.user?.uid,ht]),h.useEffect(()=>{const y=E=>{try{Ss(s,!1,"")}catch{}};return window.addEventListener("beforeunload",y),()=>window.removeEventListener("beforeunload",y)},[s]);const ds=h.useMemo(()=>String(O?.question||O?.text||""),[O?.id]),pt=h.useMemo(()=>ds.split(/\s+/).filter(Boolean),[ds]),He=is>=pt.length;String(O?.question_type||"").toLowerCase();const Se=h.useMemo(()=>Ms(O),[O?.id]),nr=h.useMemo(()=>{if(!Array.isArray(Se)||Se.length===0)return[];const y=new Map(Se);return["w","x","y","z"].map(E=>[E,y.get(E)])},[Se]);h.useEffect(()=>{et(0),U(0),D(!1),G(""),Ze(null)},[O?.id]),h.useEffect(()=>{function y(_){return _&&(_.tagName==="INPUT"||_.tagName==="TEXTAREA"||_.isContentEditable)}const E=_=>{const P=_.key;if(P===" "||P==="Spacebar"){if(!y(_.target)){const ie=ve()?.uid,he=n?.state?.lockedOut&&typeof n.state.lockedOut=="object"?n.state.lockedOut:{};!!O&&!!n?.state?.buzzerOpen&&!n?.state?.winnerUid&&(!ie||!he[ie])&&(_.preventDefault(),t())}}else String(P).toLowerCase()==="p"&&(y(_.target)||(_.preventDefault(),Qs()))};return window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)},[n?.state?.buzzerOpen,n?.state?.winnerUid,n?.state?.lockedOut,!!O]),h.useEffect(()=>{const y=_=>{if(!_)return!1;const P=(_.tagName||"").toUpperCase();return P==="INPUT"||P==="TEXTAREA"||_.isContentEditable},E=_=>{if(_.altKey||_.ctrlKey||_.metaKey||_.shiftKey||String(_.key)!=="Enter")return;const P=_.target||document.activeElement;y(P)||L&&n?.state?.winnerUid===L||(_.preventDefault(),Ye("chat"),setTimeout(()=>{try{Is.current?.focus?.()}catch{}},0))};return window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)},[L,n?.state?.winnerUid]),h.useEffect(()=>{const y=Array.isArray(m)?m:[];if(be==="chat"){const P=y.reduce((ne,ie)=>Math.max(ne,Number(ie.createdAt||0)),0);es(P||Date.now()),Ge!==0&&Ct(0);return}const E=Number(zt||0),_=y.reduce((P,ne)=>P+(Number(ne.createdAt||0)>E&&ne.uid!==L?1:0),0);_!==Ge&&Ct(_)},[be,m,zt,L]);const Ks=!!(L&&n?.state?.winnerUid===L);h.useEffect(()=>{if(!O||!Ks||!!(L&&ce?.[O.id]?.[L]))return;const E=tt.current;E&&typeof E.focus=="function"&&setTimeout(()=>{try{E.focus(),E.select?.()}catch{}},0)},[Ks,O?.id,ce,L]),h.useEffect(()=>{const y=_=>{if(!_)return!1;const P=(_.tagName||"").toUpperCase();return P==="INPUT"||P==="TEXTAREA"||_.isContentEditable},E=_=>{if(_.altKey||_.ctrlKey||_.metaKey)return;const P=_.target||document.activeElement;if(y(P))return;String(_.key||"").toLowerCase()==="n"&&(_.preventDefault(),cr())};return window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)},[O?.id]),h.useEffect(()=>{if(!O)return;const y=Number(n?.state?.perWordMs||200),E=Number(n?.state?.streamedWordsBase||0),_=Number(n?.state?.streamStartAt||0)||null;let P=null;const ne=()=>{const ie=Ae(),he=_?Math.max(0,Math.floor((ie-_)/Math.max(1,y))):0,Fe=Math.min(pt.length,E+he);n?.state?.awaitNext?et(pt.length):et(Fe)};return!n?.state?.awaitNext&&n?.state?.buzzerOpen&&!n?.state?.winnerUid&&(P=setInterval(ne,80)),ne(),()=>{P&&clearInterval(P)}},[O?.id,pt.length,n?.state?.buzzerOpen,n?.state?.winnerUid,n?.state?.perWordMs,n?.state?.streamedWordsBase,n?.state?.streamStartAt,n?.state?.awaitNext]),h.useEffect(()=>{if(!O||Se.length===0||!He)return;const y=Number(n?.state?.perChoiceMs||400);if(!Number(n?.state?.stemFinishedAt||0))return;if(n?.state?.awaitNext){we<4&&U(4);return}if(n?.state?.winnerUid||!n?.state?.buzzerOpen||we>=4)return;const _=setInterval(()=>{U(P=>Math.min(4,P+1))},y);return()=>clearInterval(_)},[O?.id,Se.length,He,n?.state?.winnerUid,n?.state?.buzzerOpen,n?.state?.perChoiceMs,n?.state?.stemFinishedAt,n?.state?.awaitNext,we]),h.useEffect(()=>{if(!O||Se.length===0||!Xe||!Xe.correct||we>=4)return;f||D(!0);const y=setInterval(()=>U(E=>E<4?E+1:4),150);return()=>clearInterval(y)},[Xe,O?.id,Se.length,we,f]),h.useEffect(()=>{O&&He&&(n?.state?.stemFinishedAt||(async()=>{try{await ci({roomId:s,at:Ae()})}catch{}})())},[He,O?.id,!!n?.state?.stemFinishedAt]),h.useEffect(()=>{!O||!He||n?.state?.choicesFinishedAt||!(!(Array.isArray(Se)&&Se.length>0)||we>=4)||(async()=>{try{await li({roomId:s,at:Ae()})}catch{}})()},[O?.id,He,we,!!n?.state?.choicesFinishedAt]);const us=Number(n?.state?.buzzWindowMs||0)||0,ms=Number(n?.state?.buzzWindowStartAt||0)||0,xt=h.useMemo(()=>{if(!us||!ms)return null;const y=us-Math.max(0,Ae()-ms);return Math.max(0,y)},[us,ms,Q]),st=n?.state?.answerWindowUid||null,hs=Number(n?.state?.answerWindowDeadlineAt||0)||0,Tt=h.useMemo(()=>!st||!hs?null:Math.max(0,hs-Ae()),[st,hs,Q]);h.useEffect(()=>{O&&n?.state?.buzzerOpen&&(n?.state?.winnerUid||n?.state?.awaitNext||xt!==null&&(xt>0||(async()=>{try{await rt({roomId:s,open:!1})}catch{}})()))},[xt,!!O,n?.state?.buzzerOpen,n?.state?.winnerUid,n?.state?.awaitNext]),h.useEffect(()=>{O&&n?.state?.buzzerOpen&&n?.state?.choicesFinishedAt&&(n?.state?.buzzWindowStartAt||(async()=>{try{await rt({roomId:s,open:!0})}catch{}})())},[!!O,n?.state?.buzzerOpen,n?.state?.choicesFinishedAt,n?.state?.buzzWindowStartAt]),h.useEffect(()=>{if(!O)return;const y=n?.state?.winnerUid;!y||!st||y!==st||!Tt||Tt>0||ce?.[O.id]?.[y]||(async()=>{try{if(!await oi({roomId:s,uid:y}))return;const P=String(O?.question_type||"").toLowerCase()==="tossup",ne=!!n?.state?.currentBuzzInterrupt,ie=P&&ne?-4:0,Fe=ve()?.displayName||"Player";if(await ln({roomId:s,questionId:O.id,uid:y,displayName:Fe,data:{status:"incorrect",text:"",correct:!1,points:ie}}),ie!==0)try{await cn({roomId:s,uid:y,delta:ie})}catch{}await un({roomId:s,uid:y}),await Ns({roomId:s}),await rt({roomId:s,open:!0})}catch{}})()},[Tt,ce,O?.id,n?.state?.winnerUid,st]);async function rr(){try{x(!0),g(""),await wt({roomId:s,passcode:A});try{window.localStorage.setItem(`mp_pass_ok_${s}`,"1"),n?.passHash&&window.localStorage.setItem(`mp_pass_hash_${s}`,String(n.passHash))}catch{}k(!1)}catch(y){g(y?.message||String(y))}finally{x(!1)}}async function ar(){K("");const y=String(T||"").trim();if(!y||y.length<2){K("Enter a username (min 2 chars)");return}if(l.some(P=>(P.displayName||"").toLowerCase()===y.toLowerCase())){K("Username is taken in this room");return}const _=Ga(y);try{x(!0),await wt({roomId:s,uid:_.uid,displayName:_.displayName}),S(!1)}catch(P){K(P?.message||String(P))}finally{x(!1)}}if(i.loading||!n)return e.jsx("div",{className:"min-h-screen app-radial-bg dark:app-rad-bg transition-colors glass-backdrop",children:e.jsxs(at,{auth:i,children:[e.jsx(ma,{}),e.jsxs("div",{className:"glass p-6 space-y-3 max-w-3xl",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Multiplayer Room"}),e.jsxs("p",{className:"opacity-80 text-sm",children:["Practice Science Bowl together in real time. Rooms support live buzzing, chat, and shared control of question flow. Create a room on the",e.jsx("a",{className:"text-blue-600 hover:underline ml-1",href:"/multiplayer",children:"multiplayer page"})," or join with a code."]}),e.jsxs("ul",{className:"list-disc pl-5 text-sm opacity-80 space-y-1",children:[e.jsx("li",{children:"Host or join private/public rooms"}),e.jsx("li",{children:"Buzz in on toss-ups and type answers"}),e.jsx("li",{children:"Multiple choice and short-answer grading"}),e.jsx("li",{children:"Filters for tournaments, categories, and rounds"})]}),e.jsxs("div",{className:"pt-2",children:[e.jsx("a",{href:"/round-generator",className:"text-blue-600 hover:underline text-sm",children:"Try the Round Generator"}),e.jsx("span",{className:"opacity-60 mx-2",children:"•"}),e.jsx("a",{href:"/buzzer",className:"text-blue-600 hover:underline text-sm",children:"Use the simple buzzer"})]}),e.jsx("div",{className:"pt-3",children:e.jsx(mt,{})})]})]})});const ir=!!ve();if(!i.user&&!ir)return e.jsx("div",{className:"min-h-screen app-radial-bg dark:app-rad-bg transition-colors glass-backdrop",children:e.jsx(at,{auth:i,children:e.jsxs("div",{className:"glass p-6 space-y-3 max-w-md",children:[e.jsx("div",{className:"font-medium",children:"Enter a username to join"}),e.jsx("input",{className:"rounded-lg border border-black/10 dark:border-white/10 px-3 py-2 bg-white dark:bg-darkcard w-full",placeholder:"Username",value:T,onChange:y=>R(y.target.value)}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{className:"btn btn-primary",onClick:ar,disabled:z||!T,children:"Join"}),B&&e.jsx("div",{className:"text-sm text-red-600",children:B})]}),e.jsx("div",{className:"text-xs opacity-70",children:"You can sign in later; your guest slot will be removed automatically."})]})})});async function Vs(){try{q("");const y=_e=>{const le=String(_e||"").trim().toUpperCase();return le&&(le==="PHYSICAL SCIENCE"?"PHYSICS":le==="LIFE SCIENCE"?"BIOLOGY":le==="EARTH AND SPACE SCIENCE"?"EARTH AND SPACE":le==="PHYS"?"PHYSICS":le==="CHEM"?"CHEMISTRY":le)};let E=Me&&Me.length?Me:J.selectedTournaments&&J.selectedTournaments.length?J.selectedTournaments:Be.length?Be:(W.tournaments||[]).slice(0,2);if(!E.length){q("No tournaments loaded yet.");return}await W.ensureLoaded(E);const _=W.getLoadedQuestions(E),P=n?.game?.used&&typeof n.game.used=="object"?n.game.used:{},ne=Pe&&Pe.length?Pe:J.selectedCategories||[],ie=new Set(ne||[]),he=_.filter(_e=>{const le=String(_e.category||"").toUpperCase(),gt=y(le),bt=!ie.size||le&&(ie.has(gt)||ie.has(le)),pe=String(_e.question_type||"").toLowerCase(),fs=me.tossup&&pe==="tossup"||me.bonus&&pe==="bonus",qe=!P[_e.id];return bt&&Vn(_e)&&fs&&qe});if(!me.tossup&&!me.bonus){q("Select at least one type: Toss-up or Bonus");return}if(he.length===0){q("No questions available (all used for current filters).");return}const Fe=he[Math.floor(Math.random()*he.length)];await ii({roomId:s,questionId:Fe.id,tournaments:E}),await mn({roomId:s}),await rt({roomId:s,open:!0}),Ze(null)}catch(y){q(y?.message||String(y))}}async function Qs(){try{if(n?.state?.winnerUid)return;const y=!!n?.state?.buzzerOpen;await rt({roomId:s,open:!y})}catch{}}async function or(y){y?.preventDefault();const E=Ms(O),_=(E||[]).length>0,P=(F||"").trim(),ne=P;if(!ne){Ze({correct:!1,reason:"No answer provided"});return}if(!O)return;const ie=ve(),he=ie?.uid,Fe=ie?.displayName||"Player";he&&n?.state?.winnerUid,await dn({roomId:s,grading:!0});const _e=String(O?.question_type||"").toLowerCase()==="tossup",le=E,gt=String(O?.question||O?.leadin||O?.text||"").trim(),bt=String(O?.answer??(Array.isArray(O?.answers)?O.answers[0]:"")??"").trim();let pe=null;try{if(_e)_?pe=await(await bi({userAnswer:P,correctAnswer:bt,question:gt,choices:le})).json():pe=await(await fn({userAnswer:P,correctAnswer:bt,question:gt})).json();else{const Dt={userAnswer:P,correctAnswer:bt,question:gt,..._?{choices:le}:{}};pe=await(await fn(Dt)).json()}}catch{pe={correct:!1,reason:"Grading failed"}}Ze(pe),w(""),await dn({roomId:s,grading:!1});const fs=!He;let qe=0;_e?qe=pe.correct?4:fs?-4:0:qe=pe.correct?10:0,await ln({roomId:s,questionId:O.id,uid:he,displayName:Fe,data:{status:pe.correct?"correct":"incorrect",text:ne,correct:!!pe.correct,points:qe}}),qe!==0&&await cn({roomId:s,uid:he,delta:qe}),pe.correct?await hn({roomId:s,value:!0}):(await un({roomId:s,uid:he}),await Ns({roomId:s}),await rt({roomId:s,open:!0}))}async function cr(){try{await hn({roomId:s,value:!1}),await Ns({roomId:s}),await mn({roomId:s}),await Vs()}catch{}}return e.jsxs("div",{className:"min-h-screen app-radial-bg dark:app-radial-bg transition-colors glass-backdrop",children:[e.jsx(at,{auth:i,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ni,{room:n,roomId:s,membersCount:l.length,onBack:()=>a("/multiplayer"),members:l,currentQ:O,answersMap:ce}),N&&!ht&&e.jsx(Si,{passPrompt:A,setPassPrompt:b,onJoin:rr,busy:z,error:C}),(!N||ht)&&e.jsxs("div",{className:"grid lg:grid-cols-3 gap-4 items-start",children:[e.jsxs("div",{className:"glass p-6 lg:col-span-2 space-y-4",children:[e.jsx(ki,{onStartNext:Vs,onTogglePause:Qs,isPaused:!n?.state?.buzzerOpen,winnerActive:n?.state?.winnerUid,buzzWindowRemainingMs:xt,showBuzzTimer:!!O&&!!n?.state?.buzzerOpen&&!!n?.state?.choicesFinishedAt&&!n?.state?.winnerUid&&!n?.state?.awaitNext&&xt!==null}),V&&e.jsx("div",{className:"text-sm text-red-600",children:V}),e.jsx(zi,{grading:ns,currentQ:O,words:pt,displayedWordCount:is,plainQuestionText:ds,showBuzzHint:!n?.state?.winnerUid&&n?.state?.buzzerOpen,fullMcChoices:nr,choiceStreamCount:we,resultBanner:Xe}),e.jsx(Ci,{currentQId:O?.id,buzzes:O?Mt[O.id]:[],answersForQ:O?ce?.[O.id]:{},selfUid:L,members:l,typingMap:Et,winnerUid:n?.state?.winnerUid,awaitNext:n?.state?.awaitNext,mcTypedAnswer:F,setMcTypedAnswer:G,onSubmit:or,onUpdateTyping:(y,E)=>Ss(s,y,E),mcInputRef:tt,answerWindowUid:st,answerWindowRemainingMs:Tt}),e.jsx(Ei,{history:$,page:Oe,setPage:ts,pageSize:ss,byId:Ws,buzzesMap:Mt,answersMap:ce,members:l}),C&&e.jsx("div",{className:"text-sm text-red-600",children:C})]}),e.jsxs("div",{className:"glass p-6 space-y-6",children:[e.jsx("div",{className:"flex border-b border-black/10 dark:border-white/10 mb-3",children:["settings","chat"].map(y=>{const E=be===y,_=y==="settings"?"Settings":"Chat";return e.jsxs("button",{className:`relative px-3 py-2 -mb-px border-b-2 text-sm font-medium mr-2 ${E?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent opacity-70 hover:opacity-100"}`,onClick:()=>Ye(y),children:[_,y==="chat"&&!E&&Ge>0&&e.jsx("span",{className:"absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1 rounded-full bg-red-600 text-white text-[10px] leading-[18px] text-center shadow",children:Ge>99?"99+":Ge})]},y)})}),be==="settings"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Selection"}),e.jsx(yi,{tournaments:W.tournaments||[],tournamentGroups:Un,selectedTournaments:Me,setSelectedTournaments:er,tournamentGroupsOpen:$n,setTournamentGroupsOpen:Wn,handleTournamentToggle:Hn,tournamentVisibleEntriesMainRef:Gn,isDark:Xn,showTournamentModal:Qn,setShowTournamentModal:Yn})]}),e.jsx(wi,{categories:qn,selectedCategories:Pe,setSelectedCategories:tr}),e.jsxs("div",{className:"pt-2",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Question Type"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:me.tossup,onChange:y=>Js(E=>({...E,tossup:y.target.checked}))}),"Toss-up"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:me.bonus,onChange:y=>Js(E=>({...E,bonus:y.target.checked}))}),"Bonus"]})]})]}),e.jsx(vi,{selectedTournaments:Me,tournaments:W.tournaments||[],roundRanges:ft,setRoundRanges:sr,roundsByTournament:Jn,globalNumericRoundMax:Kn})]}):e.jsx(Mi,{roomId:s,messages:m,typingMap:Et,selfUid:L,onSendMessage:async y=>{try{await si({roomId:s,text:y})}catch{}},onUpdateTyping:(y,E)=>Ss(s,y,E),disabled:!!(L&&n?.state?.winnerUid===L),inputRef:Is})]})]})]})}),(()=>{const y=n?.state?.lockedOut&&typeof n.state.lockedOut=="object"?n.state.lockedOut:{},E=!!O&&!!n?.state?.buzzerOpen&&!n?.state?.winnerUid&&(!L||!y[L]);return e.jsx("div",{className:"md:hidden fixed bottom-0 inset-x-0 z-40 p-3 pb-[calc(env(safe-area-inset-bottom)+12px)] pointer-events-none",children:e.jsx("div",{className:"max-w-3xl mx-auto pointer-events-auto",children:e.jsx("button",{className:`w-full py-4 rounded-2xl text-white text-lg font-bold shadow-xl active:scale-[0.98] transition ${E?"bg-red-600":"bg-red-300 cursor-not-allowed"}`,onClick:()=>{E&&t()},"aria-label":"Buzz",disabled:!E,children:E?"BUZZ":n?.state?.winnerUid?"BUZZ LOCKED":"BUZZ DISABLED"})})})})()]})}let ks=null,Je={roomId:null,typing:null,draft:null,at:0};async function Ss(t,s,r){const a=Vt(),i=Date.now(),n=r||"",o=!s||n.length===0||i-(Je.at||0)>300||Je.typing!==!!s,c=async()=>{try{const l=ve?.()||null,u=l?.uid,d=l?.displayName||"Player";if(!u)return;const m=Date.now();if(Je.roomId===t&&Je.typing===!!s&&Je.draft===n&&m-(Je.at||0)<120)return;const v=oe(a,`mp/roomMembers/${t}/${u}`);await re(v,{uid:u,displayName:d,typing:!!s,draft:n,lastTypedAt:Date.now()}),Je={roomId:t,typing:!!s,draft:n,at:m}}catch{}};ks&&clearTimeout(ks),o?await c():ks=setTimeout(c,120)}function As({children:t,dark:s,setDark:r,themePref:a,setThemePref:i,userChangedPrefRef:n}){return e.jsxs("div",{className:"min-h-screen app-radial-bg dark:app-radial-bg transition-colors glass-backdrop text-black dark:text-white flex flex-col items-center px-4 py-10",children:[e.jsxs("div",{className:"w-full max-w-md flex items-center justify-between mb-4 gap-2",children:[e.jsxs(Jt,{to:"/round-generator",className:"inline-flex items-center gap-1 text-xs px-3 py-1 rounded-full border border-black/10 dark:border-white/20 hover:bg-black/5 dark:hover:bg-white/10 transition","aria-label":"Back to home",children:[e.jsx("span",{"aria-hidden":"true",className:"-ml-0.5 mr-0.5",children:"←"}),e.jsx(Yr,{size:14,"aria-hidden":"true"}),e.jsx("span",{children:"Home"})]}),e.jsxs("div",{className:"relative inline-flex items-center group",children:[a!=="system"&&e.jsx("button",{type:"button",onClick:()=>{n.current=!0,i("system"),r(Ie("system"))},className:"mr-2 hidden group-hover:inline-flex items-center px-2 py-1 rounded text-xs border border-black/10 dark:border-white/20 bg-white/70 dark:bg-black/40 backdrop-blur-sm text-black dark:text-white hover:bg-white/90 dark:hover:bg-black/60 transition","aria-label":"Follow system theme",title:"Follow system",children:"Follow system"}),e.jsx(An,{checked:s,onChange:o=>{n.current=!0,i(o?"dark":"light"),r(o)}})]})]}),t]})}function Ri(){const t=Ne(),[s,r]=I.useState(""),[a,i]=I.useState(""),[n,o]=I.useState(!1),[c,l]=I.useState(""),[u,d]=I.useState(!1),[m,v]=I.useState(""),[p,z]=I.useState("system"),[x,C]=I.useState(()=>{try{return document.documentElement.classList.contains("dark")}catch{return Ie("system")}}),g=I.useRef(!1);I.useEffect(()=>{let k=!0;return zn().then(M=>{k&&(z(M),C(Ie(M)))}),()=>{k=!1}},[]),I.useEffect(()=>{document.documentElement.classList.toggle("dark",x),x?document.body.classList.add("dark-bg"):document.body.classList.remove("dark-bg");let k=document.querySelector('meta[name="theme-color"]');k||(k=document.createElement("meta"),k.name="theme-color",document.head.appendChild(k)),k.setAttribute("content",x?"#000000":"#ffffff")},[x]),I.useEffect(()=>{g.current&&Cn(p)},[p]),I.useEffect(()=>{if(p!=="system")return;C(Ie("system"));const k=En(M=>{C(!!M)});return()=>k&&k()},[p]);const j=/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(s),w=a.length>=10,A=async()=>{if(l(""),!j){l("Enter a valid email.");return}if(!w){l("Password must be at least 10 characters.");return}o(!0);try{await t.loginWithEmail(s,a)}catch(k){const M=k?.code||"";l(M==="auth/invalid-credential"||M==="auth/wrong-password"||M==="auth/user-not-found"?"Wrong email or password.":M==="auth/too-many-requests"?"Too many attempts. Try again later.":M==="auth/invalid-email"?"Enter a valid email.":k?.message||"Login failed.")}finally{o(!1)}},b=async()=>{if(l(""),!j){l("Enter a valid email.");return}if(!w){l("Password isn’t safe. Use at least 10 characters.");return}o(!0);try{await t.signupWithEmail(s,a)}catch(k){const M=k?.code||"";l(M==="auth/email-already-in-use"?"That email already exists. Try signing in.":M==="auth/weak-password"?"Password isn’t safe. Use at least 10 characters.":M==="auth/invalid-email"?"Enter a valid email.":k?.message||"Sign up failed.")}finally{o(!1)}},N=async()=>{l(""),o(!0);try{await t.loginWithGoogle()}catch(k){const M=k?.code||"";l(M==="auth/popup-closed-by-user"?"Sign-in was canceled.":M==="auth/cancelled-popup-request"?"Another sign-in is already in progress.":k?.message||"Google sign-in failed.")}finally{o(!1)}};return t.user?e.jsx(As,{dark:x,setDark:C,themePref:p,setThemePref:z,userChangedPrefRef:g,children:e.jsxs("div",{className:"mx-auto w-full max-w-md p-6 glass space-y-4",children:[e.jsxs("div",{className:"mb-3",children:["You’re signed in as ",e.jsx("strong",{children:t.user.email||t.user.displayName}),"."]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("a",{href:"/",className:"btn btn-primary",children:"Go to app"}),e.jsx("button",{className:"btn btn-ghost",onClick:t.logout,children:"Logout"})]})]})}):u?e.jsx(As,{dark:x,setDark:C,themePref:p,setThemePref:z,userChangedPrefRef:g,children:e.jsxs("div",{className:"mx-auto w-full max-w-md p-6 glass space-y-4 flex flex-col items-center",children:[e.jsx("h1",{className:"text-xl font-semibold gradient-text",children:"Reset password"}),m&&e.jsx("div",{className:"rounded-lg border border-green-300/60 bg-green-50 text-green-800 dark:bg-green-900/20 dark:text-green-200 dark:border-green-400/40 px-3 py-2 text-sm",children:m}),c&&e.jsx("div",{className:"rounded-lg border border-red-300/60 bg-red-50 text-red-800 dark:bg-red-900/20 dark:text-red-200 dark:border-red-400/40 px-3 py-2 text-sm",children:c}),e.jsx("input",{className:"w-full rounded-lg border border-black/10 bg-white dark:bg-darkcard text-black dark:text-white px-2 py-2",placeholder:"Enter your email",type:"email",autoComplete:"email",value:s,onChange:k=>r(k.target.value)}),e.jsxs("div",{className:"flex flex-col items-center gap-2 w-full mt-2",children:[e.jsxs("button",{className:"btn btn-primary flex items-center justify-center gap-2 w-full",disabled:n||!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(s),onClick:async()=>{l(""),v(""),o(!0);try{await gr(je(),s),v("Password reset email sent, if you have an account with us! Check your inbox.")}catch(k){k?.code==="auth/user-not-found"?l("No account found for that email."):k?.code==="auth/invalid-email"?l("Enter a valid email."):l(k?.message||"Failed to send reset email.")}finally{o(!1)}},children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M22 2L11 13"}),e.jsx("path",{d:"M22 2l-7 20-4-9-9-4 20-7z"})]}),"Send reset email"]}),e.jsxs("button",{className:"btn btn-ghost flex items-center justify-center gap-2 w-full",onClick:()=>{d(!1),l(""),v("")},children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back"]})]})]})}):e.jsx(As,{dark:x,setDark:C,themePref:p,setThemePref:z,userChangedPrefRef:g,children:e.jsxs("div",{className:"mx-auto w-full max-w-md p-6 glass mt-0 space-y-4 flex flex-col items-center",children:[e.jsx(da,{}),e.jsx("h1",{className:"text-xl font-semibold gradient-text",children:"Sign in"}),c&&e.jsx("div",{className:"rounded-lg border border-red-300/60 bg-red-50 text-red-800 dark:bg-red-900/20 dark:text-red-200 dark:border-red-400/40 px-3 py-2 text-sm",role:"alert","aria-live":"polite",children:c}),e.jsxs("button",{className:"btn btn-google w-full bg-white text-[#1f1f1f] border border-black/10 hover:bg-white/90 dark:bg-white dark:text-[#1f1f1f] dark:hover:bg-white/90 flex items-center justify-center text-base",style:{maxWidth:320,minHeight:48,paddingTop:8,paddingBottom:8},disabled:n,onClick:N,children:[e.jsx("span",{className:"google-icon",style:{width:28,height:28,marginRight:14,display:"flex",alignItems:"center",justifyContent:"center"},"aria-hidden":!0}),e.jsx("span",{style:{lineHeight:"28px"},children:"Sign in with Google"})]}),e.jsx("div",{className:"text-center opacity-60 text-sm",children:"or"}),e.jsx("input",{className:"w-full rounded-lg border border-black/10 bg-white dark:bg-darkcard text-black dark:text-white px-2 py-2",placeholder:"email",type:"email",autoComplete:"email",value:s,onChange:k=>r(k.target.value)}),e.jsx("input",{className:"w-full rounded-lg border border-black/10 bg-white dark:bg-darkcard text-black dark:text-white px-2 py-2",placeholder:"password",type:"password",autoComplete:"current-password",value:a,onChange:k=>i(k.target.value)}),e.jsxs("div",{className:"flex flex-col w-full mt-2 gap-2 items-center",children:[e.jsxs("div",{className:"flex gap-2 w-full justify-center",children:[e.jsxs("button",{className:"btn btn-fancy flex items-center justify-center gap-2 text-sm font-medium",disabled:n,onClick:A,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 12h14M12 5l7 7-7 7"})}),"Login"]}),e.jsxs("button",{className:"btn btn-orange flex items-center justify-center gap-2 text-sm font-medium hover-lift",disabled:n,onClick:b,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Sign up"]})]}),e.jsx("button",{className:"text-xs text-red-500 hover:underline focus:underline font-normal w-full mt-2 flex items-center justify-center gap-1 bg-transparent border-none p-0",type:"button",style:{cursor:"pointer"},onClick:()=>{d(!0),l(""),v("")},children:"Forgot password?"})]})]})})}const Ti=Ar([{path:"/",element:e.jsx(Ea,{})},{path:"/round-generator",element:e.jsx(js,{})},{path:"/practice",element:e.jsx(js,{})},{path:"/admin",element:e.jsx(js,{})},{path:"/signin",element:e.jsx(Ri,{})},{path:"/buzzer",element:e.jsx(Oa,{})},{path:"/buzzer/:code",element:e.jsx(La,{})},{path:"/buzzer/:code/generate",element:e.jsx(Fa,{})},{path:"/buzzer/:code/round",element:e.jsx($a,{})},{path:"/multiplayer",element:e.jsx(fi,{})},{path:"/multiplayer/:roomId",element:e.jsx(_i,{})},{path:"*",element:e.jsx(Mr,{to:"/",replace:!0})}]);lr.createRoot(document.getElementById("root")).render(e.jsx(I.StrictMode,{children:e.jsx(Sr,{children:e.jsx(ya,{children:e.jsx(zr,{router:Ti})})})}));export{wi as C,Ue as L,vi as R,yi as T,Mn as a,fn as b,bi as c,mt as d,To as e,Wo as f,Y as g,Fo as h,Mo as i,Ro as j,Lo as k,Oo as l,_o as m,Sn as n,Go as o,Ms as p,$o as q,Do as r,Bo as s,Uo as t,ji as u,Po as v,Io as w,Eo as x,Ho as y,Co as z};
